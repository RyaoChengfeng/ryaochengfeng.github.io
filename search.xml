<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>图片文件结构与PNG编码</title>
      <link href="/2022/3/7cad8c576e96/"/>
      <url>/2022/3/7cad8c576e96/</url>
      
        <content type="html"><![CDATA[<h1 id="图片文件结构与PNG编码"><a href="#图片文件结构与PNG编码" class="headerlink" title="图片文件结构与PNG编码"></a>图片文件结构与PNG编码</h1><h2 id="图像存储"><a href="#图像存储" class="headerlink" title="图像存储"></a>图像存储</h2><h3 id="颜色在计算机的存储"><a href="#颜色在计算机的存储" class="headerlink" title="颜色在计算机的存储"></a>颜色在计算机的存储</h3><ul><li><strong>颜色模式</strong></li></ul><p><strong>RGB色彩模式</strong>是颜色模式之一（除此之外还有YUV模式和CMYK模式等等）</p><blockquote><p>在实际的开发中，我们可能还会遇到RGBA模式，其中的A代表的是alpha通道，一般表示透明度，值从0%-100%，0-表示完全透明，100-表示完全不透明。</p></blockquote><p>RGB（255, 128, 196）：有3个颜色分量，分别是R的值255，G的值128，B的值196，这三个分量分别用了8位存储。咱们前面提到过8位存储，可以存储256个值。</p><p>关于RGB的颜色表示还有一种16进制表示方式，比如刚才的RGB（255,128,196）换算成16进制为#FF80C4</p><ul><li><strong>像素</strong></li></ul><p>每一个像素都有一个明确的位置和被分配的色彩值</p><ul><li><strong>分辨率（Resolution）</strong></li></ul><p>又称解析度，可以细分为显示分辨率、图像分辨率、打印分辨率和扫描分辨率。</p><p>显示分辨率：分辨率 4000x3000</p><p>图像分辨率: 常用单位，dpi（点每英寸），ppi（像素每英寸）。1英寸&#x3D;2.54厘米(cm)，它的实质是描述了图像的真实大小。比如“水平分辨率 72dpi”</p><ul><li><strong>图像文件格式</strong></li></ul><p><strong>BMP（Bitmap）</strong>：是Windows操作系统中的标准图像文件格式，采用位映射存储格式，无压缩，BMP文件的图像深度可选1、4、8、24位。BMP最大的特点就是<strong>没有压缩</strong>（所以它的图像大小你可以直接算出来）</p><p><strong>JPEG</strong>：<strong>联合图像专家小组</strong>（Joint Photographic Experts Group，<strong>JPEG</strong>）是一种针对图像的有损压缩标准方法。使用的一种失真压缩标准方法，24 bit真彩色，不支持动画、不支持透明色。</p><p><strong>PNG</strong>：<strong>便携式网络图形</strong>（Portable Network Graphics，<strong>PNG</strong>）是一种无损压缩的位图图形格式格式是无损（不失真）数据压缩的，PNG格式有8位、24位、32位三种形式，其中8位PNG支持两种不同的透明形式（索引透明和alpha透明）。</p><p><strong>GIF</strong>：<strong>图像互换格式</strong>（Graphics Interchange Format，<strong>GIF</strong>）是一种无损压缩的位图图形格式，采取8位色重现图像。</p><h3 id="图片的基本概念"><a href="#图片的基本概念" class="headerlink" title="图片的基本概念"></a>图片的基本概念</h3><ul><li><strong>位图（Bitmap）</strong></li></ul><p>又叫格栅图或者点阵图，是利用像素阵列来表示的图像。位图的每个像素都被分配了特定的位置和颜色值，颜色值可以由RGB组合或者灰度值表示。</p><ul><li><strong>位深度（Bit Depth）</strong></li></ul><p>每个像素用来表示颜色信息的位数，位深度越大，颜色越逼真，占用空间也就越大。例如，位深度为1的位图的像素只能为黑色或者白色，位深度为8的图像像素有2^8^（即256）个可能的颜色值。</p><ul><li><strong>颜色通道</strong></li></ul><p>RGB图像的像素由红绿蓝三个颜色通道组成，8<strong>位&#x2F;通道</strong>的图像中，每个通道有256个可能值，因此每个像素有24位可能的值，通常将24位RGB位图成为真色彩位图。</p><blockquote><p>色深度与位深度</p><p>色深度：一个颜色通道的位数，单位为 位&#x2F;通道 。常有8bit、10bit</p><p>位深度：一个像素的位数</p></blockquote><ul><li><strong>Alpha通道</strong></li></ul><p>在原有的图片编码基础上，添加像素的透明度信息，因为通常把RGB三种颜色信息分别成为三种颜色的通道，所以透明度信息也成为Alpha通道。</p><ul><li><strong>矢量图（Vector）</strong></li></ul><p>用点、直线或者多边形等基于数学方程的几何图形表示的图像。</p><blockquote><p><strong>位图与矢量图</strong></p><p>位图的放大实际上是每个像素的放大，单个像素的放大会使线条和形状参差不齐，导致我们看到的图片“模糊不清晰”。而矢量图通过路径和颜色来记录图片信息，放大之后并不会失真。</p><p>位图处理已经标准化，并且硬编码到显卡内，GPU能够处理位图。但矢量图的处理只能依靠CPU。</p></blockquote><h2 id="PNG编码与解码"><a href="#PNG编码与解码" class="headerlink" title="PNG编码与解码"></a>PNG编码与解码</h2><h3 id="PNG文件结构"><a href="#PNG文件结构" class="headerlink" title="PNG文件结构"></a>PNG文件结构</h3><p>PNG图像格式文件由文件署名和数据块(chunk)组成。</p><h4 id="文件署名域（Signature）"><a href="#文件署名域（Signature）" class="headerlink" title="文件署名域（Signature）"></a>文件署名域（Signature）</h4><p>一张 PNG 图片二进制数据的开头必须是这 8 字节:</p><p><code>0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a</code> 转换为 10 进制是 <code>137, 80, 78, 71, 13, 10, 26, 10</code>。</p><p>（Linux下我们可以用file命令直接查看文件的实际格式，但是他本质上也是利用文件头标志来进行文件类型判断的。）</p><h4 id="数据块（Chunks）"><a href="#数据块（Chunks）" class="headerlink" title="数据块（Chunks）"></a>数据块（Chunks）</h4><p>有两种类型的数据块，一种是称为<strong>关键数据块</strong>(critical chunk)；另一种叫做<strong>辅助数据块</strong>(ancillary chunks)。</p><p>每个数据块都包含图片的描述信息，数据块由四个部分组成：</p><table><thead><tr><th>名称</th><th>长度</th><th>说明</th></tr></thead><tbody><tr><td>Length</td><td>4 bytes</td><td>指定 <strong>Chunk Data</strong> 的长度</td></tr><tr><td>Chunk Type</td><td>4 bytes</td><td>指定数据块类型</td></tr><tr><td>Chunk Data</td><td>可变</td><td>按照Chunk Type存放指定数据</td></tr><tr><td>CRC</td><td>4 bytes</td><td>检查是否有错误的循环冗余代码</td></tr></tbody></table><p>这里要注意 Length 保存的是该数据块中 Chunk Data 的长度，也就是说，一个数据块的长度应该为 Length 的值加上12 bytes。</p><p>Chunk Type 由4个字符组成，：第一个字符是否大写（critical），决定了该数据块是否是关键（critical）数据块；第二个字符大写表示公开，小写表示私有；第三个字符规定必须大写；第四个字符大写则表示只能在关键数据块不变时被复制，小写则表示任何情况下能复制。</p><h4 id="关键数据块"><a href="#关键数据块" class="headerlink" title="关键数据块"></a>关键数据块</h4><p>关键数据块定义了4个标准数据块，每个PNG文件都必须包含它们。</p><p>1、<strong>文件头数据块IHDR(header chunk)</strong></p><p>包含有PNG文件中存储的图像数据的基本信息，并要作为<strong>第一个数据块</strong>出现在PNG数据流中，而且一个PNG数据流中只能有一个文件头数据块。它用13个字节按照顺序来表示图像数据的基本信息：</p><table><thead><tr><th>域的名称</th><th>长度</th><th>说明</th></tr></thead><tbody><tr><td>Width</td><td>4 bytes</td><td>图片宽度，以像素为单位</td></tr><tr><td>Height</td><td>4 bytes</td><td>图片高度，以像素为单位</td></tr><tr><td>Bit Depth</td><td>1 byte</td><td>图像深度</td></tr><tr><td>Color Type</td><td>1 byte</td><td>颜色类型</td></tr><tr><td>Compression Method</td><td>1 byte</td><td>压缩算法</td></tr><tr><td>Filter Method</td><td>1 byte</td><td>滤波方法</td></tr><tr><td>Interlace Method</td><td>1 byte</td><td>扫描方法</td></tr></tbody></table><ul><li><code>Bit Depth</code>代表图像深度。索引彩色图像：1，2，4或8；灰度图像：1，2，4，8或16；真彩色图像：8或16；</li><li><code>Color Type</code>（颜色类型）PNG 图片一共有 5 种色彩类型，<code>0</code> 代表灰度颜色，<code>2</code> 代表用 RGB 表示颜色，即 <code>(R, G, B)</code>，<code>3</code> 代表用色板表示颜色，<code>4</code> 代表灰度和透明度来表示颜色，<code>6</code> 代表用 RGB 和透明度表示颜色，即 <code>(R, G, B, A)</code>。色板的色彩类型里，每个像素是由 1 个色彩通道表示的。</li><li><code>Co2,mpression Method</code> 代表了压缩算法。目前只支持 <code>0</code>，表示 <strong>deflate&#x2F;inflate</strong>。（<strong>Deflate&#x2F;inflate</strong> 是一种结合了 LZ77 和霍夫曼编码的无损压缩算法，被广泛运用于 <code>7-zip</code>，<code>zlib</code>，<code>gzip</code> 等场景。）</li><li><code>Filter Method</code> 代表在压缩前应用的过滤函数类型，目前只支持 <code>0</code>。过滤函数类型 <code>0</code> 里面包括了 5 种过滤函数。</li><li><code>Interlace Method</code> 代表图片数据是否经过交错，<code>0</code> 代表非隔行扫描，<code>1</code> 代表 Adam7。</li></ul><p>2、<strong>调色板数据块PLTE(palette chunk)</strong></p><p>它包含有与索引彩色图像(indexed-color image)相关的彩色变换数据，它仅与索引彩色图像有关，如果存在，要放在图像数据块(image data chunk)之前。真彩色的PNG数据流也可以有调色板数据块，目的是便于非真彩色显示程序用它来量化图像数据，从而显示该图像。结构如下：</p><table><thead><tr><th align="center">颜色</th><th align="center">字节</th><th align="center">意义</th></tr></thead><tbody><tr><td align="center">Red</td><td align="center">1 byte</td><td align="center">0 &#x3D; 黑色, 255 &#x3D; 红</td></tr><tr><td align="center">Green</td><td align="center">1 byte</td><td align="center">0 &#x3D; 黑色, 255 &#x3D; 绿色</td></tr><tr><td align="center">Blue</td><td align="center">1 byte</td><td align="center">0 &#x3D; 黑色, 255 &#x3D; 蓝色</td></tr></tbody></table><p>PLTE数据块是定义图像的palette信息，PLTE可以包含1~256个palette信息，每一个palette信息由3个字节组成，因此palette数据块所包含的最大字节数为768，palette的长度应该是3的倍数，否则，这将是一个非法的palette。</p><p>对于索引图像，palette信息是必须的，palette的颜色索引从0开始编号，然后是1、2……，palette的颜色数不能超过色深中规定的颜色数（如图像色深为4的时候，调色板中的颜色数不可以超过2^4&#x3D;16），否则，这将导致PNG图像不合法。</p><p>3、<strong>图像数据块IDAT(image data chunk)</strong></p><p>存储实际的图片数据，一个图片数据流可能包含多个连续顺序的 IDAT 数据块。创建 IDAT 数据块的步骤：</p><ol><li>将扫描获得的图片信息及其大小储存，具体的图片信息和大小规则在 IHDR 中保存</li><li>采取 IHDR 指定的过滤方法，对图像数据进行过滤。目前只有定义了method 0</li><li>采取 IHDR 指定的压缩方法，对过滤的数据进行压缩</li></ol><p>如果想要读取图片信息，将上面三个步骤逆序执行即可。</p><p>4、<strong>图像结束数据IEND(image trailer chunk)</strong></p><p>它用来标记PNG文件或者数据流已经结束，并且必须要放在文件的尾部。</p><p>如果我们仔细观察PNG文件，我们会发现，文件的结尾12个字符看起来总应该是这样的：</p><p><code>00 00 00 00 49 45 4E 44 AE 42 60 82</code></p><p>不难明白，由于数据块结构的定义，IEND数据块的长度总是0（<code>00 00 00 00</code>，除非人为加入信息），数据标识总是IEND（<code>49 45 4E 44</code>），因此，CRC码也总是<code>AE 42 60 82</code>。</p><blockquote><p>表示数据块开始的IHDR必须放在最前面， 表示PNG文件结束的IEND数据块放在最后面，其他数据块的存放顺序没有限制。</p></blockquote><h4 id="辅助数据块"><a href="#辅助数据块" class="headerlink" title="辅助数据块"></a>辅助数据块</h4><p><del>（cv查表）</del></p><table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td>bKGD</td><td>指定默认的背景颜色</td></tr><tr><td>cHRM</td><td>校准色度</td></tr><tr><td>dSIG</td><td>数字签名</td></tr><tr><td>eXIf</td><td><a href="https://en.wikipedia.org/wiki/Exif">Exif</a> metadata 信息</td></tr><tr><td>gAMA</td><td>指定亮度的伽马校准值2,</td></tr><tr><td>hIST</td><td>色彩直方图，估算颜色的使用频率</td></tr><tr><td>iCCP</td><td><a href="https://en.wikipedia.org/wiki/ICC_color_profile">ICC color profile</a></td></tr><tr><td>iTXt</td><td>以键值对方式存储可能的压缩文本和翻译信息</td></tr><tr><td>pHYs</td><td>指定像素大小或图片比例</td></tr><tr><td>sBIT</td><td>除了指定位深度（8，16 等等）外，保存原始数据以便恢复</td></tr><tr><td>sPLT</td><td>提出建议使用的调色板，可能有多个</td></tr><tr><td>sRGB</td><td>指明是否使用<a href="https://en.wikipedia.org/wiki/SRGB_color_space">sRGB color space</a></td></tr><tr><td>sTER</td><td>储存立体视图（<a href="https://en.wikipedia.org/wiki/Stereoscopic">stereoscopic</a>）的相关信息，</td></tr><tr><td>tEXt</td><td>保存作者等键值对的文本信息</td></tr><tr><td>tIME</td><td>上次修改时间</td></tr><tr><td>tRNS</td><td>保存透明信息，分为不透明、全透明、Alpha</td></tr><tr><td>zTXt</td><td>保存压缩后的文本信息以及对应的压缩方式标识</td></tr></tbody></table><h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><p>PNG的压缩分为两个步骤：预解析（过滤）和压缩</p><h4 id="隔行扫描"><a href="#隔行扫描" class="headerlink" title="隔行扫描"></a>隔行扫描</h4><p>隔行扫描（Interlacing），也称交错扫描（interleaving），是一种位图编码的方式，编码时不严格按照相邻行进行。当连接速度比较慢时，采用隔行扫描的图片可以渐进地进行显示，即先显示较为模糊的版本，然后逐渐变清晰。如图：</p><p><img src="https://s2.loli.net/2022/03/20/B9WKPpsaQCYm5ET.gif" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/B9WKPpsaQCYm5ET.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>我们常用的 GIF、PNG、JPEG 都采用了隔行扫描的方式，其中 PNG 采取的是二维、七通道的<a href="https://en.wikipedia.org/wiki/Adam7_algorithm">Adam7</a>，二维表示扫描支持竖直和水平方向，7代表一张图片会被拆分为7个子图片。</p><p><img src="https://s2.loli.net/2022/03/20/Bbh9eNTzyOmtdsv.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/Bbh9eNTzyOmtdsv.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20190819143548.png"></p><p>和 GIF 采取的一维、四通道算法相比，PNG 在网速相同的情况下，尤其是网速较慢时，能够更快地显示出图片的基本外貌。</p><h4 id="Filter（过滤）"><a href="#Filter（过滤）" class="headerlink" title="Filter（过滤）"></a>Filter（过滤）</h4><p>PNG编码使用差分对原始像素数据进行Filter，该过程无任何压缩损失，并且完全可逆。对图像来说，存储残差所需的比特远远小于实际图像所需，这也是差分编码的收益来源</p><ul><li><strong>差分编码</strong></li></ul><p>[2,3,4,5,6,7,8]会变成[2,1,1,1,1,1,1]，其中 [2, 3-2&#x3D;1, 4-3&#x3D;1, 5-4&#x3D;1, 6-5&#x3D;1, 7-6&#x3D;1, 8-7&#x3D;1]</p><p>如果数据是线性相关的(也就是说，值与前一个值有一些很小的差异)，那么最终会将数据集的值转换为大量重复的小值，这些小值更容易被压缩。 PNG文件格式使用称为“filtering”的delta编码格式。基本上，对于每一个像素扫描线，当前像素都是按照与左边像素、上面像素和上面左侧像素的某种关系进行编码的。</p><p>对于不同的内容，须使用不同的Filter类型来提升压缩收益，<strong>过滤的重点</strong>是将大多数转换后的字节将聚集在零附近，从而为压缩引擎提供更小、更可预测的字节值范围来处理。</p><p>为了便于描述，规定了<code>相邻像素</code>相对<code>当前像素</code>的方位：左（A）、上（B）、左上（C）。</p><table><thead><tr><th>C</th><th>B</th></tr></thead><tbody><tr><td>A</td><td>X</td></tr></tbody></table><p>上文提到的 5 种过滤函数为：</p><table><thead><tr><th>过滤类型</th><th>存储值(O)&#x3D;实际值(X)-预测值(R)</th></tr></thead><tbody><tr><td>0</td><td>O &#x3D; X</td></tr><tr><td>1</td><td>O &#x3D; X - A</td></tr><tr><td>2</td><td>O &#x3D; X - B</td></tr><tr><td>3</td><td>O &#x3D; X - (A+B)&#x2F;2</td></tr><tr><td>4</td><td>Peath(A,B,C)</td></tr></tbody></table><p>Peath(A,B,C): Paeth预测器(A,B,C的线性函数)</p><p>Peath具体计算为 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">base = <span class="title class_">AboveRow</span>[j] + <span class="title class_">LeftCol</span>[i] – <span class="title class_">AboveRow</span>[-<span class="number">1</span>]</span><br><span class="line">pLeft = <span class="title class_">Abs</span>(base – <span class="title class_">LeftCol</span>[i])           <span class="comment">// abs(A-C)</span></span><br><span class="line">pTop = <span class="title class_">Abs</span>(base – <span class="title class_">AboveRow</span>[j])     <span class="comment">// abs(L-C)</span></span><br><span class="line">pTopLeft = <span class="title class_">Abs</span>(base – <span class="title class_">AboveRow</span>[-<span class="number">1</span>])    <span class="comment">// abs(A+L-2*C)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pLeft &lt;= pTop &amp;&amp; pLeft &lt;= pTopLeft)</span><br><span class="line">    pred[i][j] = <span class="title class_">LeftCol</span>[i]                   <span class="comment">// 使用左边参考像素值</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(pTop &lt;= pTopLeft)</span><br><span class="line">    pred[i][j] = <span class="title class_">AboveRow</span>[j]             <span class="comment">// 使用上方参考像素值</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    pred[i][j] = <span class="title class_">AboveRow</span>[-<span class="number">1</span>]           <span class="comment">// 若上方与左边均判断为不存在边界的情况，则使用左上方的值</span></span><br></pre></td></tr></table></figure><blockquote><p>选择合适的过滤器？</p><p>没有。每一行进行增量测试压缩，保存最小的结果，然后对下一行重复，对于20行的图像相当于对整个图像进行五次过滤和压缩。对于将被传输和解码多次的图像来说，这可能是一个合理的权衡。</p><p>过滤器也很少用于低位深度（灰度）图像，尽管在极少数情况下将此类图像提升到 8 位然后过滤是有效的。但是，一般来说，过滤器类型 None 是最好的。</p></blockquote><blockquote><p>一些接近最优的经验法则：比如对调色板图像以及低于8位的灰度图像不使用过滤器；对于其他的图像，选择最小化绝对差和的滤波器；不是使用256模除(%)，而是使用标准的带符号数学，然后获取abs值，并将它们全部添加到给定行中，然后比较其他筛选器类型的和，选择给出最小和的过滤器。</p></blockquote><h4 id="Deflate"><a href="#Deflate" class="headerlink" title="Deflate"></a>Deflate</h4><p>正式的压缩阶段使用 <a href="https://en.wikipedia.org/wiki/DEFLATE">Deflate</a> 进行压缩，它由 Huffman 编码 和 LZ77 压缩构成。Deflate是一种压缩数据流的算法，任何需要流式压缩的地方都可以用（<del><em>但我并没有去了解它具体的实现，所以就略过吧</em></del>）</p><h3 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h3><p>（图片和数据均来自<a href="https://vivaxyblog.github.io/2019/12/07/decode-a-png-image-with-javascript-cn.html">一步一步解码 PNG 图片</a>）</p><p><img src="https://s2.loli.net/2022/03/20/6yXKjOHpoZGJfrz.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/6yXKjOHpoZGJfrz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="示例图片"></p><p>👆 这是一张我们接下去要解码的图片，但它太小了，放大了展示给大家看下。👇</p><p><img src="https://s2.loli.net/2022/03/20/zG9QE6Za1AUiDVu.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/zG9QE6Za1AUiDVu.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>二进制数据如下</p><table><thead><tr><th></th><th>0 ~ 3</th><th>4 ~ 7</th><th>8 ~ 11</th><th>12 ~ 15</th></tr></thead><tbody><tr><td>0 ~ 15</td><td><code>137, 80, 78, 71</code></td><td><code>13, 10, 26, 10</code></td><td><code>0, 0, 0, 13</code></td><td><code>73, 72, 68, 82</code></td></tr><tr><td>16 ~ 31</td><td><code>0, 0, 0, 2</code></td><td><code>0, 0, 0, 2</code></td><td><code>2, 3, 0, 0</code></td><td><code>0, 15, 216, 229</code></td></tr><tr><td>32 ~ 47</td><td><code>183, 0, 0, 0</code></td><td><code>1, 115, 82, 71</code></td><td><code>66, 1, 217, 201</code></td><td><code>44, 127, 0, 0</code></td></tr><tr><td>48 ~ 63</td><td><code>0, 9, 112, 72</code></td><td><code>89, 115, 0, 0</code></td><td><code>11, 19, 0, 0</code></td><td><code>11, 19, 1, 0</code></td></tr><tr><td>64 ~ 79</td><td><code>154, 156, 24, 0</code></td><td><code>0, 0, 12, 80</code></td><td><code>76, 84, 69, 255</code></td><td><code>0, 0, 0, 255</code></td></tr><tr><td>80 ~ 95</td><td><code>0, 0, 0, 255</code></td><td><code>255, 255, 255, 251</code></td><td><code>0, 96, 246, 0</code></td><td><code>0, 0, 4, 116</code></td></tr><tr><td>96 ~ 111</td><td><code>82, 78, 83, 255</code></td><td><code>255, 255, 127, 128</code></td><td><code>144, 197, 89, 0</code></td><td><code>0, 0, 12, 73</code></td></tr><tr><td>112 ~ 127</td><td><code>68, 65, 84, 120</code></td><td><code>156, 99, 16, 96</code></td><td><code>216, 0, 0, 0</code></td><td><code>228, 0, 193, 39</code></td></tr><tr><td>128 ~ 143</td><td><code>168, 232, 87, 0</code></td><td><code>0, 0, 0, 73</code></td><td><code>69, 78, 68, 174</code></td><td><code>66, 96, 130</code></td></tr></tbody></table><p>每个表格的单元格内有 4 字节数据，每个字节由 8 位组成，1 位代表的是 <code>0</code> 或者 <code>1</code> 的一个数字。</p><ul><li><strong>签名部分</strong></li></ul><table><thead><tr><th>0 ~ 3</th><th>4 ~ 7</th></tr></thead><tbody><tr><td><code>137, 80, 78, 71</code></td><td><code>13, 10, 26, 10</code></td></tr><tr><td><code>0x89, 0x50, 0x4e, 0x47</code></td><td><code>0x0d, 0x0a, 0x1a, 0x0a</code></td></tr></tbody></table><p>这张图片的前 8 个字节满足PNG签名的要求。</p><ul><li><strong>文件头数据块部分</strong></li></ul><table><thead><tr><th>8 ~ 11</th><th>12 ~ 15</th></tr></thead><tbody><tr><td><code>0, 0, 0, 13</code></td><td><code>73, 72, 68, 82</code></td></tr><tr><td>长度</td><td>类型</td></tr><tr><td><code>13</code></td><td><code>IHDR</code></td></tr></tbody></table><table><thead><tr><th>16 ~ 19</th><th>20 ~ 23</th><th>24 ~ 27</th><th>28</th></tr></thead><tbody><tr><td><code>0, 0, 0, 2</code></td><td><code>0, 0, 0, 2</code></td><td><code>2, 3, 0, 0</code></td><td><code>0</code></td></tr><tr><td><code>width</code></td><td><code>height</code></td><td><code>depth</code>, <code>colorType</code>, <code>compression</code>, <code>filter</code></td><td><code>interlace</code></td></tr><tr><td><code>2</code></td><td><code>2</code></td><td><code>2, 3, 0, 0</code></td><td><code>0</code></td></tr></tbody></table><table><thead><tr><th>29 ~ 32</th></tr></thead><tbody><tr><td><code>15, 216, 229, 183</code></td></tr><tr><td>CRC32 校验和</td></tr></tbody></table><ul><li><strong>PLTE部分</strong></li></ul><table><thead><tr><th>75 ~ 78</th><th>79 ~ 82</th><th>83 ~ 86</th></tr></thead><tbody><tr><td><code>255, 0, 0, 0</code></td><td><code>255, 0, 0, 0</code></td><td><code>255, 255, 255, 255</code></td></tr></tbody></table><p>色板中包含的数据是 RGB 数据，以 <code>R, G, B</code> 的形式保存，这里一共 12 字节，表示了 4 个色块。得到的色板信息如下：</p><p><strong>色板</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[255, 0, 0], [0, 255, 0], [0, 0, 255], [255, 255, 255]]</span><br></pre></td></tr></table></figure><ul><li><strong>tRNS部分</strong></li></ul><table><thead><tr><th>99 ~ 102</th></tr></thead><tbody><tr><td><code>255, 255, 255, 127</code></td></tr></tbody></table><p>这个数据块为色板提供透明信息，每个字节表示一个色块的透明信息。与色板组合后的色板如下：</p><p><strong>色板</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[255, 0, 0, 255], [0, 255, 0, 255], [0, 0, 255, 255], [255, 255, 255, 127]]</span><br></pre></td></tr></table></figure><ul><li><strong>IDAT部分</strong></li></ul><p>我们重点关注图像数据块的解码部分。</p><table><thead><tr><th>107 ~ 110</th><th>111 ~ 114</th></tr></thead><tbody><tr><td><code>0, 0, 0, 12</code></td><td><code>73, 68, 65, 84</code></td></tr><tr><td>长度</td><td>类型</td></tr><tr><td><code>12</code></td><td><code>IDAT</code></td></tr></tbody></table><p>声明 12 字节的 <code>IDAT</code>像素数据</p><table><thead><tr><th>115 ~ 118</th><th>119 ~ 122</th><th>123 ~ 126</th></tr></thead><tbody><tr><td><code>120, 156, 99, 16</code></td><td><code>96, 216, 0, 0</code></td><td><code>0, 228, 0, 193</code></td></tr></tbody></table><p>所有行的像素数据会经过 deflate 压缩算法压缩。所以，需要对这里的像素数据解压，这里直接使用了 <code>zlib.inflate()</code> 函数。</p><p>解压出来的像素数据是 Uint8Array：<code>0, 16, 0, 176</code>。</p><p><strong>扫描线 Scanline</strong> </p><p>一根扫描线包含图片一行像素的数据。我们知道这张图片的高度是 2，也就是像素数据中有 2 行扫描线。</p><p>一根扫描线由 1 字节的过滤函数标记和像素信息组成。像素信息一个接一个地排列，中间没有多余的空位。如果扫描线长度不足以填满字节的位数，最后几位会被补齐。一根扫描线的结构如下：</p><table><thead><tr><th>过滤函数</th><th>像素…[补齐…]</th></tr></thead><tbody><tr><td><code>8 位</code></td><td><code>每像素位数</code> * <code>每行像素数</code> + <code>补齐</code></td></tr></tbody></table><p><strong>色彩类型 - 色彩通道 - 通道深度 - 每像素位数</strong></p><table><thead><tr><th>色彩类型</th><th>色彩</th><th>每像素通道数</th><th>通道深度</th><th>每像素位数</th></tr></thead><tbody><tr><td><code>0</code></td><td>灰度</td><td>1</td><td>1, 2, 4, 8, 16</td><td>1, 2, 4, 8, 16</td></tr><tr><td><code>2</code></td><td>真彩色（RGB）</td><td>3</td><td>8, 16</td><td>24, 48</td></tr><tr><td><code>3</code></td><td>色板</td><td>1</td><td>1, 2, 4, 8</td><td>1, 2, 4, 8</td></tr><tr><td><code>4</code></td><td>灰度和透明度</td><td>2</td><td>8, 16</td><td>16, 32</td></tr><tr><td><code>6</code></td><td>色彩色和透明度（RGBA）</td><td>4</td><td>8, 16</td><td>32, 64</td></tr></tbody></table><p>这张图片的色彩类型是 <code>3</code>，所以每个像素包含 <code>1</code> 个色彩通道。又因为图片的通道深度是 <code>2</code>，所以我们知道每个像素是用 <code>2</code> 位来表示的。</p><p><strong>解码扫描线</strong></p><table><thead><tr><th>行</th><th>过滤函数</th><th>像素…[补齐…]</th></tr></thead><tbody><tr><td></td><td><code>8 位</code></td><td><code>每像素 2 位 * 2 像素</code> + <code>4 位补齐</code> &#x3D; <code>8 位</code></td></tr><tr><td><code>0</code></td><td><code>0</code></td><td><code>00010000</code> (<code>16</code>)</td></tr><tr><td><code>1</code></td><td><code>0</code></td><td><code>10110000</code> (<code>176</code>)</td></tr></tbody></table><p>这张图片里面的过滤函数 <code>0</code> 表示这张图数据未经过滤。所以我们只要保留原始数据就行了。</p><p><strong>扫描线像素</strong></p><table><thead><tr><th>行</th><th>第 1 列</th><th>第 2 列</th><th>补齐…</th></tr></thead><tbody><tr><td><code>0</code></td><td><code>00</code></td><td><code>01</code></td><td><code>0000</code></td></tr><tr><td><code>1</code></td><td><code>10</code></td><td><code>11</code></td><td><code>0000</code></td></tr></tbody></table><p>这里每个像素中的数据表示了这个像素的颜色在色板中的索引。根据色板，我们可以还原出图片的像素信息：<code>[[255, 0, 0, 255], [0, 255, 0, 255], [0, 0, 255, 255], [255, 255, 255, 127]]</code>。</p><p><strong>图片像素</strong></p><table><thead><tr><th>行\列</th><th><code>0</code></th><th><code>1</code></th></tr></thead><tbody><tr><td><code>0</code></td><td><code>(255, 0, 0, 255)</code></td><td><code>(0, 255, 0, 255)</code></td></tr><tr><td><code>1</code></td><td><code>(0, 0, 255, 255)</code></td><td><code>(255, 255, 255, 127)</code></td></tr></tbody></table><p>最后可以得到这样一个PNG图片信息：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">imageData = <span class="punctuation">&#123;</span></span><br><span class="line">  width<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  height<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  data<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">127</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>PNG (Portable Network Graphics) Specification <a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Contents.html">http://www.libpng.org/pub/png/spec/1.2/PNG-Contents.html</a></p><p>PNG文件格式 <a href="https://rimson.top/png-format/">https://rimson.top/png-format/</a></p><p>PNG文件格式详解 <a href="https://blog.mythsman.com/post/5d2d62b4a2005d74040ef7eb/">https://blog.mythsman.com/post/5d2d62b4a2005d74040ef7eb/</a></p><p>Portable Network Graphics (PNG) Specification (Second Edition) <a href="https://www.w3.org/TR/PNG/">https://www.w3.org/TR/PNG/</a></p><p>一步一步解码 PNG 图片 <a href="https://vivaxyblog.github.io/2019/12/07/decode-a-png-image-with-javascript-cn.html">https://vivaxyblog.github.io/2019/12/07/decode-a-png-image-with-javascript-cn.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu依赖错误记录(未解决)</title>
      <link href="/2022/3/5008382d91a6/"/>
      <url>/2022/3/5008382d91a6/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu依赖错误记录-未解决"><a href="#Ubuntu依赖错误记录-未解决" class="headerlink" title="Ubuntu依赖错误记录(未解决)"></a>Ubuntu依赖错误记录(未解决)</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在使用如<code>apt update</code> <code>apt upgrade</code> <code>apt install</code>等等依赖操作时偶尔出现的错误，一直没有找到通用的解决方案，且<code>dependencies</code>的错误种类各样，故在此仅仅记录解决的操作</p><h2 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h2><h3 id="The-following-packages-have-unmet-dependencies"><a href="#The-following-packages-have-unmet-dependencies" class="headerlink" title="The following packages have unmet dependencies:"></a>The following packages have unmet dependencies:</h3><blockquote><p>下列软件包有未满足的依赖关系：<br> libpython2-stdlib : 破坏: libpython-stdlib (&lt; 2.7.15-2) 但是 2.7.5-5ubuntu3 正要被安装<br> python2 : 破坏: python (&lt; 2.7.15-2) 但是 2.7.5-5ubuntu3 正要被安装<br> python2-minimal : 破坏: python-minimal (&lt; 2.7.15-2) 但是 2.7.5-5ubuntu3 正要被安装</p></blockquote><p>经常出现的问题，原因是<strong>尝试安装的软件包正在寻找它在当前版本中找不到的“依赖关系”</strong>。一般在换源后会出现这样的问题。在网上的通用方法是<strong>更新包数据库，清除包缓存，然后下载并重新安装较新版本。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get autoclean</span><br><span class="line">sudo apt-get -f install</span><br><span class="line">sudo dpkg --configure -a</span><br><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure><p>修复错误可以使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -u dist-upgrade</span><br><span class="line">sudo apt-get -o Debug::pkgProblemResolver=<span class="built_in">yes</span> dist-upgrade</span><br><span class="line">sudo apt-get remove --dry-run package-name</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -u dist-upgrade</span><br><span class="line">sudo apt-get clean package-name</span><br><span class="line">sudo apt-get install --reinstall package-name</span><br></pre></td></tr></table></figure><p>当然由于未知原因，有时这些操作并<strong>不管用</strong>。我一般直接采用 <code>uninstall</code>所有的报错包，在检查软件源都可用后将它们重新安装下来。</p><h3 id="dpkg-error-processing-archive-x2F-var-x2F-cache-x2F-apt-x2F-archives-x2F"><a href="#dpkg-error-processing-archive-x2F-var-x2F-cache-x2F-apt-x2F-archives-x2F" class="headerlink" title="dpkg: error processing archive &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;*"></a>dpkg: error processing archive &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;*</h3><blockquote><p>准备解压 …&#x2F;libopenal1_1%3a1.19.1-1_i386.deb  …<br>正在解压 libopenal1:i386 (1:1.19.1-1) 并覆盖 (1:1.19.1-1) …<br>dpkg: 处理归档 &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;libopenal1_1%3a1.19.1-1_i386.deb (–unpack)时出错：<br> 尝试覆盖共享的 ‘&#x2F;usr&#x2F;share&#x2F;doc&#x2F;libopenal1&#x2F;changelog.Debian.gz’, 它与软件包 libo<br>penal1:i386 中的其他实例不同<br>在处理时有错误发生：<br> &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;libopenal1_1%3a1.19.1-1_amd64.deb<br> &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;libopenal1_1%3a1.19.1-1_i386.deb<br>E: Sub-process &#x2F;usr&#x2F;bin&#x2F;dpkg returned an error code (1)</p></blockquote><p>出现的原因可能是未完全安装。</p><p>可以用以下命令强行overwrite</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i --force-overwrite /var/cache/apt/archives/libopenal1_1%3a1.19.1-1_amd64.deb</span><br></pre></td></tr></table></figure><p><code>.deb</code>尤其多的时候为了不麻烦其实采用全部overwrite目前也没有出现过问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i --force-overwrite /var/cache/apt/archives/*.deb</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux下设定键盘Fn键控制功能</title>
      <link href="/2022/3/80bb26f6b2bf/"/>
      <url>/2022/3/80bb26f6b2bf/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux下设定键盘Fn键控制功能"><a href="#Linux下设定键盘Fn键控制功能" class="headerlink" title="Linux下设定键盘Fn键控制功能"></a>Linux下设定键盘Fn键控制功能</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>入手新键盘，在Linux上使用时发现顶部F1-F12区域默认为功能键，应该是Mac的键盘行为。我希望在使用Fn+FXX来使用这些功能。</p><h2 id="设定方法"><a href="#设定方法" class="headerlink" title="设定方法"></a>设定方法</h2><p>可以通过设定 <code>/sys/module/hid_apple/parameters/fnmode</code>来控制Fn的模式</p><ul><li><code>0</code> 禁用功能键，按<code>Fn+FXX</code>等同于触发<code>FXX</code></li><li><code>1</code> 默认功能键，按<code>FXX</code>等同于触发<code>Fn+FXX</code></li><li><code>2</code> 默认非功能键，按<code>FXX</code>触发<code>FXX</code>，按<code>Fn+FXX</code>触发<code>Fn+FXX</code>。这也是windows下的默认行为</li></ul><p>于是<code>echo 2 &gt; /sys/module/hid_apple/parameters/fnmode</code>即可</p><p>要让该设定永久生效，需要写入启动项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sudo vim /path/hid_apple.conf</span></span><br><span class="line">options hid_apple fnmode=2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#软链接</span></span><br><span class="line">sudo <span class="built_in">ln</span> -s /path/hid_apple.conf /etc/modprobe.d/hid_apple.conf</span><br></pre></td></tr></table></figure><h2 id="自组键盘经历"><a href="#自组键盘经历" class="headerlink" title="自组键盘经历"></a>自组键盘经历</h2><p>之前的黑皮cherry红轴108键的键盘实在是不好用，想要换一个87键的键盘。但是一直没有找到好用且好看的键盘。了解到客制化键盘的说法，简单看了一下感觉不太复杂，简单来说就是套件+键轴+键帽，于是动手组了一把。</p><p>套件用的<strong>腹灵MK870</strong>，热插拔+RGB+三模确实很香，而且还有三侧出线。值得一提的是大键调教的很好，空格键处还贴心地配了两边的黑条。不过买回来没有送typec连接线，得自己拿一根。无线模式延迟还是有的，高速打字的时候能明显感觉得到，<strong>不建议用无线来打游戏</strong></p><p>键轴直接用的87个<strong>G白pro</strong>，很舒服的线段轴。（在寝室用也比较优雅，不会被刀）。插轴的时候，轴脚买回来歪了要掰直再插。</p><p>键帽随便买一套好看的就好，只要是PBT的材质。二色工艺的可以透光，不过其实无所谓</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>&lt;萌化&gt;Ubuntu设置启用“嗨多磨!”登录音效</title>
      <link href="/2021/12/2d290da6e095/"/>
      <url>/2021/12/2d290da6e095/</url>
      
        <content type="html"><![CDATA[<h1 id="萌化-Ubuntu设置启用“嗨多磨！”登录音效"><a href="#萌化-Ubuntu设置启用“嗨多磨！”登录音效" class="headerlink" title="[萌化]Ubuntu设置启用“嗨多磨！”登录音效"></a>[萌化]Ubuntu设置启用“嗨多磨！”登录音效</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>はいどうもー！ バーチャルYouTuber【キズナアイ】です！</p></blockquote><p>HAI DOMO！VIRTUAL YOUTUBER KIZUNA AI DESU！</p><p>2021年12月4日，在仅仅5年后的纪念直播上，“虚拟偶像”绊爱亲自宣布了“休眠”的消息。</p><p>（没错，这其实是套着折腾教学的情怀感想回，先咕咕咕）</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MapReduce论文学习</title>
      <link href="/2021/11/df9fd59361b6/"/>
      <url>/2021/11/df9fd59361b6/</url>
      
        <content type="html"><![CDATA[<h1 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h1><h2 id="MapReduce是什么"><a href="#MapReduce是什么" class="headerlink" title="MapReduce是什么"></a>MapReduce是什么</h2><h3 id="Google三驾马车"><a href="#Google三驾马车" class="headerlink" title="Google三驾马车"></a>Google三驾马车</h3><p><img src="https://i.loli.net/2021/11/23/9Rc8LHqpAxMVIlO.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/9Rc8LHqpAxMVIlO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>Google的基础设施有三驾马车，分别是《Google File System》、《Google MapReduce》以及《Google BigTable》</p><p>现代各种优秀的分布式系统实现的本质，都源于那几篇经典的研究和论文。比如非常流行的 Hadoop(HDFS、MapReduce、Hbase)、Spark、Hive，以及国产数据库软件 TiDB、OceanBase 都是参考这几篇经典论文设计的</p><p>三驾马车之间的关系：</p><p><img src="https://i.loli.net/2021/11/23/R7Jo5f38lhzspOb.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/R7Jo5f38lhzspOb.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121031843498"></p><h3 id="MapReduce解决的问题"><a href="#MapReduce解决的问题" class="headerlink" title="MapReduce解决的问题"></a>MapReduce解决的问题</h3><p>谷歌在这为了处理海量的原始数据，已经实现了数以百计的、专用的计算方法。这些计算方法用来处理大量的原始数据。</p><p>2004年谷歌提出了MapReduce, 在此之前谷歌程序员面对的大规模数据集,常常需要编程实现:</p><ol><li>统计某个关键词的现的频率,计算PageRank</li><li>对大规模数据按词频排序</li><li>对多台机器上的文件进行Grep等</li></ol><p>这些工作不可能在一台机器上完成(否则也不能称之为大规模)，要想在可接受的时间内完成运算，只有将这些计算分布在成百上千的主机上,因此谷歌的程序员每次编写代码都需要处理<strong>并行计算,分发数据,处理错误</strong>等问题<strong>。</strong> </p><p>为了解决上述复杂的问题，谷歌设计了一个新的抽象模型，使用这个抽象模型，我们只要表述我们想要执行的简单运算即可，而不必关心并行计算、容错、数据分布、负载均衡等复杂的细节，这些问题都被封装在了一个库里面。</p><p>设计这个抽象模型的灵感来自Lisp和许多其他函数式语言的Map和Reduce的原语，在大多数运算都包含这样的操作：</p><blockquote><p>在输入数据的“逻辑”记录上应用Map操作得出一个中间key&#x2F;value pair集合，然后在所有具有相同key值的value值上应用Reduce操作，从而达到合并中间的数据，得到一个想要的结果的目的。</p></blockquote><p>使用MapReduce模型，再结合用户实现的Map和Reduce函数，我们就可以非常容易的实现大规模并行化计算；通过MapReduce模型自带的“再次执行”（re-execution）功能，也提供了初级的容错实现方案</p><h2 id="MapReduce的架构-x2F-实现"><a href="#MapReduce的架构-x2F-实现" class="headerlink" title="MapReduce的架构&#x2F;实现"></a>MapReduce的架构&#x2F;实现</h2><h3 id="MapReduce编程模型"><a href="#MapReduce编程模型" class="headerlink" title="MapReduce编程模型"></a>MapReduce编程模型</h3><p>例子：WordCount</p><p><img src="https://i.loli.net/2021/11/23/xL5RWGcj82Xgtmw.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/xL5RWGcj82Xgtmw.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121034200807"></p><p>利用一个输入的key&#x2F;value pair集合来产生一个输出的key&#x2F;value pair集合。</p><p>MapReduce库的用户用两个函数表达这个计算：<code>Map</code>和<code>Reduce</code>。</p><p>用户自定义的<code>Map</code>函数接受一个输入的key&#x2F;value pair集合，然后产生一个中间key&#x2F;value pair值的集合。MapReduce库把所有具有相同中间key值I的中间value值集合在一起后传递给<code>Reduce</code>函数。</p><p>用户自定义的<code>Reduce</code>函数接受一个中间key的值<code>I</code>和相关的一个value值的集合。<code>Reduce</code>函数合并这些value值，形成一个较小的value值的集合。通常我们通过一个<strong>迭代器</strong>把中间value值提供给<code>Reduce</code>函数，这样我们就可以处理无法全部放入内存中的大量的value值的集合。</p><p><strong>需要一提的是</strong>：每个Map在结束后，会将输出结果产生为一个中间文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">map(String key, String value):</span><br><span class="line">    // key: document name</span><br><span class="line">    // value: document contents</span><br><span class="line">    for each word w in value:</span><br><span class="line">        EmitIntermediate(w, &quot;I&quot;);</span><br><span class="line"></span><br><span class="line">reduce(String key, Iterator values):</span><br><span class="line">    // key: a word</span><br><span class="line">    // values: a list of counts</span><br><span class="line">    int result = 0;</span><br><span class="line">    for each v in values:</span><br><span class="line">        result += ParseInt(v);</span><br><span class="line">    Emit(AsString(result));      </span><br></pre></td></tr></table></figure><p>用户提供的 <code>Map</code> 函数和 <code>Reduce</code> 函数应有如下类型：</p><p><img src="https://i.loli.net/2021/11/23/6lvurZqicBCeGzK.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/6lvurZqicBCeGzK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121034838623"></p><p><strong>值得注意的是</strong>，在实际的实现中 MapReduce 框架使用 <code>Iterator</code> 来代表作为输入的集合，主要是为了避免集合过大，无法被完整地放入到内存中</p><h3 id="MapReduce的应用"><a href="#MapReduce的应用" class="headerlink" title="MapReduce的应用"></a>MapReduce的应用</h3><p>分布式的Grep：<code>Map</code>函数输出匹配某个<code>pattern</code>的一行，<code>Reduce</code>函数是一个恒等函数，即把中间数据复制到输出。</p><p>计算URL访问频率：<code>Map</code>函数处理日志中web页面请求的记录，然后输出<code>(URL,1)</code>。<code>Reduce</code>函数把相同URL的value值都累加起来，产生<code>(URL,记录总数)</code>结果。</p><p>倒排索引：<code>Map</code>函数分析每个文档输出一个<code>(word,document_id)</code>的列表，<code>Reduce</code>函数的Input是一个<code>word</code>的所有<code>(word，document_id)</code>，排序所有的<code>document_id</code>，输出<code>(word,list(document_id))</code>。所有的输出集合形成一个简单的倒排索引，它以一种简单的算法跟踪词在文档中的位置。</p><p><img src="https://i.loli.net/2021/11/23/j8tIPNxw4TL5CGz.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/j8tIPNxw4TL5CGz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121040558131"></p><h3 id="MapReduce架构"><a href="#MapReduce架构" class="headerlink" title="MapReduce架构"></a>MapReduce架构</h3><p><img src="https://i.loli.net/2021/11/23/CAEVQ8oeYu9IZOR.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/CAEVQ8oeYu9IZOR.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121054502095"></p><ol><li><p>用户程序首先调用 MapReduce 库将输入文件分成M个数据片段，每个数据片段的大小一般从16MB到64MB(可以通过可选的参数来控制每个数据片段的大小)。然后用户程序在机群中创建大量的程序副本。</p></li><li><p>这些程序副本中的有一个特殊的程序：master。副本中其它的程序都是worker程序，由master分配任务。有M个Map任务和R个Reduce任务将被分配，master将一个Map任务或Reduce任务分配给一个空闲的worker。每个worker一项任务</p></li><li><p>被分配了Map任务的worker程序读取相关的输入数据片段，从输入的数据片段中解析出key&#x2F;value pair，然后把key&#x2F;value pair传递给用户自定义的Map函数，由Map函数生成并输出的中间key&#x2F;value pair，并缓存在内存中。</p></li><li><p>缓存中的key&#x2F;value pair通过分区函数分成R个区域，之后周期性的写入到本地磁盘上。缓存的key&#x2F;value pair在本地磁盘上的存储位置将被回传给master，由master负责把这些存储位置再传送给Reduce worker。</p></li><li><p>当Reduce worker程序接收到master程序发来的数据存储位置信息后，使用RPC(Remote Procedure Call：该协议允许运行于一台计算机的程序调用另一个地址空间(通常为一个开放网络的一台计算机)的子程序)从Map worker所在主机的磁盘上读取这些缓存数据。</p><p>当Reduce worker读取了所有的中间数据后，通过<strong>对key进行排序</strong>后使得具有相同key值的数据聚合在一起。<strong>由于许多不同的key值会映射到相同的Reduce任务上，因此必须进行排序</strong>。如果中间数据太大无法在内存中完成排序，那么就要在外部进行排序。</p></li><li><p>Reduce worker程序遍历排序后的数据，对于每一个唯一的key值，Reduce worker程序将这个key值和它相关的value值的集合传递给用户自定义的Reduce函数。Reduce函数的输出被追加到所属分区的输出文件。</p></li><li><p>当所有的Map和Reduce任务都完成之后，master唤醒用户程序。此时，用户程序中的MapReduce调用返回到用户代码中。</p></li></ol><p>在这个过程中：</p><p>master应当维护多种数据结构。它会存储每个map和reduce任务的状态（空闲、处理中、完成），和每台工作机器的ID（对应非空闲的任务）。</p><p>master是将map任务产生的中间文件的位置传递给reduce任务的通道。因此，master要存储每个已完成的map任务产生的R个中间文件的位置和大小。map任务完成时，master会接收到位置和大小的更新信息。这些信息会被逐步发送到正在处理中的reduce任务节点处。</p><h2 id="MapReduce的容错"><a href="#MapReduce的容错" class="headerlink" title="MapReduce的容错"></a>MapReduce的容错</h2><p>因为MapReduce库的设计初衷是使用由成百上千的机器组成的集群来处理超大规模的数据，所以，这个库必须要能很好的处理机器故障。</p><h3 id="worker故障"><a href="#worker故障" class="headerlink" title="worker故障"></a>worker故障</h3><p>如何检测worker的故障？发心跳包。</p><p>master周期性的ping每个worker。如果在一定时间范围内没有收到worker返回的信息，master将把这个worker标记为失效。</p><p>所有由这个失效的worker完成的<strong>Map任务</strong>被重设为初始的空闲状态，之后这些任务就可以被安排给其他的worker。同样的，worker失效时<strong>正在运行的Map或Reduce任务</strong>也将被重新置为空闲状态，等待重新调度。</p><p><strong>值得一提的是</strong>：worker完成的Reduce任务的输出存储在全局文件系统上，因此不需要再次执行。而Map任务的输出存储在worker对应的这台机器上，不可访问。</p><p>当一个Map任务首先被worker A执行，之后由于worker A失效了又被调度到worker B执行，这个“重新执行”的动作会被通知给所有执行Reduce任务的worker。任何还没有从worker A读取数据的Reduce任务将从worker B读取数据</p><p>通过这样的方式，MapReduce可以处理大规模worker失效的情况。</p><h3 id="master故障"><a href="#master故障" class="headerlink" title="master故障"></a>master故障</h3><p>那就寄！</p><p>备份。一个解决办法是让master周期性将其维护的数据写入磁盘，作为checkpoint，当master挂了后可以通过checkpoint来重启master进程。</p><p>但需要考虑到master故障后再恢复比较麻烦，只有一个master进程，Google的实现是当master故障后，让客户检查到这个状态，然后中止运算并重启MapReduce操作。</p><h2 id="MapReduce在实践过程中的优化"><a href="#MapReduce在实践过程中的优化" class="headerlink" title="MapReduce在实践过程中的优化"></a>MapReduce在实践过程中的优化</h2><h3 id="存储位置"><a href="#存储位置" class="headerlink" title="存储位置"></a>存储位置</h3><p>在分布式系统中，网络带宽通常是稀缺资源，很容易成为系统瓶颈。为了减少网络通信，Google通过将输入数据存储在本地磁盘上。</p><ol><li>GFS把每个文件按64MB一个Block分隔，每个Block保存在多台机器上，环境中就存放了多份拷贝(一般是3个拷贝)。MapReduce的master在调度Map任务时会考虑输入文件的位置信息，尽量将一个Map任务调度在包含相关输入数据拷贝的机器上执行</li><li>如果无法实现，就尝试在保存有输入数据拷贝的机器附近的机器上执行Map任务（比如在同一个交换机的机器上执行Map）</li></ol><h3 id="任务粒度"><a href="#任务粒度" class="headerlink" title="任务粒度"></a>任务粒度</h3><p>正常情况下M、R比集群中的worker数量大很多，这样一来在每台worker机器都执行大量的不同任务能够提高集群的负载均衡能力</p><p>但实际情况下，master会执行O(M+R)次调度，并且在内存中保存O(M*R)个状态</p><p>R的值是由用户指定的，而M的值也尽量满足每一个独立任务都是处理大约16M到64M的输入数据，使得上述存储位置的优化最有效</p><p>比如M&#x3D;200000, R&#x3D;5000，使用2000个worker</p><h3 id="备用任务"><a href="#备用任务" class="headerlink" title="备用任务"></a>备用任务</h3><p>在运算过程中，如果有几台机器运行特别慢，会极大影响MapReduce操作的总时间。</p><p>这里有个通用的方法。MapReduce会启用处理中状态(in-progress)的任务的备用任务进程，它和原任务做相同的事情，无论哪个完成了任务，都视为该任务已经完成</p><h3 id="分区函数"><a href="#分区函数" class="headerlink" title="分区函数"></a>分区函数</h3><p>前面说到R的值是由用户指定的，可以通过分区函数对数据分区，比如用<code>hash(key) mod R</code>进行分区，能够让key&#x2F;value pair比较均衡的分给执行Reduce的worker。当输出的key值是URLs，我们希望每个主机的所有条目保持在同一个输出文件中，又可以通过<code>hash(hostname(urlkey)) mod R</code>将所有来自同一个主机的URLs分在一个分区中。</p><h3 id="顺序保证"><a href="#顺序保证" class="headerlink" title="顺序保证"></a>顺序保证</h3><p>我们确保在给定的分区中，中间key&#x2F;value pair数据的处理顺序是按照key值增量顺序处理的。这样的顺序保证对每个分区生成一个有序的输出文件，这对于需要对输出文件按key值随机存取的应用非常有意义。</p><h3 id="合并函数"><a href="#合并函数" class="headerlink" title="合并函数"></a>合并函数</h3><p>比如在进行词频统计时，一些词的出现频率非常的高，这会导致产生例如<code>(I,1)</code>这种key&#x2F;value pair，导致中间文件到同一个Reduce的大小不均衡。</p><p>此时可以通过指定一个可选的combiner函数，combiner函数首先在本地将这些记录进行一次合并，然后将合并的结果再通过网络发送出去。</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>磁盘挂载没有写权限？彻底关闭你的windows快速启动</title>
      <link href="/2021/9/7a37f059971a/"/>
      <url>/2021/9/7a37f059971a/</url>
      
        <content type="html"><![CDATA[<h2 id="win10的快速启动"><a href="#win10的快速启动" class="headerlink" title="win10的快速启动"></a>win10的快速启动</h2><p>我们都知道windows10在“电源管理”处有一个“快速启动”选项，默认情况下他是开启的。</p><p>这会让windows10更快的关闭和启动。在启用该选项时，本质上win10让你的PC执行了部分休眠，事实上，你的windows并没有关机。（即使你长按电源键关机或者手动点击关机）</p><h2 id="快速启动导致的问题"><a href="#快速启动导致的问题" class="headerlink" title="快速启动导致的问题"></a>快速启动导致的问题</h2><p>在双系统下，如果你在某个linux系统上尝试挂载window磁盘，便会出现磁盘只有读权限，而没有写权限。</p><p>尝试<code>umount</code>后重新挂载依然无法获得写权限。</p><p><img src="https://i.loli.net/2021/09/22/mz3ZbgdSGEkxYlj.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/22/mz3ZbgdSGEkxYlj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我早就关闭了“快速启动”选项，但在某一天开始依旧出现了这样的问题，显然我需要一个彻底关闭windows的方法。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>搜索<code>how to shutdown windows fully</code>彻底关机有两种：</p><p>1、点击关机时按住shirt键</p><p>2、使用 <code>shutdown /s /f /t 0</code>进行关机</p><p>全部尝试后依然无效。</p><p>了解到，在关闭快速启动选项之前，休眠文件会由windows创建，你可以在系统磁盘中找到 <code>hiberfil.sys</code>的文件。</p><p>然而在GUI中关闭快速启动选项后，文件并不会由windows删除。（windows为啥设计这种脏操作）</p><p>解决：</p><p>1、在确保有<code>hiberfil.sys</code>文件存在</p><p>2、打开管理员权限的命令行，执行<code>powercfg /h off</code></p><p>3、确保<code>hiberfil.sys</code>文件已经删除，再重新启动即可。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://unix.stackexchange.com/questions/107978/cant-access-windows-drive-windows-is-hibernated-refused-to-mount">https://unix.stackexchange.com/questions/107978/cant-access-windows-drive-windows-is-hibernated-refused-to-mount</a></p><p><a href="https://superuser.com/questions/1010084/windows-is-hibernated-refused-to-mount-but-fast-startup-is-disabled-on-window">https://superuser.com/questions/1010084/windows-is-hibernated-refused-to-mount-but-fast-startup-is-disabled-on-window</a></p><p><a href="https://unix.stackexchange.com/questions/432869/cant-mount-dual-boot-partition-windows-is-hibernated">https://unix.stackexchange.com/questions/432869/cant-mount-dual-boot-partition-windows-is-hibernated</a></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>敏感词过滤实现</title>
      <link href="/2021/7/ac22932d46a9/"/>
      <url>/2021/7/ac22932d46a9/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>需要实现一个基于已有的敏感词库的敏感词过滤的功能</p><h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><h3 id="遍历匹配"><a href="#遍历匹配" class="headerlink" title="遍历匹配"></a>遍历匹配</h3><p>遍历词库的每一个词，匹配后进行过滤（比如把它们全部换成*号）</p><p>字符串匹配比较常见的算法有：</p><ul><li>Brute Force算法</li><li>KMP算法</li><li>Boyer-Moore算法（BM算法）</li></ul><p>当然，用于字符串匹配的算法有非常多，这里不再赘述</p><p><strong>一个敏感词库的词量往往是巨大的，它会远大于需要处理的文本量</strong>，在这种场景下使用遍历匹配的方法显然<strong>不可行</strong></p><h3 id="利用-DFA-算法"><a href="#利用-DFA-算法" class="headerlink" title="利用 DFA 算法"></a>利用 DFA 算法</h3><h4 id="DFA：Deterministic-Finite-Automata-（确定型有穷自动机）"><a href="#DFA：Deterministic-Finite-Automata-（确定型有穷自动机）" class="headerlink" title="DFA：Deterministic Finite Automata （确定型有穷自动机）"></a>DFA：Deterministic Finite Automata （确定型有穷自动机）</h4><p>从一个状态通过一系列的事件转换到另一个状态，即 state -&gt; event -&gt; state。</p><ul><li>确定：状态以及引起状态转换的事件都是可确定的，不存在“意外”。</li><li>有穷：状态以及事件的数量都是可穷举的。</li></ul><p>计算机操作系统中的进程状态与切换可以作为 DFA 算法的一种近似理解</p><p><img src="https://i.loli.net/2021/09/15/4rHS1xYozvfKkOT.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/4rHS1xYozvfKkOT.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>举例：将DFA算法用于匹配关键词</strong></p><p>我们可以将每个文本片段作为状态，例如“匹配关键词”可拆分为“匹”、“匹配”、“ 匹配关”、“匹配关键”和“匹配关键词”五个文本片段。</p><p><img src="https://i.loli.net/2021/09/15/PkS2OrVw5ysxaDc.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/PkS2OrVw5ysxaDc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20210915205452.png"></p><p>过程：</p><ul><li>初始状态为空，当触发事件“匹”时转换到状态“匹”；</li><li>触发事件“配”，转换到状态“匹配”；</li><li>依次类推，直到转换为最后一个状态“匹配关键词”。</li></ul><p>再让我们考虑多个关键词的情况，例如“匹配算法”、“匹)配关键词”以及“信息抽取”。</p><p><img src="https://i.loli.net/2021/09/15/XldZQIhN1EjasFy.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/XldZQIhN1EjasFy.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们可以发现对于关键词匹配，它的状态是一个树形结构，这样我们判断一个词是否为敏感词时就大大减少了检索的匹配范围。</p><p><strong>如何构建图示结构？</strong></p><p> 为了处理整个关键词库，我们可以使用字典（数组、哈希表、balabala…..）</p><p>字典使用 HashTable 实现，因为一个节点的子节点个数未知，而 HashTable 可以动态扩展，而且可以在 O(1) 的时间复杂度内判断某个子节点是否存在</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">state_event_dict = &#123;</span><br><span class="line">    <span class="string">&quot;匹&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;配&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;算&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;法&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;is_end&quot;</span>: <span class="literal">True</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;关&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;键&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;词&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;is_end&quot;</span>: <span class="literal">True</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;信&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;息&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;抽&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;取&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;is_end&quot;</span>: <span class="literal">True</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用嵌套字典来作为树形结构（这玩意就是Trie 树），<code>key</code> 作为事件，通过<code>is_end</code>字段来判断状态是否为最后一个状态，如果是最后一个状态，则停止状态转换，获取匹配的关键词。</p><p>每一个敏感词都可以看做一个关键词，构建敏感词的时间复杂度是可以忽略不计的，因为构建完成后我们是可以无数次使用的。对于查找敏感词的时间复杂度。如果字符串的长度为 <code>n</code>，而每个敏感词查找的时间复杂度是 <code>O(m)</code>（<code>m</code> 为最长的字符串的长度），我们需要对字符串遍历 <code>n</code>遍，所以查找敏感词的这个过程的时间复杂度为 <code>O(m*n)</code>。用DFA算法能够很好的满足需求。</p><p>缺点：占用的内存和敏感词库的大小成正比。</p><h3 id="为什么不使用正则匹配"><a href="#为什么不使用正则匹配" class="headerlink" title="为什么不使用正则匹配"></a>为什么不使用正则匹配</h3><p>正则表达式引擎有两种：NFA和DFA。我们常常说用正则去匹配文本，这是NFA的思路。</p><p>大多数正则表达式引擎本质是NFA（非确定性有穷自动机）。而NFA由于在匹配时会多次回溯，导致相比于DFA效率低了很多</p><p><strong>为什么正则使用NFA？：</strong></p><h4 id="NFA：Nondeterministic-Final-Auomaton（非确定型有穷自动机）"><a href="#NFA：Nondeterministic-Final-Auomaton（非确定型有穷自动机）" class="headerlink" title="NFA：Nondeterministic Final Auomaton（非确定型有穷自动机）"></a>NFA：Nondeterministic Final Auomaton（非确定型有穷自动机）</h4><p><img src="https://i.loli.net/2021/09/15/VYpGLw1dtZbS3Uj.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/VYpGLw1dtZbS3Uj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>对于正则匹配，同样逐个读入待匹配字符，每读一个字符，即选取多种可能的匹配规则的一种继续匹配，一旦发现匹配失败，则回溯（backtrack）到之前的状态，重新开始尝试新的一种匹配，直至匹配完成</p><h4 id="NFA-vs-DFA"><a href="#NFA-vs-DFA" class="headerlink" title="NFA vs DFA"></a>NFA vs DFA</h4><p><img src="https://i.loli.net/2021/09/15/KZLsoQ2Erbq5p3i.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/KZLsoQ2Erbq5p3i.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>正则表达式在计算机看来只是一串符号，正则引擎首先肯定要解析它。NFA引擎只需要编译就好了；而DFA引擎则比较繁琐，编译完还不算，还要遍历出表达式中所有的可能。因为对DFA引擎来说机会只有一次，它必须得提前知道所有的可能，才能匹配出最优的结果</p><p>DFA的时间复杂度是线性的。DFA不记录所有可能的路径，结果是确定的。</p><p>NFA的时间复杂度较不稳定，好坏程度取决于正则表达式的书写与匹配对象的复杂程度。但NFA相较于DFA，它具有更强大的功能。因此，它也成为Java，JavaScript，PHP，Python，Ruby实现正则表达式的方式。NFA匹配结果，基于表达式，它记录所有可能的路径</p><p>正则中的非贪婪模式、反向引用、零宽断言等只有使用NFA引擎才有。因此大部分正则引擎都使用NFA来实现</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/weixin_43378396/article/details/105910145?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162681308016780271543050%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=162681308016780271543050&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-105910145.first_rank_v2_pc_rank_v29&utm_term=dfa%E7%AE%97%E6%B3%95&spm=1018.2226.3001.4187">DFA 算法</a></p><p><a href="https://hooj0.github.io/sensitive-words-filter/">敏感词过滤、脱敏</a></p><p><a href="https://houbb.github.io/2020/01/07/regex-and-dfa-02">Regex 正则表达式原理及如何从零实现</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-dfa">java 实现敏感词过滤</a></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 敏感词过滤 </tag>
            
            <tag> DFA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CUDA+cuDNN+pytorch GPU环境搭建</title>
      <link href="/2021/5/8432c972721a/"/>
      <url>/2021/5/8432c972721a/</url>
      
        <content type="html"><![CDATA[<h2 id="安装CUDA"><a href="#安装CUDA" class="headerlink" title="安装CUDA"></a>安装CUDA</h2><blockquote><p>安装</p></blockquote><p>首先去英伟达官网下载cuda安装包：<a href="https://developer.nvidia.com/cuda-toolkit-archive">https://developer.nvidia.com/cuda-toolkit-archive</a></p><p><img src="https://i.loli.net/2021/05/19/bx9B3RXCzMOQy8G.png" class="lazyload" data-srcset="https://i.loli.net/2021/05/19/bx9B3RXCzMOQy8G.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="https://i.loli.net/2021/05/19/bx9B3RXCzMOQy8G.png"></p><p><img src="https://i.loli.net/2021/05/19/d2BcPO7DxnWltaN.png" class="lazyload" data-srcset="https://i.loli.net/2021/05/19/d2BcPO7DxnWltaN.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="https://i.loli.net/2021/05/19/d2BcPO7DxnWltaN.png"></p><p><strong>踩坑：这里最好不要使用deb的安装，推荐使用runfile</strong></p><p>我最初在使用deb的安装时，在最后一步</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install cuda</span><br></pre></td></tr></table></figure><p>中，得到了<code>depends: cuda-11-3 (&gt;= 11.3.0) but it is not going to be installed site:forums.developer.nvidia.com</code>的错误，而这个错误并没有得到良好的解决方案。</p><p>我在搜索资料后推测是由于本身已经安装了nvidia-driver所导致的结果，而英伟达的cuda本身已经自带了驱动（这是一件很奇怪的事情）。</p><p>因此我推荐<strong>runfile</strong>的安装，我在此安装成功。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget &lt;https:<span class="comment">//developer.download.nvidia.com/compute/cuda/11.3.0/local_installers/cuda_11.3.0_465.19.01_linux.run&gt;</span></span><br><span class="line">sudo sh cuda_11<span class="number">.3</span><span class="number">.0</span>_465<span class="number">.19</span><span class="number">.01</span>_linux.run</span><br></pre></td></tr></table></figure><p>需要注意的是，在执行<code>sudo sh cuda_11.3.0_465.19.01_linux.run</code>时，最好使用<code>sudo sh cuda_11.3.0_465.19.01_linux.run -no-opengl-libs</code></p><p><strong>cuda</strong>主要有以下参数：</p><ul><li><code>-no-opengl-libs</code>：表示只安装驱动文件，不安装<strong>OpenGL</strong>文件。必需参数，原因同上。注意：不是<code>no-opengl-files</code>。</li><li><code>-uninstall (deprecated)</code>：用于卸载<strong>CUDA Driver</strong>（已废弃）。</li><li><code>-toolkit</code>：表示只安装<strong>CUDA Toolkit</strong>，不安装<strong>Driver</strong>和<strong>Samples</strong></li><li><code>-help</code>：查看更多高级选项。</li></ul><p><strong>安装过程中的坑</strong></p><p>首先会有一个阅读声明，一直滑到底部输入accept即可。我遇到了无法滑到底部的情况，也就是不能输入accpet。</p><p>解决：</p><p>使用<code>init 3</code>关闭图形界面即可。</p><p><strong>选项</strong></p><p>选项<strong>install nvidia accelerated Graphics Driver</strong>,输入<strong>n</strong>，因为我们已经安装了<strong>nvidia</strong>的驱动。</p><p>选项<strong>install the OpenGL libraries</strong>,如果双显卡(集显+独显)选择<strong>n</strong>，如果只有独显可以选择<strong>y</strong>，如果双显卡选择<strong>y</strong>的话，会出现<strong>黑屏</strong>或者<strong>循环登录</strong>的问题，如果加了上面的参数就不会出现这个选项了。</p><p>后面的可以都选择<strong>yes</strong>，最后一个选项我们可以选择<strong>n</strong>,也就是不复制<strong>Samples</strong>，因为安装目录下有<strong>samples</strong>。</p><p>之后install等待安装结束即可</p><p>此时使用<code>startx</code>重新进入图形界面。</p><blockquote><p>配置环境</p></blockquote><p>终端编辑<code>/etc/profile</code>或者<code>.bashrc</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda<span class="number">-11.3</span>/lib64</span><br><span class="line"><span class="keyword">export</span> PATH=$PATH:/usr/local/cuda<span class="number">-11.3</span>/bin</span><br><span class="line"><span class="keyword">export</span> CUDA_HOME=$CUDA_HOME:/usr/local/cuda<span class="number">-11.3</span></span><br></pre></td></tr></table></figure><p>运行<code>source /etc/profile</code>或者<code>source .bashrc</code></p><h2 id="安装cuDNN"><a href="#安装cuDNN" class="headerlink" title="安装cuDNN"></a>安装cuDNN</h2><p><strong>Installing from a Tar File</strong></p><p>1.Navigate to your <cudnnpath> directory containing the cuDNN Tar file.</p><p>2.Unzip the cuDNN package.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf cudnn-9.0-linux-x64-v7.tgz</span><br></pre></td></tr></table></figure><p>3.Copy the following files into the CUDA Toolkit directory, and change the filepermissions.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> cuda/include/cudnn*.h /usr/local/cuda/include <span class="comment">#此处我和官方文档不同</span></span><br><span class="line">sudo <span class="built_in">cp</span> cuda/lib64/libcudnn* /usr/local/cuda/lib64</span><br><span class="line">sudo <span class="built_in">chmod</span> a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*</span><br></pre></td></tr></table></figure><p>使用<code>cat /usr/local/cuda/include/cudnn_version.h | grep CUDNN_MAJOR -A 2</code>可以查看版本</p><p>网上的<code>cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2</code>这个操作显然在官方文档的操作下是不行的。</p><h2 id="安装pytorch"><a href="#安装pytorch" class="headerlink" title="安装pytorch"></a>安装pytorch</h2><p>conda使用一个正确的环境，不然会默认安装在base上</p><p>在 <a href="https://pytorch.org/get-started/locally/">https://pytorch.org/get-started/locally/</a> 选择正确的方案即可，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch torchvision torchaudio cudatoolkit=11.1 -c pytorch -c nvidia</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决ubuntu deepin-wine TIM无法打开文件位置</title>
      <link href="/2021/4/ca7d14eb3e01/"/>
      <url>/2021/4/ca7d14eb3e01/</url>
      
        <content type="html"><![CDATA[<p>这个坑其实比较好理解 打开文件位置,其实是两个步骤: 打开资源管理器–&gt;跳转到指定位置 deepin-tim是在deepin系统上的, deepin的资源管理器是<code>dde-file-manager</code> ubuntu上面可没有这玩意, 所以打不开很正常 所以添加可执行文件<code>dde-file-manager</code>间接打开ubuntu的资源管理器就可以了</p><p>在&#x2F;usr&#x2F;bin&#x2F; 下面创建文件 dde-file-manager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/bin/dde-file-manager</span><br></pre></td></tr></table></figure><p>输入以下命令</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/python3</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.<span class="title function_">system</span>(<span class="string">&#x27;nautilus &quot;&#x27;</span>+sys.<span class="property">argv</span>[<span class="number">2</span>]+<span class="string">&#x27;&quot;&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>nautilus 是ubuntu的资源管理器</li></ul><p>对该文件授权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> +x /usr/bin/dde-file-manager</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> 折腾 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> wine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决jetbrains IDE(Goland)莫名报错: Unresolved reference</title>
      <link href="/2021/4/ed34e8e9b6f3/"/>
      <url>/2021/4/ed34e8e9b6f3/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一觉醒来项目直接爆红，很怪很怪，go mod是没有问题的</p><p>struct全部unresolved reference的错误，但是程序却可以正常运行</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>目前有两种解决方案，这对于jetbrains家的所有IDE都是可行的</p><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>在settings - go - gopath下方勾上 “Index entire gopath”</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/c0404681-7e89-453e-b401-b263d5d75dbc.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/c0404681-7e89-453e-b401-b263d5d75dbc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>在file - invalidate caches中选择invalidate and restart</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/82b2dc87-0434-4fcc-b779-8354c4b3063b.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/82b2dc87-0434-4fcc-b779-8354c4b3063b.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
      
      
      <categories>
          
          <category> 报错 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jetbrains </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决Ubuntu连接华为freebuds3蓝牙耳机失败</title>
      <link href="/2021/4/d33e602069a3/"/>
      <url>/2021/4/d33e602069a3/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>把Ubuntu18扬了后，重装Ubuntu20.04，莫名解决了在Ubuntu18上的一些问题，而耳机和brightness control的坑一直没碰，最近越发感到不能连接蓝牙耳机的不方面，终于解决，记录出来</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>系统：Ubuntu20.04</p><hr><p>在设置-蓝牙中始终连接不上蓝牙耳机</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/%E8%A7%A3%E5%86%B3Ubuntu%E8%BF%9E%E6%8E%A5%E5%8D%8E%E4%B8%BAfreebuds3%E8%93%9D%E7%89%99%E8%80%B3%E6%9C%BA%E5%A4%B1%E8%B4%A5.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/%E8%A7%A3%E5%86%B3Ubuntu%E8%BF%9E%E6%8E%A5%E5%8D%8E%E4%B8%BAfreebuds3%E8%93%9D%E7%89%99%E8%80%B3%E6%9C%BA%E5%A4%B1%E8%B4%A5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>尝试安装<code>blueman</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install blueman</span><br></pre></td></tr></table></figure><p>再打开<code>blueman</code>进行连接</p><p>失败</p><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>控制台重启蓝牙服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service bluetooth restart</span><br></pre></td></tr></table></figure><p>打开蓝牙控制检查工作情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bluetoothctl</span><br><span class="line">show</span><br></pre></td></tr></table></figure><p>将会显示类似内容：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Controller</span> <span class="attr">C8</span>:<span class="attr">B2</span>:9<span class="attr">B</span>:<span class="attr">F3</span>:<span class="attr">BB</span>:<span class="number">27</span> (public)</span><br><span class="line"><span class="title class_">Name</span>: ryao-<span class="title class_">Lenovo</span>-<span class="title class_">Legion</span>-<span class="variable constant_">Y7000P</span>-2020H</span><br><span class="line"><span class="title class_">Alias</span>: ryao-<span class="title class_">Lenovo</span>-<span class="title class_">Legion</span>-<span class="variable constant_">Y7000P</span>-2020H</span><br><span class="line"><span class="title class_">Class</span>: <span class="number">0x001c010c</span></span><br><span class="line"><span class="title class_">Powered</span>: yes</span><br><span class="line"><span class="title class_">Discoverable</span>: yes</span><br><span class="line"><span class="title class_">DiscoverableTimeout</span>: <span class="number">0x00000000</span></span><br><span class="line"><span class="title class_">Pairable</span>: yes</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Message</span> <span class="title class_">Notification</span> <span class="title class_">Se</span>.. (<span class="number">00001133</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: A/V <span class="title class_">Remote</span> <span class="title class_">Control</span>        (0000110e-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="variable constant_">OBEX</span> <span class="title class_">Object</span> <span class="title class_">Push</span>          (<span class="number">00001105</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Message</span> <span class="title class_">Access</span> <span class="title class_">Server</span>     (<span class="number">00001132</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">PnP</span> <span class="title class_">Information</span>           (<span class="number">00001200</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">IrMC</span> <span class="title class_">Sync</span>                 (<span class="number">00001104</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Vendor</span> specific           (<span class="number">00005005</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-0002ee000001)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Headset</span> <span class="variable constant_">AG</span>                (<span class="number">00001112</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: A/V <span class="title class_">Remote</span> <span class="title class_">Control</span> <span class="title class_">Target</span> (0000110c-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Generic</span> <span class="title class_">Attribute</span> <span class="title class_">Profile</span> (<span class="number">00001801</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Phonebook</span> <span class="title class_">Access</span> <span class="title class_">Server</span>   (0000112f-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Audio</span> <span class="title class_">Sink</span>                (0000110b-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Generic</span> <span class="title class_">Access</span> <span class="title class_">Profile</span>    (<span class="number">00001800</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Headset</span>                   (<span class="number">00001108</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Audio</span> <span class="title class_">Source</span>              (0000110a-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="variable constant_">OBEX</span> <span class="title class_">File</span> <span class="title class_">Transfer</span>        (<span class="number">00001106</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="title class_">Modalias</span>: <span class="attr">usb</span>:v1D6Bp0246d0535</span><br><span class="line"><span class="title class_">Discovering</span>: no</span><br><span class="line"><span class="title class_">Advertising</span> <span class="title class_">Features</span>:</span><br><span class="line"><span class="title class_">ActiveInstances</span>: <span class="number">0x00</span></span><br><span class="line"><span class="title class_">SupportedInstances</span>: <span class="number">0x05</span></span><br><span class="line"><span class="title class_">SupportedIncludes</span>: tx-power</span><br><span class="line"><span class="title class_">SupportedIncludes</span>: appearance</span><br><span class="line"><span class="title class_">SupportedIncludes</span>: local-name</span><br><span class="line"><span class="title class_">SupportedSecondaryChannels</span>: 1M</span><br><span class="line"><span class="title class_">SupportedSecondaryChannels</span>: 2M</span><br><span class="line"><span class="title class_">SupportedSecondaryChannels</span>: <span class="title class_">Coded</span></span><br></pre></td></tr></table></figure><p>如果没有显示，那么蓝牙设备可能有问题，以下操作将不会解决问题</p><p>正常显示，则执行以下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">agent on</span><br><span class="line">default-agent</span><br><span class="line">power on</span><br><span class="line">pairable on</span><br></pre></td></tr></table></figure><p><strong>将设备调至配对模式</strong>，扫描设备</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan on</span><br></pre></td></tr></table></figure><p>显示设备</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devices</span><br></pre></td></tr></table></figure><p>出现类似内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Device 00:0E:0E:16:20:FF 00-0E-0E-16-20-FF</span><br><span class="line">Device 00:0E:0B:16:11:9F ZK#001#104</span><br><span class="line">Device 94:17:00:46:AC:8F Redmi K30 Ultra</span><br><span class="line">Device 10:63:C8:E8:26:DC 10-63-C8-E8-26-DC</span><br><span class="line">Device EC:7E:FC:28:DD:3F Mi Smart Band 4</span><br><span class="line">Device 60:AB:67:79:3D:8D 1432412001的MI 9 SE</span><br><span class="line">Device 00:0E:0B:16:20:FF 00-0E-0B-16-20-FF</span><br><span class="line">Device 46:C9:D5:E7:84:A5 46-C9-D5-E7-84-A5</span><br><span class="line">Device 00:0E:0B:14:F3:08 00-0E-0B-14-F3-08</span><br><span class="line">Device 7C:2A:DB:54:4E:F6 7C-2A-DB-54-4E-F6</span><br><span class="line">Device 9C:6B:72:B0:FB:36 realme X2</span><br><span class="line">Device 00:00:12:44:48:34 ShanghaiTieTaWang</span><br><span class="line">Device 6C:06:D6:2F:A5:C1 FreeBuds 3</span><br></pre></td></tr></table></figure><p>安装<code>pulseaudio-module-bluetooth</code>（如果像我一样pair failed的话）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install pulseaudio-module-bluetooth </span><br><span class="line">pulseaudio -k</span><br><span class="line">pulseaudio --start</span><br></pre></td></tr></table></figure><p>然后连接设备</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trust [MAC_ADDRESS]</span><br><span class="line">pair [MAC_ADDRESS]</span><br><span class="line">connect [MAC_ADDRESS]</span><br></pre></td></tr></table></figure><p>终于成功</p><p>退出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> 折腾 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu踩坑：资源占用情况低但显示仍然卡顿</title>
      <link href="/2021/4/61aa3931e5e3/"/>
      <url>/2021/4/61aa3931e5e3/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>系统：Ubuntu20.04 以及 Ubuntu18.04</p><p>无论是拖动滑动条，还是播放视频，还是切换屏幕都会有间断性的卡顿</p><p>这是一个一直困扰我的问题，以至于我认为是Ubuntu自身的问题，我在Ubuntu的体验上一直不如windows上丝滑，他会有间断性的卡顿，以至于我感觉是帧率太低或者其他的原因</p><h2 id="初步尝试过程"><a href="#初步尝试过程" class="headerlink" title="初步尝试过程"></a>初步尝试过程</h2><p>我怀疑是nvidia驱动的问题，于是我尝试卸载并重新安装nvidia驱动，问题依然没有解决。于是我又更新了Ubuntu内核，但是无效</p><p>那么真的是帧率低吗</p><p>我尝试使用<code>mesa-utils</code>用<code>glxgears</code>来监视帧率，发现能够一直保持在140以上，这显然是不低的。</p><p>我又将nvidia驱动禁用，使用intel集显，但没有改变卡顿问题。</p><p>我将这个问题搁置又拾起了多次</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>在多次搜索之后竟然偶然在csdn上找到了一个相同的问题<a href="https://blog.csdn.net/qq_43334196/article/details/107374390">https://blog.csdn.net/qq_43334196&#x2F;article&#x2F;details&#x2F;107374390</a><br>我发现我也安装了这个所谓的“系统监视器”，安装命令是 <code>sudo apt install indicator-multiload</code></p><p>（所以在你翻到这篇文章后一定不要用它了）</p><p>你在首选项中能找到这样的东西</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/Untitled.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/Untitled.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>于是它每次检测的时候你的界面就会卡顿一次，体验非常不好</p><p>于是<strong>卸载</strong>它就行了</p><p><strong>但是我目前依然不清楚卡顿的内部原因，按道理检测系统资源是不会卡顿的，现在我的Ubuntu异常丝滑了</strong></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> 折腾 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用go-cqhttp搭建qqbot</title>
      <link href="/2021/4/2b48558f4b48/"/>
      <url>/2021/4/2b48558f4b48/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>好久没写博客了（同时前几篇也太水了），之前在折腾博客基建，这段时间也搞了一堆东西，虽然有记录，但是没时间整理一下然后写出来，刚好最近没有什么</p><span id="more"></span><p>事，本来想实践一下微信小程序和微信公众号的开发，奈何没有成年，申请不了，于是被打回来写qqbot，本着好玩的目的，但是实践的过程中还是遇到了一些困难，由于缺乏基本认识而踩了一堆坑</p><h2 id="QQ-协议端搭建"><a href="#QQ-协议端搭建" class="headerlink" title="QQ 协议端搭建"></a>QQ 协议端搭建</h2><p>没错，这个东西叫协议端！</p><p>目前比较常见的有：</p><ul><li><a href="https://link.zhihu.com/?target=https://github.com/Mrs4s/go-cqhttp">go-cqhttp</a> (基于 <a href="https://link.zhihu.com/?target=https://github.com/Mrs4s/MiraiGo">MiraiGo</a>)</li><li><a href="https://link.zhihu.com/?target=https://github.com/yyuueexxiinngg/cqhttp-mirai/tree/embedded">cqhttp-mirai-embedded</a></li><li><a href="https://link.zhihu.com/?target=https://github.com/mamoe/mirai">Mirai</a> + <a href="https://link.zhihu.com/?target=https://github.com/yyuueexxiinngg/cqhttp-mirai">cqhttp-mirai</a></li><li><a href="https://link.zhihu.com/?target=https://github.com/mamoe/mirai">Mirai</a> + <a href="https://link.zhihu.com/?target=https://github.com/iTXTech/mirai-native">Mirai Native</a> + <a href="https://link.zhihu.com/?target=https://github.com/richardchien/coolq-http-api">CQHTTP</a></li><li><a href="https://link.zhihu.com/?target=https://github.com/takayama-lily/onebot">OICQ-http-api</a> (基于 <a href="https://link.zhihu.com/?target=https://github.com/takayama-lily/oicq">OICQ</a>)</li><li><em>酷Q (已停止开发)</em></li></ul><p>（来自知乎）</p><p>我这里采用go-cqhttp，采用其他的基本也相同，最重要的是要基于onebot标准</p><p>关于如何搭建可以看<a href="https://docs.go-cqhttp.org/guide/">文档</a></p><p>首先编写<code>config.hjson</code>文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">    go-cqhttp 默认配置文件</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    // QQ号</span><br><span class="line">    uin: 0</span><br><span class="line">    // QQ密码</span><br><span class="line">    password: &quot;&quot;</span><br><span class="line">    // 是否启用密码加密</span><br><span class="line">    encrypt_password: false</span><br><span class="line">    // 加密后的密码, 如未启用密码加密将为空, 请勿随意修改.</span><br><span class="line">    password_encrypted: &quot;&quot;</span><br><span class="line">    // 是否启用内置数据库</span><br><span class="line">    // 启用将会增加10-20MB的内存占用和一定的磁盘空间</span><br><span class="line">    // 关闭将无法使用 撤回 回复 get_msg 等上下文相关功能</span><br><span class="line">    enable_db: true</span><br><span class="line">    // 访问密钥, 强烈推荐在公网的服务器设置</span><br><span class="line">    access_token: &quot;&quot;</span><br><span class="line">    // 重连设置</span><br><span class="line">    relogin: &#123;</span><br><span class="line">        // 是否启用自动重连</span><br><span class="line">        // 如不启用掉线后将不会自动重连</span><br><span class="line">        enabled: true</span><br><span class="line">        // 重连延迟, 单位秒</span><br><span class="line">        relogin_delay: 3</span><br><span class="line">        // 最大重连次数, 0为无限制</span><br><span class="line">        max_relogin_times: 0</span><br><span class="line">    &#125;</span><br><span class="line">    // API限速设置</span><br><span class="line">    // 该设置为全局生效</span><br><span class="line">    // 原 cqhttp 虽然启用了 rate_limit 后缀, 但是基本没插件适配</span><br><span class="line">    // 目前该限速设置为令牌桶算法, 请参考: </span><br><span class="line">    // https://baike.baidu.com/item/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95/6597000?fr=aladdin</span><br><span class="line">    _rate_limit: &#123;</span><br><span class="line">        // 是否启用限速</span><br><span class="line">        enabled: false</span><br><span class="line">        // 令牌回复频率, 单位秒</span><br><span class="line">        frequency: 1</span><br><span class="line">        // 令牌桶大小</span><br><span class="line">        bucket_size: 1</span><br><span class="line">    &#125;</span><br><span class="line">    // 是否忽略无效的CQ码</span><br><span class="line">    // 如果为假将原样发送</span><br><span class="line">    ignore_invalid_cqcode: false</span><br><span class="line">    // 是否强制分片发送消息</span><br><span class="line">    // 分片发送将会带来更快的速度</span><br><span class="line">    // 但是兼容性会有些问题</span><br><span class="line">    force_fragmented: false</span><br><span class="line">    // 心跳频率, 单位秒</span><br><span class="line">    // -1 为关闭心跳</span><br><span class="line">    heartbeat_interval: 0</span><br><span class="line">    // HTTP设置</span><br><span class="line">    http_config: &#123;</span><br><span class="line">        // 是否启用正向HTTP服务器</span><br><span class="line">        enabled: true</span><br><span class="line">        // 服务端监听地址</span><br><span class="line">        host: 127.0.0.1</span><br><span class="line">        // 服务端监听端口</span><br><span class="line">        port: 22333</span><br><span class="line">        // 反向HTTP超时时间, 单位秒</span><br><span class="line">        // 最小值为5，小于5将会忽略本项设置</span><br><span class="line">        timeout: 0</span><br><span class="line">        // 反向HTTP POST地址列表</span><br><span class="line">        // 格式: </span><br><span class="line">        // &#123;</span><br><span class="line">        //    地址: secret</span><br><span class="line">        // &#125;</span><br><span class="line">        post_urls:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 正向WS设置</span><br><span class="line">    ws_config: &#123;</span><br><span class="line">        // 是否启用正向WS服务器</span><br><span class="line">        enabled: false</span><br><span class="line">        // 正向WS服务器监听地址</span><br><span class="line">        host: 127.0.0.1</span><br><span class="line">        // 正向WS服务器监听端口</span><br><span class="line">        port: 6700</span><br><span class="line">    &#125;</span><br><span class="line">    // 反向WS设置</span><br><span class="line">    ws_reverse_servers: [</span><br><span class="line">        // 可以添加多个反向WS推送</span><br><span class="line">        &#123;</span><br><span class="line">            // 是否启用该推送</span><br><span class="line">            enabled: true</span><br><span class="line">            // 反向WS Universal 地址</span><br><span class="line">            // 注意 设置了此项地址后下面两项将会被忽略</span><br><span class="line">            // 留空请使用 &quot;&quot;</span><br><span class="line">            reverse_url: ws://127.0.0.1:22334/</span><br><span class="line">            // 反向WS API 地址</span><br><span class="line">            reverse_api_url: ws://you_websocket_api.server</span><br><span class="line">            // 反向WS Event 地址</span><br><span class="line">            reverse_event_url: ws://you_websocket_event.server</span><br><span class="line">            // 重连间隔 单位毫秒</span><br><span class="line">            reverse_reconnect_interval: 3000</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    // 上报数据类型</span><br><span class="line">    // 可选: string array</span><br><span class="line">    post_message_format: string</span><br><span class="line">    // 是否使用服务器下发的新地址进行重连</span><br><span class="line">    // 注意, 此设置可能导致在海外服务器上连接情况更差</span><br><span class="line">    use_sso_address: false</span><br><span class="line">    // 是否启用 DEBUG</span><br><span class="line">    debug: false</span><br><span class="line">    // 日志等级 trace,debug,info,warn,error</span><br><span class="line">    log_level: &quot;info&quot;</span><br><span class="line">    // WebUi 设置</span><br><span class="line">    web_ui: &#123;</span><br><span class="line">        // 是否启用 WebUi</span><br><span class="line">        enabled: false</span><br><span class="line">        // 监听地址</span><br><span class="line">        host: 127.0.0.1</span><br><span class="line">        // 监听端口</span><br><span class="line">        web_ui_port: 9999</span><br><span class="line">        // 是否接收来自web的输入</span><br><span class="line">        web_input: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>./go-cqhttp</code>运行后需要进行滑块认证，在浏览器抓取<code>cap_union_new_verify</code> 的返回值，然后把ticket的值输入就行了。</p><p>此时协议端搭建完毕</p><p><strong>注：记得iptable开放相应端口</strong></p><h2 id="后端搭建"><a href="#后端搭建" class="headerlink" title="后端搭建"></a>后端搭建</h2><h3 id="一、使用机器人框架"><a href="#一、使用机器人框架" class="headerlink" title="一、使用机器人框架"></a>一、使用机器人框架</h3><p>不得不说python的nonebot和nonebot2实在是太方便了，文档也十分详细。</p><p>如果你只是想要一个qqbot，推荐使用以上两个框架，大概几个小时就能实现一个bot</p><p>如果你想用go来写，也可以用<a href="https://github.com/wdvxdr1123/ZeroBot">ZeroBot</a>来作为你的框架</p><h3 id="二、写后端来调用协议"><a href="#二、写后端来调用协议" class="headerlink" title="二、写后端来调用协议"></a>二、写后端来调用协议</h3><p>虽然框架很好用（单指python的库）</p><p>但由于觉得好玩，我还是头铁地使用了go来开发</p><p>找不到真正合适的go开发框架，于是自己写websocket来对接</p><p>go websocket的使用请自行学习，这里简单描述搭建服务的过程，细节可以参考我的代码部分<a href="https://github.com/RyaoChengfeng/rinqqbot/blob/main/controller/ws.go">https://github.com/RyaoChengfeng/rinqqbot/blob/main/controller/ws.go</a></p><ul><li>http监听ws反向端口<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">controller.StartWebsocket()  </span><br><span class="line">err:= http.ListenAndServe(config.Addr+<span class="string">`:`</span>+config.WsPort,<span class="literal">nil</span>)  </span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line"> fmt.Println(err)  </span><br><span class="line"> os.Exit(<span class="number">1</span>)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>将http升级为ws并启动ws<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> wsConnection <span class="keyword">struct</span> &#123;  </span><br><span class="line"> wsSocket *websocket.Conn <span class="comment">// 底层websocket  </span></span><br><span class="line"> inChan   <span class="keyword">chan</span> *wsMessage <span class="comment">// 读队列  </span></span><br><span class="line"> outChan  <span class="keyword">chan</span> *wsMessage <span class="comment">// 写队列  </span></span><br><span class="line">  </span><br><span class="line"> mutex     sync.Mutex <span class="comment">// 避免重复关闭管道,加锁处理  </span></span><br><span class="line"> isClosed  <span class="type">bool</span>  </span><br><span class="line"> closeChan <span class="keyword">chan</span> <span class="type">byte</span> <span class="comment">// 关闭通知  </span></span><br><span class="line"> id        <span class="type">int64</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> upgrader = websocket.Upgrader&#123;  </span><br><span class="line"> ReadBufferSize:  <span class="number">1024</span>,  </span><br><span class="line"> WriteBufferSize: <span class="number">1024</span>,  </span><br><span class="line"> <span class="comment">// 允许所有的CORS 跨域请求，正式环境可以关闭  </span></span><br><span class="line"> CheckOrigin: <span class="function"><span class="keyword">func</span><span class="params">(r *http.Request)</span></span> <span class="type">bool</span> &#123;  </span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span>  </span><br><span class="line"> &#125;,  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StartWebsocket</span><span class="params">()</span></span> &#123;  </span><br><span class="line"> WsConnAll = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int64</span>]*wsConnection)  </span><br><span class="line"> http.HandleFunc(<span class="string">&quot;/&quot;</span>, wsHandler)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wsHandler</span><span class="params">(rsp http.ResponseWriter, req *http.Request)</span></span> &#123;  </span><br><span class="line"> <span class="comment">// 应答客户端告知升级连接为websocket  </span></span><br><span class="line"> wsSocket, err := upgrader.Upgrade(rsp, req, <span class="literal">nil</span>)  </span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line"> log.Logger.Error(<span class="string">&quot;升级为websocket失败&quot;</span>, err.Error())  </span><br><span class="line"> &#125; maxConnId++  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">// 连接数保持一定数量，超过的部分不提供服务  </span></span><br><span class="line"> <span class="comment">// 如果要控制连接数可以计算WsConnAll长度 len(WsConnAll) wsConn := &amp;wsConnection&#123;  </span></span><br><span class="line"> wsSocket:  wsSocket,  </span><br><span class="line"> inChan:    <span class="built_in">make</span>(<span class="keyword">chan</span> *wsMessage, <span class="number">1000</span>),  </span><br><span class="line"> outChan:   <span class="built_in">make</span>(<span class="keyword">chan</span> *wsMessage, <span class="number">1000</span>),  </span><br><span class="line"> closeChan: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">byte</span>),  </span><br><span class="line"> isClosed:  <span class="literal">false</span>,  </span><br><span class="line"> id:        maxConnId,  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> WsConnAll[maxConnId] = wsConn  </span><br><span class="line">   <span class="comment">// 处理器,发送定时信息，避免意外关闭  </span></span><br><span class="line"> <span class="keyword">go</span> processLoop(wsConn)  </span><br><span class="line"> <span class="comment">// 读协程  </span></span><br><span class="line"> <span class="keyword">go</span> wsReadLoop(wsConn)  </span><br><span class="line"> <span class="comment">// 写协程  </span></span><br><span class="line"> <span class="keyword">go</span> wsWriteLoop(wsConn)  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>在多线程中处理协议端发来的message，并提取信息进行调用协议端api<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">err = json.Unmarshal(msg.data, &amp;msgData)  </span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line"> log.Logger.Error(<span class="string">&quot;json信息解析错误&quot;</span>, err.Error())  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//log.Logger.Debug(&quot;收到消息：&quot;,msgData)  </span></span><br><span class="line">HandleWsMsg(msgData)</span><br></pre></td></tr></table></figure></li><li>在<code>HandleWsMsg</code>中进行bot功能实现<br>message结构请参考对应的协议文档，以及基于onebot标准的协议的onebot标准，具体参考下方链接</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://docs.go-cqhttp.org/">go-cqhttp文档</a>  </li><li><a href="https://github.com/howmanybots/onebot/blob/master/v11/specs/README.md">Onebot标准</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> go </tag>
            
            <tag> qqbot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-1-链表</title>
      <link href="/2020/12/2fb9b06514d1/"/>
      <url>/2020/12/2fb9b06514d1/</url>
      
        <content type="html"><![CDATA[<h3 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h3><p>指针大法好</p><p>真正到学习数据结构的时候才发现自己对指针的特性理解得非常肤浅，在真正使用链表的时候卡了很久</p><hr><blockquote><p>  核心</p></blockquote><p>增</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">p-&gt;data=*data++; <span class="comment">//data为数据集合</span></span><br><span class="line">p-&gt;next=L-&gt;next;</span><br><span class="line">L-&gt;next=p;</span><br></pre></td></tr></table></figure><p>删</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Link *q;</span><br><span class="line">q=p-&gt;next;</span><br><span class="line">p-&gt;next=q-&gt;next;</span><br><span class="line"><span class="built_in">free</span>(q);</span><br></pre></td></tr></table></figure><p>查</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e=p-&gt;data; <span class="comment">//e为节点data</span></span><br></pre></td></tr></table></figure><p>插</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Link *s;</span><br><span class="line">s=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Link));</span><br><span class="line">s-&gt;data=e; <span class="comment">//e为节点data</span></span><br><span class="line">s-&gt;next=p-&gt;next;</span><br><span class="line">p-&gt;next=s;</span><br></pre></td></tr></table></figure><blockquote><p>  实现</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> Elemtype;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    Elemtype data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> <span class="title">Link</span>;</span></span><br><span class="line"></span><br><span class="line">Link **head;</span><br><span class="line">Link **tail;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先进后出link</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">d_CreateLink</span><span class="params">(Link **L,Elemtype data[],<span class="type">int</span> n)</span>&#123;</span><br><span class="line">    Link *p;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    *L=(Link *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">    (*L)-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        p-&gt;data=*data++;</span><br><span class="line">        p-&gt;next=(*L)-&gt;next;</span><br><span class="line">        (*L)-&gt;next=p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//先进先出link</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">CreateLink</span><span class="params">(Link **L,Elemtype data[],<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    Link *p,*r;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    *L=(Link *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">    r=*L;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        p-&gt;data=*data++;</span><br><span class="line">        r-&gt;next=p;</span><br><span class="line">        r=p;</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增量式单链表（正序）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">AddLink</span><span class="params">(Link **L,Elemtype data[],<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    Link *p,*r;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">if</span> (tail!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        r=*tail;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        *L=(Link *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        r=*L;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        p-&gt;data=*data++;</span><br><span class="line">        r-&gt;next=p;</span><br><span class="line">        r=p;</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">    *tail=r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到第i个节点的data</span></span><br><span class="line">Elemtype <span class="title function_">GetElem</span><span class="params">(Link *L,<span class="type">int</span> i,Elemtype e)</span>&#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    Link *p;</span><br><span class="line">    p=L-&gt;next;</span><br><span class="line">    j=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p&amp;&amp;j&lt;i)&#123;</span><br><span class="line">        p=p-&gt;next;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!p||j&gt;i)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    e=p-&gt;data;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在第i个节点之前插入新的node，L长度+1</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InsertElem</span><span class="params">(Link *L,<span class="type">int</span> i,Elemtype e)</span>  &#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    Link *p,*s;</span><br><span class="line">    p=L;</span><br><span class="line">    j=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p&amp;&amp;j&lt;i)&#123;</span><br><span class="line">        p=p-&gt;next;</span><br><span class="line">        ++j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!p||j&gt;i) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Link));</span><br><span class="line">    s-&gt;data=e;</span><br><span class="line">    s-&gt;next=p-&gt;next;</span><br><span class="line">    p-&gt;next=s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Elemtype <span class="title function_">DeleteElem</span><span class="params">(Link *L,<span class="type">int</span> i,Elemtype e)</span>&#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    Link *p,*q;</span><br><span class="line">    p=L;</span><br><span class="line">    j=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p-&gt;next&amp;&amp;j&lt;i)&#123;</span><br><span class="line">        p=p-&gt;next;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!(p-&gt;next)||j&gt;i)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    q=p-&gt;next;</span><br><span class="line">    p-&gt;next=q-&gt;next;</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 线性表 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法题解(3)-贪心</title>
      <link href="/2020/12/0980416f6804/"/>
      <url>/2020/12/0980416f6804/</url>
      
        <content type="html"><![CDATA[<h4 id="P2240-【深基12-例1】部分背包问题"><a href="#P2240-【深基12-例1】部分背包问题" class="headerlink" title="P2240 【深基12.例1】部分背包问题"></a>P2240 【深基12.例1】部分背包问题</h4><p>好像只是数学问题，用单位价格排出性价比，取从大到小直到装满就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">mon</span>&#123;</span><br><span class="line">    <span class="type">int</span> w,v;</span><br><span class="line">    <span class="type">double</span> bili;</span><br><span class="line">&#125;money[<span class="number">110</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(mon *a,mon *b)</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> t=a-&gt;bili;</span><br><span class="line">    a-&gt;bili=b-&gt;bili;</span><br><span class="line">    b-&gt;bili=t;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> d=a-&gt;w;</span><br><span class="line">    a-&gt;w=b-&gt;w;</span><br><span class="line">    b-&gt;w=d;</span><br><span class="line"></span><br><span class="line">    d=a-&gt;v;</span><br><span class="line">    a-&gt;v=b-&gt;v;</span><br><span class="line">    b-&gt;v=d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(mon arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">nullptr</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">double</span> pivot = arr[<span class="built_in">rand</span>() % len].bili;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i].bili &gt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &gt; arr[i].bili)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,bag;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;bag);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;money[i].w,&amp;money[i].v);</span><br><span class="line">        <span class="keyword">if</span> (money[i].w==<span class="number">0</span>) money[i].bili=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> money[i].bili=<span class="number">1.0</span>*money[i].v/money[i].w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(money,n);</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (bag&gt;=money[i].w)&#123;</span><br><span class="line">        bag-=money[i].w;</span><br><span class="line">        sum+=money[i].v;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    sum+=bag*money[i].bili;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf&quot;</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P1090合并果子"><a href="#P1090合并果子" class="headerlink" title="P1090合并果子"></a>P1090合并果子</h4><p>刚看到题目心想，这不就是个数学题嘛，排完序一个个加起来就好了，然后配合官方巨水的样例测一下后，一下就提交了。</p><p>之后陷入了疯狂tl和wa的窘境。</p><p>思路如下，要得到最小的花费体力值，先将原数据排序，再将其放到for中进行循环过程来加出sum的值，每次将父列的第一个加到第二个后都要再排一次序来得到新子列，这样才能保证最小</p><p>所以在里面用一个时间复杂度低的插入排序就可以解决问题</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> pivot = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &lt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shell_sort</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> h = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &lt; length / <span class="number">3</span>) &#123;</span><br><span class="line">        h = <span class="number">3</span> * h + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &gt;= h &amp;&amp; arr[j] &lt; arr[j - h]; j -= h) &#123;</span><br><span class="line">                <span class="built_in">swap</span>(&amp;arr[j], &amp;arr[j - h]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        h = h / <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">int</span> guo[n+<span class="number">5</span>];</span><br><span class="line">    guo[n]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;guo[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> tili;</span><br><span class="line">    <span class="built_in">quick_sort</span>(guo,n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">shell_sort</span>((guo+i),n-i);</span><br><span class="line">        tili=<span class="number">0</span>;</span><br><span class="line">        tili+=(guo[i+<span class="number">1</span>]+guo[i]);</span><br><span class="line">        guo[i+<span class="number">1</span>]+=guo[i];</span><br><span class="line">        sum+=tili;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P1223-排队接水"><a href="#P1223-排队接水" class="headerlink" title="P1223 排队接水"></a>P1223 排队接水</h4><p>本是是很简单问题，莫名出了错</p><p>思路是先排序，再把时间加起来，再求平均就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">per</span> &#123;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">int</span> time;</span><br><span class="line">&#125;person[<span class="number">2000</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(per *a,per *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=a-&gt;time;</span><br><span class="line">    a-&gt;time=b-&gt;time;</span><br><span class="line">    b-&gt;time=t;</span><br><span class="line"></span><br><span class="line">    t=a-&gt;index;</span><br><span class="line">    a-&gt;index=b-&gt;index;</span><br><span class="line">    b-&gt;index=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(per arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> pivot = arr[<span class="built_in">rand</span>() % len].time;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i].time &lt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &lt; arr[i].time)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        person[i].index=i+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;person[i].time);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(person,n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,person[i].index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> shijian=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        shijian+=person[i].time;</span><br><span class="line">        sum+=shijian;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>,<span class="number">1.0</span>*sum/n);</span><br><span class="line">    <span class="comment">//?????我卡了半天,后面的1.0*sum/n是原本就有的,sum是int类型。</span></span><br><span class="line">    <span class="comment">//然后本是int的sum变成double,去掉了1.0,就又过了两个，但是第一个却过不了。</span></span><br><span class="line">    <span class="comment">//把1.0加上，就全部过了。离谱</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 贪心 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法题解(2)-二分</title>
      <link href="/2020/12/4cd8ae11fe0e/"/>
      <url>/2020/12/4cd8ae11fe0e/</url>
      
        <content type="html"><![CDATA[<h4 id="洛谷P1873-砍树"><a href="#洛谷P1873-砍树" class="headerlink" title="洛谷P1873 砍树"></a>洛谷P1873 砍树</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(a, b) a&gt;b?a:b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN(a, b) a&gt;b?b:a</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> N, M, mid, length;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld %lld&quot;</span>, &amp;N, &amp;M);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> l = <span class="number">0</span>, s = <span class="number">1000000000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> height[N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;height[i]);</span><br><span class="line">        l = <span class="built_in">MAX</span>(height[i], l);</span><br><span class="line">        s = <span class="built_in">MIN</span>(height[i], s);</span><br><span class="line">    &#125;</span><br><span class="line">    mid = s + ((l - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (s + <span class="number">1</span> &lt; l) &#123;</span><br><span class="line">        length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mid &lt; height[i]) length += height[i] - mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (length &gt;= M) &#123;</span><br><span class="line">            s = mid;</span><br><span class="line">            mid = s + ((l - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            l = mid;</span><br><span class="line">            mid = s + ((l - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, mid);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P2249-【深基13-例1】查找"><a href="#洛谷P2249-【深基13-例1】查找" class="headerlink" title="洛谷P2249 【深基13.例1】查找"></a>洛谷P2249 【深基13.例1】查找</h4><p>就是写二分，但是要注意输出最左边，也就是最小的，怎么找出左边界需要想一下（于是我一直wa</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> len, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = len;</span><br><span class="line">    <span class="type">int</span> mid;</span><br><span class="line">    <span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">        mid =l + (r-l)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (arr[mid] &lt; value)</span><br><span class="line">            l = mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (arr[l]==value)</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="type">int</span> number[n+<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;number[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;value);</span><br><span class="line">        index=<span class="built_in">find</span>(number,n,value);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1678-烦恼的高考志愿"><a href="#洛谷P1678-烦恼的高考志愿" class="headerlink" title="洛谷P1678 烦恼的高考志愿"></a>洛谷P1678 烦恼的高考志愿</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">min</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> min;</span><br><span class="line">    <span class="keyword">if</span> (a&lt;b)min=a;</span><br><span class="line">    <span class="keyword">else</span> min=b;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="type">int</span> school[n+<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;school[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    std::<span class="built_in">sort</span>(school,school+n);</span><br><span class="line">    <span class="type">int</span> stu[m+<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;stu[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> l=<span class="number">0</span>,r=n;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">            <span class="type">int</span> mid=(l+r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(school[mid]&lt;=stu[i])&#123;</span><br><span class="line">                l=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                r=mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stu[i]&lt;=school[<span class="number">0</span>])&#123;</span><br><span class="line">            sum+=school[<span class="number">0</span>]-stu[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            sum+=<span class="built_in">min</span>(<span class="built_in">abs</span>(school[l<span class="number">-1</span>]-stu[i]),<span class="built_in">abs</span>(school[l]-stu[i]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P2440-木材加工"><a href="#P2440-木材加工" class="headerlink" title="P2440 木材加工"></a>P2440 木材加工</h4><p>和砍树问题的思路一样，另写一个函数来判断是否符合要求，然后用二分法确定最大的值即可</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> n, k;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> a[<span class="number">1000005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">jd</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        sum += a[i] / x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum&gt;=k)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> l = <span class="number">0</span>, r = <span class="number">100000001</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> mid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (l + <span class="number">1</span> &lt; r) &#123;</span><br><span class="line">        mid = l+(r-l)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">jd</span>(mid)) &#123;</span><br><span class="line">            l = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,l);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P2678-跳石头"><a href="#P2678-跳石头" class="headerlink" title="P2678 跳石头"></a>P2678 跳石头</h4><p>同样的二分套路，这里定义了所在石头和下一个石头，mid大于间距时，将石头搬走，同时计数，mid小与或等于间距时，进入下一个石头。当搬走的总数要小于预计的数目时，证明mid偏小，将left右移，否则right左移，最终得到正确的mid。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> num[<span class="number">100000</span>];</span><br><span class="line"><span class="type">long</span> l,n,m,dis=<span class="number">0</span>,first=<span class="number">0</span>,end;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">jd</span><span class="params">(<span class="type">long</span> mid)</span></span>&#123;</span><br><span class="line">    <span class="type">long</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> temp=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= n)&#123;</span><br><span class="line">        first=num[temp];</span><br><span class="line">        end=num[i];</span><br><span class="line">        dis=end-first;</span><br><span class="line">        <span class="keyword">if</span> (dis&lt;mid)&#123;</span><br><span class="line">            sum++;</span><br><span class="line">        &#125; <span class="keyword">else</span> temp=i;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum&lt;=m)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%ld%ld%ld&quot;</span>,&amp;l,&amp;n,&amp;m);</span><br><span class="line">    num[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%ld&quot;</span>,&amp;num[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> left=<span class="number">0</span>,right=l,mid,rst;</span><br><span class="line">    <span class="keyword">while</span> (left&lt;=right)&#123;</span><br><span class="line">        mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">jd</span>(mid))&#123;</span><br><span class="line">            rst=mid;</span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> right=mid<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%ld&quot;</span>,rst);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 二分查找 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法题解(1)-排序</title>
      <link href="/2020/12/a7d68e1b79ca/"/>
      <url>/2020/12/a7d68e1b79ca/</url>
      
        <content type="html"><![CDATA[<h3 id="排序（c-）"><a href="#排序（c-）" class="headerlink" title="排序（c++）"></a>排序（c++）</h3><p>虽然是c++，其实是c语法</p><h4 id="洛谷P1271-选举学生会"><a href="#洛谷P1271-选举学生会" class="headerlink" title="洛谷P1271 选举学生会"></a>洛谷P1271 选举学生会</h4><p>已经得知了数据范围，使用桶排序</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">    <span class="type">int</span> bucket[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n+<span class="number">1</span>; ++i) &#123;</span><br><span class="line">        bucket[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">        bucket[num] += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n+<span class="number">1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; bucket[i]; ++j) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1923-找出第k小的数"><a href="#洛谷P1923-找出第k小的数" class="headerlink" title="洛谷P1923 找出第k小的数"></a>洛谷P1923 找出第k小的数</h4><p>练习快排和分治</p><p>判断排序后两边数组长度，选择一边进行递归</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意题目中最小数序号是0</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findi_quicksort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len,<span class="type">int</span> index)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len&lt;=<span class="number">1</span>) <span class="keyword">return</span> arr[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> temp = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,k=len;</span><br><span class="line">    <span class="keyword">while</span> (i&lt;k)&#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; temp)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (temp &lt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index&lt;j) <span class="keyword">return</span> <span class="built_in">findi_quicksort</span>(arr, j,index);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (index&gt;=k) <span class="keyword">return</span> <span class="built_in">findi_quicksort</span>(arr + k, len - k,index-k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,i;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;i);</span><br><span class="line">    <span class="type">int</span> number[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;number[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">findi_quicksort</span>(number,n,i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1059-明明的随机数"><a href="#洛谷P1059-明明的随机数" class="headerlink" title="洛谷P1059 明明的随机数"></a>洛谷P1059 明明的随机数</h4><p>数据范围不大，可以用桶排序</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> bucket[<span class="number">1001</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> number;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> &amp;i : bucket) &#123;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;number);</span><br><span class="line">        bucket[number]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1001</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bucket[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1001</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bucket[i] &gt; <span class="number">0</span>) &#123; </span><br><span class="line">            count++;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr>P1059重新想了一下，也可以用快排<p>排序完后检测重复然后跳过就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>*a,<span class="type">int</span>*b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quicksort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len&lt;=<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> temp = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,k=len;</span><br><span class="line">    <span class="keyword">while</span> (i&lt;k)&#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i]&lt;temp)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i],&amp;arr[j]);</span><br><span class="line">            j++;</span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(temp&lt;arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i],&amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;</span><br><span class="line">        &#125; <span class="keyword">else</span> i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(arr,j);</span><br><span class="line">    <span class="built_in">quicksort</span>(arr+k,len-k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">int</span> number[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;number[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    number[n+<span class="number">1</span>]=<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">quicksort</span>(number,n);</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="keyword">if</span> (number[i]==number[i+<span class="number">1</span>]) cnt--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (number[i] != number[i + <span class="number">1</span>]) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, number[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1093-奖学金"><a href="#洛谷P1093-奖学金" class="headerlink" title="洛谷P1093 奖学金"></a>洛谷P1093 奖学金</h4><p>结构体排序问题，挺有收获的，语法和算法方面。</p><p>先用快排排好结构体。注意写对swap函数</p><p>然后用冒泡排序的思想排出2,3条件即可</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">stu</span> &#123;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">int</span> cn, mh, en;</span><br><span class="line">    <span class="type">int</span> sum;</span><br><span class="line">&#125; student[<span class="number">310</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为什么用位运算交换就会错？</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(stu *a, stu *b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t=a-&gt;sum;</span><br><span class="line">    a-&gt;sum=b-&gt;sum;</span><br><span class="line">    b-&gt;sum=t;</span><br><span class="line"></span><br><span class="line">    t=a-&gt;cn;</span><br><span class="line">    a-&gt;cn=b-&gt;cn;</span><br><span class="line">    b-&gt;cn=t;</span><br><span class="line"></span><br><span class="line">    t=a-&gt;index;</span><br><span class="line">    a-&gt;index=b-&gt;index;</span><br><span class="line">    b-&gt;index=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quicksort</span><span class="params">(stu arr[], <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>) <span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> temp = arr[<span class="built_in">rand</span>() % len ].sum;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i].sum &gt; temp) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (temp &gt; arr[i].sum) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k - <span class="number">1</span>]);</span><br><span class="line">            k--;</span><br><span class="line">        &#125; <span class="keyword">else</span> i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quicksort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        student[i].index = i + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;student[i].cn, &amp;student[i].mh, &amp;student[i].en);</span><br><span class="line">        student[i].sum = student[i].cn + student[i].en + student[i].mh;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(student, n);</span><br><span class="line">    <span class="type">int</span> in = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (in == <span class="number">0</span>) &#123;</span><br><span class="line">        in = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (student[i].sum == student[i + <span class="number">1</span>].sum) &#123;</span><br><span class="line">                <span class="keyword">if</span> (student[i].cn &lt; student[i + <span class="number">1</span>].cn) &#123;</span><br><span class="line">                    <span class="built_in">swap</span>(&amp;student[i], &amp;student[i + <span class="number">1</span>]);</span><br><span class="line">                    in = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (student[i].cn == student[i + <span class="number">1</span>].cn &amp;&amp; student[i].index &gt; student[i + <span class="number">1</span>].index) &#123;</span><br><span class="line">                    <span class="built_in">swap</span>(&amp;student[i], &amp;student[i + <span class="number">1</span>]);</span><br><span class="line">                    in = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, student[i].index, student[i].sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1781-宇宙选举"><a href="#洛谷P1781-宇宙选举" class="headerlink" title="洛谷P1781 宇宙选举"></a>洛谷P1781 宇宙选举</h4><p>本来以为非常简单，但是发现涉及大整数处理（如果用python这种就丝毫没有问题）</p><p>只要选出一个，所以找出max就可以了，应该不用排序</p><p>感觉指针这种东西挺奇妙，结构体配上数组直接整死我。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">per</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">char</span> vote[<span class="number">1000</span>];</span><br><span class="line">&#125;person[<span class="number">25</span>];</span><br><span class="line"></span><br><span class="line">per <span class="title function_">max</span><span class="params">(per a,per b)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(a.vote)&gt;<span class="built_in">strlen</span>(b.vote))</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strlen</span>(a.vote)&lt;<span class="built_in">strlen</span>(b.vote))</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(a.vote, b.vote) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        person[i].index=i+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,person[i].vote);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(person[<span class="number">24</span>].vote,person[<span class="number">0</span>].vote);</span><br><span class="line">    person[<span class="number">24</span>].index=person[<span class="number">0</span>].index;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        person[<span class="number">24</span>].index=max(person[<span class="number">24</span>],person[i]).index;</span><br><span class="line">        <span class="built_in">strcpy</span>(person[<span class="number">24</span>].vote,max(person[<span class="number">24</span>],person[i]).vote);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,person[<span class="number">24</span>].index);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,person[<span class="number">24</span>].vote);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1104-生日"><a href="#洛谷P1104-生日" class="headerlink" title="洛谷P1104 生日"></a>洛谷P1104 生日</h4><p>可以用结构体做，用快排，之前写过一个了，不过这次想用c++的sort()试一下，就当自己练练c++的语法。</p><p>自己写一个cmp就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span>  <span class="comment">//万能头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std; <span class="comment">//没有这个底下的就都要std::</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">per</span> &#123;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="type">int</span> y, m, d, index;</span><br><span class="line">&#125; person[<span class="number">200</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(per a, per b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.y &lt; b.y)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (a.y &gt; b.y)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (a.y == b.y) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.m &lt; b.m)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (a.m &gt; b.m)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (a.m == b.m) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a.d &lt; b.d)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (a.d &gt; b.d)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (a.d == b.d) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a.index &gt; b.index)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; person[i].s &gt;&gt; person[i].y &gt;&gt; person[i].m &gt;&gt; person[i].d;</span><br><span class="line">        person[i].index = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(person + <span class="number">1</span>, person + n + <span class="number">1</span>, cmp);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)cout &lt;&lt; person[i].s &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="反思："><a href="#反思：" class="headerlink" title="反思："></a>反思：</h4><p>这种题可以用数学思维附上加权，然后排序就可以了，（通俗说就是加权加到一科考好就可以在其他科不考的情况下卷赢其他人）</p><p>貌似要多条件排序都可以这样做，比如</p><p>year*10000+mouth*100+day</p><p>如果部分条件是倒序就减掉就可以了:</p><p>score*10000+(10000-index)</p><h4 id="洛谷P1116-车厢重组"><a href="#洛谷P1116-车厢重组" class="headerlink" title="洛谷P1116 车厢重组"></a>洛谷P1116 车厢重组</h4><p>冒泡排序，加个count就可以了，单纯想熟悉一下</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>*a,<span class="type">int</span>*b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = *a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bubble_sort</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> in = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (in) &#123;</span><br><span class="line">        in = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; arr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                in = <span class="number">1</span>;</span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="built_in">swap</span>(&amp;arr[i],&amp;arr[i+<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">int</span> car[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;car[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">bubble_sort</span>(car,n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,cnt);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1068-分数线划定"><a href="#洛谷P1068-分数线划定" class="headerlink" title="洛谷P1068 分数线划定"></a>洛谷P1068 分数线划定</h4><p>又是结构体。。。那就用加权吧（</p><p>要注意weight[d-1]，用d就错了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> weight[<span class="number">5010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quicksort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> pivot = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &gt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &gt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quicksort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;a,&amp;b);</span><br><span class="line">        weight[i]=(b+<span class="number">1</span>)*<span class="number">10000</span>-a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(weight,n);</span><br><span class="line">    <span class="type">int</span> d=(<span class="type">int</span>)m*<span class="number">1.5</span>;</span><br><span class="line">    <span class="type">int</span> score=weight[d<span class="number">-1</span>]/<span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">while</span> (weight[d<span class="number">-1</span>]/<span class="number">10000</span>==score) &#123;</span><br><span class="line">        d++;</span><br><span class="line">    &#125;</span><br><span class="line">    d--;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,weight[d<span class="number">-1</span>]/<span class="number">10000</span>,d);</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (weight[i]/<span class="number">10000</span>&gt;=score)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,<span class="number">10000</span>-weight[i]%<span class="number">10000</span>,weight[i]/<span class="number">10000</span>);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P5143-攀爬者"><a href="#洛谷P5143-攀爬者" class="headerlink" title="洛谷P5143 攀爬者"></a>洛谷P5143 攀爬者</h4><p>又是结构体？感觉挺简单，却是个提高题</p><p>用加权，然后把距离加起来就可以了</p><p>后面的测试数据好大，用longlong</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">long</span> <span class="type">long</span> *a,<span class="type">long</span> <span class="type">long</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">long</span> <span class="type">long</span> arr[],<span class="type">long</span> <span class="type">long</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">long</span> <span class="type">long</span> pivot = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &lt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> location[n+<span class="number">1</span>];</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> x,y,z;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">        location[i]=z*<span class="number">100000000</span>+y*<span class="number">10000</span>+x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(location,n);</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> z1=location[i]/<span class="number">100000000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> y1=(location[i]%<span class="number">100000000</span>)/<span class="number">10000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> x1=(location[i]%<span class="number">100000000</span>)%<span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> z2=location[i+<span class="number">1</span>]/<span class="number">100000000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> y2=(location[i+<span class="number">1</span>]%<span class="number">100000000</span>)/<span class="number">10000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> x2=(location[i+<span class="number">1</span>]%<span class="number">100000000</span>)%<span class="number">10000</span>;</span><br><span class="line">        sum+=<span class="built_in">sqrt</span>(<span class="number">1.0</span>*((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)+(z2-z1)*(z2-z1)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.3Lf&quot;</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 排序 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用hexo搭建个人网站</title>
      <link href="/2020/12/c03d6b73cca7/"/>
      <url>/2020/12/c03d6b73cca7/</url>
      
        <content type="html"><![CDATA[<h1 id="用hexo搭建个人网站"><a href="#用hexo搭建个人网站" class="headerlink" title="用hexo搭建个人网站"></a>用hexo搭建个人网站</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>未成年，所以域名无法备案，然后网站前几天挂了，本来想用来做新生实践课的大作业，然而ddl</p><p>来了，网站却用不了</p><p>虽然我启用了81端口，nginx也监听了相应端口，然而WordPress却没有改配置（踩坑）。于是进去后就只是一个html。。WordPress管理端是默认端口，于是也没办法管了，只好迅速配一个hexo，刚好自己也准备做一个，只不过太忙了（所以现在更忙了，淦）</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>你需要github或者gitee的账号，以及git的基本操作知识</p><p>我的环境是Ubuntu。</p><p>要求：最新版本的nodejs、npm、git。具体安装 or 更新方法不在此赘述。</p><p><strong>请在自己的电脑上！而不是云服务器！</strong></p><p>使用npm安装hexo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g hexo -cil</span><br></pre></td></tr></table></figure><h2 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h2><p><strong>请全部用sudo（不然会出现权限问题）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init &lt;folder&gt;</span><br><span class="line">cd &lt;folder&gt;</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>若报错:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.js:39</span><br><span class="line">throw new ERR_CONSOLE_WRITABLE_STREAM(&#x27;stdout&#x27;);</span><br><span class="line">^</span><br><span class="line"></span><br><span class="line">TypeError [ERR_CONSOLE_WRITABLE_STREAM]: Console expects a writable stream instance for stdout</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>请更新npm和nodejs</p><p><strong>同时请保证文件夹内是空的！</strong></p><p>新建完成后，指定文件夹的目录如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   ├── _drafts</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure><p><strong>_config.yml</strong>：网站的 <a href="https://hexo.io/zh-cn/docs/configuration">配置</a> 信息，您可以在此配置大部分的参数</p><p>启动服务器。在路径下，命令行（即Git Bash）输入以下命令，运行即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>浏览器访问网址： <code>http://localhost:4000/</code></p><p>至此，您的Hexo博客已经搭建在本地。</p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>gitee新建仓库，名为自己的用户名</p><p>进入项目文件夹：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim _config.yml </span><br></pre></td></tr></table></figure><p>编辑theme来修改主题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: volantis</span><br></pre></td></tr></table></figure><p>终端输入（<strong>要在项目文件夹</strong>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-theme-volantis</span><br></pre></td></tr></table></figure><p>编辑<code>_config.yml</code> ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@gitee.com:himmi/himmi.git #或者https等等</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><p>安装插件,要在<strong>站点目录</strong>下执行以上安装:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>如果已经在其他目录安装了<code>hexo-deployer-git</code>插件，可以使用以下命令卸载该插件：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo hexo deploy</span><br></pre></td></tr></table></figure><p>至此，部署完毕。</p><p>剩下的配置请参考hexo的doc，主题的配置参考各自的doc（其实配置才是折腾的地方）</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://hexo.io/zh-cn/">https://hexo.io/zh-cn/</a></p><p><a href="https://www.simon96.online/2018/10/12/hexo-tutorial/">https://www.simon96.online/2018/10/12/hexo-tutorial/</a></p><p><a href="https://gitee.com/help/articles/4136#article-header3">https://gitee.com/help/articles/4136#article-header3</a></p><p><a href="https://blog.csdn.net/mqdxiaoxiao/article/details/95781368">https://blog.csdn.net/mqdxiaoxiao/article/details/95781368</a></p><p><a href="https://segmentfault.com/a/1190000011203711">https://segmentfault.com/a/1190000011203711</a></p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为网站配置https/http2</title>
      <link href="/2020/11/7b98a429154f/"/>
      <url>/2020/11/7b98a429154f/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前建站的时候就配过了一次了，刚好新人任务有要求，就简单记录一下</p><p>https由于传输原理的问题会比http要慢，在2012年谷歌提出SPDY的方案来应对https存在的延迟等问题。http2相比于https有了一些新特性。于是这里配置http2. </p><h2 id="配置http2"><a href="#配置http2" class="headerlink" title="配置http2"></a>配置http2</h2><p>使用免费的<a class="wp-editor-md-post-content-link" href="https://letsencrypt.org/">Let’s Encrypt</a>，在官网中会告诉你用 <a class="wp-editor-md-post-content-link" href="https://certbot.eff.org/">Certbot</a> ACME 客户端自动配置，进去选择自己的nginx版本和系统版本就好了。页面上会出现操作步骤。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install core;</span><br><span class="line">sudo snap refresh core</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install --classic certbot </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /snap/bin/certbot /usr/bin/certbot</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx</span><br></pre></td></tr></table></figure><p>于是certbot就自动配置好nginx </p><p>使用这个来自动续订：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew --dry-run</span><br></pre></td></tr></table></figure><hr>我们也可以手动折腾一下。<p>申请证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx --register-unsafely-without-email certonly</span><br></pre></td></tr></table></figure><p>选择对应的nginx配置文件（注意，它需要是正确可用的配置，可以执行<code>sudo nginx -t</code>来检查配置），此后letsencrypt证书将会自动生成在<code>/etc/letsencrypt/live/your_conf_file</code>中。</p><p>基本配置:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>; </span><br><span class="line">    <span class="attribute">server_name</span> yoursite;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2; </span><br><span class="line">    <span class="attribute">server_name</span> yoursite; </span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/your_conf_file/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your_conf_file/privkey.pem;</span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf;</span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此时https已配置完成。</p></blockquote><p>禁止不安全的协议:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4&#x27;</span>; </span><br></pre></td></tr></table></figure><p>启用HSTS:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>; </span><br><span class="line"><span class="attribute">add_header</span> Strict-Transport-Security max-age=<span class="number">15768000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>; </span><br><span class="line"><span class="attribute">server_name</span> yoursite;</span><br><span class="line"><span class="attribute">add_header</span> Strict-Transport-Security max-age=<span class="number">15768000</span>; </span><br><span class="line"><span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>  其他的安全配置</p></blockquote><p>缓存连接凭据:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">20m</span>;</span><br><span class="line"><span class="attribute">ssl_session_timeout</span> <span class="number">60m</span>;</span><br></pre></td></tr></table></figure><p>配置赫尔曼密钥:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">openssl</span> dhparam -out dhparam.pem <span class="number">2048</span> <span class="comment">#在 ssh 运行， openssl 生成 2048 位的密钥而不是当作参数写入 nginx.conf 文件</span></span><br><span class="line">ssl_dhparam /path/to/dhparam.pem; <span class="comment">#在 .conf 中配置</span></span><br></pre></td></tr></table></figure><p>OCSP 缝合</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>; </span><br><span class="line"><span class="attribute">ssl_trusted_certificate</span> /etc/nginx/cert/trustchain.crt; </span><br><span class="line"><span class="attribute">resolver</span> <span class="number">233.5.5.5</span> <span class="number">233.6.6.6</span> valid=<span class="number">300s</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>note:图解HTTP(1)</title>
      <link href="/2020/11/e7a4c959b321/"/>
      <url>/2020/11/e7a4c959b321/</url>
      
        <content type="html"><![CDATA[<h2 id="报文和实体的差别"><a href="#报文和实体的差别" class="headerlink" title="报文和实体的差别"></a>报文和实体的差别</h2><p>关于第三章中报文和实体的差别，书中讲得太简洁。</p><p><strong>报文</strong>要么是一个请求报文，要么就是一个响应报文。</p><p>一次传输中，在应用层来看，就是一个传输的单位（客户端请求服务器，是发送一个“请求报文”，服务器响应客户端，则发送“响应报文”），即为书中说的：</p><p>报文是HTTP通信中的基本单位，通过HTTP通信传输 实体其实是报文的一部分，存在于报文主体内 如一个GET请求报文中，就没有报文主体。<br>那么这种情况下，也就不存在实体 实体是作为请求或响应的有效载荷数据被传输 那么在如响应报文中有： </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain </span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>5 1234</span><br></pre></td></tr></table></figure><p> 那么1234就是实体。 实体的内容由实体首部和实体主体组成： 实体头部不一定会有。如上面“1234”这部分内容，就只有实体主体，没有实体头部。<br><strong>实体主体也确实等同于报文主体</strong>：在没有实体头部的时候就是这样 需要实体头部的场合，则是“传输中需要进行编码操作”的时候，如传输表单内容： </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /upload HTTP/1.1 </span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>example.com </span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>xxx </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=AaBbCcDd </span><br><span class="line">--AaBbCcDd </span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data; name=&quot;username&quot; RuphiLau </span><br><span class="line">--AaBbCcDd </span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data; name=&quot;file&quot;; filename=&quot;picture.jpg&quot; </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>image/jpeg ...(picture.jpg的数据)... </span><br><span class="line">--AaBbCcDd-- </span><br></pre></td></tr></table></figure><p>这个报文里有多个实体 实体里，也有实体头部、实体主体，同样是通过CR+LF分割。 在现在的http协议下，传输编码只有一种：<code>Transfer-Encoding: chunked</code> 在其他任何情况下，实体&#x3D;实体主体 <br> 而这就刚好对应了上文的：<strong>编码提升效率</strong> 也就是说,当实体(像图片,文本这种数据的载体)不进行编码时,传输数据按照原貌直接传输,报文主体和实体主体是同一样东西.但是为了提高传输效率,要对实体进行编码 比如说:一个图片按原文传输需要5个字节,编码以后传输就是3个字节了,相当于主体内容已经改变了,但是报文主体是不变的,已经发生了变化 </p><p><br> <br></p><h2 id="HSTS"><a href="#HSTS" class="headerlink" title="HSTS"></a>HSTS</h2><p> <strong>HTTP Strict Transport Security</strong>（HSTS）告诉浏览器只能通过HTTPS访问当前资源，而不是HTTP </p><p>配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=&lt;expire-time&gt;</span><br><span class="line">Strict-Transport-Security: max-age=&lt;expire-time&gt;; includeSubDomains</span><br><span class="line">Strict-Transport-Security: max-age=&lt;expire-time&gt;; preload</span><br></pre></td></tr></table></figure><blockquote><p>  简介</p></blockquote><p>一个网站接受一个HTTP的请求，然后跳转到HTTPS，用户可能在开始跳转前，通过没有加密的方式和服务器对话，比如，用户输入<a href="http://foo.com/">http://foo.com</a> 或者直接 foo.com。 </p><p>这样存在中间人攻击潜在威胁，跳转过程可能被恶意网站利用来直接接触用户信息，而不是原来的加密信息。</p><p> 网站通过HTTP Strict Transport Security通知浏览器，这个网站禁止使用HTTP方式加载，浏览器应该自动把所有尝试使用HTTP的请求自动替换为HTTPS请求</p><blockquote><p>  处理步骤</p></blockquote><p>你的网站第一次通过HTTPS请求，服务器响应<code>Strict-Transport-Security</code> 头，浏览器记录下这些信息，然后后面尝试访问这个网站的请求都会自动把HTTP替换为HTTPS。 </p><p>当HSTS头设置的过期时间到了，后面通过HTTP的访问恢复到正常模式，不会再自动跳转到HTTPS。 </p><p>每次浏览器接收到Strict-Transport-Security头，它都会更新这个网站的过期时间，所以网站可以刷新这些信息，防止过期发生。 </p><p>Chrome、Firefox等浏览器里，当您尝试访问该域名下的内容时，会产生一个307 Internal Redirect（内部跳转），自动跳转到HTTPS请求</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决网站配置完https后访问http失败</title>
      <link href="/2020/11/bbf6c1bf9db3/"/>
      <url>/2020/11/bbf6c1bf9db3/</url>
      
        <content type="html"><![CDATA[<p>报错如下： </p><p>解决办法： 在nginx里配置，让请求http的时候跳转到https就可以啦</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> ryaoknw.site; </span><br><span class="line"><span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意启用https和http的时候要把80和433端口开放</p><p>之后看了一下各个网站，采用的方式也是把http跳转到 https</p><hr><p>发现也可以直接在配置ssl的server块中监听80端口，自己当时的理解错了，url里的http和https只是指定协议，域名依旧是dns解析出来的ip地址，只要改一下端口就好了</p>]]></content>
      
      
      <categories>
          
          <category> 报错 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello, World!</title>
      <link href="/2020/11/f953da04e2b2/"/>
      <url>/2020/11/f953da04e2b2/</url>
      
        <content type="html"><![CDATA[<p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/1000600035f02b5989ae5.jpeg" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/1000600035f02b5989ae5.jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>历经曲折，折腾了一个晚上加上一个下午，终于把博客建出来了。准备手动搭建环境，装好了nginx和mysql，php，但是最后的phpmyadmin总是有迷之问题，折腾了好久最终放弃</p><p>之后使用云帮手来无脑搭环境，然而云帮手果然出了各种问题。。。无奈之下回到了最初的宝塔面板，装好环境后自己搭了WordPress，配了ssl和</p><span id="more"></span><p>域名解析。期间域名解析配错了，又折腾了好久（还有v2ray开全局代理访问会爆500啊！）收获就是之后重装都异常熟练</p><p><img src="https://pic.downk.cc/item/5fce09ee3ffa7d37b3da8877.jpg" class="lazyload" data-srcset="https://pic.downk.cc/item/5fce09ee3ffa7d37b3da8877.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>再就是欢乐地选主题，换了三个siren，sakura和krato，而且最终也没有和ks和zcy一样用kale。还是用了krato，然后稍微折腾一下就成功了</p><p>算是完成了自己的一个浪漫。不过还是想之后有时间写静态页面的博客，但是最近ddl太！多！了！从开学到现在作息非常极客！急需时间管理大法。</p><p>之后有时间要陆陆续续地把自己的东西整理一下，搬到博客上来</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
