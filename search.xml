<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>葉・为什么我要吹爆U149・偶像大师U149 第十一话分析</title>
      <link href="/2023/7/3806e80c5edf/"/>
      <url>/2023/7/3806e80c5edf/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>ep11的演出能让你在完全不了解前面的剧情的情况下看懂故事，而你只需要知道爱丽丝是u149偶像团的一员就行。</p><p>ep11完全是剧场版水平的节奏把控。</p><h2 id="EP10"><a href="#EP10" class="headerlink" title="EP10"></a>EP10</h2><p>在大家都说出自己的希望时，爱丽丝也举起了手，但是却不知道自己想要什么，陷入了迷茫。由此转入ep11的爱丽丝回。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731175829534.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731175829534.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731175829534"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731175859014.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731175859014.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731175859014"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731175929059.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731175929059.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731175929059"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731175944632.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731175944632.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731175944632"></p><h2 id="EP11"><a href="#EP11" class="headerlink" title="EP11"></a>EP11</h2><p>紧接ep1的分析。</p><p>开篇依旧是爱丽丝的梦境画面，这里的构图与第一话完全相同，有意在进行对比。</p><p>（第一话）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731174712800.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731174712800.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731174712800"></p><p>（第十一话）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731174623436.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731174623436.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731174623436"></p><p>此时的爱丽丝的心境与第一话时有了不同，爱丽丝的眼睛被完全遮住，她陷入了迷茫：“大人和小孩的区别，是什么？”（大人と子供の違いって、なに？）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731174814420.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731174814420.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731174814420"></p><p>爱丽丝认为，<strong>大人是不会像自己现在一样不够成熟的，是不会像自己现在一样陷入迷茫的</strong>。爱丽丝想成为“大人”，想把自己当成一个“大人”，所以她强制自己要足够的坚强，她不会向父母诉说自己的苦衷，这也导致了爱丽丝始终没有向父母说出自己真正的想法。爱丽丝足够的努力，她保持了优秀的成绩，每天努力的练习，但是在如今还是没有和“大人”一样坚强</p><p>第一话中爱丽丝捧起丝带，来到门前，时钟指向12，梦境结束。而在第12话中，爱丽丝一只手放下丝带，梦境中下起雨，然后画面借此切回现实。可以注意到这个构图很像雨伞的构造，由此切向挣着雨伞的爱丽丝，非常自然。这是非常经典的切镜方式（双城之战中全是）。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731175246641.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731175246641.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731175246641"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731175343077.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731175343077.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731175343077"></p><p>然后画面来到大人的酒局上，米内p的“梦”与其他人说的“梦”不是一回事</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731180811219.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731180811219.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731180811219"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731180905941.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731180905941.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731180905941"></p><p>肮脏的大人只是把小偶像们当成商品。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731181032442.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731181032442.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731181032442"></p><p>大人愚弄孩子，无视孩子们的梦想，米内p感到不高兴</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731181129680.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731181129680.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731181129680"></p><p>“那些孩子们的梦想是很认真的”，“我们大人凭什么自视甚高”，“一口一个小孩”，由此点出隐藏的后续一句话——大人と子供の違いって、なに？</p><p><strong>难道成熟的大人，就已经失去了梦想了吗？难道怀揣梦想的人，就无法变得成熟吗？大人和小孩的区别，是什么？</strong></p><p>（我现在才发现它通过标题写在画面中了，这说明我没有过度解读，以及这种方式太妙了）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731181551888.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731181551888.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731181551888"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731181606391.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731181606391.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731181606391"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731181619998.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731181619998.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731181619998"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731181842491.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731181842491.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731181842491"></p><p>后续转入小偶像的场景，大家怀着期待的眼神看着米内p，米内p虽然只能妥协“U149”的称呼，但还是要笑着对小偶像们宣布，这里也是非常细节的神态变化。</p><p><strong>ep10中大家写下的梦想在黑板中被擦去，而U149的字写在了上面，这个“U149”并不属于任何一个人的梦想。</strong></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731182350246.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731182350246.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731182350246"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731182421422.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731182421422.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731182421422"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731182526820.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731182526820.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731182526820"></p><p>被大人利用的不知情的小偶像们，也正是米内p用积极的行动才让小偶像没有在意这个事实。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731182632566.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731182632566.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731182632566"></p><p>这里与第一话的镜头对应，反映爱丽丝的情绪</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731182824264.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731182824264.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731182824264"></p><p>这里同样与第一话对应，第十一话爱丽丝没有开灯，情绪更加糟糕。</p><p>（第一话）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731183616613.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731183616613.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731183616613"></p><p>（第十一话）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731183643774.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731183643774.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731183643774"></p><p>然后画面给到米内p正在纠结于企划书。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731183905533.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731183905533.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731183905533"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184003895.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184003895.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184003895"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184019153.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184019153.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184019153"></p><p>米内p反复的删改文案，孩子们被删去，然后变为了大人。这里米内p还在为“U149”这件事而烦恼，他是从孩子成长为了大人，却没办法为孩子们把事情做好。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184115129.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184115129.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184115129"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184215796.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184215796.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184215796"></p><p>爱丽丝搜索升学相关的事情，镜头给到爱丽丝看向镜中的自己（与第一话对应）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184522271.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184522271.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184522271"></p><p>爱丽丝需要和父母一起商量自己的事情，但是父母的房门紧闭，父母依旧在忙于工作</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184745984.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184745984.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184745984"></p><p>（第十一话）这里与第一话的对比同样是光线由亮变为暗</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184721287.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184721287.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184721287"></p><p>（第一话）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731184644501.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731184644501.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731184644501"></p><p>爱丽丝始终没有勇气去面对父母，镜头给到劳累工作的母亲，母亲关闭表格后，电脑桌面是爱丽丝的照片，父母也非常爱爱丽丝</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185011106.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185011106.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185011106"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185145560.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185145560.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185145560"></p><p>母亲看着爱丽丝的照片微笑，背景中墙上也挂着爱丽丝的照片</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185158840.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185158840.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185158840"></p><p>爱丽丝关上门之前顿了一下，然后关上了门，这里体现爱丽丝的犹豫和逃避（停顿-&gt;犹豫，关上-&gt;逃避），爱丽丝期盼着父母能够主动的关心她</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185406809.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185406809.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185406809"></p><p>随后画面来到训练室，镜头反复在谈论未来的其他成员与一直在训练的爱丽丝之间来回切换，这里有意表现爱丽丝的焦虑</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185646687.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185646687.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185646687"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185713872.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185713872.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185713872"></p><p>随后画面来到米内p和爱丽丝的面谈。不坦率的爱丽丝，和觉得自己不够成熟的米内p</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185918104.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185918104.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185918104"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731185931953.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731185931953.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731185931953"></p><p>（这里的翻译应该是：橘真像个大人啊 橘さんは大人だな）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731190006990.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731190006990.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731190006990"></p><p>爱丽丝下定决心决定和父母谈一谈的点击发送，转场到米内p文案的点击</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731190532065.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731190532065.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731190532065"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731190607047.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731190607047.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731190607047"></p><p>画面在米内p和爱丽丝之间反复切换（交叉剪辑），两件事在同一时间线上进行，最终通过米内p收到爱丽丝的妈妈发来的消息，将双线汇聚到一起。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731190823699.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731190823699.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731190823699"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731190839978.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731190839978.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731190839978"></p><p>再次切到相同的镜头，通过光线表示情绪有所好转，但窗帘遮住面部是情绪始终为负面的一种表现方式。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731191014879.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731191014879.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731191014879"></p><p>同样的给到镜中的爱丽丝，但此时是眼瞳中映出的画面</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731191158164.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731191158164.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731191158164"></p><p>摘下蝴蝶发饰，对应第一话中的戴上发饰。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731191255838.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731191255838.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731191255838"></p><p>（第一话中照镜子然后微笑，戴上发饰）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731191400357.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731191400357.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731191400357"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731191440198.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731191440198.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731191440198"></p><p>爱丽丝进入梦境，同时本话正式抛出疑问：“大人と子供の違いってなに？”</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731200813688.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731200813688.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731200813688"></p><p>此时的爱丽丝给出的回答是：“大人，不会哭”</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731200947991.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731200947991.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731200947991"></p><p>随后与第一话相同，指针指向12，闹钟响起，爱丽丝醒来</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201032794.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201032794.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201032794"></p><p>（这里给到爱丽丝起床的镜头，而不是像第一话一样在镜子中起床的镜头，或许没有实际意义）</p><p><img src="/./pictures/image-20230731201155918.png" class="lazyload" data-srcset="/./pictures/image-20230731201155918.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201155918"></p><p>为了解答这个问题，动画先来回答下面的问题：“大人是什么？”。这里是从黑屏嵌字到黑屏逐渐透明化而转变为爱丽丝的两位“大人”的画面，非常带感。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201110129.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201110129.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201110129"></p><p>乌云密布，即将下雨，而一直把自己当做“大人”的爱丽丝像个“孩子”一样逃离了面谈，走下台阶。（当然是走下台阶，而不是走上台阶）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201615823.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201615823.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201615823"></p><p>随后进入in fact插入曲演出</p><p>连接现实的门的白线</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201722920.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201722920.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201722920"></p><p>门打开</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201815999.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201815999.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201815999"></p><p>被吸入现实</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201836688.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201836688.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201836688"></p><p>现实世界（没有人了解 真正的我）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201857219.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201857219.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201857219"></p><p>镜头处于远景，把爱丽丝放到画面右侧的一小部分，突出孤身一人</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731201942347.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731201942347.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731201942347"></p><p>爱丽丝的眼中的自己始终是被映出的自己，那真正的自己是什么？</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731202213795.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731202213795.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731202213795"></p><p>透过映像是没有面庞的大人，此时任性的爱丽丝不再作为“大人”</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731202247140.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731202247140.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731202247140"></p><p>由于这个歌曲（in fact）是在动画之前就有的，所以歌词不太能去与剧情做对应，而动画只是尽量的对歌词做了画面的对应，所以我也删去了一些对于画面的过度解读，只是指出一些有设计的地方。</p><p>雨后天晴再展开后续，对应后续情节走向（其实也不用暗示，或许这里只是单纯的雨后天晴）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731202725184.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731202725184.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731202725184"></p><p>爱丽丝来到了第十话中live的天台，哼起了偶像的歌</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731203000940.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731203000940.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731203000940"></p><p>爱丽丝为自己作为“孩子”的任性而道歉</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731203137131.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731203137131.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731203137131"></p><p>此处有很多画面也是给出水面的倒影，而不是直接给出画面（或许只是为了增加画面的层次和视觉效果）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731203608287.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731203608287.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731203608287"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731203632268.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731203632268.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731203632268"></p><p>米内p作为“大人”，表示<strong>大人也会有自己的梦想</strong></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731203703371.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731203703371.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731203703371"></p><p>爱丽丝不再作为“大人”，释放出属于“孩子”的任性，抱怨父母对自己不够关心。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731203900408.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731203900408.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731203900408"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204218842.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204218842.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204218842"></p><p>此时，米内p想到了自己的无能为力，正如爱丽丝的父母一样，他们要忙于工作，没法给到爱丽丝足够的关心，这也是他们作为“大人”的无能为力。<strong>“大人”并不是爱丽丝所认为的那样坚强</strong>。<strong>“大人”也会流泪</strong>。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204236607.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204236607.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204236607"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204250088.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204250088.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204250088"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204304750.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204304750.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204304750"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204340586.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204340586.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204340586"></p><p>此处米内p的眼泪落下，爱丽丝瞳孔映出泪水，梦境中的露水映出爱丽丝</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204421261.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204421261.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204421261"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204532310.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204532310.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204532310"></p><p>爱丽丝向前迈进，一帧黑屏，梦境中爱丽丝站起</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204600063.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204600063.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204600063"></p><p>露水中映出母亲工作的各种画面</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204759563.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204759563.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204759563"></p><p>爱丽丝沿着白线向前追寻，露水中映出“大人”满满的艰辛，<strong>“大人”并没有那么坚强</strong>，大人也是有苦说不出的人</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204830697.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204830697.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204830697"></p><p>在追寻的尽头，她看见了自己。此时，她收获了<strong>答案</strong>。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731204904065.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731204904065.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731204904065"></p><p>米内p询问爱丽丝想要成为什么样的“大人”</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205247103.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205247103.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205247103"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205259850.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205259850.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205259850"></p><p>大人和小孩，到底哪里不同呢？ </p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205326902.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205326902.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205326902"></p><p>此时，画面给到爱丽丝小时的回忆，母亲的脸颊流着泪水，爱丽丝撒娇，母亲擦干泪笑着面对爱丽丝</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205518245.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205518245.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205518245"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205613082.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205613082.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205613082"></p><p>米内p擦干泪，谁说大人不会流泪的</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205722931.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205722931.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205722931"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205733181.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205733181.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205733181"></p><p>爱丽丝看见母亲，第一反应不是愧疚逃避，而是冲向母亲（在ep4中体验蹦极时，害怕时叫出“妈妈”）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731205819777.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731205819777.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731205819777"></p><p>米内p一个人黑灯坐着，望着白板上的u149，心里还是在纠结这个名字。米内p依旧在为自己不够作为一个“大人”一样能把一切都做好而自责</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210054181.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210054181.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210054181"></p><p>随后到了第二天。这里与第一话的处理也完全相同，只是米内p在左边，爱丽丝在右边，两人位置相反。这次该轮到爱丽丝帮助米内p了</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210132753.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210132753.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210132753"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210209405.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210209405.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210209405"></p><p>相同的构图，但是仰望的是米内p，在台阶上的是爱丽丝</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210338699.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210338699.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210338699"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210359887.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210359887.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210359887"></p><p>“叫我爱丽丝就好”，爱丽丝放下了作为“大人”的想法，因为她已经得出了<strong>答案</strong></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210435852.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210435852.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210435852"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210548751.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210548751.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210548751"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210600968.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210600968.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210600968"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210614284.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210614284.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210614284"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210628187.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210628187.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210628187"></p><p>“<strong>孩子和大人都是一样的，我是这么想的</strong>”，这就是爱丽丝的<strong>答案</strong>，这句话也完全消解了米内p的忧虑</p><p>孩子和大人都是一样的，爱丽丝认为不必去让自己作为一个“大人”，只要和大家一起闪耀，一个名字是无所谓的（即“橘”与“爱丽丝”，“U149”与其他更好的名字）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210802165.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210802165.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210802165"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731210844736.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731210844736.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731210844736"></p><p>本话结束。</p><h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>爱丽丝生日快乐！</p><p>这就是学神的含金量！初次看完难以抑制自己的兴奋，这也是为什么我有动力写一个这么长的剧情演出分析。</p><p>简单的剧情，华丽的演出，为什么我喜欢以至于专门写一个分析呢，毕竟我最喜欢的剧场动画是少女歌剧（</p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>葉・为什么我要吹爆U149・偶像大师U149 第一话分析</title>
      <link href="/2023/7/36da2f69d466/"/>
      <url>/2023/7/36da2f69d466/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>作为偶像动画，一般都会聚焦在偶像团体的故事上，比如团队的组建、联系、演出、日常交流以及各自的矛盾等等，但U149给了大人的非常多的画面，有意的表现大人世界的虚伪，唯利是图，而失去了自己最初的热情等等（但也并没有对此极力的讽刺），这也是与传统偶像动画的不同之处。</p><p>ep1和ep11都是爱丽丝回，在分析ep11前，我想先详细分析ep1。</p><h2 id="EP1"><a href="#EP1" class="headerlink" title="EP1"></a>EP1</h2><p>动画开篇给到爱丽丝梦境的画面，这里的彩带连接大门，然后时间的指针指向12，代表现在的爱丽丝是12岁。这里的时钟有1-20的刻度，对应1-20岁（孩子到大人）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731162407876.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731162407876.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731162407876"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731162446622.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731162446622.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731162446622"></p><p>随后闹钟响起，爱丽丝醒来，这里并没有直接给爱丽丝镜头，而是镜子印出的爱丽丝，后续依旧在房间内依旧只会给到镜子印出的爱丽丝，而不是爱丽丝本身，有意让观众对爱丽丝的神态进行对比。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731162558050.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731162558050.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731162558050"></p><p>爱丽丝同学说“橘的成绩那么好，不用被家长说，真好啊”，而爱丽丝回答“并不是这样的”，这里爱丽丝是在表示自己并不觉得“不用被家长说”这件事真好。因此引起了同学的疑惑，但爱丽丝知道自己和她们说的不是一回事，于是否定</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731163549725.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731163549725.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731163549725"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731163640995.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731163640995.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731163640995"></p><p>爱丽丝离开时被同学询问是否是要去做偶像的工作，爱丽丝犹豫的给出肯定，这里也提前暗示了此时的爱丽丝并不是正式的偶像</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731163957032.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731163957032.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731163957032"></p><p>后续就是一大段大人职场的牢骚话，有对孩子的蔑视，有职场的上下级尊卑关系，有职场的甩锅</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731164222365.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731164222365.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731164222365"></p><p>这里满头大汗的米内p从阴影走到阳光下，非常经典且好用的用光线展现情绪变化的处理。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731164542944.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731164542944.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731164542944"></p><p>因此爱丽丝希望别人叫她“橘”</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731160552561.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731160552561.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731160552561"></p><p>镜头先给到米内p眼中的光，这是对工作的热情，然后转向社长的眼神。社长虽然也是虚伪的大人，给米内p画饼，但是这里可以看出社长也会因此感到愧疚。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731161420274.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731161420274.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731161420274"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731161513202.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731161513202.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731161513202"></p><p>爱丽丝训练完后一路小跑回到了家，但家里没有开灯，这说明爱丽丝的父母工作繁忙。这里镜头给出非常细节的爱丽丝的神情变化，然后再给到了透过鱼缸中的水的爱丽丝的神情，爱丽丝为父母不能陪伴自己而感到失落。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731165058628.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731165058628.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731165058628"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731165145571.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731165145571.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731165145571"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731160959535.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731160959535.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731160959535"></p><p>爱丽丝家里玄关处的镜头通常会给到鱼缸，而不是直接给爱丽丝，这在前面爱丽丝出门时也有体现，但我并没有看出用意。</p><p>但尽管父母经常不能陪伴自己，爱丽丝依然非常尊敬喜爱自己的父母，这里可以体现爱丽丝的懂事。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731161852555.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731161852555.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731161852555"></p><p>以及这里的后续也给到聊天中的“未读消息”，说明父母很忙</p><p>家里墙上全是爱丽丝的照片</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731165305866.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731165305866.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731165305866"></p><p>这里明显的提示监护人没有签名，说明了爱丽丝没有与父母商量过自己出道的事情，而是“在不影响学习就行”的程度上进行偶像活动。这里也能体现爱丽丝的懂事，即了解父母的付出，不想给他们带来更多的担忧。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731165701552.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731165701552.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731165701552"></p><p>爱丽丝来到了新环境，但有点内向，无法融入，所以无所事事，打开窗户又关上。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731165952986.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731165952986.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731165952986"></p><p>米莉亚看出了爱丽丝无法融入，于是引出话题。这里依旧是一个非常细致的神态变化。<del>（米莉亚麻麻！）</del></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731170123040.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731170123040.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731170123040"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731170154897.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731170154897.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731170154897"></p><p>然后晴主动的去问爱丽丝（小偶像们都太温柔了）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731170418475.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731170418475.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731170418475"></p><p>爱丽丝希望制作人靠谱，然后给到米内p下车赶路的镜头。后续米内p赶到，但是迟到了<del>（多么希望她们能指引我）</del></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731171026638.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731171026638.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731171026638"></p><p>爱丽丝觉得米内p态度不好，看不起小孩，于是很生气。然后觉得米内p很不负责，也不成熟，于是要去申请换制作人</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731171219558.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731171219558.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731171219558"></p><p>偶像大师经典报菜名环节，本家动画也有</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731171434960.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731171434960.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731171434960"></p><p>这里是给到米内p和爱丽丝并排，但是两人保持的非常远的距离，体现爱丽丝对米内p的不信任</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731171606916.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731171606916.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731171606916"></p><p>以及后续非常经典的视角偏移</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731171641817.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731171641817.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731171641817"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731171706305.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731171706305.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731171706305"></p><p>在短暂的聊天后，米内p发现自己与爱丽丝有共同的话题，冲到台阶上发表演说，而爱丽丝也因此对米内p产生信任</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731172107062.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731172107062.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731172107062"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731172120051.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731172120051.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731172120051"></p><p>这里完全相同的角度和构图对应了前面米内p眼中的光</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731172213633.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731172213633.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731172213633"></p><p>两人互动表明爱丽丝已经信任米内p</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731172426853.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731172426853.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731172426853"></p><p>然后，请欣赏非常炫酷的结尾部分动画！</p><p>又是经典的从阴影跳向阳光</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731172620511.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731172620511.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731172620511"></p><p>非常成年人的生活</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731173121245.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731173121245.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731173121245"></p><p>从米内p的歌衔接到爱丽丝的歌，表现大家对未来的憧憬。然后爱丽丝闭眼入睡，进入梦境（ED）</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230731173312216.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230731173312216.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230731173312216"></p><p>然后就是无敌神中神的ED，我可以看无数遍（</p><h2 id="后续推荐"><a href="#后续推荐" class="headerlink" title="后续推荐"></a>后续推荐</h2><p>如果你非常喜欢U149，可以去看看B站up主<strong>amuro1985</strong>非常专业的各话分析（目前只到第八话）</p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023年4月追番锐评</title>
      <link href="/2023/7/5f5cff851208/"/>
      <url>/2023/7/5f5cff851208/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>不是那么棒的四月，每周指望着U149活着。</p><p>实在没什么动力也没什么时间写，想着憋出一篇U149 ep11的分析，于是先顺手把4月的流水账记下。</p><h2 id="2023年4月"><a href="#2023年4月" class="headerlink" title="2023年4月"></a>2023年4月</h2><h3 id="天国大魔境"><a href="#天国大魔境" class="headerlink" title="天国大魔境"></a>天国大魔境</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730141110.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730141110.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>star：8</p><p>或许我应该写一个长篇分析，因为它确实做的很好，但是这不是原创动画，我并没有看过原作，本季也并没有触及主线，实在不好写。动画中有非常多很有意思的设计（比如相对独立的五十岚海负责的第十话中女尊男卑的社会）</p><p>这是整个四月唯一真正精彩真正可以360度来吹的作品。</p><p>末世双线叙事一眼反乌托邦，一看就是要讲严肃叙事的动画。动画第一话就能看出制作水准，真流斩子所有打戏镜头都非常多样，作画质量极高，张数巨多。而在灾难中也不乏两人的日常场景，而且镜头非常多样化（与某霸权高下立判），日常的对话部分非常流畅和沉浸。（<strong>神中神的the异世界轻改<del>(学神限定)</del>也是通过这样的方式来为观众带来沉浸感，这也是它为何获得如此多的好评的重要原因之一</strong>）</p><p>第12话神中神中神。前面一系列的环境和真流的神态描写为斩子的遭遇做足了暗示。结尾部分行云流水的镜头语言，无限高的天花板，成熟到裂开的果实，一个人吃不完的热汤，将燃尽熄灭的蜡烛，手伸向外面的天空，一系列流畅的意识流镜头调动着观众的思考，也将观众的注意力从雷普这种会引起生理厌恶的场景本身引向<strong>对雷普展示的含义的思考</strong>，即自我认知的哲学命题<del>（又是经典的「我是谁，我从哪里来，我要到哪里去」）</del>。</p><p>动画从一开始就在为这个命题的引出做铺垫，各种细节都在给观众突破“差别”的暗示，比如学院中没有男女的差别；灾难后的新生人类的外貌都是圆脸，而旧人类都是有明显差异化的面部特征等等，从各个角度都在为观众淡化「区别」。而学院中更是没有外面的社会中的「区别」，比如同性恋、没有“性”、“男女”、“生育”的概念，美美姬的兽耳，学生们的超能力等等。我是男人，我叫斩子，我原本不是长这样的。当人与人之间的这些差别都在“新世界”中消失时，当你的精神寄托在了另一个肉体中时，当灾难摧毁了社会中的身份和角色，我们是否应该像故事中的旧人类一样去重建它，还是应该像新人类一样以其他的方式活下去？<strong>当身份认同和角色认同不再，那么该如何回答「我是谁」这个问题？</strong></p><p>本季主线基本没有触及，草草收尾了，雷普这种应当作为关键冲突点的展开居然在这里毫无意义，我还期待着斩子会在后续对自己的认知变化作出怎样的反应，没想到真流的一句类似「你就是你」的话就把话题结束了，而漫画也没有完结，我无法得知后续。</p><p>抛开主线不谈，第8话与第12、13话的联系非常出色。美美姬（<strong>福圆美里配音！</strong>）和白的故事在第13话最后的那一幕，将第8话中埋下的伏笔与第12、第13话中的从前故事巧妙地呼应和回收，给我带来了极大的震撼。</p><p>遗憾的是最终得知两个世界不是一个时间线，这种展开很常见很好写，因此对我来说有点无聊。</p><h3 id="我推的孩子"><a href="#我推的孩子" class="headerlink" title="我推的孩子"></a>我推的孩子</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730141157.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730141157.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：6.5</p><p>第一话的中后段高质量以及最后的展开让我对这个动画有了错误的期待，想看后续如何面对爱死去这件事，主角如何理解爱，如何在这个过程中与自己和解，但实际上只是借着这个噱头展开校园漫画，实在是没劲。</p><p>动画工坊在第一话试图证明自己做萌系以外的动画的实力，但没想到貌似这就是上限了。</p><p>在正式展开本篇剧情时便转为了厕纸演出，同时，我所期待的一些关键性的场景并没有漫画中的表现力，包括拯救赤音，拉memu入伙，以及最终的帽子一指。动画中没有进行修改，而是直接采用漫画中的画面顺序进行呈现，而由于画面的连续性，这些转折点失去了原本在漫画中带来的震撼效果。</p><h3 id="鬼灭之刃-刀匠村篇"><a href="#鬼灭之刃-刀匠村篇" class="headerlink" title="鬼灭之刃 刀匠村篇"></a>鬼灭之刃 刀匠村篇</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730141424.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730141424.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：5</p><p>炭治郎大帝将要征服二次元！</p><p><strong>!!!前方输出高能，请鬼灭PSTD患者自觉跳过!!!</strong></p><p>鬼灭从来没有演出，镜头极其单调，叙事只知道怼脸，让角色念出一大串的台词，然后请作画们画一段长镜头，于是经费就燃烧了，你也不知道经费烧没烧，但观众说燃烧了就是燃烧了，爆卖3亿还不好？环大陆好评如潮！<del>（我直言期待原神动画）</del>。</p><p>我不知道如何才能把动画做得这么无聊的，ep7看boss登场，然后炭治郎大帝站桩十分钟一堆慢动作来塞心理描写、神态描写，然后把内容念完了开始嘴炮论战。我想知道监督是专业的吗？还是哪个大专捞来的？永远不知道镜头为何物。</p><p>最后我鼓起勇气看看被吹的弥豆子回，炭治郎陷入拯救自己妹妹和杀鬼的艰难抉择中，这种展开一般为表现角色内核的开展点，为后续剧情深入展现角色形象做剧情上的分割点。此时的决策非常值得观众的思考，于是炭治郎选择了杀鬼，并为妹妹的生命感到悲伤，然后，<strong>弥豆子并没有发生什么，从此不畏惧阳光了</strong>。<del>天哪，太厉害了！</del>，但由于原作本身不怎么样，这里我也不细喷了，只能说我写不出这样的东西hhhh。但我也确实没什么文笔，免不了被人叫喊“<strong>你行你上啊</strong>”。</p><p>想了想，不如让我来做下一季的监督吧，我也会做。鬼灭动画只需要1.找花江夏树来念台词说书 2.找梶浦由記老师来编曲 3.需要经费燃烧的时候找阿部望先生来拉刀光。而这大概就能呈现鬼灭动画足够的体验。</p><p><del>好了，爽快。</del></p><h3 id="无神世界的神明活动"><a href="#无神世界的神明活动" class="headerlink" title="无神世界的神明活动"></a>无神世界的神明活动</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730141436.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730141436.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：5</p><p>用最低的经费做最有想象力的演出！rpgmaker做战斗画面, 简陋页游3d做怪物登场，通过大头演艺，角色怼脸配上低质特效背景来表现燃，还有最经典直接上现实套滤镜画面。稻叶友纪用奇思妙想做出了我从未见过的创意！</p><p><strong>淳皇鬼后放飞自我，直接让广大黑子原地道歉！从不屑到理解，从谩骂到感谢！</strong></p><blockquote><p>你们就当我在发病吧，但是我是真的很喜欢<br>人的观点真的是会随着经历过的事而改变，我现在都还记得当初看完动画时的感受<br>淳皇的调教和鬼后的咆哮真的越听越喜欢，不需要讨论演技，不需要反转<br>所有的答案都在动画里面了<br>前面忘了，后面忘了，但是。<br>世界は残酷だ それでも君を愛すよ<br>なにを犠牲にしても それでも君を守るよ<br>能听到淳皇鬼后的配音作品的是一种幸运，也需要莫大的勇气<br>你们可以说我格局太小，有小礼而无大义，毕竟我本来就没有什么家国情怀，兼济天下的情操，我也不想争论对错的问题<br>动画中我真正在乎的，也确实就那么几个cv</p></blockquote><p>虽然我很喜欢，但实在没法用这种兴奋打上一个高分，因为动画本身不值得一看，我看下去的动力是动画以外的东西。</p><h3 id="机动战士高达-水星的魔女-Season2"><a href="#机动战士高达-水星的魔女-Season2" class="headerlink" title="机动战士高达 水星的魔女 Season2"></a>机动战士高达 水星的魔女 Season2</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730141503.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730141503.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>star：5</p><p>太经典的烂尾模式。</p><p>在米米要和母亲联手时我就觉得收不住了，只能能看到现在纯属说第一季ep11的百合演出把我拿下了。</p><p>本身故事内容也没有仔细讨论的必要了，<del>难道我要现在还去梳理莉可丽丝的剧情细节吗？</del></p><h3 id="魔法少女毁灭者"><a href="#魔法少女毁灭者" class="headerlink" title="魔法少女毁灭者"></a>魔法少女毁灭者</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730141520.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730141520.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：3</p><p>开播前非常期待，以及第一话op和ed后依旧非常期待。</p><p>但是它实际上只是制作组的自嗨。</p><p>魔法少女毁灭者最后毁灭了什么？没有毁灭什么，所以它在讽刺吗？或许有这方面的内容，只是我水平不够，看得不仔细，总结不出来。堆砌一堆杂乱的符号却没有任何实际含义，它甚至碰瓷不了秋原叶女仆战争。魔法少女毁灭了我的脑子，或许二创可以有很多有趣的内容，但可惜的是这个动画没有热度。</p><h3 id="世界巨星"><a href="#世界巨星" class="headerlink" title="世界巨星"></a>世界巨星</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730141537.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730141537.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><del>stars：5</del></p><p>因为看了pv所以去看了动画，但实在没看完。</p><p>含歌量90%，但无法成为少女歌剧代餐</p><h3 id="偶像大师-灰姑娘女孩-U149"><a href="#偶像大师-灰姑娘女孩-U149" class="headerlink" title="偶像大师 灰姑娘女孩 U149"></a>偶像大师 灰姑娘女孩 U149</h3><p><img src="https://cdn.ryaoknw.site/picgo/20230730144438.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/20230730144438.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars: 8</p><p>年轻人的第一部偶像大师！学神的含金量！</p><p>U149 EP11分析正在日程中，尽请期待喵！</p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>彻底禁用独立显卡</title>
      <link href="/2023/5/522336ae5c77/"/>
      <url>/2023/5/522336ae5c77/</url>
      
        <content type="html"><![CDATA[<h1 id="Manjaro-彻底禁用独立显卡"><a href="#Manjaro-彻底禁用独立显卡" class="headerlink" title="[Manjaro]彻底禁用独立显卡"></a>[Manjaro]彻底禁用独立显卡</h1><h2 id="已知的问题"><a href="#已知的问题" class="headerlink" title="已知的问题"></a>已知的问题</h2><p>我在使用chrome时应用启动非常迅速，但图形界面却出现的非常慢，准确来说，是一个全屏透明占用了整个屏幕，把它最小化（通过点击应用图标等方法）在屏幕上拖动会有重影，重影是buffer未清除，应该是图形（GPU）渲染的问题。</p><p>然而，在firefox上却完全没有这个问题。</p><p>我难以准确描述我遇到的问题，在google上搜不到任何和我相似的情况，只有类似”启动慢“的问题，我尝试关闭了所有硬件加速相关的只要用到GPU的功能，还是无法解决问题。</p><p>尝试换了edge,但依旧是同样的效果，又尝试换了vivaldi, 也是同样的问题，区别就是vivaldi不是透明的而是白屏窗口，可能只是启动实现上的不同。共同点在于，它们都是基于chromium的，于是我又尝试使用chromium，但chromium却没有这个问题，我实在不知道如何排查，我尝试使用debug日志的模式启动chrome、edge，一大堆的日志中除了一些不太重要的warning之外，没有什么不正常的信息。</p><p>chrome启动慢实在影响了我的操作体验。。。而chromium被阉割了同步功能，以及现在的版本下在linux中输入存在问题（fcitx），不过在当前的chrome版本中已经修复，我还是觉得我应该使用chrome。</p><p>事情在我从kde换到awesome wm后有了进展，在某一次开机后我在awesome wm下的chrome彻底打不开了，edge等也是，我</p><p>意识到这样的不同表现来源于我的启动配置，于是我认为应该是我坏掉的独显在暗中作怪。</p><h2 id="彻底禁用独显"><a href="#彻底禁用独显" class="headerlink" title="彻底禁用独显"></a>彻底禁用独显</h2><h3 id="尝试"><a href="#尝试" class="headerlink" title="尝试"></a>尝试</h3><p>manjaro并没有提供类似设备管理器一样的可以直接把显卡禁用的功能，我也没有找到。</p><p>我在网上找到的选择使用集成显卡的方案是通过bumblebee来实现的。</p><p>对于ubuntu,可以使用<code>prime-select</code>命令来选择显卡，在manjaro（arch系）下，可以通过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mhwd -a pci nonfree 0300</span><br></pre></td></tr></table></figure><p>来安装推荐的显卡驱动，一般双显卡就是<code>video-hybrid-intel-nvidia-prime</code>，但并没有<code>prime-select</code>，arch系采用了不同的方法来处理NVIDIA Optimus技术，可以使用Bumblebee作为Optimus支持的默认解决方案。</p><p>在论坛中得知应该使用bbswitch来代替Bumblebee来做这件事比较好，Bumblebee已经过时了。</p><p>于是尝试一系列操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S bbswitch</span><br><span class="line"></span><br><span class="line">sudo nvim /etc/modprobe.d/bbswitch.conf</span><br><span class="line">options bbswitch load_state=0 unload_state=1</span><br><span class="line"></span><br><span class="line">sudo modprobe bbswitch</span><br><span class="line">sudo <span class="built_in">tee</span> /proc/acpi/bbswitch &lt;&lt;&lt; <span class="string">OFF</span></span><br><span class="line"><span class="string">cat /proc/acpi/bbswitch</span></span><br></pre></td></tr></table></figure><p>按道理应该显示OFF,但我这里一直显示ON。得知大概是由于程序占用了nvidia,导致无法禁用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo fuser -v /dev/nvidia*</span><br><span class="line"></span><br><span class="line">用户     进程号 权限   命令</span><br><span class="line">/dev/nvidiactl:      root      298314 F.... Xorg</span><br></pre></td></tr></table></figure><p>尝试设置xorg使用集显启动。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> /etc/X11/xorg.conf /etc/X11/xorg.conf.backup</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sudo nvim /etc/X11/xorg.conf</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;ServerLayout&quot;</span></span><br><span class="line">    Identifier <span class="string">&quot;layout&quot;</span></span><br><span class="line">    Screen 0 <span class="string">&quot;intel&quot;</span></span><br><span class="line">    Inactive <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Device&quot;</span></span><br><span class="line">    Identifier <span class="string">&quot;intel&quot;</span></span><br><span class="line">    Driver <span class="string">&quot;modesetting&quot;</span></span><br><span class="line">    BusID <span class="string">&quot;PCI:0:2:0&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Screen&quot;</span></span><br><span class="line">    Identifier <span class="string">&quot;intel&quot;</span></span><br><span class="line">    Device <span class="string">&quot;intel&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Device&quot;</span></span><br><span class="line">    Identifier <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    Driver <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    BusID <span class="string">&quot;PCI:1:0:0&quot;</span></span><br><span class="line">    Option <span class="string">&quot;ConstrainCursor&quot;</span> <span class="string">&quot;off&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Screen&quot;</span></span><br><span class="line">    Identifier <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    Device <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    Option <span class="string">&quot;AllowEmptyInitialConfiguration&quot;</span> <span class="string">&quot;on&quot;</span></span><br><span class="line">    Option <span class="string">&quot;IgnoreDisplayDevices&quot;</span> <span class="string">&quot;CRT&quot;</span></span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><p>然后重启，依旧无效。</p><p>我无法得知原因，但毕竟是独显坏了，奇奇怪怪的事情确实会发生hhh</p><h3 id="有效的做法"><a href="#有效的做法" class="headerlink" title="有效的做法"></a>有效的做法</h3><p>既然它已经坏了，那么我就只需要把它彻底禁用就好了</p><p>先安装intel集显的驱动，保证我至少有一个能用的驱动可以打开图形界面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mhwd -i pci video-linux</span><br></pre></td></tr></table></figure><p>然后阻止nvidia模块加载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo nvim /etc/modprobe.d/blacklist-nvidia.conf</span><br><span class="line"></span><br><span class="line">blacklist nvidia</span><br><span class="line">blacklist nvidia-drm</span><br><span class="line">blacklist nvidia-modeset</span><br><span class="line">blacklist nvidia-uvm</span><br></pre></td></tr></table></figure><p>卸载nvidia相关的驱动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mhwd -r pci video-nvidia</span><br><span class="line">sudo mhwd -r pci video-hybrid-intel-nvidia-prime</span><br></pre></td></tr></table></figure><p>以及残留配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> /etc/X11/xorg.conf</span><br></pre></td></tr></table></figure><p>reboot,然后飞快的启动了chrome,真棒。</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TOTP和2FA实现</title>
      <link href="/2023/4/0542e4f627a8/"/>
      <url>/2023/4/0542e4f627a8/</url>
      
        <content type="html"><![CDATA[<h1 id="TOTP和2FA实现"><a href="#TOTP和2FA实现" class="headerlink" title="TOTP和2FA实现"></a>TOTP和2FA实现</h1><p>很多网站的登陆系统都会提供一个开启2FA认证的安全选项，一些对安全性要求较高的还会要求必须使用2FA。</p><p>2FA是啥？二步验证（双因素验证，Two-factor authentication, 2FA）。在检查口令之外，还检查一个<strong>一次性认证码</strong>。典型的二步认证手段包括有：</p><ul><li>短信&#x2F;邮箱验证码</li><li>银行发的密码器</li><li>基于 HOTP&#x2F;TOTP 协议的应用程序</li></ul><p>2FA 中使用的是一次性密码（One Time Password，OTP），也被称作动态密码。一般 OTP 有两种策略：HOTP ( HMAC-based One Time Password) 和 TOTP ( Time-based One-time Password)</p><h2 id="TOTP工作流程"><a href="#TOTP工作流程" class="headerlink" title="TOTP工作流程"></a>TOTP工作流程</h2><p>如果用户选择打开 2FA，网站会生成一个预共享的 secret key。后续的验证码都是从这个 secret key 派生出来的，这个 secret key 应该严格保密，只有服务器和客户应当知晓。</p><p>用户登录时，首先完成传统的第一步认证，然后提供 6 位数字认证码（这个认证码由 secret key 与当前时间计算得出，每 30s 变一次），若与服务器的计算结果一致，则完成认证。</p><p>（由于Google Authenticator界面下我截不了图，偷一下应用市场的）</p><img src="https://cdn.ryaoknw.site/picgo/unnamed.webp" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/unnamed.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="zoom:50%;" /><h2 id="TOTP计算原理"><a href="#TOTP计算原理" class="headerlink" title="TOTP计算原理"></a>TOTP计算原理</h2><p>参考<a href="https://datatracker.ietf.org/doc/html/rfc4226">RFC4226</a></p><h3 id="HOTP"><a href="#HOTP" class="headerlink" title="HOTP"></a>HOTP</h3><p>HMAC-based One Time Password，由 RFC 4226 定义。一次性验证码是secret key $K$与计数器$C$的函数，其中 HMAC 过程使用的哈希函数$H$默认是 SHA-1。<br>$$<br>HOTP(K,C) &#x3D; Truncate(HMAC_{H}(K,C))<br>$$<br>HMAC 算法得出的值位数比较多，不方便用户输入，因此需要截断（Truncate）成为一组不太长十进制数。要用六位数，就是$HOTP(K,C) \mod10^6$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/pyauth/pyotp</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">generate_otp</span>(<span class="params">self, <span class="built_in">input</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">       <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">       :param input: the HMAC counter value to use as the OTP input.</span></span><br><span class="line"><span class="string">           Usually either the counter, or the computed integer based on the Unix timestamp</span></span><br><span class="line"><span class="string">       &quot;&quot;&quot;</span></span><br><span class="line">       <span class="keyword">if</span> <span class="built_in">input</span> &lt; <span class="number">0</span>:</span><br><span class="line">           <span class="keyword">raise</span> ValueError(<span class="string">&quot;input must be positive integer&quot;</span>)</span><br><span class="line">       hasher = hmac.new(self.byte_secret(), self.int_to_bytestring(<span class="built_in">input</span>), self.digest)</span><br><span class="line">       hmac_hash = <span class="built_in">bytearray</span>(hasher.digest())</span><br><span class="line">       <span class="comment"># 从160位的 SHA-1 结果中，提取出31位</span></span><br><span class="line">       offset = hmac_hash[-<span class="number">1</span>] &amp; <span class="number">0xF</span></span><br><span class="line">       code = (</span><br><span class="line">           (hmac_hash[offset] &amp; <span class="number">0x7F</span>) &lt;&lt; <span class="number">24</span></span><br><span class="line">           | (hmac_hash[offset + <span class="number">1</span>] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span></span><br><span class="line">           | (hmac_hash[offset + <span class="number">2</span>] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span></span><br><span class="line">           | (hmac_hash[offset + <span class="number">3</span>] &amp; <span class="number">0xFF</span>)</span><br><span class="line">       )</span><br><span class="line">       <span class="comment"># 得到digits位的一次性密码</span></span><br><span class="line">       str_code = <span class="built_in">str</span>(<span class="number">10_000_000_000</span> + (code % <span class="number">10</span>**self.digits))</span><br><span class="line">       <span class="keyword">return</span> str_code[-self.digits :]</span><br></pre></td></tr></table></figure><p><strong>工作流程</strong></p><ol><li><p>客户端和服务器各有一个计数器C，并且事先将计数值同步。</p></li><li><p>客户端用K,C计算一次性密码。</p></li><li><p>计算完成之后客户端计数器C计数值加1，验证通过，服务器端将计数值C加1。</p></li></ol><p>如果验证失败或者客户端不小心多进行了一次生成密码操作，那么服务器和客户端之间的计数器C将不再同步，因此需要有一个重新同步（Resynchronization）的机制：</p><p><strong>Resynchronization</strong></p><p>定义一个向前查找的参数s，服务器可以重新计算接下来的s个HOTP值，并将它们与接收到的HOTP客户端进行比较</p><p>计数器同步只需服务器计算下一个HOTP值并确定是否匹配。系统可以要求用户发送一系列（例如C&#x3D;2, 3）的HOTP值以进行重新同步，因为伪造连续的HOTP值比猜测单个HOTP值更难。</p><h3 id="TOTP"><a href="#TOTP" class="headerlink" title="TOTP"></a>TOTP</h3><p>HOTP 与 TOTP 的区别在于：HOTP 是用一个整数 counter 来计算一次性验证码，而 TOTP 是基于当前时间来计算。显然，实现了前者就能实现后者——只需要把当前时间除以 $T$ 向下取整，就能得到一个整数 counter 送进 HOTP 协议里。</p><p>Google Authenticator把$T$设置为了30s.</p><p>由于网络延时，用户输入延迟等因素，可能当服务器端接收到一次性密码时，T的数值已经改变，这样就会导致服务器计算的一次性密码值与用户输入的不同，验证失败。这可以通过同样的思路来解决，服务器计算当前时间片以及前面的n个时间片内的一次性密码值，只要其中有一个与用户输入的密码相同，则验证通过。当然，n不能太大，否则会降低安全性</p><h2 id="服务实现"><a href="#服务实现" class="headerlink" title="服务实现"></a>服务实现</h2><ol><li>服务端随机生成一个secret key，并且把这个密钥保存在数据库中。</li><li>在页面上显示一个二维码，内容是一个URI地址（<code>otpauth://totp/GitHub:LarryLuTW?secret=&#123;secret_key&#125;&amp;issuer=GitHub</code>）</li><li>客户端用某个应用扫描二维码，把secret key保存。</li><li>客户端每30秒使用secret key和时间戳生成一个6位数字的一次性密码</li><li>用户输入这个一次性密码，然后服务端进行验证</li></ol><p><strong>recovery code</strong></p><p>服务端有时会提供一个或一组recovery code，用于在你把手机砸了或者其他故障后能够登陆账户。</p><p>我们可以做一个简单的实现：</p><ul><li><p>随便用某些方法一组唯一且不能伪造的recovery code，将它们存在数据库，并对应用户和用户的secret key</p></li><li><p>用户输入recovery code后，验证recovery code是否对应该用户，验证成功后销毁recovery code和secret key，取消用户的2FA并给用户态（或者把用户跳转到setting并引导重新设置）</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>媒体资源管理方案</title>
      <link href="/2023/4/6eb8dc2e76dc/"/>
      <url>/2023/4/6eb8dc2e76dc/</url>
      
        <content type="html"><![CDATA[<h1 id="媒体资源管理方案"><a href="#媒体资源管理方案" class="headerlink" title="媒体资源管理方案"></a>媒体资源管理方案</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>Navidrome实在不好用</strong>，选择了一些媒体管理的工具。</p><p>plex：一键安装的媒体管理工具，安装自动将服务注册到systemd。有免费版，不开源，试了一下还行，但是我不太想用，<del>因为不折腾</del>，因为我不喜欢。</p><p>找到了开源的jellyfin，也部署了，太丑，发现了它的衍生商业版emby，看着舒服多了，决定用它</p><h2 id="emby"><a href="#emby" class="headerlink" title="emby"></a>emby</h2><p>emby有免费版，阉割了很多功能，甚至不能更换主题</p><p>当然，我选择使用开心版！</p><p>由于docker隔离的原因，导入媒体库不是很方便，得先挂进去</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">emby:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">lovechen/embyserver:beta</span> <span class="comment"># 建议使用beta,因为新版本功能多多</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">emby</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8096</span><span class="string">:8096</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8920</span><span class="string">:8920</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1900</span><span class="string">:1900/udp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7359</span><span class="string">:7359/udp</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">UID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GIDLIST=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./emby:/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/youmedia:/share/media</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure><p>再导入我的媒体库</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230417032751533.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230417032751533.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230417032751533"></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230418064258491.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230418064258491.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230418064258491"></p><p>看上去非常棒。</p><h2 id="syncthing-git-lfs"><a href="#syncthing-git-lfs" class="headerlink" title="syncthing+git lfs"></a>syncthing+git lfs</h2><p>用于同步三端的文件，但是手机上的<strong>syncthing</strong>，至少鸿蒙上，如果熄屏或者切屏就会断连，不过也无所谓。</p><p>我需要记录音乐文件的更改，所以使用<strong>git lfs</strong>来做版本管理</p><blockquote><p><strong>git lfs服务器只给1g的流量，所以别用了</strong></p></blockquote><p>首次添加时，如果一次性git add，然后push上去，会文件过大而失败，需要分批来做这件事</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要提交的文件夹列表</span></span><br><span class="line">folders=(<span class="string">&quot;Music&quot;</span>)</span><br><span class="line"><span class="comment"># 每次提交的文件数</span></span><br><span class="line">batch_size=10</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> folder <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;folders[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$folder</span>&quot;</span></span><br><span class="line">    files=(*)</span><br><span class="line">    num_files=<span class="variable">$&#123;#files[@]&#125;</span></span><br><span class="line">    <span class="keyword">for</span> ((i=0; i&lt;num_files; i+=batch_size))</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        batch_files=(<span class="string">&quot;<span class="variable">$&#123;files[@]:i:batch_size&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;batch_files[@]&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            git add <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        git commit -m <span class="string">&quot;add files&quot;</span></span><br><span class="line">        git push origin master</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">cd</span> ..</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>自己写了一个<a href="https://github.com/RyaoChengfeng/MusicInfoExtractor">MusicInfoExtractor</a>用于解析目录下的音乐文件，然后输出到json，再只提交元信息就好了。</p><h2 id="音乐刮削"><a href="#音乐刮削" class="headerlink" title="音乐刮削"></a>音乐刮削</h2><p>音乐的封面和标题等信息非常重要，而这些都在音乐的元信息里，在不知多久以前在某些神秘的地方下载的无损文件它很可能缺少这些信息，甚至文件名也是一串魔法字符串，这非常的不妙。</p><p>最佳的是使用网易云和qq的智能识别来填充音乐的tag，但是我没有找到任何一个实现了这个功能的工具</p><p>主流的方案是用<strong>MusicBrainz Picard</strong>或者<strong>mp3tag</strong>，但是这一堆galgame里和动画纯音乐专辑里的冷门音乐，实在是不好用。</p><p>找到了musictag：<a href="https://www.cnblogs.com/vinlxc/p/11347744.html">https://www.cnblogs.com/vinlxc/p/11347744.html</a> ，虽然貌似没有开源，但是支持了网易云和qq音乐等匹配，可惜只能在windows上用它</p><p><img src="https://cdn.ryaoknw.site/picgo/QQ20200831224848.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/QQ20200831224848.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><h2 id="番剧"><a href="#番剧" class="headerlink" title="番剧"></a>番剧</h2><p>用<a href="https://github.com/EstrellaXD/Auto_Bangumi">Auto_Bangumi</a>，再加载到emby</p><p>如果想要其他的电影电视剧，使用<a href="https://github.com/Jackett/Jackett">Jackett</a></p><h2 id="音声"><a href="#音声" class="headerlink" title="音声"></a>音声</h2><p><del>音声是好东西</del>，但我不是重度依赖者，所以不太想搭，毕竟真的吃硬盘空间</p><p>如果需要，可以使用kikoeru，十分轻量的音乐流媒体服务器，<psw>最伟大的同**声网站www.XXXX.one正是使用了它</psw></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>frp配置内网穿透暴露kubernetes集群</title>
      <link href="/2023/4/82c24833ebd8/"/>
      <url>/2023/4/82c24833ebd8/</url>
      
        <content type="html"><![CDATA[<h1 id="frp配置内网穿透暴露kubernetes集群"><a href="#frp配置内网穿透暴露kubernetes集群" class="headerlink" title="frp配置内网穿透暴露kubernetes集群"></a>frp配置内网穿透暴露kubernetes集群</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>1核2G的服务器太垃圾了，搭了kubernetes，但是各种组件都吃性能，研究了一下内网穿透，尝试让电脑在开机的时候可以用公网ip访问服务，这样就完全没有性能瓶颈了</p><p>折腾了很久。。。对于rancher，helm装完有一大大大大堆的资源被安装下来了，也不知道它的流量是怎么走的，会重定向一次host，导致循环重定向，排查了半天，最终放弃挣扎了，但是正常的服务是可以用的，同时放弃了ingress-nginx,换用了apisix，这一步也折腾了很久</p><h2 id="frp"><a href="#frp" class="headerlink" title="frp"></a>frp</h2><p>server和client都要有</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/fatedier/frp/releases/download/v0.48.0/frp_0.48.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf frp_0.48.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="配置server"><a href="#配置server" class="headerlink" title="配置server"></a>配置server</h2><p><code>vim frps.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FRP服务端</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="comment"># frp监听的端口，默认是7000，可以改成其他的</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># 授权码，请改成更复杂的</span></span><br><span class="line"><span class="attr">token</span> = b3rpf5Gm  <span class="comment"># 这个token之后在客户端会用到</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># frp管理后台端口，请按自己需求更改</span></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7001</span></span><br><span class="line"><span class="comment"># frp管理后台用户名和密码，请改成自己的</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin</span><br><span class="line"><span class="attr">dashboard_pwd</span> = admin</span><br><span class="line"><span class="attr">enable_prometheus</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># frp日志配置</span></span><br><span class="line"><span class="attr">log_file</span> = /var/log/frps.log</span><br><span class="line"><span class="attr">log_level</span> = info</span><br><span class="line"><span class="attr">log_max_days</span> = <span class="number">3</span></span><br></pre></td></tr></table></figure><p><strong>添加到systemctl命令组</strong>，保证开机自启动，当然你也可以用docker跑服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/frp</span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">ln</span> -s /root/frp/frps.ini /etc/frp/frps.ini</span><br><span class="line">sudo <span class="built_in">cp</span> frps /usr/bin</span><br></pre></td></tr></table></figure><p><code>vim /usr/lib/systemd/system/frps.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=The nginx HTTP and reverse proxy server</span><br><span class="line"><span class="attr">After</span>=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/frp/frps -c /usr/local/frp/frps.ini</span><br><span class="line"><span class="attr">KillSignal</span>=SIGQUIT</span><br><span class="line"><span class="attr">TimeoutStopSec</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">KillMode</span>=process</span><br><span class="line"><span class="attr">PrivateTmp</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">StandardOutput</span>=syslog</span><br><span class="line"><span class="attr">StandardError</span>=inherit</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> frps</span><br><span class="line">systemctl start frps</span><br></pre></td></tr></table></figure><p>记得打开需要的端口安全组和防火墙</p><h2 id="配置client"><a href="#配置client" class="headerlink" title="配置client"></a>配置client</h2><p><code>vim frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = &lt;ip&gt;</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">token</span> = b3rpf5Gm</span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="comment"># 这个自定义，之后再ssh连接的时候要用</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">7002</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c frpc.ini</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r frp /usr/local/</span><br><span class="line"></span><br><span class="line">sudo vim /usr/lib/systemd/system/frpc.service</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=The nginx HTTP and reverse proxy server</span><br><span class="line"><span class="attr">After</span>=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/frp/frpc -c /usr/local/frp/frpc.ini</span><br><span class="line"><span class="attr">KillSignal</span>=SIGQUIT</span><br><span class="line"><span class="attr">TimeoutStopSec</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">KillMode</span>=process</span><br><span class="line"><span class="attr">PrivateTmp</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">StandardOutput</span>=syslog</span><br><span class="line"><span class="attr">StandardError</span>=inherit</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> frpc</span><br><span class="line">systemctl start frpc</span><br></pre></td></tr></table></figure><p>配置完后，可以通过ssh来测试是否能登陆自己的机器</p><h2 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h2><p>配置fpcs，添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">7080</span></span><br></pre></td></tr></table></figure><p>公网server nginx配置，将请求转发到frp的http端口</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">map</span> <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> upgrade;</span><br><span class="line">  &#x27;&#x27;      close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> <span class="regexp">*.k</span>8s.ryaoknw.site k8s.ryaoknw.site;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; </span><br><span class="line">    <span class="attribute">server_name</span> <span class="regexp">*.k</span>8s.ryaoknw.site k8s.ryaoknw.site;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/k8s.ryaoknw.site-<span class="number">0001</span>/fullchain.pem; <span class="comment"># 泛域名证书</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/k8s.ryaoknw.site-<span class="number">0001</span>/privkey.pem;</span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; </span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:7080;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host      <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>; <span class="comment">#配置weboscket</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="variable">$connection_upgrade</span>;<span class="comment">#配置weboscket</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置frpc，<code>frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[http]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">custom_domains</span> = *.k8s.ryaoknw.site,k8s.ryaoknw.site</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">7080</span></span><br></pre></td></tr></table></figure><p>内网nginx配置，对应http端口（7080）会被frpc转发到127.0.01:80，nginx代理了80端口，将请求转发到上游node</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> k8s &#123;</span><br><span class="line">  <span class="attribute">server</span> <span class="number">192.168.199.111:80</span>;  <span class="comment"># NodePort </span></span><br><span class="line">  <span class="comment">#server 192.168.199.112:80;</span></span><br><span class="line">  <span class="comment">#server 192.168.199.113:80;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">map</span> <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> upgrade;</span><br><span class="line">  &#x27;&#x27;      close;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="regexp">*.k</span>8s.ryaoknw.site k8s.ryaoknw.site;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">      <span class="attribute">proxy_pass</span> http://k8s;</span><br><span class="line">      <span class="attribute">proxy_set_header</span> Host      <span class="variable">$host</span>;</span><br><span class="line">      <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">      <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">      <span class="attribute">proxy_set_header</span> Connection <span class="variable">$connection_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此配置完毕，可以部署服务在本地集群，然后用ingress暴露即可访问</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230417031401586.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230417031401586.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230417031401586"></p>]]></content>
      
      
      <categories>
          
          <category> kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
            <tag> frp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>笔记同步方案</title>
      <link href="/2023/4/419637ff8af9/"/>
      <url>/2023/4/419637ff8af9/</url>
      
        <content type="html"><![CDATA[<h1 id="笔记同步方案"><a href="#笔记同步方案" class="headerlink" title="笔记同步方案"></a>笔记同步方案</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>笔记里写了一大堆东西，现在在windows上保存，并把windows的磁盘开机自动挂载到linux上实现双端的同步，但这样在手机上是访问不到笔记的，很不方便，使用服务器搭建一个webdav倒是很方便，但是这个轻量学生机不是很可靠，万一哪天我玩崩了，内容就消失了，还是使用云服务比较靠谱。</p><h2 id="typora-picgo-七牛云"><a href="#typora-picgo-七牛云" class="headerlink" title="typora+picgo+七牛云"></a>typora+picgo+七牛云</h2><p>我只考虑使用typora作为md编辑器，因为它非常顺手，<strong>我的嘉然主题和字体也非常好看</strong>。</p><p>图片上传使用picgo，一开始用的smms图床，smms图床有足够的免费空间，但是不知何时开始国内无法访问了，图床转而用了聚合图床，免费而且快，但某日发现它会把png转成jpg，这导致我的图片从rgba变成了rgb，这非常不合理，于是转用了七牛云。</p><p>七牛云的cdn用https要记流量付费，于是用nginx做一个反代来实现https的图片</p><h2 id="尝试joplin"><a href="#尝试joplin" class="headerlink" title="尝试joplin"></a>尝试joplin</h2><p>了解到joplin可以作为一个开源的笔记同步工具，安装下来试了试，基本的流程就是</p><ul><li>导入笔记</li><li>设置同步，可以同步到onedrive、dropdox等，也可以是任何的webdav</li><li>然后设置外部编辑器为typora</li></ul><p>每次打开joplin，编辑时打开外部编辑器，但编辑完还得关闭，整个流程非常麻烦，体验非常不好。</p><h2 id="坚果云"><a href="#坚果云" class="headerlink" title="坚果云"></a>坚果云</h2><p>有看到用typora+坚果云的方案，也去试了试，坚果云会提供免费的空间，也有提供linux的客户端</p><p>同步的方法就是webdav，和onedrive是一样的</p><p>但同步需要运行它的客户端，我不是很想每次开机都启动一个坚果云客户端，只把它用来同步我的md笔记</p><h2 id="onedrive"><a href="#onedrive" class="headerlink" title="onedrive"></a>onedrive</h2><p>考虑到还是得用webdav，最后还是回到了onedrive，onedrive在windows上同步是非常方便的，但在linux上挂载需要额外的操作</p><h3 id="rclone"><a href="#rclone" class="headerlink" title="rclone"></a>rclone</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure><p>你需要拿到access_token,或者申请一个API key，用于后续配置中的<code>config_token&gt;</code>，没有API key，<code>client_id&gt;</code>和<code>client_secret&gt;</code>为空即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone authorize <span class="string">&quot;onedrive&quot;</span></span><br></pre></td></tr></table></figure><p>然后配置rclone</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone config</span><br></pre></td></tr></table></figure><p>验证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone lsd &lt;配置的网盘名称&gt;:/</span><br></pre></td></tr></table></figure><p><img src="https://cdn.ryaoknw.site/picgo/image-20230407172742346.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230407172742346.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="挂载onedrive"><a href="#挂载onedrive" class="headerlink" title="挂载onedrive"></a>挂载onedrive</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install fuse</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone mount &lt;配置的云盘名称&gt;:&lt;要挂载的云盘目录&gt; &lt;作为挂载点的本地目录&gt; --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --<span class="built_in">umask</span> 000 --daemon</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone mount onedrive:/ /home/ryao/onedrive --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --<span class="built_in">umask</span> 000 --daemon</span><br></pre></td></tr></table></figure><p>取消挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fusermount -qzu &lt;挂载路径&gt;</span><br></pre></td></tr></table></figure><p><strong>开机自启</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=<span class="string">&quot; mount onedrive:/ /home/ryao/onedrive --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --umask 000 --daemon&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/rclone.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Rclone</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">ExecStart=$(command -v rclone) $&#123;command&#125;</span></span><br><span class="line"><span class="string">Restart=on-abort</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=default.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 开机自启</span><br><span class="line">systemctl enable rclone</span><br><span class="line"># 启动</span><br><span class="line">systemctl start rclone</span><br><span class="line"># 重启</span><br><span class="line">systemctl restart  rclone</span><br><span class="line"># 停止</span><br><span class="line">systemctl status rclone</span><br></pre></td></tr></table></figure><p>终于配置好了，然后发现onedrive的速度简直就是一种折磨，尝试使用了google drive，依旧慢的离谱</p><h2 id="dropbox"><a href="#dropbox" class="headerlink" title="dropbox"></a>dropbox</h2><p><a href="https://www.dropbox.com/install">https://www.dropbox.com/install</a></p><p>放弃了折腾，选择了dropbox。</p><p>不过由于国内连不上的原因，用代理安装后还要再安装Dropbox daemon，但是会connection reset by peer.</p><p>通过下载Dropbox daemon放到根目录就行了。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230407201040417.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230407201040417.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h2 id="rclone-kodo"><a href="#rclone-kodo" class="headerlink" title="rclone+kodo"></a>rclone+kodo</h2><p>由于众所周知的原因，dropbox不方便访问，所以尽管它很好用，在我这也不好用。</p><p>为什么我不能直接用对象存储来同步呢？难道我访问oss只能用cdn回源？</p><p>在我考虑用rclone来操作dropbox而不是使用它的客户端时，我发现rclone有s3的选项</p><p>配置好就行了，文档：<a href="https://developer.qiniu.com/kodo/12285/docking-rclone">https://developer.qiniu.com/kodo/12285/docking-rclone</a></p><p>rclone是一个强大的工具</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230407205059142.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230407205059142.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>使用<code>rclone sync local-path qiniu:dest-bucket-name/dest-directory-path  </code>进行同步</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230407211058837.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230407211058837.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>对比本地与云<code>rclone check local-path qiniu:dest-bucket-name/dest-directory-path</code></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230407211352268.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230407211352268.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>非常完美</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>音乐管理方案</title>
      <link href="/2023/4/704fa143084e/"/>
      <url>/2023/4/704fa143084e/</url>
      
        <content type="html"><![CDATA[<h1 id="音乐管理方案"><a href="#音乐管理方案" class="headerlink" title="音乐管理方案"></a>音乐管理方案</h1><h2 id="Navidrome"><a href="#Navidrome" class="headerlink" title="Navidrome"></a>Navidrome</h2><p>使用Navidrome管理音乐</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20230405171158098.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20230405171158098.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">navidrome:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">deluan/navidrome:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;4533:4533&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ND_SCANSCHEDULE:</span> <span class="string">1m</span></span><br><span class="line">      <span class="attr">ND_SPOTIFY_ID:</span> <span class="string">4cd036bsq**</span></span><br><span class="line">      <span class="attr">ND_SPOTIFY_SECRET:</span> <span class="string">249ca01a**</span>  </span><br><span class="line">      <span class="attr">ND_LOGLEVEL:</span> <span class="string">info</span></span><br><span class="line">      <span class="attr">ND_SESSIONTIMEOUT:</span> <span class="string">24h</span></span><br><span class="line">      <span class="attr">ND_BASEURL:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./data:/data&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./music:/music:ro&quot;</span> <span class="comment"># 冒号左边修改成自己本地的音乐文件夹路径</span></span><br></pre></td></tr></table></figure><h3 id="Spotify同步"><a href="#Spotify同步" class="headerlink" title="Spotify同步"></a>Spotify同步</h3><p>在 Spotify 中创建一个免费帐户，然后按照以下步骤操作</p><p><a href="https://developer.spotify.com/dashboard/applications%E6%B3%A8%E5%86%8C%E5%9C%B0%E5%9D%80%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8D%95%E5%87%BB">https://developer.spotify.com/dashboard/applications注册地址，然后单击</a> Spotify 的开发者仪表板中的CREATE AN APP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ND_SPOTIFY_ID        Spotify 客户端 ID</span><br><span class="line">ND_SPOTIFY_SECRETSpotify 客户端 Secret</span><br></pre></td></tr></table></figure><h3 id="转码设置"><a href="#转码设置" class="headerlink" title="转码设置"></a>转码设置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">转码设置之所以要转码，是因为无损的文件比较大，一般都有几百M，所以需要进行转码成，便于客户端进行播放</span><br><span class="line">但 Navidrome 出于安全原因，禁用了从 Web 界面更改参数，所以需要先修改 Docker 的环境变量</span><br><span class="line">ND_ENABLETRANSCODINGCONFIG设置为 true 才能支持转码功能</span><br><span class="line">ND_TRANSCODINGCACHESIZE转码缓存的大小。设置 0 为禁用缓存，默认为 100MB</span><br></pre></td></tr></table></figure><h2 id="miniserve"><a href="#miniserve" class="headerlink" title="miniserve"></a>miniserve</h2><p>Navidrome<strong>无法直接上传音乐文件</strong>，需要文件服务器来管理。</p><p>看到中文博客上用miniserve，搭了一个，<strong>但是非常不好用</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">miniserve:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">svenstaro/miniserve:latest</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">navidrome</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;4534:8080&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./music:/downloads&quot;</span> <span class="comment"># 冒号左边修改成自己本地的音乐文件夹路径</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;-r -z -u -q -p 8080 -a username:passwd /downloads&quot;</span> <span class="comment"># </span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><h2 id="Nextcloud"><a href="#Nextcloud" class="headerlink" title="Nextcloud"></a>Nextcloud</h2><p>在考虑nextcloud、owncloud、seafile，seafile的文件不是直接保存的，而是分块加密保存的，虽然性能强大，但是<strong>不太符合我的需求</strong>。（有时间考虑搭一个seafile）</p><p>nextcloud是非常热门的文件服务方案，功能非常多。</p><p>尝试搭建，但是功能多过，过于臃肿，不太好用，而且php太慢了，1核2G的服务器想用点轻量的东西。</p><h3 id="部署-1"><a href="#部署-1" class="headerlink" title="部署"></a>部署</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./cloud/db:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=FtLpb2Mwx3Qc4BTJ7bmh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=Ks1acs2R2KU5axpbQ7AU</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=nextcloud</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=ryaoknw</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nextcloud</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nextcloud</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">4534</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./cloud/config:/var/www/html/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/nextcloud:/var/www/html/data</span> <span class="comment"># 这里是映射到外置硬盘，也自行修改</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./cloud/apps:/var/www/html/apps</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nextcloud</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=Ks1acs2R2KU5axpbQ7AU</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=nextcloud</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=ryaoknw</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_HOST=db</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">nextcloud:</span></span><br></pre></td></tr></table></figure><h2 id="cloudreve"><a href="#cloudreve" class="headerlink" title="cloudreve"></a>cloudreve</h2><p>找到了cloudreve和alist, alist的侧重不太一样，决定用cloudreve，cloudreve支持webdav，也可以当个网盘用，但是<strong>不是文件原始目录结构</strong>，操，又不能用。</p><h3 id="部署-2"><a href="#部署-2" class="headerlink" title="部署"></a>部署</h3><p>先创建空文件<code>conf.ini</code>、<code>cloudreve.db</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">cloudreve:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">cloudreve</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">cloudreve/cloudreve:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5212:5212&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./temp_data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./cloudreve/uploads:/cloudreve/uploads</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./cloudreve/conf.ini:/cloudreve/conf.ini</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./cloudreve/cloudreve.db:/cloudreve/cloudreve.db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./cloudreve/avatar:/cloudreve/avatar</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">aria2</span></span><br><span class="line">  <span class="attr">aria2:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">aria2</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">p3terx/aria2-pro</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RPC_SECRET=DGDj6tUgiBMacKZad4zW</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RPC_PORT=6800</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./aria2/config:/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./temp_data:/data</span></span><br></pre></td></tr></table></figure><h2 id="FileBrowser"><a href="#FileBrowser" class="headerlink" title="FileBrowser"></a>FileBrowser</h2><p>文件原始目录结构的文件服务，直接对应服务器文件目录。</p><h3 id="部署-3"><a href="#部署-3" class="headerlink" title="部署"></a>部署</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">filebrowser:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">filebrowser/filebrowser:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">filebrowser</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8089:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">filebrowser</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/root:/srv</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./filebrowser.db:/database.db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.filebrowser.json:/.filebrowser.json</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">    <span class="attr">logging:</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">&#x27;json-file&#x27;</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">        <span class="attr">max-size:</span> <span class="string">&#x27;1m&#x27;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">filebrowser:</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch filebrowser.db</span><br><span class="line">touch .filebrowser.json</span><br></pre></td></tr></table></figure><p>编辑<code>.filebrowser.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zh-cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;baseURL&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stdout&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/database.db&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;root&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/srv&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2023年1月追番锐评</title>
      <link href="/2023/4/57dcfb3d37eb/"/>
      <url>/2023/4/57dcfb3d37eb/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一月的动画实在没有什么意思。。。完全没有详细评价的动力哦。还是看看4月吧。</p><h2 id="2023年1月"><a href="#2023年1月" class="headerlink" title="2023年1月"></a>2023年1月</h2><h3 id="想要成为影之实力者！"><a href="#想要成为影之实力者！" class="headerlink" title="想要成为影之实力者！"></a>想要成为影之实力者！</h3><p><img src="https://lain.bgm.tv/pic/cover/c/39/96/329114_mB55b.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/39/96/329114_mB55b.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：6</p><p>20话动画，10月番1月完结，中二转生异世界</p><p>每集ed换个女主来唱，再添一张涩图诚意满满</p><p>动画改编部分也还行，关键把人设和cv整明白了，制作公司和观众之间达成了默契，用着实在不充裕的制作资源，把功夫花在观众想看的地方，成为了每周一乐的厕纸</p><h3 id="别当欧尼酱了！"><a href="#别当欧尼酱了！" class="headerlink" title="别当欧尼酱了！"></a>别当欧尼酱了！</h3><p><img src="https://lain.bgm.tv/pic/cover/c/7e/ca/378862_24TnR.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/7e/ca/378862_24TnR.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：6.5</p><p>萌系作画在近年真吃香，看oped时就被震撼到，这作画就是摆明了在炫技吧。</p><p>全篇都保持了极高的制作水准，Studio Bind纯秀技术，被垃圾污染眼睛时看看别酱动手截图简直是享受</p><h3 id="进击的巨人-最终季-完结篇-前篇"><a href="#进击的巨人-最终季-完结篇-前篇" class="headerlink" title="进击的巨人 最终季 完结篇 前篇"></a>进击的巨人 最终季 完结篇 前篇</h3><p><img src="https://lain.bgm.tv/pic/cover/c/4f/33/376739_KMN9x.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/4f/33/376739_KMN9x.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>star：8</p><p>剧场版高水准制作，但也没有那么“高水准”</p><p>只有1h还要分成前后篇，只能说MAPPA确实事情比较多</p><h3 id="冰剑的魔术师将要统一世界"><a href="#冰剑的魔术师将要统一世界" class="headerlink" title="冰剑的魔术师将要统一世界"></a>冰剑的魔术师将要统一世界</h3><p><img src="https://lain.bgm.tv/pic/cover/c/f8/95/379687_51Jj6.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/f8/95/379687_51Jj6.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：1</p><p>淳皇裕帝将要统一世界</p><p>太乐了，4倍速瞬间乐完，笑得合不拢嘴</p><h3 id="转生公主与天才千金的魔法革命"><a href="#转生公主与天才千金的魔法革命" class="headerlink" title="转生公主与天才千金的魔法革命"></a>转生公主与天才千金的魔法革命</h3><p><img src="https://lain.bgm.tv/pic/cover/c/fd/3c/395714_5EeZx.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/fd/3c/395714_5EeZx.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：5</p><p>人设不错，百合好好好</p><p>演出太傻了，重百剧情不带点纠结情愫和扭曲文学看着没意思</p><p>除了yuri之外内容不需要评价</p><h3 id="生而为狗，我很幸福"><a href="#生而为狗，我很幸福" class="headerlink" title="生而为狗，我很幸福"></a>生而为狗，我很幸福</h3><p><img src="https://lain.bgm.tv/pic/cover/c/83/d3/374319_JSG4d.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/83/d3/374319_JSG4d.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：4.5</p><p>看无修第一话时：神！</p><p>继续每周看时：好无聊，逆天的劲头一过，同质化的内容完全提不起继续看的兴趣</p><h3 id="魔王学院的不适任者～史上最强的魔王始祖，转生就读子孙们的学校～-Ⅱ"><a href="#魔王学院的不适任者～史上最强的魔王始祖，转生就读子孙们的学校～-Ⅱ" class="headerlink" title="魔王学院的不适任者～史上最强的魔王始祖，转生就读子孙们的学校～ Ⅱ"></a>魔王学院的不适任者～史上最强的魔王始祖，转生就读子孙们的学校～ Ⅱ</h3><p><img src="https://lain.bgm.tv/pic/cover/c/5e/85/330054_86gc8.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/5e/85/330054_86gc8.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>star：4</p><p>第一季时好感拉满，大沼心简直是厕纸大师，但在第二季中明显拉垮。</p><p>实在不想听裕帝的答辩声线，剧情质量与第一季也完全不能比</p><p>本来很期待这位“镀金厕纸”，但最后表现地十分遗憾。</p><h2 id="补番"><a href="#补番" class="headerlink" title="补番"></a>补番</h2><p><strong>只涉及近年放送但当季没追、之后才补完的，可能涉及想要特意评价但没时间写长评的。</strong></p><h3 id="擅长捉弄的高木同学-剧场版"><a href="#擅长捉弄的高木同学-剧场版" class="headerlink" title="擅长捉弄的高木同学 剧场版"></a>擅长捉弄的高木同学 剧场版</h3><p><img src="https://lain.bgm.tv/pic/cover/c/fd/00/347888_fBpdB.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/fd/00/347888_fBpdB.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：6</p><p>大郎，该吃狗粮了，都什么年代了还在吃传统狗粮？</p><p>我认为高木胜在小剧场的形式和只使用西片视角来表现捉弄的细节和二人心意的精妙演出，但剧场版稀烂的后半段只值得听听音乐。</p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s(基本概念)</title>
      <link href="/2023/4/7b74ee081b63/"/>
      <url>/2023/4/7b74ee081b63/</url>
      
        <content type="html"><![CDATA[<h2 id="k8s是啥"><a href="#k8s是啥" class="headerlink" title="k8s是啥"></a>k8s是啥</h2><p>为<strong>容器化</strong>应用提供集群部署和管理的开源工具</p><p>集群由master和node组成</p><p><strong>Kubernetes 组件</strong></p><p><code>kube-apiserver</code> API 服务器，公开了 Kubernetes API<br><code>etcd</code> 键值数据库，可以作为保存 Kubernetes 所有集群数据的后台数据库<br><code>kube-scheduler</code> 调度 Pod 到哪个节点运行<br><code>kube-controller</code> 集群控制器<br><code>cloud-controller</code> 与云服务商交互</p><p><strong>node 组件</strong></p><p><code>Kubelet</code> 负责当前 Node 节点的 Pod 的创建、监控、修改和删除等</p><p><code>Proxy</code> 负责 Service 代理，同时也是软件模式的负载均衡器</p><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p><img src="https://cdn.ryaoknw.site/picgo/image-20221104044635790.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221104044635790.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h3><p>Kubernetes 中创建和管理的、最小的可部署的计算单元。安排在节点上，包含一组容器和卷。同一个Pod里的容器共享同一个网络命名空间，可以使用localhost互相通信。</p><p>一个pod内共享内部的所有资源。</p><h3 id="lable"><a href="#lable" class="headerlink" title="lable"></a>lable</h3><p>Label是attach到Pod的一对键&#x2F;值对，用来传递用户定义的属性。Label Selector。</p><h3 id="replication-controller-RC"><a href="#replication-controller-RC" class="headerlink" title="replication controller(RC)"></a>replication controller(RC)</h3><p>Replication Controller确保任意时间都有指定数量的Pod“副本”在运行。如果为某个Pod创建了Replication Controller并且指定3个副本，它会创建3个Pod，并且持续监控它们。如果某个Pod不响应，那么Replication Controller会替换它，保持总数为3</p><p>（管理pod生命周期）</p><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>每个 Pod 都会被分配一个唯一的 IP, 不过缺点就是这个 IP 会随着 Pod 的销毁而消失。</p><p>一个 Service 可以视为是一组提供相同服务的 Pod 的对外访问接口</p><h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># 部署名字</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># 用来查找关联的 Pod，所有标签都匹配才行</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="comment"># 定义 Pod 相关数据</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 定义容器，可以多个</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> <span class="comment"># 容器名字</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:latest</span> <span class="comment"># 镜像</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 单独配置 pod :</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># 定义容器，可以多个</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> <span class="comment"># 容器名字</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:latest</span> <span class="comment"># 镜像</span></span><br></pre></td></tr></table></figure><h2 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h2><ul><li>Service 通过 label 关联对应的 Pod</li><li>Servcie 生命周期不跟 Pod 绑定，不会因为 Pod 重创改变 IP</li><li>提供了负载均衡功能，自动转发流量到不同 Pod</li><li>可对集群外部提供访问端口</li><li>集群内部可通过服务名字访问</li></ul><p><img src="https://cdn.ryaoknw.site/picgo/image-20221104044644362.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221104044644362.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="comment"># 默认 ClusterIP 集群内可访问，NodePort 节点可访问，LoadBalancer 负载均衡模式（需要负载均衡器才可用）</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span> <span class="comment"># 本 Service 的端口</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">test-k8s</span> <span class="comment"># 必须配置</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span> <span class="comment"># 容器端口</span></span><br><span class="line">      <span class="comment"># nodePort: 31000 # 节点端口，范围固定 30000 ~ 32767</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8090</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">test-other</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8090</span></span><br><span class="line">      <span class="comment"># nodePort: 32000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h2><p>StatefulSet 是用来管理有状态的应用，例如数据库。<br>前面我们部署的应用，都是不需要存储数据，不需要记住状态的，可以随意扩充副本，每个副本都是一样的，可替代的。<br>而像数据库、Redis 这类有状态的，则不能随意扩充副本。<br>StatefulSet 会固定每个 Pod 的名字</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:latest</span></span><br><span class="line">          <span class="comment"># IfNotPresent 仅本地没有镜像时才远程拉，Always 永远都是从远程拉，Never 永远只用本地镜像，本地没有则报错</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">volumeMounts:</span>  </span><br><span class="line">              <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/data/db</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo-data</span></span><br><span class="line">          <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">             <span class="attr">claimName:</span> <span class="string">mongodata</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="comment"># HeadLess （不分配ip）</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">27017</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Service 的 <code>CLUSTER-IP</code> 是空的，Pod 名字也是固定的。</li><li>Pod 创建和销毁是有序的，创建是顺序的，销毁是逆序的。</li><li>Pod 重建不会改变名字，除了IP，所以不要用IP直连</li></ul><p>如果直接使用 Service 名字连接，会随机转发请求，要连接指定 Pod，可以这样<code>pod-name.service-name</code>，比如<code>mongodb-0.mongodb</code></p><h2 id="ConfigMap-amp-Secret"><a href="#ConfigMap-amp-Secret" class="headerlink" title="ConfigMap &amp; Secret"></a>ConfigMap &amp; Secret</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongo-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">mongoHost:</span> <span class="string">mongodb-0.mongodb</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.ryaoknw.site/picgo/image-20221030141043781.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221030141043781.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>密码、TOKEN，我们可以放到 secret 中。（数据需要Base64编码）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line"><span class="comment"># Opaque 用户定义的任意数据 https://kubernetes.io/zh/docs/concepts/configuration/secret/#secret-types</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># 数据要 base64。https://tools.fun/base64.html</span></span><br><span class="line">  <span class="attr">mongo-username:</span> <span class="string">bW9uZ291c2Vy</span></span><br><span class="line">  <span class="attr">mongo-password:</span> <span class="string">bW9uZ29wYXNz</span></span><br></pre></td></tr></table></figure><blockquote><p>作为环境变量</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:4.4</span></span><br><span class="line">          <span class="comment"># IfNotPresent 仅本地没有镜像时才远程拉，Always 永远都是从远程拉，Never 永远只用本地镜像，本地没有则报错</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_INITDB_ROOT_USERNAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-username</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_INITDB_ROOT_PASSWORD</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-password</span></span><br><span class="line">          <span class="comment"># Secret 的所有数据定义为容器的环境变量，Secret 中的键名称为 Pod 中的环境变量名称</span></span><br><span class="line">          <span class="comment"># envFrom:</span></span><br><span class="line">          <span class="comment"># - secretRef:</span></span><br><span class="line">          <span class="comment">#     name: mongo-secret</span></span><br></pre></td></tr></table></figure><p>或者挂载为文件（不展开了）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mypod</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">foo</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">&quot;/etc/foo&quot;</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">foo</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">mysecret</span></span><br></pre></td></tr></table></figure><h2 id="ingress"><a href="#ingress" class="headerlink" title="ingress"></a>ingress</h2><p>Ingress 为外部访问集群提供了一个 <strong>统一</strong> 入口，避免了对外暴露集群端口；<br>功能类似 Nginx，可以根据域名、路径把请求转发到不同的 Service。<br>可以配置 https</p><p><strong>跟 LoadBalancer 有什么区别？</strong><br>LoadBalancer 需要对外暴露端口，不安全；<br>无法根据域名、路径转发流量到不同 Service，多个 Service 则需要开多个 LoadBalancer；<br>功能单一，无法配置 https</p><p>要使用 Ingress，需要一个负载均衡器 + Ingress Controller。</p><p>负载均衡插件，可以安装 <a href="https://metallb.universe.tf/">METALLB</a>。</p><p>NGINX Ingress <a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/">https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/</a></p><p>配置yaml。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">simple-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">hello-world.info</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/doc</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service1</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">4200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/svnbucket</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service2</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MIT6.824 Lab1</title>
      <link href="/2023/4/0decddbbfd18/"/>
      <url>/2023/4/0decddbbfd18/</url>
      
        <content type="html"><![CDATA[<h2 id="Lab1"><a href="#Lab1" class="headerlink" title="Lab1"></a>Lab1</h2><h3 id="mapreduce"><a href="#mapreduce" class="headerlink" title="mapreduce"></a>mapreduce</h3><p>lab1需要实现一个mapreduce </p><p>Master和Worker的main例程在<code>main/mrcoordinator.go</code>和<code>main/mrworker.go</code>中，不要改动这些程序。<br>需要在<code>mr/coordinator.go</code>,<code>mr/worker.go</code>和<code>mr/rpc.go</code>中实现自己的代码。</p><p>worker执行map和reduce工作，master用于调度和分配任务，同时维护任务和worker的状态，两者通过rpc调用通信。</p><ul><li>在处理 Map 任务时，需要将中间产物 Key 切分为 <code>nReduce</code> 个 reduce 任务，这个参数是调用 <code>MakeMaster()</code> 函数时指定的！</li><li>第 X 个 Reduce 任务的产物应当命名为：<code>mr-out-X</code>；</li><li>最终输出文件 <code>mr-out-X</code> 应当每行一个输出，并且采用 <code>&quot;%v %v&quot;</code> 格式（和 <code>main/mrsequential.go</code> 一致）；</li><li>当 <code>main/mrmaster.go</code> 调用 <code>mr/master.go</code> 的 <code>Done</code> 函数返回 true 时，其认为所有任务都已完成，将会退出；</li><li>当所有的任务都结束，worker 应当退出；一个简单的实现是：当调用 <code>call</code> rpc 与 master 通信失败时，认为任务结束；不过一个另外一个做法是当任务结束后，master 下发一个 <code>请退出</code> 的任务，交给 worker 去执行</li></ul><p><code>worker.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;hash/fnv&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/rpc&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;path/filepath&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Map functions return a slice of KeyValue.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">type</span> KeyValue <span class="keyword">struct</span> &#123;</span><br><span class="line">Key   <span class="type">string</span></span><br><span class="line">Value <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// use ihash(key) % NReduce to choose the reduce</span></span><br><span class="line"><span class="comment">// task number for each KeyValue emitted by Map.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ihash</span><span class="params">(key <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">h := fnv.New32a()</span><br><span class="line">h.Write([]<span class="type">byte</span>(key))</span><br><span class="line"><span class="keyword">return</span> <span class="type">int</span>(h.Sum32() &amp; <span class="number">0x7fffffff</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// main/mrworker.go calls this function.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Worker</span><span class="params">(mapf <span class="keyword">func</span>(<span class="type">string</span>, <span class="type">string</span>)</span></span> []KeyValue,</span><br><span class="line">reducef <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">string</span>, []<span class="type">string</span>)</span></span> <span class="type">string</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Your worker implementation here.</span></span><br><span class="line">info := doGetInfo()</span><br><span class="line">log.Printf(<span class="string">&quot;Worker: receive coordinator&#x27;s info %v\n&quot;</span>, info)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">task := doCorrespond()</span><br><span class="line">log.Printf(<span class="string">&quot;Worker: receive coordinator&#x27;s response %v\n&quot;</span>, task)</span><br><span class="line"><span class="keyword">switch</span> task.Type &#123;</span><br><span class="line"><span class="keyword">case</span> MapType:</span><br><span class="line">MapTask(mapf, task.File, info.NReduce, task.Id)</span><br><span class="line"><span class="keyword">case</span> ReduceType:</span><br><span class="line">ReduceTask(reducef, info.NMap, task.Id)</span><br><span class="line"><span class="keyword">case</span> WaitType:</span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line"><span class="keyword">case</span> StopType:</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MapTask</span><span class="params">(mapF <span class="keyword">func</span>(<span class="type">string</span>, <span class="type">string</span>)</span></span> []KeyValue, filePath <span class="type">string</span>, NReduce <span class="type">int</span>, id <span class="type">int</span>) &#123;</span><br><span class="line">fileName := filePath</span><br><span class="line">file, err := os.Open(fileName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;cannot open %v&quot;</span>, fileName)</span><br><span class="line">&#125;</span><br><span class="line">content, err := ioutil.ReadAll(file)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;cannot read %v&quot;</span>, fileName)</span><br><span class="line">&#125;</span><br><span class="line">file.Close()</span><br><span class="line"></span><br><span class="line">kva := mapF(fileName, <span class="type">string</span>(content))</span><br><span class="line">intermediates := <span class="built_in">make</span>([][]KeyValue, NReduce)</span><br><span class="line"><span class="keyword">for</span> _, kv := <span class="keyword">range</span> kva &#123;</span><br><span class="line">index := ihash(kv.Key) % NReduce</span><br><span class="line">intermediates[index] = <span class="built_in">append</span>(intermediates[index], kv)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">for</span> index, intermediate := <span class="keyword">range</span> intermediates &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(index <span class="type">int</span>, intermediate []KeyValue)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line">tmpFileName := fmt.Sprintf(<span class="string">&quot;mr-%d-%d&quot;</span>, id, index)</span><br><span class="line"><span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">enc := json.NewEncoder(&amp;buf)</span><br><span class="line"><span class="keyword">for</span> _, kv := <span class="keyword">range</span> intermediate &#123;</span><br><span class="line">err := enc.Encode(&amp;kv)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;cannot encode json %v\n&quot;</span>, kv.Key)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">err := WriteFile(tmpFileName, &amp;buf)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;cannot write file %v, %v\n&quot;</span>, tmpFileName, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;(index, intermediate)</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">doReport(id, MapType)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReduceTask</span><span class="params">(reduceF <span class="keyword">func</span>(<span class="type">string</span>, []<span class="type">string</span>)</span></span> <span class="type">string</span>, NMap <span class="type">int</span>, id <span class="type">int</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> kva []KeyValue</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NMap; i++ &#123;</span><br><span class="line">filePath := fmt.Sprintf(<span class="string">&quot;mr-%d-%d&quot;</span>, i, id)</span><br><span class="line">file, err := os.Open(filePath)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;cannot open %v&quot;</span>, filePath)</span><br><span class="line">&#125;</span><br><span class="line">dec := json.NewDecoder(file)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">var</span> kv KeyValue</span><br><span class="line"><span class="keyword">if</span> err := dec.Decode(&amp;kv); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">kva = <span class="built_in">append</span>(kva, kv)</span><br><span class="line">&#125;</span><br><span class="line">file.Close()</span><br><span class="line">&#125;</span><br><span class="line">results := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, kv := <span class="keyword">range</span> kva &#123;</span><br><span class="line">results[kv.Key] = <span class="built_in">append</span>(results[kv.Key], kv.Value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line"><span class="keyword">for</span> key, values := <span class="keyword">range</span> results &#123;</span><br><span class="line">output := reduceF(key, values)</span><br><span class="line">fmt.Fprintf(&amp;buf, <span class="string">&quot;%v %v\n&quot;</span>, key, output)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tmpFileName := fmt.Sprintf(<span class="string">&quot;mr-out-%d&quot;</span>, id)</span><br><span class="line">err := WriteFile(tmpFileName, &amp;buf)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;cannot write file %v, %v\n&quot;</span>, tmpFileName, err)</span><br><span class="line">&#125;</span><br><span class="line">doReport(id, ReduceType)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// send an RPC request to the coordinator, wait for the response.</span></span><br><span class="line"><span class="comment">// usually returns true.</span></span><br><span class="line"><span class="comment">// returns false if something goes wrong.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">call</span><span class="params">(rpcname <span class="type">string</span>, args <span class="keyword">interface</span>&#123;&#125;, reply <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="comment">// c, err := rpc.DialHTTP(&quot;tcp&quot;, &quot;127.0.0.1&quot;+&quot;:1234&quot;)</span></span><br><span class="line">sockname := coordinatorSock()</span><br><span class="line">c, err := rpc.DialHTTP(<span class="string">&quot;unix&quot;</span>, sockname)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;dialing:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> c.Close()</span><br><span class="line"></span><br><span class="line">err = c.Call(rpcname, args, reply)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doCorrespond</span><span class="params">()</span></span> *CorrespondResponse &#123;</span><br><span class="line">rsp := CorrespondResponse&#123;&#125;</span><br><span class="line">call(<span class="string">&quot;Coordinator.Correspond&quot;</span>, &amp;CorrespondRequest&#123;&#125;, &amp;rsp)</span><br><span class="line"><span class="keyword">return</span> &amp;rsp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doGetInfo</span><span class="params">()</span></span> *InfoResponse &#123;</span><br><span class="line">rsp := InfoResponse&#123;&#125;</span><br><span class="line">call(<span class="string">&quot;Coordinator.Info&quot;</span>, &amp;InfoRequest&#123;&#125;, &amp;rsp)</span><br><span class="line"><span class="keyword">return</span> &amp;rsp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doReport</span><span class="params">(id <span class="type">int</span>, t TaskType)</span></span> &#123;</span><br><span class="line">call(<span class="string">&quot;Coordinator.Report&quot;</span>, &amp;ReportRequest&#123;id, t&#125;, &amp;ReportResponse&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteFile</span><span class="params">(filename <span class="type">string</span>, r io.Reader)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">dir, file := filepath.Split(filename)</span><br><span class="line"><span class="keyword">if</span> dir == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">dir = <span class="string">&quot;.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f, err := ioutil.TempFile(dir, file)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;cannot create temp file: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">_ = os.Remove(f.Name())</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">defer</span> f.Close()</span><br><span class="line">name := f.Name()</span><br><span class="line"><span class="keyword">if</span> _, err := io.Copy(f, r); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;cannot write data to tempfile %q: %v&quot;</span>, name, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := f.Close(); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;can&#x27;t close tempfile %q: %v&quot;</span>, name, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">info, err := os.Stat(filename)</span><br><span class="line"><span class="keyword">if</span> os.IsNotExist(err) &#123;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := os.Chmod(name, info.Mode()); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;can&#x27;t set filemode on tempfile %q: %v&quot;</span>, name, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := os.Rename(name, filename); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;cannot replace %q with tempfile %q: %v&quot;</span>, filename, name, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>coordinator.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;net/rpc&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">Timeout = time.Second * <span class="number">10</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once *sync.Once</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Task <span class="keyword">struct</span> &#123;</span><br><span class="line">File      <span class="type">string</span></span><br><span class="line">Id        <span class="type">int</span></span><br><span class="line">Type      TaskType</span><br><span class="line">Status    TaskStatus</span><br><span class="line">StartTime time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Coordinator <span class="keyword">struct</span> &#123;</span><br><span class="line">lock sync.Mutex</span><br><span class="line"></span><br><span class="line">Files []<span class="type">string</span></span><br><span class="line"><span class="comment">// Your definitions here.</span></span><br><span class="line">NReduce  <span class="type">int</span></span><br><span class="line">NMap     <span class="type">int</span></span><br><span class="line">Close    <span class="type">bool</span></span><br><span class="line">TaskCh   <span class="keyword">chan</span> CorrespondMsg</span><br><span class="line">Tasks    []Task</span><br><span class="line">doneCh   <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">ReportCh <span class="keyword">chan</span> ReportMsg</span><br><span class="line">WorkFlow Flow</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CorrespondMsg <span class="keyword">struct</span> &#123;</span><br><span class="line">response *CorrespondResponse</span><br><span class="line">ok       <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReportMsg <span class="keyword">struct</span> &#123;</span><br><span class="line">request *ReportRequest</span><br><span class="line">ok      <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Your code here -- RPC handlers for the worker to call.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> Correspond(request *CorrespondRequest, response *CorrespondResponse) <span class="type">error</span> &#123;</span><br><span class="line">msg := CorrespondMsg&#123;response, <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)&#125;</span><br><span class="line">c.TaskCh &lt;- msg</span><br><span class="line">&lt;-msg.ok <span class="comment">// wait send task response</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> Info(request *InfoRequest, response *InfoResponse) <span class="type">error</span> &#123;</span><br><span class="line">response.NMap, response.NReduce, response.Close = c.NMap, c.NReduce, c.Close</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> Report(request *ReportRequest, response *ReportResponse) <span class="type">error</span> &#123;</span><br><span class="line">msg := ReportMsg&#123;request, <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)&#125;</span><br><span class="line">c.ReportCh &lt;- msg</span><br><span class="line">&lt;-msg.ok</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> Scheduler() &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> c.WorkFlow &#123;</span><br><span class="line"><span class="keyword">case</span> OnInit:</span><br><span class="line">c.WorkFlow = OnMap</span><br><span class="line"><span class="keyword">case</span> OnMap:</span><br><span class="line">once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator start %v\n&quot;</span>, OnMap)</span><br><span class="line">c.initMap()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> msg := &lt;-c.TaskCh:</span><br><span class="line">c.Assigner(&amp;msg)</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator: assigned a task %v to worker\n&quot;</span>, msg.response)</span><br><span class="line">msg.ok &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> msg := &lt;-c.ReportCh:</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator: Worker has executed task %v \n&quot;</span>, msg.request)</span><br><span class="line">c.lock.Lock()</span><br><span class="line">c.Tasks[msg.request.Id].Status = Finished</span><br><span class="line">c.lock.Unlock()</span><br><span class="line">msg.ok &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> OnReduce:</span><br><span class="line">once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator: %v finished, start %v\n&quot;</span>, OnMap, OnReduce)</span><br><span class="line">c.initReduce()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> msg := &lt;-c.TaskCh:</span><br><span class="line">c.Assigner(&amp;msg)</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator: assigned a task %v to worker\n&quot;</span>, msg.response)</span><br><span class="line">msg.ok &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> msg := &lt;-c.ReportCh:</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator: Worker has executed task %v\n&quot;</span>, msg.request)</span><br><span class="line">c.lock.Lock()</span><br><span class="line">c.Tasks[msg.request.Id].Status = Finished</span><br><span class="line">c.lock.Unlock()</span><br><span class="line">msg.ok &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> OnComplete:</span><br><span class="line">once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator: %v finished\n&quot;</span>, OnReduce)</span><br><span class="line">c.initComplete()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> msg := &lt;-c.TaskCh:</span><br><span class="line">msg.response.Type = StopType</span><br><span class="line">log.Printf(<span class="string">&quot;Coordinator: assigned stop to worker\n&quot;</span>)</span><br><span class="line">msg.ok &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> Assigner(msg *CorrespondMsg) &#123;</span><br><span class="line">c.lock.Lock()</span><br><span class="line"><span class="keyword">defer</span> c.lock.Unlock()</span><br><span class="line"></span><br><span class="line">finish := <span class="literal">true</span></span><br><span class="line">getJob := <span class="literal">false</span></span><br><span class="line"><span class="keyword">for</span> id, task := <span class="keyword">range</span> c.Tasks &#123;</span><br><span class="line"><span class="keyword">switch</span> task.Status &#123;</span><br><span class="line"><span class="keyword">case</span> UnDo:</span><br><span class="line">finish = <span class="literal">false</span></span><br><span class="line">getJob = <span class="literal">true</span></span><br><span class="line">c.Tasks[id].Status = Working</span><br><span class="line">c.Tasks[id].StartTime = time.Now()</span><br><span class="line">msg.response.Id = id</span><br><span class="line"><span class="keyword">switch</span> c.WorkFlow &#123;</span><br><span class="line"><span class="keyword">case</span> OnMap:</span><br><span class="line">msg.response.Type = MapType</span><br><span class="line">msg.response.File = c.Files[id]</span><br><span class="line"><span class="keyword">case</span> OnReduce:</span><br><span class="line">msg.response.Type = ReduceType</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> Working:</span><br><span class="line">finish = <span class="literal">false</span></span><br><span class="line"><span class="comment">// set timeout</span></span><br><span class="line"><span class="keyword">if</span> time.Now().Sub(task.StartTime) &gt; Timeout &#123;</span><br><span class="line">c.Tasks[id].Status = UnDo</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> Finished:</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> getJob &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !getJob &#123;</span><br><span class="line">msg.response.Type = WaitType</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> finish &#123;</span><br><span class="line">c.WorkFlow++</span><br><span class="line">once = <span class="built_in">new</span>(sync.Once)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> initMap() &#123;</span><br><span class="line">c.WorkFlow = OnMap</span><br><span class="line">c.Tasks = <span class="built_in">make</span>([]Task, <span class="built_in">len</span>(c.Files))</span><br><span class="line"><span class="keyword">for</span> index, file := <span class="keyword">range</span> c.Files &#123;</span><br><span class="line">c.Tasks[index] = Task&#123;</span><br><span class="line">File:   file,</span><br><span class="line">Id:     index,</span><br><span class="line">Status: UnDo,</span><br><span class="line">Type:   MapType,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> initReduce() &#123;</span><br><span class="line">c.WorkFlow = OnReduce</span><br><span class="line">c.Tasks = <span class="built_in">make</span>([]Task, c.NReduce)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; c.NReduce; i++ &#123;</span><br><span class="line">c.Tasks[i] = Task&#123;</span><br><span class="line">Id:     i,</span><br><span class="line">Status: UnDo,</span><br><span class="line">Type:   ReduceType,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> initComplete() &#123;</span><br><span class="line">c.WorkFlow = OnComplete</span><br><span class="line">c.doneCh &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// start a thread that listens for RPCs from worker.go</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> server() &#123;</span><br><span class="line">rpc.Register(c)</span><br><span class="line">rpc.HandleHTTP()</span><br><span class="line"><span class="comment">//l, e := net.Listen(&quot;tcp&quot;, &quot;:1234&quot;)</span></span><br><span class="line">sockname := coordinatorSock()</span><br><span class="line">os.Remove(sockname)</span><br><span class="line">l, e := net.Listen(<span class="string">&quot;unix&quot;</span>, sockname)</span><br><span class="line"><span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;listen error:&quot;</span>, e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> http.Serve(l, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// main/mrcoordinator.go calls Done() periodically to find out</span></span><br><span class="line"><span class="comment">// if the entire job has finished.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> Done() <span class="type">bool</span> &#123;</span><br><span class="line">&lt;-c.doneCh</span><br><span class="line">c.Close = <span class="literal">true</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// create a Coordinator.</span></span><br><span class="line"><span class="comment">// main/mrcoordinator.go calls this function.</span></span><br><span class="line"><span class="comment">// nReduce is the number of reduce tasks to use.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MakeCoordinator</span><span class="params">(files []<span class="type">string</span>, nReduce <span class="type">int</span>)</span></span> *Coordinator &#123;</span><br><span class="line">c := Coordinator&#123;</span><br><span class="line">Files:    files,</span><br><span class="line">NReduce:  nReduce,</span><br><span class="line">NMap:     <span class="built_in">len</span>(files),</span><br><span class="line">Close:    <span class="literal">false</span>,</span><br><span class="line">doneCh:   <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">1</span>),</span><br><span class="line">TaskCh:   <span class="built_in">make</span>(<span class="keyword">chan</span> CorrespondMsg),</span><br><span class="line">ReportCh: <span class="built_in">make</span>(<span class="keyword">chan</span> ReportMsg),</span><br><span class="line">WorkFlow: OnInit,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Your code here.</span></span><br><span class="line">once = <span class="built_in">new</span>(sync.Once)</span><br><span class="line">c.server()</span><br><span class="line"><span class="keyword">go</span> c.Scheduler()</span><br><span class="line"><span class="keyword">return</span> &amp;c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>rpc.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mr</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// RPC definitions.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// remember to capitalize all names.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TaskType <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Flow <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TaskStatus <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">WaitType TaskType = <span class="literal">iota</span></span><br><span class="line">MapType</span><br><span class="line">ReduceType</span><br><span class="line">StopType</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(task TaskType)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> task &#123;</span><br><span class="line"><span class="keyword">case</span> MapType:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;MapType&quot;</span></span><br><span class="line"><span class="keyword">case</span> ReduceType:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;ReduceType&quot;</span></span><br><span class="line"><span class="keyword">case</span> WaitType:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;WaitType&quot;</span></span><br><span class="line"><span class="keyword">case</span> StopType:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;StopType&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;unexpected TaskType %d&quot;</span>, task))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// TaskStatus</span></span><br><span class="line">UnDo TaskStatus = <span class="literal">iota</span></span><br><span class="line">Working</span><br><span class="line">Finished</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(status TaskStatus)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> status &#123;</span><br><span class="line"><span class="keyword">case</span> UnDo:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;UnDo&quot;</span></span><br><span class="line"><span class="keyword">case</span> Working:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Working&quot;</span></span><br><span class="line"><span class="keyword">case</span> Finished:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Finished&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;unexpected TaskStatus %d&quot;</span>, status))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// WorkFlow</span></span><br><span class="line">OnInit Flow = <span class="literal">iota</span></span><br><span class="line">OnMap</span><br><span class="line">OnReduce</span><br><span class="line">OnComplete</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(flow Flow)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> flow &#123;</span><br><span class="line"><span class="keyword">case</span> OnInit:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;OnInit&quot;</span></span><br><span class="line"><span class="keyword">case</span> OnMap:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;OnMap&quot;</span></span><br><span class="line"><span class="keyword">case</span> OnReduce:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;OnReduce&quot;</span></span><br><span class="line"><span class="keyword">case</span> OnComplete:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;OnComplete&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;unexpected WorkFlow %d&quot;</span>, flow))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CorrespondRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CorrespondResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">File <span class="type">string</span></span><br><span class="line">Id   <span class="type">int</span></span><br><span class="line">Type TaskType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> InfoRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> InfoResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">NMap    <span class="type">int</span></span><br><span class="line">NReduce <span class="type">int</span></span><br><span class="line">Close   <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReportRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">Id   <span class="type">int</span></span><br><span class="line">Type TaskType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReportResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(response CorrespondResponse)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> response.Type &#123;</span><br><span class="line"><span class="keyword">case</span> MapType:</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;&#123;Type:%v,File:%v,Id:%v&#125;&quot;</span>, response.Type, response.File, response.Id)</span><br><span class="line"><span class="keyword">case</span> ReduceType:</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;&#123;Type:%v,Id:%v&#125;&quot;</span>, response.Type, response.Id)</span><br><span class="line"><span class="keyword">case</span> WaitType, StopType:</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;&#123;Type:%v&#125;&quot;</span>, response.Type)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;unexpected Type %d&quot;</span>, response.Type))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(request ReportRequest)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;&#123;Id:%v,Type:%v&#125;&quot;</span>, request.Id, request.Type)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add your RPC definitions here.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Cook up a unique-ish UNIX-domain socket name</span></span><br><span class="line"><span class="comment">// in /var/tmp, for the coordinator.</span></span><br><span class="line"><span class="comment">// Can&#x27;t use the current directory since</span></span><br><span class="line"><span class="comment">// Athena AFS doesn&#x27;t support UNIX-domain sockets.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">coordinatorSock</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">s := <span class="string">&quot;/var/tmp/824-mr-&quot;</span></span><br><span class="line">s += strconv.Itoa(os.Getuid())</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Lab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MIT6.824 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CS144 Lab2</title>
      <link href="/2023/4/356cea6e7c3a/"/>
      <url>/2023/4/356cea6e7c3a/</url>
      
        <content type="html"><![CDATA[<h2 id="Lab2"><a href="#Lab2" class="headerlink" title="Lab2"></a>Lab2</h2><h3 id="wrapping-int32"><a href="#wrapping-int32" class="headerlink" title="wrapping_int32"></a>wrapping_int32</h3><p>实现序列号、绝对序列号与流索引间的转换。</p><p>出现cmake报错为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMake Error: The following variables are used in this project, but they are set to NOTFOUND.</span><br><span class="line">Please set them or make sure they are set and tested correctly in the CMake files:</span><br><span class="line">LIBPCAP</span><br><span class="line">    linked by target &quot;tcp_parser&quot; in directory /home/kangyu/sponge/testslinked by target &quot;tcp_parser&quot; in directory /home/ryao/Projects/cppProjects/CS144Labs/tests</span><br></pre></td></tr></table></figure><p>需要安装<code>libpcap-dev</code>库来解决. <code>apt install libpcap-dev</code></p><p>文段中指出了三种序列的关系，其中stream indices就是在lab1中的序列。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20221117141326664.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221117141326664.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.ryaoknw.site/picgo/image-20221117141427341.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221117141427341.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>照着写就行了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">WrappingInt32 <span class="title">wrap</span><span class="params">(<span class="type">uint64_t</span> n, WrappingInt32 isn)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//    uint64_t m = (1ll &lt;&lt; 32);</span></span><br><span class="line">    <span class="comment">//    uint32_t num = (n + isn.raw_value()) % m;</span></span><br><span class="line">    <span class="comment">//    return WrappingInt32&#123;num&#125;;</span></span><br><span class="line">    <span class="keyword">return</span> WrappingInt32&#123;isn.<span class="built_in">raw_value</span>() + <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(n)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! Transform a WrappingInt32 into an &quot;absolute&quot; 64-bit sequence number (zero-indexed)</span></span><br><span class="line"><span class="comment">//! \param n The relative sequence number</span></span><br><span class="line"><span class="comment">//! \param isn The initial sequence number</span></span><br><span class="line"><span class="comment">//! \param checkpoint A recent absolute 64-bit sequence number</span></span><br><span class="line"><span class="comment">//! \returns the 64-bit sequence number that wraps to `n` and is closest to `checkpoint`</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! \note Each of the two streams of the TCP connection has its own ISN. One stream</span></span><br><span class="line"><span class="comment">//! runs from the local TCPSender to the remote TCPReceiver and has one ISN,</span></span><br><span class="line"><span class="comment">//! and the other stream runs from the remote TCPSender to the local TCPReceiver and</span></span><br><span class="line"><span class="comment">//! has a different ISN.</span></span><br><span class="line"><span class="function"><span class="type">uint64_t</span> <span class="title">unwrap</span><span class="params">(WrappingInt32 n, WrappingInt32 isn, <span class="type">uint64_t</span> checkpoint)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> offset = n.<span class="built_in">raw_value</span>() - isn.<span class="built_in">raw_value</span>();</span><br><span class="line">    <span class="type">uint64_t</span> t = (checkpoint &amp; <span class="number">0xFFFFFFFF00000000</span>) + offset;</span><br><span class="line">    <span class="type">uint64_t</span> ret = t;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="built_in">int64_t</span>(t + (<span class="number">1ul</span> &lt;&lt; <span class="number">32</span>) - checkpoint)) &lt; <span class="built_in">abs</span>(<span class="built_in">int64_t</span>(t - checkpoint))) &#123;</span><br><span class="line">        ret = t + (<span class="number">1ul</span> &lt;&lt; <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t &gt;= (<span class="number">1ul</span> &lt;&lt; <span class="number">32</span>) &amp;&amp; <span class="built_in">abs</span>(<span class="built_in">int64_t</span>(t - (<span class="number">1ul</span> &lt;&lt; <span class="number">32</span>) - checkpoint)) &lt; <span class="built_in">abs</span>(<span class="built_in">int64_t</span>(ret - checkpoint))) &#123;</span><br><span class="line">        ret = t - (<span class="number">1ul</span> &lt;&lt; <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用 <code>ctest -R wrap</code> 进行测试</p><h3 id="tcp-receiver"><a href="#tcp-receiver" class="headerlink" title="tcp_receiver"></a>tcp_receiver</h3><p>实现tcp的接收端。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20221119213414108.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221119213414108.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>要求为：</p><blockquote><p>In the rest of this lab, you’ll be implementing the TCPReceiver. It will (1) receive segments from its peer, (2) reassemble the ByteStream using your StreamReassembler, and calculate the (3) acknowledgment number (ackno) and (4) the window size.</p></blockquote><p>需要实现<code>segment_received(const TCPSegment &amp;seg)</code>、<code>ackno()</code>、<code>window_size()</code>，具体的要求在文档(<a href="https://cs144.github.io/assignments/lab2.pdf)%E9%87%8C%E5%86%99%E7%9A%84%E5%BE%88%E6%B8%85%E6%A5%9A%E3%80%82">https://cs144.github.io/assignments/lab2.pdf)里写的很清楚。</a></p><p>总体还是很简单的。</p><p>需要注意的有：</p><ol><li><code>ackno()</code>: 对于SYN FIN 是需要单独占两个位置的 如果SYN出现了 需要+1 如果FIN也出现了 就需要再+1</li></ol><p><code>tcp_receiver.hh</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TCPReceiver</span> &#123;</span><br><span class="line">    <span class="comment">//! Our data structure for re-assembling bytes.</span></span><br><span class="line">    StreamReassembler _reassembler;</span><br><span class="line">    <span class="type">uint64_t</span> _abs_seqno;</span><br><span class="line">    WrappingInt32 _isn;</span><br><span class="line">    <span class="type">bool</span> _syn_flag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//! The maximum number of bytes we&#x27;ll store.</span></span><br><span class="line">    <span class="type">size_t</span> _capacity;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//! \brief Construct a TCP receiver</span></span><br><span class="line">    <span class="comment">//!</span></span><br><span class="line">    <span class="comment">//! \param capacity the maximum number of bytes that the receiver will</span></span><br><span class="line">    <span class="comment">//!                 store in its buffers at any give time.</span></span><br><span class="line">    <span class="built_in">TCPReceiver</span>(<span class="type">const</span> <span class="type">size_t</span> capacity)</span><br><span class="line">        : _reassembler(capacity)</span><br><span class="line">        , _abs_seqno(<span class="number">0</span>)</span><br><span class="line">        , _isn(<span class="number">0</span>)</span><br><span class="line">        , _syn_flag(<span class="literal">false</span>)</span><br><span class="line">        , _capacity(capacity) &#123;&#125;</span><br></pre></td></tr></table></figure><p><code>tcp_receiver.cc</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TCPReceiver::segment_received</span><span class="params">(<span class="type">const</span> TCPSegment &amp;seg)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> TCPHeader &amp;header = seg.<span class="built_in">header</span>();</span><br><span class="line">    <span class="comment">// 判断是否是 SYN 包</span></span><br><span class="line">    <span class="keyword">if</span> (header.syn) &#123;</span><br><span class="line">        _isn = header.seqno;</span><br><span class="line">        _syn_flag = <span class="literal">true</span>;</span><br><span class="line">        _abs_seqno = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!_syn_flag) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _abs_seqno = <span class="built_in">unwrap</span>(header.seqno, _isn, _abs_seqno);</span><br><span class="line">    <span class="comment">// 判断是否是 FIN 包</span></span><br><span class="line">    <span class="type">bool</span> _fin_flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (header.fin) &#123;</span><br><span class="line">        _fin_flag = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">uint64_t</span> stream_index = _abs_seqno - <span class="number">1</span> + header.syn;</span><br><span class="line">    _reassembler.<span class="built_in">push_substring</span>(seg.<span class="built_in">payload</span>().<span class="built_in">copy</span>(), stream_index, _fin_flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">optional&lt;WrappingInt32&gt; <span class="title">TCPReceiver::ackno</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 判断是否是在 LISTEN 状态</span></span><br><span class="line">    <span class="keyword">if</span> (!_syn_flag)</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    <span class="comment">// 如果不在 LISTEN 状态，则 ackno 还需要加上一个 SYN 标志的长度</span></span><br><span class="line">    <span class="type">uint64_t</span> abs_ack_no = _reassembler.<span class="built_in">stream_out</span>().<span class="built_in">bytes_written</span>() + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 如果当前处于 FIN_RECV 状态，则还需要加上 FIN 标志长度</span></span><br><span class="line">    <span class="keyword">if</span> (_reassembler.<span class="built_in">stream_out</span>().<span class="built_in">input_ended</span>()) &#123;</span><br><span class="line">        ++abs_ack_no;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">wrap</span>(abs_ack_no, <span class="built_in">WrappingInt32</span>(_isn));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">TCPReceiver::window_size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _capacity - _reassembler.<span class="built_in">stream_out</span>().<span class="built_in">buffer_size</span>(); &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Lab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS144 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CS144 Lab1</title>
      <link href="/2023/4/f440e1660a5f/"/>
      <url>/2023/4/f440e1660a5f/</url>
      
        <content type="html"><![CDATA[<h2 id="Lab1"><a href="#Lab1" class="headerlink" title="Lab1"></a>Lab1</h2><h3 id="stream-reassembler"><a href="#stream-reassembler" class="headerlink" title="stream_reassembler"></a>stream_reassembler</h3><p>实现一个流重组器，一个将字节流的字串或者小段按照正确顺序来拼接回连续字节流的模块。</p><p>要求：</p><ol><li>接收子串（由一串字节和大数据流中该串的第一个字节的索引组成），并提供一个<code>ByteStream</code>，其中所有的数据都被正确排序</li><li>注意考虑bytestream写满了的情况，以及reassembler满了的情况</li><li>注意边界等号</li></ol><p><img src="https://cdn.ryaoknw.site/picgo/image-20221116144212736.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221116144212736.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><code>void StreamReassembler::push_substring(const string &amp;data, const size_t index, const bool eof)</code>会接收一个子串，用_output.write()将串整理后写入，同时bytestream中可能同时调用了read()，此时会改变边界。</p><p>维护一个buffer list保证buffer不重叠，当data越界时需要裁剪。同时在write、插入buffer list时维护3个边界。</p><p>一开始我的想法是维护一个buffer的map，在插入新buffer时找到左侧已有的buffer判断是否重叠，如果重叠则合并两个buffer串，做相同的操作直到右侧（<code>index+data.size()</code>），同时还要维护整个map的capacity，并做裁剪。这样写出来的逻辑非常复杂。最后面向测试编程实在过不了所有测例，在最后折磨了一天后决定重写。</p><p>其实可以直接用capacity申请一个buffer的列表。没有字符的部分相当于字符<code>\0</code>，在插入子串时只需要计算出start和end的index，然后将buffer表的这一段覆盖即可，这样做就只需要维护unread，unassembled和unacceptable三个边界即可。在理解上和实现上都简化了太多！</p><blockquote><p>tips:实在调不对代码时可以尝试检查前面lab的代码是不是真的写对了，比如把别人的代码copy过来如果还是过不了test。。。不然就会想我一样调了一天都调不对</p></blockquote><p><code>stream_reassembler.hh</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StreamReassembler</span> &#123;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// Your code here -- add private members as necessary.</span></span><br><span class="line">    std::deque&lt;string&gt; _buffer;</span><br><span class="line">    std::deque&lt;<span class="type">bool</span>&gt; _flag;</span><br><span class="line">    <span class="type">bool</span> _is_eof = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">size_t</span> _eof_idx = <span class="number">0</span>;</span><br><span class="line">    <span class="type">size_t</span> _unassembled_bytes_size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    ByteStream _output;  <span class="comment">//!&lt; The reassembled in-order byte stream</span></span><br><span class="line">    <span class="type">size_t</span> _capacity;    <span class="comment">//!&lt; The maximum number of bytes</span></span><br><span class="line">    </span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><code>stream_reassembler.cc</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">StreamReassembler::<span class="built_in">StreamReassembler</span>(<span class="type">const</span> <span class="type">size_t</span> capacity)</span><br><span class="line">    : _buffer(capacity, <span class="string">&quot;&quot;</span>), _flag(capacity, <span class="literal">false</span>), _output(capacity), _capacity(capacity) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! \details This function accepts a substring (aka a segment) of bytes,</span></span><br><span class="line"><span class="comment">//! possibly out-of-order, from the logical stream, and assembles any newly</span></span><br><span class="line"><span class="comment">//! contiguous substrings and writes them into the output stream in order.</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">StreamReassembler::push_substring</span><span class="params">(<span class="type">const</span> string &amp;data, <span class="type">const</span> <span class="type">size_t</span> index, <span class="type">const</span> <span class="type">bool</span> eof)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// size_t _first_unread = _start_index + _output.bytes_read();</span></span><br><span class="line">    <span class="type">size_t</span> _first_unassembled = _output.<span class="built_in">bytes_written</span>();</span><br><span class="line">    <span class="type">size_t</span> _first_unaccept = _first_unassembled + _capacity;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= _first_unaccept || index + data.<span class="built_in">length</span>() &lt; _first_unassembled) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 裁剪字符串开始和结尾的index</span></span><br><span class="line">    <span class="type">size_t</span> begin_index = index;</span><br><span class="line">    <span class="type">size_t</span> end_index = index + data.<span class="built_in">length</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (begin_index &lt; _first_unassembled) &#123;</span><br><span class="line">        begin_index = _first_unassembled;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (end_index &gt;= _first_unaccept) &#123;</span><br><span class="line">        end_index = _first_unaccept;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 元素入队</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = begin_index; i &lt; end_index; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_flag[i - _first_unassembled]) &#123;</span><br><span class="line">            _buffer[i - _first_unassembled] = data[i - index];</span><br><span class="line">            _unassembled_bytes_size++;</span><br><span class="line">            _flag[i - _first_unassembled] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string wait_str;</span><br><span class="line">    <span class="keyword">while</span> (_flag.<span class="built_in">front</span>()) &#123;</span><br><span class="line">        wait_str += _buffer.<span class="built_in">front</span>();</span><br><span class="line">        _buffer.<span class="built_in">pop_front</span>();</span><br><span class="line">        _flag.<span class="built_in">pop_front</span>();</span><br><span class="line">        <span class="comment">// 为了保持队列容量不变需要在后面添加空元素占位</span></span><br><span class="line">        _buffer.<span class="built_in">emplace_back</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        _flag.<span class="built_in">emplace_back</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (wait_str.<span class="built_in">length</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">stream_out</span>().<span class="built_in">write</span>(wait_str);</span><br><span class="line">        _unassembled_bytes_size -= wait_str.<span class="built_in">length</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (eof) &#123;</span><br><span class="line">        _is_eof = <span class="literal">true</span>;</span><br><span class="line">        _eof_idx = end_index;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_is_eof &amp;&amp; _eof_idx == _output.<span class="built_in">bytes_written</span>()) &#123;</span><br><span class="line">        _output.<span class="built_in">end_input</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Lab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS144 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CS144 Lab0</title>
      <link href="/2023/4/c97217e90828/"/>
      <url>/2023/4/c97217e90828/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>cs144的lab文档非常详细，非常详细，详细到每一个都有10几页的大小，像一个仓库的readme，<del>以至于菜狗花大量时间读机翻却没看明白到底要干些什么，这也导致在开始lab0时根本不清楚自己要干些什么</del>。无论如何，这是一个很值得写完的lab。</p><p><img src="https://cdn.ryaoknw.site/picgo/image-20221116140320977.png" class="lazyload" data-srcset="https://cdn.ryaoknw.site/picgo/image-20221116140320977.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h2 id="Lab0"><a href="#Lab0" class="headerlink" title="Lab0"></a>Lab0</h2><h3 id="webget"><a href="#webget" class="headerlink" title="webget"></a>webget</h3><p>在<code>webget.cc</code>实现一个webget，实现访问外部网页。</p><p>需要使用<code>TCPSocket</code>和<code>Address</code>类</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_URL</span><span class="params">(<span class="type">const</span> string &amp;host, <span class="type">const</span> string &amp;path)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Your code here.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// You will need to connect to the &quot;http&quot; service on</span></span><br><span class="line">    <span class="comment">// the computer whose name is in the &quot;host&quot; string,</span></span><br><span class="line">    <span class="comment">// then request the URL path given in the &quot;path&quot; string.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then you&#x27;ll need to print out everything the server sends back,</span></span><br><span class="line">    <span class="comment">// (not just one call to read() -- everything) until you reach</span></span><br><span class="line">    <span class="comment">// the &quot;eof&quot; (end of file).</span></span><br><span class="line">    <span class="function">Address <span class="title">addr</span><span class="params">(host, <span class="string">&quot;http&quot;</span>)</span></span>;</span><br><span class="line">    TCPSocket st;</span><br><span class="line">    st.<span class="built_in">connect</span>(addr);</span><br><span class="line">    st.<span class="built_in">write</span>(<span class="string">&quot;GET &quot;</span> + path + <span class="string">&quot; HTTP/1.1\r\n&quot;</span>);</span><br><span class="line">    st.<span class="built_in">write</span>(<span class="string">&quot;HOST: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    st.<span class="built_in">write</span>(<span class="string">&quot;Connection: close\r\n&quot;</span>);</span><br><span class="line">    st.<span class="built_in">write</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span>(!st.<span class="built_in">eof</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; st.<span class="built_in">read</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    st.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;Function called: get_URL(&quot;</span> &lt;&lt; host &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; path &lt;&lt; <span class="string">&quot;).\n&quot;</span>;</span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;Warning: get_URL() has not been implemented yet.\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="byte-stream"><a href="#byte-stream" class="headerlink" title="byte_stream"></a>byte_stream</h3><p>需要实现一个可靠byte流。</p><p>大致需求：</p><ol><li><p>需要限制缓冲区长度，在缓冲区未满时才能写入缓冲区</p></li><li><p>字节流可以无限长</p></li><li><p>它是单线程的，不用考虑并发</p></li></ol><p>无非就是维护一个bytestream数据结构。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ByteStream</span> &#123;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::string _buffer;</span><br><span class="line">    <span class="type">size_t</span> _capacity = <span class="number">0</span>;</span><br><span class="line">    <span class="type">size_t</span> _read_count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">size_t</span> _write_count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> _input_end_flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">bool</span> _error = <span class="literal">false</span>;  <span class="comment">//!&lt; Flag indicating that the stream suffered an error.</span></span><br><span class="line">    </span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><code>byte_stream.cc</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">ByteStream::<span class="built_in">ByteStream</span>(<span class="type">const</span> <span class="type">size_t</span> capacity) : _buffer(), _capacity(capacity) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">ByteStream::write</span><span class="params">(<span class="type">const</span> string &amp;data)</span> </span>&#123;</span><br><span class="line">    <span class="type">size_t</span> cc = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; data.<span class="built_in">size</span>() &amp;&amp; <span class="built_in">remaining_capacity</span>() &gt; <span class="number">0</span>; ++i, ++_write_count, ++cc)</span><br><span class="line">        _buffer.<span class="built_in">push_back</span>(data[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! \param[in] len bytes will be copied from the output side of the buffer</span></span><br><span class="line"><span class="function">string <span class="title">ByteStream::peek_output</span><span class="params">(<span class="type">const</span> <span class="type">size_t</span> len)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _buffer.<span class="built_in">substr</span>(<span class="number">0</span>, len); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! \param[in] len bytes will be removed from the output side of the buffer</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ByteStream::pop_output</span><span class="params">(<span class="type">const</span> <span class="type">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &gt;= <span class="built_in">buffer_size</span>()) &#123;</span><br><span class="line">        _read_count += <span class="built_in">buffer_size</span>();</span><br><span class="line">        _buffer.<span class="built_in">clear</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _read_count += len;</span><br><span class="line">        _buffer.<span class="built_in">erase</span>(<span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! Read (i.e., copy and then pop) the next &quot;len&quot; bytes of the stream</span></span><br><span class="line"><span class="comment">//! \param[in] len bytes will be popped and returned</span></span><br><span class="line"><span class="comment">//! \returns a string</span></span><br><span class="line"><span class="function">std::string <span class="title">ByteStream::read</span><span class="params">(<span class="type">const</span> <span class="type">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    string data = <span class="keyword">this</span>-&gt;<span class="built_in">peek_output</span>(len);</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">pop_output</span>(len);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ByteStream::end_input</span><span class="params">()</span> </span>&#123; _input_end_flag = <span class="literal">true</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ByteStream::input_ended</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _input_end_flag; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">ByteStream::buffer_size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _buffer.<span class="built_in">size</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ByteStream::buffer_empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _buffer.<span class="built_in">size</span>() == <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ByteStream::eof</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">buffer_empty</span>() &amp;&amp; <span class="built_in">input_ended</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">ByteStream::bytes_written</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _write_count; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">ByteStream::bytes_read</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _read_count; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">ByteStream::remaining_capacity</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _capacity - _buffer.<span class="built_in">size</span>(); &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Lab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS144 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>向这狗娘养的世界</title>
      <link href="/2023/2/7e899c277a7b/"/>
      <url>/2023/2/7e899c277a7b/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，您输入的密码错误，请检查后重新输入。" data-whm="抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="2b724b68873b7a4315706a0bff5c3e1cc7e85b36e129837c49a37d5f7d934c37">688c91111db14f9d3aa396aa4128ccffdacdbe782570004c361f8b69f19568aeeeadaff6c616a36466967f4aa1a0a0541960d207ab8a56812ebfb99e843497742848826da20fefa43941c2853ce072323a7e60b2c9559d04c588a7552a5530ee3889a60a36503823ec713f283d04817a3b749f04c92a972c7e7a8dcfb81a4a6a7172b07c75c599cd90020bb7fb7aa784302b8a8e8af36df4e97cf259725f0758d3aefe0dc89bc726a1b0ff4cdf3f4faa30c4fd392b2491865d5e85402cefa43acd170a42cc49d67ba4747a931bca1fdb7b41e1731dd443c1e18e273648c845686c1fb0fbb325f8320097076347b7a41c8d88e424a5e2f637e5c2e370a77ad436840fb61fe7d2203e9047f9382477e81e3cfcc84dfd6bf096152c61a8231d130cfd6f96181d3a75460696d9156ba828d1955f881e42f33967a2a6d94cf8885ab396726c4e5dc14a112d2b5ba8b155a4dbac73f874e8d5e0b3ad3773f60f4fd4b99c0ead70780d146b0ad8815c648b967b92a5000f281b5ffeed6e9b12a79c27dc9fda1403c9c8e1d079eca4d241da2d7be8903947522f48497bc459b88fa8236848ff547d43d99c4b0bf7f7c663cbd50373651f7e438107a465eb9c4a356038c218de855385d207d9850236266a54b88c04e51f15e3c7563757cba571879de170fccd457b6dd4bf3fd0010798a07f6490dea2ec367ab9053ac9902417bd067d9d7e7fe1ea82e7e77f752d94d85b770eccba06bbd9398099a8ada08e449f90ff8d95a85e3fdef0dab66f4540033c7325c93b600fb46896fb8df6ffe02af3b99cd34ba1f104201f1ac2bc534590a74cba0063bd94e60ec64df3b4548f9805c97aab4bb75a62323fc38de12699db59ab79cca48574d457b66cdec08bcb5604a30150acf2713bcc44e11f90f850c5285735ab46a1b645098ff8acc96780abc2a8d68d07293724fcef0ab0d85dd3384997f898d0e426f1d73d2214f4bf7870fccd8fa5b60a57ab69b2227a39c668f9fec735ab82e2e8f5cd890097cc4c8961c61366017e0c60a313c4fff6477894e9bbb8729beb84f604dea2d9b88a1920dcde8b0cf89169b456459edf54a65d8e3a4472cc894781d686bf54d95f8e67385be8e7003b846a04217609aec65d6dc6fe8b232b97fddd4f6ea1a4a671ecf89e79d9ec7982cacb142a6b1e918349d780de7ee82dbebd0278a6c6a08b379f1149fee6f7d2fd5838d2199eae2eac771278fb872f3dc04edc0884f3fe1efa84dea2f630631a1aa20ee552d2795872b17498a9191f257e5accf64f12d10f1d7076978e84b2b120d457e3a43adba8f6a21e5db6f65de89a8f9aade32400cfcc860ea6cb1deb7eb613cd843c878e495e0a168ee7d06610a950cdd38eb774051ba709c6c4bcae1b1d0a5ee2cad40713b608c65dd6bd5f01a6a26ab016b60e80e3a88a2bc770fdc1d9a19d03957e449f6b2aeb8860dd5e4bfd41759a9f361c11c9bbb6254bdabe60fae78025c17fa8e477f0ca0468f04f41092052d6c574176d3b57217144ce9126ff727b89ed8b27c4f5e2f133b3c3a168b671a4bb23b2544e47082dfc30db6d094de5cbf574aba8308e0d99a834e589126b1e56f9b282c28b330bb883af10bd511a9de5f8cbe275aced1a36e8d94d4b7f95c922956ab3f7a3ad5fe5b25412130028f1e3c72d9796de840514c322fd44e34327af30ffd35791256c4dfe4773b16a577e48365cc74fae7eccb62091cee796b9bd7829f40184270de27ba5c8b3574375b9effc0c52d25e906276aba95bfaff8c4f52ab90006f256155b3057ef208742fe0ba82967ce35abca9265a056b58176a7d15e5c079dbe4a5137a69f9d0c7f281af7835490a0bd8329590e9635c92c96dc0dcb494e7d12c4ebb60abbe173ed67488b7fee843ff486e5283242c57e1cfb67370ff1e78779621c5b12d8a3519c7b6b0a7cf703add8f23ad043062df6a744968f91aaa99dc1ba055367a975d3083c75b18fa356cfc5824651ecd029fb9271be62e647d5e0a4e889889d5c88d56e1c925176f70d4441930d76e5962a711f5b8caffb641f208a417a0867a07fcd7d8ec88aabc655c7dad853bbabd7f457ad51007c885ed7bd4baa5d07d993a98fc819d6bfb1642491d4ae15b23073940880ca86100a6ab58c475e7d15500ae38a2539cfb947d422270fe69ae743e0961c2f395be4eed3f093b45aa32e66b6bdc895280fbd43998f80dd9d0e7e9e6f59dc3e981d09ff13a86d10b3b83509d392cf3e1200403c334179d9c8282fc27e7af0ae3324deb2432e5998921b7bdb269281635dd16c3f999f0adabd9825554c97417f99151813e6cb7d66df2ffbb0bcd6794214717997f527c619dc3e0bb0ba038f5a84551b6d567f81fe40c74b42d32b55b8a5249e7f614f61633257167dbd79e529bb829907f9b0296b322fcc90d65a2ed16c7686be1f4888175a694b59ebbf772b3cf251323bf616fb4de01d288a3d83a225d035cbcca3e43097ba1d9dd70a645043db3c46240381a01015f1c97895fc0d35c670d76be4ac94203fd7d444d36b0d58a37bb0405a1ae4ea71f8c49b0a24dbea7039e599bc2a49cb8c68f97ddf127ddc4fef182fa6523894904793fdfee30ded8602daf2d626b08acf1ab59152395591623509e29fb65bbbe94885a14c806f4f1f086ffb0aa6cffa5b7c519968bd18fde006778ff869cbd85f33a1457fd308d36e1b09419c1c22cd0c096f0cd4425612efedb5d0cfc887b4c4c581fc0bb1d37940508b14e3f1ea3c1842349574cef8d8562e1759908ec98bcdeaa580b9663ff0b8c3d1377520da1e35ac1fcd01233ff791c3ef885ccc87b19e1750a7640fbc6a47031e288121ce69efb5de9e1ea98c2fbf624973c9f9fe151b81ed69f5316b3c6630ecf402e0446927cfe5d6b6c7c35b5addf209b9b7941bab060e10bc89478bc47614771fe05be045b4511934209e8313a802f7e958c074445b8177988f087b11dce647494c75704e984225491ed95bee058eba1107e826b07b30c6b5df342290467b020c081e56d20e948d5ebcb285f33773d29fa22de001a44c280752bf418cade93cdc3c46cb6035e3f6c910d3b9fd789807e68669d5a9836b32215e5dfeb67e2d1952d1ea1997f798397360d8cdebf2455ecd6aa94d0ca82bac22ddaaf568f14734dc617e7544a15e82fe3d9af94a66d9f5663d73bdb1f2f58ae3b50fffe5228fdb9408b1e869c486385aed1fb4f0afe75b647280cd6d2563efcd4defbfc14e87ef2593e1a3f1c1d8e69622a15d044b68234095557979f29cd7b7b6e8ac16c203cfede481a98034f4802c18c89ef06deaa120af9d88aa099b71563f96e6b62ee6887b3be5749a0b07f4c262aa781918f676383655b2e91bf63ec3c0bf0a13cb2bcfbb4aa3ef89b528939ac70f19f5ecfc363fd015ba916afbba0e4301c5cd92de6fbfe204ec22740cd095e643788d53aabd40f5ebcbfa6f2344038d9ce109b5e87be46015acc7dedbe3fc38c3909c222e8f7e38f7bc4ead9eee60c9df7baecc5ac58d17c909759bac6eccd2970736aa57012a5d3e9d377d3dfd4fd28910d147c2d1e487650caf9dfe162706b6a49a8bf866371918bcc7408d3040df3041eadc3030c8e37f36e1e4145d81da75e6aba6391e675e2a1821b7d58838cf5fe53ec30c3e13346a9affa506d88125df93a9b78affae751dfa74f7c668ee8cac51d4fd913a702314ecd0b19927ec697ae0f241699d433d4cd67d1753aa40014152d3c636aed752d13b31b538034ca4a98a46539da0085e6d0dc52768b3cad183a0001e6477e226590969d6b75936c2a6aeedea51d4e9243d642f311bc75d57321bdf197e9aa6a0a92ea6293edb1de8b734facce373d339cbbb9a33aae119e2838b1123944487b2828ce8ccc9435cdaca33f95ae6dccfd29f17b7dfd0c5e8660afafd688ecbadd2b78752b38e125c85401caec0f7372767f1f96f20cc52efb4d2c6413ce594a14d50cc71df755ceaef7bed9ebdf6293d9dfa9c7ffc8ef1903c6c12147d0f8368fdf5ff876e0b18d0e75a1d803b7d8f26dd49eba0059f394bdb7e07d3ef5d6d490e6ee7d307459a0206e39233589950b476b195ba31c5d3b47d7dbc4f56b10d19124ce5348ebb47fa7c482560a2231f4dbb077667a2a376adedf030bb3e85745e9a4b202d0995f03aab0b38b217e77cf3f11030b2dad42f10301209fcc217548a4529a151257037117450405b32f2dcc32232d9b7944dac72ae090db254134107c032258167080e555df52dcf39a15c4639ebbf4f3688a391409695f39dda4ceb2141330b771b881fb9fd48d81efd659bbc5bcced5a360083e09e625a6b2bee797e3b867ce21740462782e4482f5dd36e4ebc49f5dafae9374f18f943331d9d8837353771c5a448f8cd85969a1e2021982f2bdfc19fd56c6f49fe4088d49fe57bf8440faa88e83ca41f8db39a1fa267aac69c4e163e3fe2bbc3aaa06852cde374fb9a01134d47203f782b033e1dcd575c06cda55d739b1f5d22038a17a5f00b25e4ad5c0521b2e9eb7f4436cb0c7b441233c69c8e40af3f692e937666b1577d1c3b3dc367c8a694d5ee79d6c04a2b545a909a1c27609d110209d0c27be029cc6e0d0141147339ddeed6579d81c15205cbb88f64e313c03580157a2abe76f64be2af24749c964158f4aa33592b37e7b719b47cccf5f56426775102bd2c8464ebc17871d20c0c7a4a5be68c4b68b116a9f566bb7491d5a4b8783aa66c5ca88b1b4e0865c4de42345a0e08fe62e166863b8caece8575449ee2c5f61e0b98b99b06233762d5cef9b999b322b7f081f6f9670c9ad23b5f6f9143c4d1d9c5c221e7b7abcaaaf2e39d95b117887c85e38982238c57d49f01decaab6659c060a697fbed221d7cc8391444cfda0ed491e5e4cb20beabe7cc3e74fcada5148ed4726157ae41c3fcc6b3d19ff830a6f613e64e6306d8684168994dda1026ebec21122d72e2e7a100d5a16bc75a9ea12afa062f6a5bdf13045235effba5c048cde334d5b15aba0b570060b857e338db8374162eaf55de3cd9693541355a3d2811c09cc2af2c8439754ddb870a6b738c02f1045be89fbc1651b32218485b109919156377f24584025c16b77d81ac2e17a230dff4860bfb962cdfa93528bcd4c38a6a17d2275a1d662d71c3fae4ef1e92f26e2904664fb8c3bfa16c55a30d767150e3c9541893b793aeec379cac1f3da29f90ee548f4a0d6027e98d2ebd102c5e42d0bba1de46c5acfe8397be29f00cc88a85181486074b85813b3776d8a600f5870c5a08b34d36dc159533091097356e4645f43f78691bb8edc8f7823381bea0b3071882c4c84c276c639009cfd3f2a486248e57b2f7596ffb856f2148790a71f1c30aaabc204d1e3b4310f86559d5efd50ac591f388097c1a3a3763032a4404b68c0c7a798e415542cc3012dc70836ed5e0e9be174ddaf2ebed57e108e9cb2adb2bd604899cfbf9172e5353008c47f5a28606e0d7aa1cb87e0b3426d08b7f255e88c6666b324ea7853825b054c9ca3ed7681170a5cf8a76c0ff509efb2283c582fb877fd232cf5ef522cd01ecc9475ea6d853271badc708be7b60aca30886c6a48086f32a24b881153eec6a443b87863ef017614198fb302d816ad5d374fe11dc4b882e95968e58582faf0354f90d9996f0cf52b5cec03a6c8d710b57ed0cbb153fe9b546e74bcb5b3c76049142dd428d44e4db76052d766d18fb8f895795c7a25e5b89de9bea3eb231574bd40ddac22416154d981b856e47760b3e1f0f326f834177deace521ababef6f54320d8fb4bd4099f4248377ba6224d36a93f023defef3373f33322e6af1f79cec0f87fb5cf1340aa2509c719b4a63a85e0b62ae7066f915fc08b049697889e208b28c2df9187d2cdd87c9c1e696ff8d873c0c0e1eed1d2063825c6ee09c9eb09b8316d541e4d55d638f201a55fcab094a1e273914cb6531fcb2546631a977c4c0aebdcf90182667c76b113718a2e2eabd4eea03e01d2398f77ac68d0d3f3e0a55993813d74916e283f58252b09bbe5f10bd0287fba03054228a0013d145d9577f77009f02dec8dd53cbedbb8870af62e52c04aad8ae7c5a30d055e9df31b6930b4949578e209983d67d982126999019e58ddec9507ba567acecfac4ee8672680f6f9522bcd1d443cf80fdff62edddc8b17d32485662534257d6d952268932af29fba7e9bc46a9f4ba3f60434544c06a2d7e04a12b054a04febce8b361a26f02a4ddde7171d86d0b6f0689584834859d18106181e7d65d6d065865bfee6a141319b8a34582a6c7602139bc0103f931de99ae94729b0a23fa7facd0e032033dc6f0d77cb6c70c48946b59f2bd81fbcaab62bc27395c6b7dc9b44e1c652f963eae3b93df412b6d1c2e456fc1cf8f524eb94bdb5c2a3da15d662a90c72c5e4690764a0751a8ee227c849585697ec04dee202537671992af6a8e957e97bfb4d8526e645f5d28b1651e8aead14bede03cd28a6bc86415a4e3959cd2e63b7a73a55fc5026db86b365359a90ce2752781104fee6f29edc40776d7d2a8a414781dc05fde9588b6dd10b34792313e420994474e93ddfce6b46730d98fc6efb9a1a4ab8cd2beebbb7fc9300f722a06bdd2ad65232926acf0b400c7a16a29d0ce193754c57a1432f9b26dd83977d4da598d14fe1fc5813022779fb4461453cbdf1bc643b82d08729c8b01b8197f06e94f9ad9398542a827b4f2ce6d06f505d8911c392c3f79247dd51d750ba6493c75fb6aa9fdcd817cac1ddc75febe6a107475a83356d11c87c2ce94f6542126e3447c57cf70ca6f6b369c18dffc4710054f3aef4c0879214c26326515f061955ea64c9fef7df2dba609c9dd4c4070450c809f371c6540484c38dd0a6401e342e1858abd42b5f63ca228f5fc066137e3b4d914773bcdbac7cebd9bb0815d9e1ddb2d4f576adfda90000222a89c5557df2bbb11119e0de063a5fd6691cad3f062cea55551a80b7b27056f869017fa7b2026ade8fd921e50bbbf8a2d30fd3206deb9d4caf71eaa3cb8643b51133abc16ec4192f40cffe08c3633dc26d01cfb34e2531f470e702451774f60cee78a5b5ae116e30139ff3c3d9cb9a3bed794de78c35ae85515bbb7e6064c4f6d856b35ba186f62d114a83cad903edc3e7767614acce40fc575d8ce9a7e59d35d35215bd056fdeca0294c798a62089f9e90809e87fd938f37bf605722fdb5da754a6f389ec6eb61b32c7a82bac06738abb20828aa06507d44c5498339e82b85f37456629103e43eabc23dd987f0b0c228427b9ac4b73149f12f47b847104cfb93226cf867c6ba008cdcba8548355806c7bbca1c8994ece7f1776be7dcd1857d5feb2f0a89af007d11a90809d2f3e728df0aa4d790122d89dcd4f3422bf302289fa177741d6c36839128112599d25ecbaa9cc592aa939e83d9ac3d137b8125504b769aab272f8c70fa465be5eeccb5f27685eb23ae116cc919311d6869998aacff6cb28a2506d1ad4f4e0b18197608bbc86cde923bef36121d1ee89b98bbeb82ab2a34440036ac888bce404c12c0c66c593e9e651d9df3ffaed571bd1d6a4f8b93f0436b38245dde2d08913dc07359e967087952c2c239d0a05d6181452c30b433a16a8ca71b374d9116f88a3477e40343af58cfbe66268d7f793a8af40124cdcda2a1f55836a6a1977980ff1d526636954421f01cd26aaf1ced42ab958c7aea235c1a68d081d9a94a2979090b2a37038889761b327cefd8c344a4c39f36e0f4f06ee201eca99f4dbbafd5fb7cdc9ae46ca098ae141e419e426f07945e03e3990e61a3c2e4b48f2005738a800ca37ad0068a28391e6061e6ae623f7b8b7685ac422129f9f54294ac36bd3b86d8e3d2a5607767bd954aedd9e19acdd2c25b308d229095e76b4cfea0fed0b202206142356b4588ff5ff5379b98b5f48fd43432794083f262722984809863c805a5a3b0a0b78234b61e5d94db7cce0ac0cf565e0bf847920cdfac04eca20225bb18e1992605c01d90dc19b64ed6a7ec02970fd5381dcf504d368b0e5d6bc8aae2e59be9adae86014fcd770bbf096825e75852c2a82e57f10aa63e55d5b5c6c57d158131488945a63c9b3a924cf642fe6e1b29f7ff54a4028b0aba8184063898fdb452b18c869a4e9fe034a3040541171f2edbe718f12a9ef0b720c913821e4196b9716d722b4ef4791a3f7ac9fd3cc5f25f2d7eac91bec6633a1b75a468148b9e29d1690bcd19f48a16407eceb0d76251c99ce2eaac18de80cc933df52288f03e3222a77e2b1e8de47f9f1969b371ce52dc0efcfad37502364b6242dd96168ad2bf8652d9447baa8569a203cff2c7cfab08910a1f755ef7b25141a256ee8ee6b08269fdf08392d2ed29cc67d783bf2832e1c005452ac8de8c6272947c4692fb4118f547096bc6c50ca0aba56ea38f7efb72bc19a3088f3d9e51e9e131cf32cdbafe59275f724451f33ff65f5ac0f656738bc280cfb3f9ac24d04e5955c607c0060fbb84493938766b8e3afbb5226dac6358c7b560d47e5316591bea1b668701bd8d95d2cde7db69f7dcde99c2ba7f2a61f54052df4d6f4c8e789b5cf569bfc2f7f454f7051bbd2616d4ed2c2aca5f781a4d733e7abd8bae9189f4305e5d82ddd85b24f86419068957630da33dca436c664cc814c70b5318ad7698056a0e19decbf157b934392ebbc1fe0a9790cbaf7d50a5e68d105bf82af14ca16944663dac6a68a0e54a6261ad16a4365d8a84d2048145ac7495365a023588a8f7626f70e2c8995b7cb94610714042708a7d6f06da46636de3a4feb29d0114685219eacf174c54dc36bad75d99486c1edec1a4e6fc64ca98ea0ef187fd2dadcb4d450378f9a1ace265aed295efe1503f44a83d323d3ce177c27f8995545775ebb13ef8f32218c3e67b0f124f83a3d1042741c6ba1451095f5518bfd7de7318714a6a74cc692238a4cbc8d974f8d06ac8cc03a1cd22c141f8780c6354a84f3c042fb9ed96976d2f6492ca41a2d83793327559a5c44a7a765a462e720818a9d0be2def48366b39b5bca5b38aed283df97ad276b78252eb74a0894b8e797251caf8714fbcfedc5062a67afbb63577c2f3e9c333092314faa2523c3ac28a307bff4cd5e41f1523781d7d248e49f0af125a1ae2eb8dcbca4992651ca4253e7957508819bff9f06f73cd92a1f1fd7ef0984877625037e7cbfd4a1bc2f5c12fe171493d50fa191712f9940ae2f7fbb2fc87ca15547a18d602f9a7740a502d160164faa9d0b953e4d6d8da43b556c703139b5d3e09a6b9aade831fb25a96b80fa42a3797503401caa11714d7df6a82ba7ab3713c2a5496a45d9858b32cbaed4ff906ac195a82dedf37f71ea7a2c385606d55a00d3894c801f379b63c0cdfeaaa19d15d42393aa708d11169989113db71734be2890fe76f6443bcbc8d8e83e74161eee6f32e35f6d3e7a290a6a1b01697f3fdf5042fb91db7f0f4d447a8aefa3bf4da5c4c78191a5a829de7500b2450bb2bb438dbfb70b04d4efee5ad625e3eb54cb3e81a25534e424aec20a778cebfc4e7b48672121ab4f07d91367c891b5cebbe8b85f7bca1e4f2ce4991d31a0d22dfe81950221d70ff1756d48cd1b364ccedfb8be290b925297df442bfa15fc1a3c2374fdcaa56e904b1a11d4424a7622f0f5e2dbb958d59ebdb5ee63fa31287332a5ef5f1a8dcc5a654a0a7b2d208e1ad57f8338a9b6a62252fa9adabff59b957ea12cbd9987f1f8de9522a15adc6f62c8367e7e6ede6f3b7b1eb2dbe1cb229bbb24c4c41111985a9cdfb17db68a00927905745f555e94c2d2080bf5b3361c8a1c7da39b13731ee2005b2008d87a816eeb689a22809638ca73d42233c6db9b4e9fca6cca288b403cd6faf2bfd49687d6a666db4cb72fedb14445a6ce3a18c63dd4902376237cb2bf96f6cf4eaf6e15835d7f519d2cd583d6880525225c03e37f02f64356ffa208ae97eb0ae52c9a81126f65e91c9139c77be8c48f61df690429a74530a9a9807e3c17f07d68afc931006aa6313e6f223cf7f227eecaa0f0e4614eea0a7a41b334a918f9370835508a9820c3527063c4fe026b90a6fc0ac52b176c6bb4b224e10d9c099ab2de3dca777cd75f28583ae5e6ae5e4b2be4be5f94a82f853f5957ee2e011a443c4291a467a25e609dfb6d61e4531dabdede9d00b1ebe51458d5ce9ba64557b51e15676bf024d99c7ce6b00eeee7d455c01725545b5d901ebd2b11401643d6124d84af79430c4acde6b714a459eb11464ae7bcfb74aa7f137052191b2ba106ee67e324961f5f52936646090748a7d914eb2749816833764fe8445e195f72fea591642bb1dd9639cee29def56025590b942e68c1d497a67f9ffdf314b306562aecbd274d48718016260862ee531a1b15ea6ed4d2585cebc835adb177ed313609fbd6b256219f70d4fdeaca6f5e96a64a0f163ed8f4f97dcc10ebc938f1d1e079e698e55e45d1ff98c096132557287b5a1c594c0692f8ba55e7e47ffb018335542ba87e3be795db74912bc0ea482489be08b1a83b9dc9b445779f3f66fc3e4159b5be34a714f91043c5e9c4ab73c31585c6755f7f9124fbfe9e2ea401c1bf1321243f7efdaaa7166919b19661a2663fae7a3ba5f5f9fee854271485b2adc81c21c22059132d9776fb180b04b40cb4728590f7b8e4eae3de83648952db712bd48ead2573a239021102b3e4cf6ba0f2dca171b35f517c3150d99b449945d9e003f2bc7b0ba543092f67cc37ee2de0545e80322cf9b238920b0462cacbc7a68a0d24c037eb2eb62f269a2089948b0a99c64096f3b0b8679e12174bf30a7b7a8f7b38f2a16f281970571e9fbfe131441ecb054cbe19a0220294f2a1863ea004e3fd110947d9d959ad104055fc60936cf75f5033f01c29aca9bbd84fe0941083c0626b9ee349bc8fc767c8bff9061b570d91525ebc1c8643261e45c9dbf41ecea16bd62733b3d17f7f4d73ae7ec4ffe31468be4df96750111d26eea6439745c08955c9da97ec3075f22a1eb9eb4a5e6d24fadb4c4c6e52dea3299b22a0a64dd8a09853e94027c3e8d7c8c9659b70aa2f8ba3a17ee614fbcb9b337815d7ffa8289082d0e139c94a4734f682f0dfca276f4669c6791afaef750044402cfc16e01cdb22e6a8680d707b52f46cffaf6dfcfd3bf0665decffe31c861b8afed963fd8c7451a347807157d367717dec33eeee9c7205fbd960ac4d0213098023d6f3c017dd2f99790059a3d42e3b0c3fece9c35c70d288f251f26f764515a9a3b7144ea90370c19bf1d95e87f901504806f11cffff1fb794fe11b9267428c274f24db5b33e9db59eafbbc3c99099ebafb7e5fb27c28221f6ab6ef6612d17e8f9e8c6b55f430a6d1d57f1d86af549d02d8f3d8ce37e69c9828ac821d80c52d50fbeba2eb58cb124dd57be7d9fce1aea28d48746e935c6e13ab941b1cd0e1a6d4fc21f6fb484bf7e92b2e11dc282ef20ec025c36c2099fdf7003dd1ed4acf601f57822aaffc36b609a120be71da2cbbacda25c23f5c8e3f46b3fae88bc7f6f0e9d6cab7c40ab989078fed53db51346c8da571bd38edfaf0ae09d0989c84754a91b2d6fd09ebe475f9b110f03b9f43ea9e4d8c456104c45190d0ccb417710854e826988cc327e8798cf91bd45a2297222e3a505be75aafc35f38c30185289583626cb26e03d7363b7b77eeb84ce03afd6c96d3ec74f0fd8a2591961335da61367cf9620e732c31aa1fd3e5537d6be47a0988d76110477c7765067e34dcce7177e2b605af1d4435a8f93c9ef76e638bb6d5d0c541d53b4c55d716777108c9a90e2363fac80111b8bbe4721214dd339b46d1a1876e5caaf8e4d41394bd9c19a910c7428775e313da7c4fc20265550a89ba4a17f3fbd51d6e4389ad9f2bfc7bc918f894510ce15608f1c689319ec2ad5c3cabd186a382ef213e3a86f9aaa1e9ee37f52e187f841fe23a08d8d5a540ad4500ab43bd0b98a6a8a60bd9cb5dcd7c2b8d3325ee4024808de9d2e558565b5c754bb2c0aae0393e857b9169ee7bf5616325b1eb5eefbb174d0913071d240f25bcb42e4fe43c3478ffb41982738a48854d4860a2f5d7551402139181fcaf57d80e2c8060e8eeea48045bc88e63beb15150a927a57b9729aab1dddbb785ee458b54aa5d09f065cee35716bacb483b248fc90d7fbd749f768239b68eeea5b15ef1612924ad34791405b762d83baa04ce783dc8fcfda8c755ea2efa7216a329aad514bd03dd0471ab1f3bc84f929705a1acd101dca37306a413ac8e4b3d0e869f93c303b6ed36494935d07ebfdb87c3feb1d25ce4fb2c962dabf679538cdb4b9c78f54e48bc93f988b30f1c8568bafda6ea2454446b19fa599cf65152f28626adab5ddc9ae47e62c56df2618b96db9473822d437204906f210209600a492e7803363fc483d4936222fac8c0ab3439ee9be53b4d8814033395439a6cb9c93b9a8ed4977e1b4618fd53d9cbbc73ec13e2f5561f7990ef63add918f4bc8aa3170aa80c09a8d5bff96f40aaed323841a7a16d0a30ff9adb62bdaa4da88161823bc02deb63537eca109e7b265d71fc3c11b33b06125f70c0680e0fe974987cb1048ffd405e92f16ead941f4d41f457261931363f801dfd0d54864609bab19510d0741ab8e0b2f1307468110bb6172d068f5adff0ac5b775dc9aa9e436b7f24f8b19196c0e3fa7ef0dc683ab4a4566f68f0211955d333e96d147694be384eb63c4ad9c717a6c9112c5190b5367382198539e8c811044b5df00dabd8562f056b677510159a7a3bed5da2e468110a9de4981004cf848097238441ab95df2dc541c6966e9fa9dba1a05ac6fd04ebabb7ca6cd17d9111577fbda68812da8e635caa414e983b102df97863910e1f6ad7c746dcb9516dc6e3b73cb56ae30d1ba3385981d6b03ecb1fb242c56e9abd7b786aaba8ada05c519c221e8487efa1c97af98ba7c6001bcd5ae7d0041984080bf0f81382728cef8dd9edaadbf3f0207e14090aca8d4aca80c7b3e19c1e6149b31c6c41d3dfe7fcf655684cad74438363c60c328da71d23910655953321c63985735acbb0efd579c2176f5038a53da31bc1f2465e8a187ccd7d30c9a9454cd42d211d896424b77d2a334df43a66adecba421e7c7ef8a1ae86c0e3299295e4cc0287d1aa1a73dc883b748287433fc06a591ca47a5394a2fea414c4a977d035dfedc01910a24bca2ddd16b630a0517b29a185e0b153313963ef89185e5425c1eedaf0c948c46e259b822818dccb8fa643c42ff9486e4e4fb5d119e6d27d56abaca181129c51df4e693168f4cbdcfad722aa3b4e9d1ccf6ed8649799d11cf5a76e4bddfb078bbb9bca9cb174abfd1c9980b6bbc33f76819203e4429d2edb0c3fd4bb01f26f642681b734a84d1ec43cc91247503dc0b5cf09f4f0a931846d6dee873ddea950f7423a3d61a26468403b38d5e2316c26184c842afd6c9463d9f0202cde21a19ad4c7fc0cdb8b446eb9f97c5cf0e47342c178667de95fb6f1efa8477ebfb239ed74d0c34dee1940ff96ed172ff027e41755912ced7aaf47f8b0adf76ad401937dc2fd600fef140a47ca8eb18a90ddbc55d51307d015050a4705668aad66f0d2d420c2ed695aba786d6a1344f5d0eeebce30e832c69e73ab5619777198bfb3c545901ba31b37c4eee3dd1cf26feb355d845e8c7d187acfc8cdd9c09d634cfc755d86b58767de0acd92edabb9ae8680569ff04360dd26e03a5bdcf44de3b25f7df8d3f3745e627dc58c5791426ed50fceea2ab69dbacec2a40331d9d5b4cba374b8404ce66e603d74c5185dbd2ece18586dc3283d0ae2a67aeaf918f9ad229c65db8301b25570e33273ee108ed28227e3ecb8588ea86ce04541d5eaa6781abaa20ce6c7c822440418bd70b8aaa10cafb39a3b38bc3df62abf4741c12ba3490276e93e1669d29bbfc9f23de7b2a80995fc119816e55a5baac09d03d4f8dc32249942c5591ce42056eefa130ee7332ee1f0ad685b669fcfb626b6927647e697ec63d3cb141f87713c73b8c5ada4d419493587843a3773ac3d14fee7abfdacb5fdb0c86947f1678f2be30b3a124e484f70f6b50b5e85f9147cda2732b918edc96a512c21192170c1f14492c2ade3e6d87648ba0e8347bdd5a0d996908291489611eb85b57fbf86e351e873b4ea9cd1d6c06aa7b361165b499af5a27d4e1be2ef4195cbf46e7de87cd83029fadf5aed2701d51fd0fd80492b1a0c9e173abd238eadcd79254eadb49c58f69913cb436b75966e9c5f8c1adadc70389a0fe4f78e2a09bfc1c510297ba5c2933deda0b3b447a86a709961c654669a0a6ca8cf5d7b69d70ea06149734232725bc9845fb482969c51eca24c722398e80e25085ab26e1a001d7a09c08c2ee18f8fea24d19245e6c3078eefae67091213322bb276305d4aea32c1cd703cba4a90660864928c46332598415f0f4d4ff9a0503a6d501d7f1685b404991f726b82d98856ad07fec7feb55691ea4e7a631536eb70b6c7edbd71ac5de3f1465f484d0ac0559697dc1caab8b0d391984de6344a4ef2dd95e9c96609fa58bdeb8b8e8f761bd1da31a03e73c7509ab6b476dc9b7e2a55afe727e6f23d65c3162591fe7802ab0c7007102ef4c8b63f324833804ba0a24c447ae8987a930027f340055c62db134e0c55d16f26033e0014e3d376ec980fd195da08c3f73f8d4fee50d30f0a3122fbb4603639db4f5b2d3c1d3b0daa711a732ca5b287597b7ae44911a9689584ec0ddac37800709807a29f1a2112521d7c95d41268014cda26c482d6d6e3046ec8a224b6955303f396a8ff09c9c18beefd4c1e3abfbd150f4f910a156121b7d34760d602c38c9034a790825f76fe92957a9a8100303387e028cbab1dfb45860f35406c0f55548c936666f017c85c14b2fc9c41074caeca997e2ccadf0673dc4299edcfbb75873084e029dfa9b7401a168eb8e876535349749b753a704f25ee25b905d3ad13d51a89c1aea335fe0032b4301dcef53b641502ad88ed1d2bc862c463b6049bee638584a8f362bb8c0bababa0e5079b31721155ff9780be8e141cfd22ff28743a07be8447dab0ca2e1ab253efd95c8f18c7ce20f77be278b076bbb35522557d1cb797ed3ca26abbbd8e797173efa0ad633ad2d34b364e6c1cc97a9195871b8db97cc5914b97cfcada3d01fb579dd92c0f227dc67308d0346ef66308a67f549706c20ae78ca165cd37659b9f008d666dbe32385b2c0ce5b7bdd8a7d07db4c6e4487da88dd51b406adaa9973512cf5a73ea2f497822f4ce1d37c54a07de8c27c214e87128f12e5d1da2f41066d9b345a030bb448fc216b4fb08328de427f8042c84663a0209a000a847d534c615214492bf06c771e9914f3412c2925b06a84f1e5f542b8a87519e5bd86059c67e13ac48d1412b2e6ff6065cd8fa74fa35b709304ec479a46d928e0d5c605219cdb55fd0a49026ffddcbdbf3c4f22a15b99e89a38bfaff6f1f1ed1d105cd3069243aec50c2c6c0c44f94ec948ed7f890d01b72fce7194ee1fc049bcb8af4d99e7a58b62c566d67950a4411eb28cef7af760081f5b7d3acabec1e1aefe51e98a9306db32b32a8bc96a5e5eac22724752cf56328c6cb44a263435cf600dc3676f0be3cad316fb9c5aba5322bf58461bfbe2d6f803a0eb2f44e7c74e8eb97e5e4073dd892947e99bb52f44ba31d97f02a7eb395ca2b3d0cf482545475b4ddadb4cfe55602e5b1765ded8b4ba0e3254021d77ffd02ae9e667b971e54ca6438194504f8b6b1c7cc35927abcad25a5d3fd7859afa4a67ae3841c78be5a8af464990f64aa1ea449a7d18b1ac7a25013a80117e5e6a1c83d53bad607dc211fadabfa23fcf6cf429a867ddd904dd0d2fccd5012cdf809509b1a7b02fc584fe303a36cc7075a6ab03dec671d6c5a7635007752e517bb2c6f8f293bf2d22cbf3f7f57c38b3edbf767bff86072139d6f8e225a21a46316602de1208e6f219f011d490f8f2d1be36490f7f2d8e9df105d000d44b57dc71f55eb342d21c880d41481671d3b420d7cc96eb879356839e0eea8c83ca43407f76e849b39403bcfc80349b8e48b499775a362da72d91104c48c022da425fa23e7cebc39c3ef117eb976c5e4ba6ae20d34834fdb1f1ae327a1702f42b78ee9509557fc03ce40a8c2a5316979d89c02944dbcdf40800f6a8a3688a62ceaf512ce4c90e04b08835b75275d93ee5bea22ea48a64a60fe6ff5f72f95f6a3ec99ff1e80eead731102b09d42b9d21b27ba78e8528bdac1d3ebfb71b750aa19184048ab09be23e0c3464fc1b9e5a874294476a2f058f52b1d401891bf410cb115a044d9f6c8797d549dea2af53583156c60e380c5bf950f41712283c2d0add7ded2673170adbbb36c19ecf942b67897b322595745ffc754793d4e0b5174567fd02ba736f8646679a2ad0e8bd3a3aef4b7b88cbdd8a275252e772c6ffcbe146bd8731323695b2c1fdf33ab8334b60b97ebde91bfe9aeedebff2f9ffb801cc60900fbfefff6e6f176d0833d3062041fb67dff1089a335d62068b95f129553d032115eb55fda40467b6a676433de4692178f88e4110064d00d58031babe081b96fe95ab56e661513a4e912406567a6db90044dd28b55329b7f29ec8a218c6e17d08627b16cef0c8b41c866e51cc4d2045f10042b109ae5061d8cc21b308bd1937565ab4ad8f99bee863cfd5c722aefc283bb6a666e56f2b5fb738ba4c4209c7b362bce3b7a1a6a20e11c3bc7a16dafef12b0abdf929277f5b88f57a15e8a91690df9a1c991e54d436a7830aecda8d9507707503eaf81280118978df8dc17e829868d4403ab69da509eed00fb21520115924e2286a8ca84328f1d1a16d3cab8c77aa23942bd4d6fa8f2df462f5832f4fce8c7dc141bbb227bf66a4a8df8413f48d610b2a4c19f463e29b4f26d1403aac5e889d947af7671c12447236fb7ce033c1598cfbb9f44d081b1e34b17b3cf0805130af2e8a3478cd0cf10057645ea3d7d9c8ad63ca54f54251b320014a96c6df42708ad1efde0a53e9adbf3acfc630992382e5a3e56fb818b860b8f9661465f721d243f55f3c0b4a65748564d44e3db2200c85ad1b9fa98ce2329db45dce58a77273e68447726364204cac8d7a9dccab4cb0c33f7a6f48681eba8b5a1f698a722301378bcb32b9aed8a8a00134462e382038a082f69c4c8ab43ee7462b1212a11cd19ddeca3e3ac512cb4dcaebdef141a73b2649c58020401495892a9f3686049ee8c9dbe1b45768e9cf0ec3c945d7afcf9824a0652c4e8e9585fcf5d228146ea52db99d0e700a3c2961f59528020df13b6ffb4a47e3cb85be418aab4e4beec48b92d1a7a2e89dc889fb27ecc51dbbe67922d50970bacc80cad46402409ac9ae72927d0e7aa4d1686c31a6bad44e3987f26d57607c827bfdfe23320964395d2163cc1c7d210308819f04141ae19b7e58fb0196a95f3e85759285e8ab4cb890832398efd7a210e318fd0fd2d22f2daee082205183aca5d5f3519572eb9d1e9c52af1ee513cf5da315c0725f979fb9d802052bb60587bde14fbb0a0135d69ce2e6286aad99c8069f7d4984bbebb8e0701fd24971b978a1b27caa0889fc27c79af5d593841244ba4c91610ccb7a5ec63d60f505f6e62bf14d0da6917dba3336725c63e033f065e5f3d6497ce2df848564e93881ae8d04f10f3c9df739fe15e5aad625554f4d8df28794bc09e858a29986855354c3ecc6eddc76b41bb299fcdbab69d64d420a5afac01d237efe2e48b1590446e4db8d7a587f5f7d917166e3ebe3014fcb33dcc46d626f38c3bb63bb2cc20a30bf64242f95f05c94417fe740191a58dfe06ebebfba51231553104e6026d500c707bcdb882812846aee83209ee88fc8b7b37a5129b93621987cd77145831b28c2715ae49c3b7fe09f88b09f897b18b83dc0a1022669a9989ccd125b3d912b7ca9d34d26562c84290c8331aa7a87f1f957c3c7eddd1906e7270386edb6773b284268a03b44e4f9fb192a65868a84985fe26358b203d4ac6f8ffeacb4c8f78fd939d384fd6d2adaf522f50aa22a90c195b0133871cb4e662a9324f748cc4ae2ceedae46e90c5ee77e9aea2d480b18d9a840fca567ccca8945ba5ccc2c136cfe278b33728be36db1f9de6200298f1cd75c8b5a80ed3d8c04801191e8aa250468a61fe0ac7bc3cad2b2db788733c167865d730e290506cac71d988e913669ad33c26e349a4822afc38b21f7fe08000bfd63c7d209617b05658278cb220b38ad2528dbe8dd681aaab85ea806285cde04e3433392ed5d7ac27c0a08c7a5ec9f748b45c3a94593556258f0a2f9f1e45b9824ca7f683fd1864ca187d2ac6c145986c2755cbae4d441aea9706ba451f5c506546fde65f6e263b996d6ab133514a27519b3786d135ad5b1eaa26ef4a7c2c82857f4afc3219e446a6b72efa89768286e119b61e035a0aa7d9b68a33eab4be704a2f1d553bba18d8e2a8c84da78b84c449dc77f7c4382c17aad3d8af1c2c6f532fc68c42dd54c62c65a3dc08ca84f1939042799d89f2a2dfbc59d7c9d8bbc2ff9d6c51e0cf7a3eb1af56364cf53a3ba079fa5af81817a9128db3ef66ad9e58b6001218519acfeccbbdd20ca1bc19fc7d26698123c71f6a15590b3d52fb73d518e5254626565c82fd18d55ebc63a90da746aae2b3eb0a7e86f72f2232d9d6b63ac29fd3317e7989da79f5187d8d5bd2901836716b205dced5eda5f00ae91daa8f8be8241ec82182e1c5774157fc437829faf3144828bee91602ed076f0f19139b0aa572817d7a2117b46cf2d1cb06ee6b00825b3fa18751b5a68418831f1391aed8dfbe5bdc38468193b95eed99dbb1ea3fdb77586edc5f2b75446ecd423ade60b57f3c4baf91ec2c17a9f004db6d7145a0d20ad060f1d4bd4effe053b5735bc719c41b4b4762d1fdb97a9233ece6f420348aaab748668326c95e97e3ed96235371c4a65ff9d56873cefe3c2370c7e8c4be8b0f66b6eb20c0e97aa01f38474c7dcdc4f47a706069444dd221e350a28eac3da4d91904257441fb30a683cd6815ea12834ad4fdc1d238fede20cb618ba94021616f7db99c731df7ffb54e7a7992a9cbecfeccd3dd07f665ddc3e1f0b18ac032abc9f1e197ae99876fa4092a3b28dfb1e0ef4e8983aa8ff9440909b21e718802484f49e39c7bd3f440a11a8586a5858c9e5b7b5d8d6ad677a23a6581d59132333505d7be786e354279bb4070f58bb29ae506a3bbe5e7d1bbc702a54fe8b48ca0f93f5f19516362aa3841909083a696be3a3f9eb72464566b9bc91b575ba74f33778af44ef90d0b4078c9ac8379265f014fa45eabb308dc10a08ad1e76319162d2d5ea6b2440dd91d2727f8fc7b102560de011cd65882560b5474c18fd0eac3e07567673c27ec3b73bfc453a7a44f6bff3dc283edd41e158edc923e55cb863d106251077daafdfa7036dd4cd4cfa0d74754c8c89a2099aaa706e3c9e49c861b1bf61a385dfb852a51e6eb091d82445ccbf6df587f1ebe933c28bacfc107019435061186dbb20f97c8b93c6c0a02fe69fab8fa6f0da47b06a0c75da718d6675372693ca16df70ac69f42a181cd61543e9c33d7bb124aab180537f02368a3db64453de923ed9baf4ec89fbcb1e31bef2bf56390faadc4f4a106e5bba3bdccc17c0b7128284e5a09862a98be956bbe568be02742025e7be9e2cff67fb5c28fac2e3fe1ebb11ca4852e2e84d2800bdd4fc5a259c6526fcf0c83a9a3054752224318e8c7a16c4f2968187e61974dd39c91963130085bcb8cda9223048cf60474c64bb6d6272f2ecc0a55d90ea1a1dc7269211a125d7c7edf4d3f836a0ce3203f9d2804de016f2d75310a521cf34c3d180713f799b0b43727a3bb2160f2013eb3d7168e83f2e0d41f886d2cb20fd0f69be80f1cd5ec7bb2b11a407fe215f2f19e75664aaac2424f9429b36ef02a8d77a000ba81df641554ad5d11b6916de83f6bef568e80282b2573c95b028a28b0ab2fc3700a08d5968fe55effd88c3f80493fc5f2b550977bb21d15bd72a70d422d</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Password is required.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
            <tag> private </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022年10月追番锐评·兼年度动画排名</title>
      <link href="/2023/1/72c99cd69d60/"/>
      <url>/2023/1/72c99cd69d60/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>懒得写但又总是想写，<del>于是便随便水水罢</del></p><p>本来还打算单独以一篇「看动画破放了怎么办·尬黑·孤独摇滚」来作为评价的，但是懒，以及感觉怎么写也无法准确表达自己的想法，<del>于是也随便水水罢</del></p><h2 id="2022年10月"><a href="#2022年10月" class="headerlink" title="2022年10月"></a>2022年10月</h2><h3 id="电锯人"><a href="#电锯人" class="headerlink" title="电锯人"></a>电锯人</h3><p><img src="https://lain.bgm.tv/pic/cover/c/26/b4/321885_92uzU.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/26/b4/321885_92uzU.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：7</p><p>中山龙拿着电锯人ip的红利追求所谓的“电影感”，最后做出来的东西实在不太符合期望。</p><p>可笑的是吹的几话都不是龙哥监督的。</p><p>作画水准实在不敢恭维，一堆异样的走路摆动幅度，极其粗糙的长镜头运镜，是否搞错了真实系作画是个啥？更不用提各种谜之演出，战斗节奏说停就停，还有一段意义不明却占了几分钟的清晨生活特写。</p><p>期待龙哥的后续发挥，但他实在不适合来做电锯人。</p><h3 id="秋叶原冥途战争"><a href="#秋叶原冥途战争" class="headerlink" title="秋叶原冥途战争"></a>秋叶原冥途战争</h3><p><img src="https://lain.bgm.tv/pic/cover/c/da/3d/389450_BbZ4n.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/da/3d/389450_BbZ4n.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：6.5</p><p>PA原创动画</p><p>套着女仆皮的日本黑帮故事，全篇充斥昭和味。</p><p>在看完前几集后，黑道女仆的噱头意味已经淡去后，本番本质上是对黑道元素的利用，用极其荒诞的展开以及一堆女仆元素来展现黑道题材中的对于无意义无结果的认真与坚持。在荒诞背后透露出悲剧，而只要将这层荒诞稍微减弱，悲剧色彩就被无限的放大。</p><p>本番剧情的展开十分严谨和自洽，在每个荒诞和反常识的展开背后，都有前文的伏笔作为呼应。</p><p>动画逻辑的核心是对「女仆」职业所抱有的“认真”和“大义”，这种坚持与大幅度流血与牺牲形成极大反差，体现出「无意义」，全篇都在以一种荒诞的形式来讲述背后的严肃内涵。</p><p>但要说内涵，实际上除了从9&#x2F;10话开始的正剧，到最后岚子被杀，我只能认为这是一个“形式”大于“内容”的作品，就和上季度的孔明一样。</p><p>不过就总体而言，这个原创还是给了我不少乐子和惊喜，极力夸张的演出风格与其背后的荒诞为作品增色不少。</p><p>我极力反对那些在看完噱头图一乐后就抛下一个“逆天”，而在热情退却后写下一句”无聊“作为口水话来评价这个番，它其实是制作组的一次用心的，充满诚意的「单推」</p><h3 id="机动战士高达-水星的魔女"><a href="#机动战士高达-水星的魔女" class="headerlink" title="机动战士高达 水星的魔女"></a>机动战士高达 水星的魔女</h3><p><img src="https://lain.bgm.tv/pic/cover/c/f1/fd/349441_uND33.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/f1/fd/349441_uND33.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：7</p><p><del>大河内将重新定义高达！</del></p><p>大河内携手高达ip，将其打造为现代的，符合当下主流审美的高达味。本作抛弃了高达一贯坚持的宏大叙事，从校园、百合双女主以及融入其中的各种要素来讲「后退只能选择其一，前进兼得两者」的主题（当然，虽然还有一半没出，但是专业的动漫高手是不对其抱有乐观预期的）</p><p>值得一提的是ep11长达4分钟的调情演出真的太精彩了</p><p>总之还行（至少我认为整体比电锯人好看）</p><h3 id="恋爱FLOPS"><a href="#恋爱FLOPS" class="headerlink" title="恋爱FLOPS"></a>恋爱FLOPS</h3><p><img src="https://lain.bgm.tv/pic/cover/c/ac/ba/375735_AR8Al.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/ac/ba/375735_AR8Al.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：6</p><p>以故意典为卖点来消解因为典带来的烂俗感觉，脚本安本享，著有石头门混沌子等作，是5pb、mages的脚本家。</p><p>由于脚本我可熟了，后面开始“神展开”的时候也没抱有太大期待，从前面的水准就能看出不太能期待，以及对5pb等作一贯神展开背后没什么严谨逻辑支撑的了解，最后失去了典要素为卖点后，本作也就没什么意思了。</p><p>附科学妄想经典番茄酱：</p><img src="https://s2.loli.net/2022/11/24/JqvRzINy2fSjFCA.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/11/24/JqvRzINy2fSjFCA.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 33%;" /><h3 id="孤独摇滚！"><a href="#孤独摇滚！" class="headerlink" title="孤独摇滚！"></a>孤独摇滚！</h3><p><img src="https://lain.bgm.tv/pic/cover/c/e2/e7/328609_2EHLJ.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/e2/e7/328609_2EHLJ.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：8</p><p>值得逐帧去看的萌豚动画，制作水平太高了，动作细节设计的太好，改编的部分也精致有创意。</p><p>太厉害以至于我唯一能想到的尬黑只能是原作自身水平，我将化身成为cloverworks厨，这是今年给我最大惊喜的动画，它甚至只是芳文社漫改。</p><p>演出形式又新又整活，以至于你能很容易的制造各种题材的二创。</p><p>制作团队厨力拉满，以至于作画演出水准足以让平凡内容焕发新生，喜多厨头子けろりら天天在twitter高强度摸喜多。</p><p>这样的高质量制作暴打10月顶级ip电锯人，本来7月pv出来后，我只是因为有长谷川育美<del>（明羽杏子）</del>才去关注的。</p><p>那么介于我对这样一个动画的喜爱，在看完第12话后我不得不去关注它的缺陷，这也是为什么要「看动画破放了怎么办·尬黑·孤独摇滚」</p><p>我对结尾充满了失望，它不具有任何冲击性，我所设想的有那么多人的帮助，并不是说要改变社恐，而是至少可以去展现波奇的心境转变，而不是依旧因为简单的理由（譬如最直接的我喜欢音乐）去对待摇滚，这不是君に朝が降る。在bocchi the rock优秀的背后，不可否认它对于主角的形象转变的刻画是非常乏力的，不可否认的是不管怎么解读，这一整季的成长性是欠缺的。作为一个动画刹帝利，在我的观点里，波奇的所谓「社恐」不过是一种标签化的展示，一种夸张的舞台表演，一种将笑点合理化的说辞而已。因此在最后我将尬黑为：「毫无深刻主题可言」「对社恐与他人的相处方式表现失真（对平民与上层阶级关系表现失真）」「缺乏主线连贯性」，这一点更适用与另一个评分高得离谱的动画「辉夜第三季」，只不过在那里更看不到什么批评之声。</p><h3 id="契约之吻"><a href="#契约之吻" class="headerlink" title="契约之吻"></a>契约之吻</h3><p><img src="https://lain.bgm.tv/pic/cover/c/25/cd/375817_O7LGk.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/25/cd/375817_O7LGk.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：7.5</p><p>A1的7月原创，本来是准备专门出一篇来谈谈丸户史明的风格以及其脚本设计的高明，但是感觉能力不足以写的专业全面点，于是作罢。</p><p>典型输出角色类型的番，实际上剧情不行，但我太爱了，star+1。</p><p>追番体验远大于补番体验的动画，每一集都有新乐子，要去深究，剧情其实漏洞百出，各种作画和演出问题也可以单独切出来批斗批斗，为什么有这种好的观感，得益于前几话的提纯，以及丸户脚本抓住人心的水平。</p><p>cv会泽纱弥的声音可太好听了，表现力拉满的同时还带有涩气，1月的生而为狗的表现也很好，这种cv可以期待一手同人音声以及套马甲进军里界（简直是至福）</p><h2 id="年度动画top"><a href="#年度动画top" class="headerlink" title="年度动画top"></a>年度动画top</h2><p>仅评价8分以上作品。</p><h3 id="1-Cyberpunk-Edgerunners"><a href="#1-Cyberpunk-Edgerunners" class="headerlink" title="1. Cyberpunk: Edgerunners"></a>1. Cyberpunk: Edgerunners</h3><p>极高的水准，trigger拉来众元老，用行动告诉了业界依旧可以有着20年前的高水平。</p><p>啥时候养老院khara也来一个原创（</p><h3 id="2-メイドインアビス-烈日の黄金郷"><a href="#2-メイドインアビス-烈日の黄金郷" class="headerlink" title="2. メイドインアビス 烈日の黄金郷"></a>2. メイドインアビス 烈日の黄金郷</h3><p>双线叙事编排精巧，跨越时代的冒险被深渊的罗盘所联系。</p><p>深渊是工具，将一切现代价值解构，将人从「有机」转为「无机」，“天地不仁，以万物为刍狗”，在深渊中，人变为了最原始的生命形态，在此，「一切垃圾都能变成黄金」。</p><p>通俗意义上的生命不具有「价值」，愿望获得形体，意志化为肉身。</p><blockquote><p>痛みと痛み取り替えよう<br>糧にするんだ　落花のかけら<br>すべて傷ついて僕は象ってく　形になる<br>目覚めの先で<br>行こう　ずっと　響かせよう</p></blockquote><h3 id="3-ぼっち・ざ・ろっく！"><a href="#3-ぼっち・ざ・ろっく！" class="headerlink" title="3. ぼっち・ざ・ろっく！"></a>3. ぼっち・ざ・ろっく！</h3><p>在进击的巨人与孤独摇滚中纠结，由于在写这个的时候笔者已经玩过muv-luv了，对巨人剧本有着相当量的不满。以及笔者向来对厨力和用心有着情感倾向，于是决定还是给孤独摇滚吧。</p><h3 id="4-進撃の巨人-The-Final-Season-Part-2"><a href="#4-進撃の巨人-The-Final-Season-Part-2" class="headerlink" title="4. 進撃の巨人 The Final Season Part.2"></a>4. 進撃の巨人 The Final Season Part.2</h3><p>mappa尽力了，而wit还在用古桥一浩x间谍过家家这种答辩摆烂</p><h3 id="5-かぐや様は告らせたい-ウルトラロマンティック"><a href="#5-かぐや様は告らせたい-ウルトラロマンティック" class="headerlink" title="5. かぐや様は告らせたい-ウルトラロマンティック-"></a>5. かぐや様は告らせたい-ウルトラロマンティック-</h3><p>演出大好，4月最佳</p><h3 id="6-からかい上手の高木さん③"><a href="#6-からかい上手の高木さん③" class="headerlink" title="6. からかい上手の高木さん③"></a>6. からかい上手の高木さん③</h3><p>只要细节和铺垫做到位了，即使是普普通通的展开也完全可以在制作工业化的时代做到乱杀，单集亮眼</p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过手机USB或者蓝牙共享网络</title>
      <link href="/2022/10/ac2b91736516/"/>
      <url>/2022/10/ac2b91736516/</url>
      
        <content type="html"><![CDATA[<p>才知道能这样。。。简单记录</p><h2 id="USB"><a href="#USB" class="headerlink" title="USB"></a>USB</h2><ul><li><p>手机打开“USB共享网络”</p></li><li><p>连接数据线</p></li><li><p><code>ip addr</code> 或者 <code>ifconfig</code> 查看是否有新增网络接口，如 <code>usb0</code>，<code>dhclient usb0</code> 分配IP地址即可。</p></li></ul><p>不出意外会在有线网络处连接上手机网络</p><h2 id="蓝牙"><a href="#蓝牙" class="headerlink" title="蓝牙"></a>蓝牙</h2><ul><li>手机配对系统蓝牙</li><li>手机打开“蓝牙共享网络”</li><li>在网络处连接即可</li></ul><p>成功时网络配置里长这样：</p><p><img src="https://s2.loli.net/2022/10/05/3ZSRhWsUozHNlTk.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/05/3ZSRhWsUozHNlTk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221005223718112"></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>葉・锐评莉可丽丝！</title>
      <link href="/2022/10/6a26be0842f4/"/>
      <url>/2022/10/6a26be0842f4/</url>
      
        <content type="html"><![CDATA[<h3 id="莉可丽丝"><a href="#莉可丽丝" class="headerlink" title="莉可丽丝"></a>莉可丽丝</h3><p><img src="https://lain.bgm.tv/pic/cover/c/65/19/364450_xx2zx.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/65/19/364450_xx2zx.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：6.5</p><p>开播前以及开播中都期待值拉满的原创动画。</p><p>在看到pv，以及看到第一集后，对画面质量的优秀、主角动作的精细程度感到十分惊喜。泷奈的cv若山诗音是老熟人了，新届热门cv，事务所也在强推，倒也没太喜欢，但是千束的cv安济知佳发挥非常出色，完美表现了千束的活力和元气。本身我对具有百合气息的番表示极度欢迎（谁不喜欢看美少女贴贴呢），于是它成为了我周六更新第一时间就会去看的番。</p><p>后续剧情槽点很多，不过制作组重心依旧不在挖掘剧情设定，倒是关注于女主角的神态和动作细节上，每一集都会出现的清新日常画面也让这番大火，切片都能上抖音爆款。当然，这挺好的。至少，前大半部分精细的神态动作，以及足立监督设计的场景让整个番的贴贴场景充满“日常感”，值得一提的是，bgm和ed的插入也非常精准。</p><p>制作组专注于“日常”的部分，而有意淡化lycoris背景设定下的黑暗一面，其实设定部分要展开黑暗面、挖掘深刻内涵，可以写的东西是很多的，比如lycoris的诞生，DA组织的实际背景，旧电波塔时期的事件等等。淡化这些以后观感是很好的（至少对于我来说，我是吃这一套的）</p><p>而在第7、8集开始，从千束心脏的设定开始，莉可丽丝转向了更深刻的故事内核（虽然它烂了，但不可否认的是，它确实有去尝试表达这些）：</p><p>DA机关培养着社会工具人lycoris，泷奈也是其中一员，他们从诞生之时就被社会赋予了社会义务。</p><p>lycoreco咖啡作为一个日常的场所，而亚兰机关和DA组织作为黑暗面的部分，二者形成对立冲突。他们各自代表一种态度：前者作为一个日常的、有生活感的温馨场所，而后者追求将每个人的天赋进行开发，让他们都去执行自己的「天职」，即使人们不再信仰上帝，但是依旧为了为了这种「天职」而追求，以此来感受到自己的「人生价值」。千束作为一个亚兰机关的孩子，而在lycoreco咖啡中生活的她并不愿意去履行这种所谓的被赋予的社会义务，而是只想做自己想做的，守护自己想守护的。泷奈在前期也对自己在DA的生活方式有着强烈的执着，觉得自己一定要以执行「天职」的方式才能感受到人生的价值。直到她遇到了千束，逐渐被千束<del>贴贴</del>影响，这种观念才有所改变（从这方面看，莉可丽丝其实也算是一个很不政治正确的番，很明显它是对选择在lycoreco咖啡生活的千束表示肯定的，同时对DA也有明显的讽刺）。</p><p>莉可丽丝所想要表达的，<strong>正是对放过「天职」，放下固化的执念，好好追求自己的幸福的生活态度的肯定</strong>。</p><p>题外话：所以说现代社会对人「天职」的要求也逐渐成为了人自己对自己「天职」永无止尽的要求，有时候部分人确实得想想，自己到底再卷什么，说到底最终能卷离自身的精神虚无吗。</p><p>正因如此，我在12集前，甚至11集时，还在期待更多，期待它完美落地后我能直接吹爆，但是12集直接让整个故事变成了喜剧「乐」</p><p>那么12集以及之后的13集到底烂在哪？让我来仔细喷一喷。</p><p>它的剧情逻辑过于扯淡了，这一点实在不用多说，只能说<strong>如果制作组觉得日本人的脑子是这样的</strong>，那么能想出番里的日本人这样行动也是挺合理的。但是其实也能接受，因为倘若仔细想想前面的剧情逻辑到底如何，大家心里应该都有点数，只是这集尤其逆天罢了，这么一想<strong>日本人的脑子确实是这样的</strong>。</p><p>在我看来，真正影响观感的，是整个主角形象的彻底崩坏，以及故事内核的彻底崩坏。</p><p>千束，作为一个故事中最讨喜的角色，为什么讨喜呢？因为她一直作为一个坚强、自信、对任何事情坦然接受展开笑容、遇事游刃有余的形象出现，但在12集中，千束所展现的只是和吉叔的一顿嘴炮，以及摆脱了杀人机器的「天职」，而被莫名其妙的“不杀人”的新「天职」所束缚的形象，她的行动根本不是对「天职」观念的否定，而只是被另一种形式的束缚了而已。而泷奈和吉叔两人，一个“心脏要逃走了！”，一个“来杀我呀来杀我呀”属实逆天，这就是你足立眼里的对立冲突？</p><p>而在13集，千束一顿操作后依旧没有解决自己对于「天职」观念的矛盾，制作组而是换了一种方式，“诶，我让大叔把吉叔杀了，让千束开个挂，这样千束不就既和解了也活下来了嘛”，属实在原有崩坏的基础上更加崩坏了。我在想千束在lycoris战友身受重伤的时候心里有何感想，一枪一枪打向绿毛的时候心里有何感想，泷奈快要被杀的时候有何感想。惦记着不杀人的想法在电波塔扯淡，难道被肃清的lycoris的命就不是命了？难道被杀的恐怖分子的命就不是命了？难道被大叔杀了的吉叔就不关自己的事了？</p><p>我不理解，为什么后面要突然去讨论一些不属于自己的话题，明明不需要关注杀不杀人，法不法治，这单纯只是一个触发矛盾的工具，只需要简单的，实在不行弱智一点，机械降神的解决问题，这样千束依旧以全能洒脱游刃有余的形象获得所有人的好感，剧情弱智和多余未回收的设定是贯彻全番的问题。于是为了填这些，再强行加上逆天设定。只可惜它还是要去讨论不属于自己水平和日本人脑子的话题，最终主人形象彻底崩坏，内核崩坏，而逆天的剧情只能让这个番配上一个字「乐」。</p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
            <tag> 评论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>葉・赛博朋克・简评</title>
      <link href="/2022/10/cba225035484/"/>
      <url>/2022/10/cba225035484/</url>
      
        <content type="html"><![CDATA[<h2 id="赛博朋克边缘行者"><a href="#赛博朋克边缘行者" class="headerlink" title="赛博朋克边缘行者"></a>赛博朋克边缘行者</h2><p>star：8.5</p><p>由于会讨论“赛博朋克”这个话题，为了便于区分，我姑且在文中只称这作Cyberpunk: Edgerunners为“边缘行者”</p><h3 id="赛博朋克"><a href="#赛博朋克" class="headerlink" title="赛博朋克"></a>赛博朋克</h3><p>在如今看到的大部分涉及未来科技，新颖世界观的作品，它们被标榜为“赛博朋克”，但实质上大多只有“赛博”没有“朋克”。</p><p>赛博朋克本身就是对未来科技发展的一种悲观预期，对人类未来可能出现的社会形态的假设和探讨，它会对现在社会的传统概念进行解构，展现出一种颠覆性或者叛逆性，它的整体风格一定是<strong>反乌托邦</strong>的。边缘行者在这一点上做的尤其好，整部番中都始终展现出一种无限压抑，无可奈何的氛围，整个叙事氛围都笼罩在对于赛博社会的无力感中。</p><p>在边缘行者中，在夜之城这个赛博社会中，<strong>传统价值被完全解构，人们的精神价值依附于金钱、肢体改造、以及幻想物</strong>。这一点在第一集的诸多细节画面中有着较为详细的展现。</p><h3 id="大卫"><a href="#大卫" class="headerlink" title="大卫"></a>大卫</h3><p>在这样的一个未来社会中，大卫，作为赛博社会中的一个普通人，他在赛博社会中的精神虚无，陷入后现代精神危机。这一点在前3集中就有集中表现，比如母亲死前，即使自己对于当下生活感到不满，依旧没有表露，跟随母亲的心愿上学；在母亲死后，自己不知何去何从，然后出现一个镜头，大卫从高处跃下，落在垃圾堆。</p><p>直到被一个成熟涩气大姐姐lucy捡走，从之前和母亲相依为命的「群体」转变到了团队的「群体」，依旧在其中继续迷茫地活着，然后在团队中被Maine认可，被lucy认可，也对于强大、经验丰富的Maine心有崇拜，这也为后续大卫继承Maine的领导者身份，追求团队工作，追求自己的身体改造做足了铺垫。</p><p>直到Maine死亡，大卫的精神状态被迫接受了转变。</p><p>前三集直接让我不得不熬夜看完这整部番，充满光污染，高饱和的画面，无处不在的社会和民生细节的刻画，让我甚至需要暂停反复观看，完全没有快进的想法。第二集被lucy带走，以及拉去月球，整体演出表现高涨的情绪、癫狂的浪漫主义，在夜之城的这种疯狂中，更是进一步衬托了赛博社会人们精神虚无的现状。</p><p>Maine的命运其实也是对男主命运的预示。在夜之城这样一个赛博社会中人们作为社会工具，无法逃脱体制，被夜之城操纵，精神除了追求身体改造没有别的出路，直到被折磨至精神疯狂，在被彻底混乱之前挣扎，然后作为毫不起眼的死亡体验素材从社会中消失（吉米的大量摆放的素材完全突出了这一点）</p><p>第6集Maine之死的演出实在过于优秀，在最后一幕中，静止镜头配合强大的蒙太奇手法，配上嘈杂的噪声音乐，一整个就是极致的暴力赛博演出，实在精彩！</p><p>后续故事讲述大卫精神危机所导致的恶化，在第8集时，变为了当初自己讨厌的那类人，让自己母亲身亡的那类“走狗”，大卫在团队中迷失自我，无可奈何的走向崩溃，直到在最后一话，在极致癫狂的精神错乱中，随着Rebecca的荒诞式的惨死，自己的生命也走向了最后一刻，最后那仿佛释然般的一笑是为何而笑呢？</p><h3 id="lucy"><a href="#lucy" class="headerlink" title="lucy"></a>lucy</h3><p>我始终认为lucy其实并不是边缘行者中的主角，她和Maine、Rebecca等人一样，在这短短10集的动画中只是作为一个故事工具人，这也导致了我心中的遗憾：<del>这么好的大姐姐居然没戏份？！</del></p><p>lucy从前2集就抓住了我的眼球，一个成熟、独立、有经验的前辈，一个帅气潇洒又带有疯狂的赛博女郎，而在第2集带david去月球的情节中又表现出lucy讨厌夜之城这种赛博社会，向往一种在那时已经被完全解构的传统的浪漫、自由与解放。（多么好的涩气大姐姐，<strong>很符合我对赛博女郎的想象</strong>）</p><p>lucy和david其实有着相似的悲惨经历，这也不难去理解lucy为什么会在短短的时间内就接受了david。</p><p>后续david死后，lucy一个人去了早就能去的月球观光车，没有自由和解放，依旧无法逃脱赛博社会的压迫，极致的悲哀和无力感。</p><p>让我觉得不满的点在于，lucy在接受david之前，也就是我上述所说的一个独立的赛博女郎形象，而在后续情节中，尤其是在Maine死后，却直接转变为了一个为了保护大卫而行动，以及等待男主角拯救的传统动画女主角形象，而在家里更只是一个相互依偎，让大卫搂搂抱抱的“居家贤内助”形象，我本以为揭示lucy的身世后一定会有更多的转变。</p><p>确实，这样也问题不大，只是我觉得可以更好，现在的结局只是：david死了，lucy依旧没有获得她想要的自由和解放。我觉得可以有另一种可能性，譬如大卫在赛博社会中不知何去何从，陷入后现代精神危机，而lucy向往的是旧传统的浪漫。可以用浪漫主义解决后现代问题。</p><p><strong>不然在第2集那个经典的在月球上带着david纵身一跃有何意义？</strong></p><h3 id="吐糟"><a href="#吐糟" class="headerlink" title="吐糟"></a>吐糟</h3><p>其实这作一点都不扳机社，可能唯一符合扳机社风格的就是Rebecca了。（没想到trigger居然有这种水准）</p><p>有人说david的一生为了别人而活着有什么不好的，确实，这也是一种典型的生活方式，要多点篇幅刻画其实也可以写成“赛博士郎”（笑）</p><p>边缘行者通过多个角色的生活方式提供了一个多元的视角，在夜之城中，每个人都有自己应对人生虚无的方式，依靠他人而活的david，为了自己而活的Rebecca，<del>为了オナニー而活的Pilar</del>，为了夜之城的金钱地位而活的Faraday等等。在赛博朋克的框架下， 边缘行者对于夜之城的各种生活方式都有着一种嘲弄和同情的态度（唯一去表示肯定的白月光可能就是lucy的传统浪漫吧）</p><p>真没想到如今的日本业界还有水准做出这样的动画，trigger这波拉来了一大众元老人物做出的边缘行者无疑能成为今年最佳动画，在这部边缘行者中我仿佛看到了老gainax的影子（trigger真的很gainax），这部边缘行者的男主角david总能让我看到EVA中真嗣、FCLC中的直太、甚至包括天元突破中的西蒙的影子。他们都是在为一种无力感和迷茫感做斗争，挣扎于自己人生价值的虚无。但是david并没有想这些角色一样受到trigger以往“突破天际”的眷顾，真嗣有葛城美里，有明日香，有真希波；直太有春原晴子；西蒙有大哥，优子和妮亚。但是david却只是处于每一个人都有着深深的无力感的赛博社会中（你以为lucy是春原晴子？错啦！），在这样一个一切传统价值都被解构的社会中，<strong>david无法找到自己所应当「相信」的东西</strong>，只有金钱、肢体改造和幻想物，所以他最终只能为了他人而活，为了他人的梦想而活。</p><h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>奈何文化水平低，看不懂很多东西，没法做出细致的“锐评”。</p><p>写一个这样的评价实在费劲，不知不觉就花了个把小时，其中还有一堆不通顺的胡言乱语，但是懒得审懒得改了，如果有时间和动力，还想做一篇《双城之战》的评论，这是我近几年来最爱的，丝毫看不到任何缺陷的作品（吹爆捏）。</p><h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p><a href="https://writeas.xyz/zsn4p7dacycfy8e6.md">https://writeas.xyz/zsn4p7dacycfy8e6.md</a></p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
            <tag> 评论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022年7月追番锐评</title>
      <link href="/2022/10/cf556c178003/"/>
      <url>/2022/10/cf556c178003/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>博客老旧没动静了，之前还意外扬了一次，准备手写一个前后端自己搭建一个新的，上手觉得不太有趣，于是作罢了，旧博客由于更新hexo和主题导致不兼容，自己写的一些js配置全没了，不想再折腾一遍了。</p><p>无论如何，本来想只做技术的，现在发现没啥意思，不如在里面发发牢骚，平时追番完结了只在群里锐评一番，流水账一通说完旧没有后续了，而bgm的简评限制了200字，实在不够婆罗门说一通的，想了想把看过的番评放到这里来或许挺不错的。</p><h2 id="2022年7月"><a href="#2022年7月" class="headerlink" title="2022年7月"></a>2022年7月</h2><h3 id="继母的拖油瓶是我的前女友"><a href="#继母的拖油瓶是我的前女友" class="headerlink" title="继母的拖油瓶是我的前女友"></a>继母的拖油瓶是我的前女友</h3><p><img src="https://lain.bgm.tv/pic/cover/c/49/54/343106_cT6ZV.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/49/54/343106_cT6ZV.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：5</p><p>厕纸轻改动画，水准就不用多说了，设定挺好玩的，不过制作组没有玩出什么花活，但它姑且能看，这番就好比寸止挑战，该A上去完结的时候给你停一手</p><h3 id="欢迎来到实力至上主义教室-第二季"><a href="#欢迎来到实力至上主义教室-第二季" class="headerlink" title="欢迎来到实力至上主义教室 第二季"></a>欢迎来到实力至上主义教室 第二季</h3><p><img src="https://lain.bgm.tv/pic/cover/c/c8/8a/371546_Df9ri.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/c8/8a/371546_Df9ri.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars: 5</p><p>制作非常烂的厕纸，也不必多说，值得一题第12集，作为看过原作的人，单纯为了等路哥暴打龙男孩而看，制作组也尤其懂，在打戏方面异常精致，画面质量出乎意料，可谓是为了这点醋，才包的饺子。</p><h3 id="夏日重现"><a href="#夏日重现" class="headerlink" title="夏日重现"></a>夏日重现</h3><p><img src="https://lain.bgm.tv/pic/cover/c/d9/f5/326895_j1S2n.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/d9/f5/326895_j1S2n.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：7</p><p>话题度拉满的动画，原作被吹为命运石之门等级，但至少动画实在不敢恭维，专注于叙事，而在形象塑造上非常马虎，大部分时候它所渲染的氛围与我心中所想的完全不同，尤其bgm的把控让我想要大骂。整个看下来，唯一让我影响深刻的演出部分也就只有第三集结尾追潮的部分。而尤其25话结局的演出，实在太烂了。</p><h3 id="来自深渊-烈日的黄金乡"><a href="#来自深渊-烈日的黄金乡" class="headerlink" title="来自深渊 烈日的黄金乡"></a>来自深渊 烈日的黄金乡</h3><p><img src="https://lain.bgm.tv/pic/cover/c/ae/18/298477_eBaQ8.jpg" class="lazyload" data-srcset="https://lain.bgm.tv/pic/cover/c/ae/18/298477_eBaQ8.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>stars：8.5</p><p>布耶可cv寺崎裕香的表现太优秀了！不太熟的cv，但是从现在开始关注了。</p><p>第一季以及剧场版的质量也非常高，原作的质量也很高，作为第二季，整体质量很高，bgm质量很高，尤其重要部分的bgm的插入完美把控了情感，演出非常精彩。</p><p>双线叙事编排精巧，跨越时代的冒险被深渊的罗盘所联系。</p><p>深渊联系着上面的世界，与被诅咒的奈落的另一头，莉可在奈落是死的形态，在深渊上面是活的形态，深渊赋予生命的死亡意义，“不管怎样，我们都不过是奈落的产物”。在abyss，有机物不存在额外的价值，而深渊将给予「挑战」它的人们「价值」。</p><p>深渊是工具，将一切现代价值解构，将人从「有机」转为「无机」，“天地不仁，以万物为刍狗”，在深渊中，人变为了最原始的生命形态，在此，「一切垃圾都能变成黄金」。</p><p>通俗意义上的生命不具有「价值」，愿望获得形体，意志化为肉身。</p><p>部分场景的演出差了点意思，比如第7话，以及最后一话中有的场面的插入甚至可以说生硬尴尬，缺少了应有的震撼，或许也只是我期待值过高了。</p><p>ps：我尤其讨厌所谓的原作党，很多时候他们很大的影响了一个动画的讨论氛围，这也是我更喜欢讨论原创番的原因</p>]]></content>
      
      
      <categories>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图片文件结构与PNG编码</title>
      <link href="/2022/3/7cad8c576e96/"/>
      <url>/2022/3/7cad8c576e96/</url>
      
        <content type="html"><![CDATA[<h1 id="图片文件结构与PNG编码"><a href="#图片文件结构与PNG编码" class="headerlink" title="图片文件结构与PNG编码"></a>图片文件结构与PNG编码</h1><h2 id="图像存储"><a href="#图像存储" class="headerlink" title="图像存储"></a>图像存储</h2><h3 id="颜色在计算机的存储"><a href="#颜色在计算机的存储" class="headerlink" title="颜色在计算机的存储"></a>颜色在计算机的存储</h3><ul><li><strong>颜色模式</strong></li></ul><p><strong>RGB色彩模式</strong>是颜色模式之一（除此之外还有YUV模式和CMYK模式等等）</p><blockquote><p>在实际的开发中，我们可能还会遇到RGBA模式，其中的A代表的是alpha通道，一般表示透明度，值从0%-100%，0-表示完全透明，100-表示完全不透明。</p></blockquote><p>RGB（255, 128, 196）：有3个颜色分量，分别是R的值255，G的值128，B的值196，这三个分量分别用了8位存储。咱们前面提到过8位存储，可以存储256个值。</p><p>关于RGB的颜色表示还有一种16进制表示方式，比如刚才的RGB（255,128,196）换算成16进制为#FF80C4</p><ul><li><strong>像素</strong></li></ul><p>每一个像素都有一个明确的位置和被分配的色彩值</p><ul><li><strong>分辨率（Resolution）</strong></li></ul><p>又称解析度，可以细分为显示分辨率、图像分辨率、打印分辨率和扫描分辨率。</p><p>显示分辨率：分辨率 4000x3000</p><p>图像分辨率: 常用单位，dpi（点每英寸），ppi（像素每英寸）。1英寸&#x3D;2.54厘米(cm)，它的实质是描述了图像的真实大小。比如“水平分辨率 72dpi”</p><ul><li><strong>图像文件格式</strong></li></ul><p><strong>BMP（Bitmap）</strong>：是Windows操作系统中的标准图像文件格式，采用位映射存储格式，无压缩，BMP文件的图像深度可选1、4、8、24位。BMP最大的特点就是<strong>没有压缩</strong>（所以它的图像大小你可以直接算出来）</p><p><strong>JPEG</strong>：<strong>联合图像专家小组</strong>（Joint Photographic Experts Group，<strong>JPEG</strong>）是一种针对图像的有损压缩标准方法。使用的一种失真压缩标准方法，24 bit真彩色，不支持动画、不支持透明色。</p><p><strong>PNG</strong>：<strong>便携式网络图形</strong>（Portable Network Graphics，<strong>PNG</strong>）是一种无损压缩的位图图形格式格式是无损（不失真）数据压缩的，PNG格式有8位、24位、32位三种形式，其中8位PNG支持两种不同的透明形式（索引透明和alpha透明）。</p><p><strong>GIF</strong>：<strong>图像互换格式</strong>（Graphics Interchange Format，<strong>GIF</strong>）是一种无损压缩的位图图形格式，采取8位色重现图像。</p><h3 id="图片的基本概念"><a href="#图片的基本概念" class="headerlink" title="图片的基本概念"></a>图片的基本概念</h3><ul><li><strong>位图（Bitmap）</strong></li></ul><p>又叫格栅图或者点阵图，是利用像素阵列来表示的图像。位图的每个像素都被分配了特定的位置和颜色值，颜色值可以由RGB组合或者灰度值表示。</p><ul><li><strong>位深度（Bit Depth）</strong></li></ul><p>每个像素用来表示颜色信息的位数，位深度越大，颜色越逼真，占用空间也就越大。例如，位深度为1的位图的像素只能为黑色或者白色，位深度为8的图像像素有2^8^（即256）个可能的颜色值。</p><ul><li><strong>颜色通道</strong></li></ul><p>RGB图像的像素由红绿蓝三个颜色通道组成，8<strong>位&#x2F;通道</strong>的图像中，每个通道有256个可能值，因此每个像素有24位可能的值，通常将24位RGB位图成为真色彩位图。</p><blockquote><p>色深度与位深度</p><p>色深度：一个颜色通道的位数，单位为 位&#x2F;通道 。常有8bit、10bit</p><p>位深度：一个像素的位数</p></blockquote><ul><li><strong>Alpha通道</strong></li></ul><p>在原有的图片编码基础上，添加像素的透明度信息，因为通常把RGB三种颜色信息分别成为三种颜色的通道，所以透明度信息也成为Alpha通道。</p><ul><li><strong>矢量图（Vector）</strong></li></ul><p>用点、直线或者多边形等基于数学方程的几何图形表示的图像。</p><blockquote><p><strong>位图与矢量图</strong></p><p>位图的放大实际上是每个像素的放大，单个像素的放大会使线条和形状参差不齐，导致我们看到的图片“模糊不清晰”。而矢量图通过路径和颜色来记录图片信息，放大之后并不会失真。</p><p>位图处理已经标准化，并且硬编码到显卡内，GPU能够处理位图。但矢量图的处理只能依靠CPU。</p></blockquote><h2 id="PNG编码与解码"><a href="#PNG编码与解码" class="headerlink" title="PNG编码与解码"></a>PNG编码与解码</h2><h3 id="PNG文件结构"><a href="#PNG文件结构" class="headerlink" title="PNG文件结构"></a>PNG文件结构</h3><p>PNG图像格式文件由文件署名和数据块(chunk)组成。</p><h4 id="文件署名域（Signature）"><a href="#文件署名域（Signature）" class="headerlink" title="文件署名域（Signature）"></a>文件署名域（Signature）</h4><p>一张 PNG 图片二进制数据的开头必须是这 8 字节:</p><p><code>0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a</code> 转换为 10 进制是 <code>137, 80, 78, 71, 13, 10, 26, 10</code>。</p><p>（Linux下我们可以用file命令直接查看文件的实际格式，但是他本质上也是利用文件头标志来进行文件类型判断的。）</p><h4 id="数据块（Chunks）"><a href="#数据块（Chunks）" class="headerlink" title="数据块（Chunks）"></a>数据块（Chunks）</h4><p>有两种类型的数据块，一种是称为<strong>关键数据块</strong>(critical chunk)；另一种叫做<strong>辅助数据块</strong>(ancillary chunks)。</p><p>每个数据块都包含图片的描述信息，数据块由四个部分组成：</p><table><thead><tr><th>名称</th><th>长度</th><th>说明</th></tr></thead><tbody><tr><td>Length</td><td>4 bytes</td><td>指定 <strong>Chunk Data</strong> 的长度</td></tr><tr><td>Chunk Type</td><td>4 bytes</td><td>指定数据块类型</td></tr><tr><td>Chunk Data</td><td>可变</td><td>按照Chunk Type存放指定数据</td></tr><tr><td>CRC</td><td>4 bytes</td><td>检查是否有错误的循环冗余代码</td></tr></tbody></table><p>这里要注意 Length 保存的是该数据块中 Chunk Data 的长度，也就是说，一个数据块的长度应该为 Length 的值加上12 bytes。</p><p>Chunk Type 由4个字符组成，：第一个字符是否大写（critical），决定了该数据块是否是关键（critical）数据块；第二个字符大写表示公开，小写表示私有；第三个字符规定必须大写；第四个字符大写则表示只能在关键数据块不变时被复制，小写则表示任何情况下能复制。</p><h4 id="关键数据块"><a href="#关键数据块" class="headerlink" title="关键数据块"></a>关键数据块</h4><p>关键数据块定义了4个标准数据块，每个PNG文件都必须包含它们。</p><p>1、<strong>文件头数据块IHDR(header chunk)</strong></p><p>包含有PNG文件中存储的图像数据的基本信息，并要作为<strong>第一个数据块</strong>出现在PNG数据流中，而且一个PNG数据流中只能有一个文件头数据块。它用13个字节按照顺序来表示图像数据的基本信息：</p><table><thead><tr><th>域的名称</th><th>长度</th><th>说明</th></tr></thead><tbody><tr><td>Width</td><td>4 bytes</td><td>图片宽度，以像素为单位</td></tr><tr><td>Height</td><td>4 bytes</td><td>图片高度，以像素为单位</td></tr><tr><td>Bit Depth</td><td>1 byte</td><td>图像深度</td></tr><tr><td>Color Type</td><td>1 byte</td><td>颜色类型</td></tr><tr><td>Compression Method</td><td>1 byte</td><td>压缩算法</td></tr><tr><td>Filter Method</td><td>1 byte</td><td>滤波方法</td></tr><tr><td>Interlace Method</td><td>1 byte</td><td>扫描方法</td></tr></tbody></table><ul><li><code>Bit Depth</code>代表图像深度。索引彩色图像：1，2，4或8；灰度图像：1，2，4，8或16；真彩色图像：8或16；</li><li><code>Color Type</code>（颜色类型）PNG 图片一共有 5 种色彩类型，<code>0</code> 代表灰度颜色，<code>2</code> 代表用 RGB 表示颜色，即 <code>(R, G, B)</code>，<code>3</code> 代表用色板表示颜色，<code>4</code> 代表灰度和透明度来表示颜色，<code>6</code> 代表用 RGB 和透明度表示颜色，即 <code>(R, G, B, A)</code>。色板的色彩类型里，每个像素是由 1 个色彩通道表示的。</li><li><code>Co2,mpression Method</code> 代表了压缩算法。目前只支持 <code>0</code>，表示 <strong>deflate&#x2F;inflate</strong>。（<strong>Deflate&#x2F;inflate</strong> 是一种结合了 LZ77 和霍夫曼编码的无损压缩算法，被广泛运用于 <code>7-zip</code>，<code>zlib</code>，<code>gzip</code> 等场景。）</li><li><code>Filter Method</code> 代表在压缩前应用的过滤函数类型，目前只支持 <code>0</code>。过滤函数类型 <code>0</code> 里面包括了 5 种过滤函数。</li><li><code>Interlace Method</code> 代表图片数据是否经过交错，<code>0</code> 代表非隔行扫描，<code>1</code> 代表 Adam7。</li></ul><p>2、<strong>调色板数据块PLTE(palette chunk)</strong></p><p>它包含有与索引彩色图像(indexed-color image)相关的彩色变换数据，它仅与索引彩色图像有关，如果存在，要放在图像数据块(image data chunk)之前。真彩色的PNG数据流也可以有调色板数据块，目的是便于非真彩色显示程序用它来量化图像数据，从而显示该图像。结构如下：</p><table><thead><tr><th align="center">颜色</th><th align="center">字节</th><th align="center">意义</th></tr></thead><tbody><tr><td align="center">Red</td><td align="center">1 byte</td><td align="center">0 &#x3D; 黑色, 255 &#x3D; 红</td></tr><tr><td align="center">Green</td><td align="center">1 byte</td><td align="center">0 &#x3D; 黑色, 255 &#x3D; 绿色</td></tr><tr><td align="center">Blue</td><td align="center">1 byte</td><td align="center">0 &#x3D; 黑色, 255 &#x3D; 蓝色</td></tr></tbody></table><p>PLTE数据块是定义图像的palette信息，PLTE可以包含1~256个palette信息，每一个palette信息由3个字节组成，因此palette数据块所包含的最大字节数为768，palette的长度应该是3的倍数，否则，这将是一个非法的palette。</p><p>对于索引图像，palette信息是必须的，palette的颜色索引从0开始编号，然后是1、2……，palette的颜色数不能超过色深中规定的颜色数（如图像色深为4的时候，调色板中的颜色数不可以超过2^4&#x3D;16），否则，这将导致PNG图像不合法。</p><p>3、<strong>图像数据块IDAT(image data chunk)</strong></p><p>存储实际的图片数据，一个图片数据流可能包含多个连续顺序的 IDAT 数据块。创建 IDAT 数据块的步骤：</p><ol><li>将扫描获得的图片信息及其大小储存，具体的图片信息和大小规则在 IHDR 中保存</li><li>采取 IHDR 指定的过滤方法，对图像数据进行过滤。目前只有定义了method 0</li><li>采取 IHDR 指定的压缩方法，对过滤的数据进行压缩</li></ol><p>如果想要读取图片信息，将上面三个步骤逆序执行即可。</p><p>4、<strong>图像结束数据IEND(image trailer chunk)</strong></p><p>它用来标记PNG文件或者数据流已经结束，并且必须要放在文件的尾部。</p><p>如果我们仔细观察PNG文件，我们会发现，文件的结尾12个字符看起来总应该是这样的：</p><p><code>00 00 00 00 49 45 4E 44 AE 42 60 82</code></p><p>不难明白，由于数据块结构的定义，IEND数据块的长度总是0（<code>00 00 00 00</code>，除非人为加入信息），数据标识总是IEND（<code>49 45 4E 44</code>），因此，CRC码也总是<code>AE 42 60 82</code>。</p><blockquote><p>表示数据块开始的IHDR必须放在最前面， 表示PNG文件结束的IEND数据块放在最后面，其他数据块的存放顺序没有限制。</p></blockquote><h4 id="辅助数据块"><a href="#辅助数据块" class="headerlink" title="辅助数据块"></a>辅助数据块</h4><p><del>（cv查表）</del></p><table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td>bKGD</td><td>指定默认的背景颜色</td></tr><tr><td>cHRM</td><td>校准色度</td></tr><tr><td>dSIG</td><td>数字签名</td></tr><tr><td>eXIf</td><td><a href="https://en.wikipedia.org/wiki/Exif">Exif</a> metadata 信息</td></tr><tr><td>gAMA</td><td>指定亮度的伽马校准值2,</td></tr><tr><td>hIST</td><td>色彩直方图，估算颜色的使用频率</td></tr><tr><td>iCCP</td><td><a href="https://en.wikipedia.org/wiki/ICC_color_profile">ICC color profile</a></td></tr><tr><td>iTXt</td><td>以键值对方式存储可能的压缩文本和翻译信息</td></tr><tr><td>pHYs</td><td>指定像素大小或图片比例</td></tr><tr><td>sBIT</td><td>除了指定位深度（8，16 等等）外，保存原始数据以便恢复</td></tr><tr><td>sPLT</td><td>提出建议使用的调色板，可能有多个</td></tr><tr><td>sRGB</td><td>指明是否使用<a href="https://en.wikipedia.org/wiki/SRGB_color_space">sRGB color space</a></td></tr><tr><td>sTER</td><td>储存立体视图（<a href="https://en.wikipedia.org/wiki/Stereoscopic">stereoscopic</a>）的相关信息，</td></tr><tr><td>tEXt</td><td>保存作者等键值对的文本信息</td></tr><tr><td>tIME</td><td>上次修改时间</td></tr><tr><td>tRNS</td><td>保存透明信息，分为不透明、全透明、Alpha</td></tr><tr><td>zTXt</td><td>保存压缩后的文本信息以及对应的压缩方式标识</td></tr></tbody></table><h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><p>PNG的压缩分为两个步骤：预解析（过滤）和压缩</p><h4 id="隔行扫描"><a href="#隔行扫描" class="headerlink" title="隔行扫描"></a>隔行扫描</h4><p>隔行扫描（Interlacing），也称交错扫描（interleaving），是一种位图编码的方式，编码时不严格按照相邻行进行。当连接速度比较慢时，采用隔行扫描的图片可以渐进地进行显示，即先显示较为模糊的版本，然后逐渐变清晰。如图：</p><p><img src="https://s2.loli.net/2022/03/20/B9WKPpsaQCYm5ET.gif" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/B9WKPpsaQCYm5ET.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>我们常用的 GIF、PNG、JPEG 都采用了隔行扫描的方式，其中 PNG 采取的是二维、七通道的<a href="https://en.wikipedia.org/wiki/Adam7_algorithm">Adam7</a>，二维表示扫描支持竖直和水平方向，7代表一张图片会被拆分为7个子图片。</p><p><img src="https://s2.loli.net/2022/03/20/Bbh9eNTzyOmtdsv.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/Bbh9eNTzyOmtdsv.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20190819143548.png"></p><p>和 GIF 采取的一维、四通道算法相比，PNG 在网速相同的情况下，尤其是网速较慢时，能够更快地显示出图片的基本外貌。</p><h4 id="Filter（过滤）"><a href="#Filter（过滤）" class="headerlink" title="Filter（过滤）"></a>Filter（过滤）</h4><p>PNG编码使用差分对原始像素数据进行Filter，该过程无任何压缩损失，并且完全可逆。对图像来说，存储残差所需的比特远远小于实际图像所需，这也是差分编码的收益来源</p><ul><li><strong>差分编码</strong></li></ul><p>[2,3,4,5,6,7,8]会变成[2,1,1,1,1,1,1]，其中 [2, 3-2&#x3D;1, 4-3&#x3D;1, 5-4&#x3D;1, 6-5&#x3D;1, 7-6&#x3D;1, 8-7&#x3D;1]</p><p>如果数据是线性相关的(也就是说，值与前一个值有一些很小的差异)，那么最终会将数据集的值转换为大量重复的小值，这些小值更容易被压缩。 PNG文件格式使用称为“filtering”的delta编码格式。基本上，对于每一个像素扫描线，当前像素都是按照与左边像素、上面像素和上面左侧像素的某种关系进行编码的。</p><p>对于不同的内容，须使用不同的Filter类型来提升压缩收益，<strong>过滤的重点</strong>是将大多数转换后的字节将聚集在零附近，从而为压缩引擎提供更小、更可预测的字节值范围来处理。</p><p>为了便于描述，规定了<code>相邻像素</code>相对<code>当前像素</code>的方位：左（A）、上（B）、左上（C）。</p><table><thead><tr><th>C</th><th>B</th></tr></thead><tbody><tr><td>A</td><td>X</td></tr></tbody></table><p>上文提到的 5 种过滤函数为：</p><table><thead><tr><th>过滤类型</th><th>存储值(O)&#x3D;实际值(X)-预测值(R)</th></tr></thead><tbody><tr><td>0</td><td>O &#x3D; X</td></tr><tr><td>1</td><td>O &#x3D; X - A</td></tr><tr><td>2</td><td>O &#x3D; X - B</td></tr><tr><td>3</td><td>O &#x3D; X - (A+B)&#x2F;2</td></tr><tr><td>4</td><td>Peath(A,B,C)</td></tr></tbody></table><p>Peath(A,B,C): Paeth预测器(A,B,C的线性函数)</p><p>Peath具体计算为 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">base = <span class="title class_">AboveRow</span>[j] + <span class="title class_">LeftCol</span>[i] – <span class="title class_">AboveRow</span>[-<span class="number">1</span>]</span><br><span class="line">pLeft = <span class="title class_">Abs</span>(base – <span class="title class_">LeftCol</span>[i])           <span class="comment">// abs(A-C)</span></span><br><span class="line">pTop = <span class="title class_">Abs</span>(base – <span class="title class_">AboveRow</span>[j])     <span class="comment">// abs(L-C)</span></span><br><span class="line">pTopLeft = <span class="title class_">Abs</span>(base – <span class="title class_">AboveRow</span>[-<span class="number">1</span>])    <span class="comment">// abs(A+L-2*C)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pLeft &lt;= pTop &amp;&amp; pLeft &lt;= pTopLeft)</span><br><span class="line">    pred[i][j] = <span class="title class_">LeftCol</span>[i]                   <span class="comment">// 使用左边参考像素值</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(pTop &lt;= pTopLeft)</span><br><span class="line">    pred[i][j] = <span class="title class_">AboveRow</span>[j]             <span class="comment">// 使用上方参考像素值</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    pred[i][j] = <span class="title class_">AboveRow</span>[-<span class="number">1</span>]           <span class="comment">// 若上方与左边均判断为不存在边界的情况，则使用左上方的值</span></span><br></pre></td></tr></table></figure><blockquote><p>选择合适的过滤器？</p><p>没有。每一行进行增量测试压缩，保存最小的结果，然后对下一行重复，对于20行的图像相当于对整个图像进行五次过滤和压缩。对于将被传输和解码多次的图像来说，这可能是一个合理的权衡。</p><p>过滤器也很少用于低位深度（灰度）图像，尽管在极少数情况下将此类图像提升到 8 位然后过滤是有效的。但是，一般来说，过滤器类型 None 是最好的。</p></blockquote><blockquote><p>一些接近最优的经验法则：比如对调色板图像以及低于8位的灰度图像不使用过滤器；对于其他的图像，选择最小化绝对差和的滤波器；不是使用256模除(%)，而是使用标准的带符号数学，然后获取abs值，并将它们全部添加到给定行中，然后比较其他筛选器类型的和，选择给出最小和的过滤器。</p></blockquote><h4 id="Deflate"><a href="#Deflate" class="headerlink" title="Deflate"></a>Deflate</h4><p>正式的压缩阶段使用 <a href="https://en.wikipedia.org/wiki/DEFLATE">Deflate</a> 进行压缩，它由 Huffman 编码 和 LZ77 压缩构成。Deflate是一种压缩数据流的算法，任何需要流式压缩的地方都可以用（<del><em>但我并没有去了解它具体的实现，所以就略过吧</em></del>）</p><h3 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h3><p>（图片和数据均来自<a href="https://vivaxyblog.github.io/2019/12/07/decode-a-png-image-with-javascript-cn.html">一步一步解码 PNG 图片</a>）</p><p><img src="https://s2.loli.net/2022/03/20/6yXKjOHpoZGJfrz.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/6yXKjOHpoZGJfrz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="示例图片"></p><p>👆 这是一张我们接下去要解码的图片，但它太小了，放大了展示给大家看下。👇</p><p><img src="https://s2.loli.net/2022/03/20/zG9QE6Za1AUiDVu.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/20/zG9QE6Za1AUiDVu.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>二进制数据如下</p><table><thead><tr><th></th><th>0 ~ 3</th><th>4 ~ 7</th><th>8 ~ 11</th><th>12 ~ 15</th></tr></thead><tbody><tr><td>0 ~ 15</td><td><code>137, 80, 78, 71</code></td><td><code>13, 10, 26, 10</code></td><td><code>0, 0, 0, 13</code></td><td><code>73, 72, 68, 82</code></td></tr><tr><td>16 ~ 31</td><td><code>0, 0, 0, 2</code></td><td><code>0, 0, 0, 2</code></td><td><code>2, 3, 0, 0</code></td><td><code>0, 15, 216, 229</code></td></tr><tr><td>32 ~ 47</td><td><code>183, 0, 0, 0</code></td><td><code>1, 115, 82, 71</code></td><td><code>66, 1, 217, 201</code></td><td><code>44, 127, 0, 0</code></td></tr><tr><td>48 ~ 63</td><td><code>0, 9, 112, 72</code></td><td><code>89, 115, 0, 0</code></td><td><code>11, 19, 0, 0</code></td><td><code>11, 19, 1, 0</code></td></tr><tr><td>64 ~ 79</td><td><code>154, 156, 24, 0</code></td><td><code>0, 0, 12, 80</code></td><td><code>76, 84, 69, 255</code></td><td><code>0, 0, 0, 255</code></td></tr><tr><td>80 ~ 95</td><td><code>0, 0, 0, 255</code></td><td><code>255, 255, 255, 251</code></td><td><code>0, 96, 246, 0</code></td><td><code>0, 0, 4, 116</code></td></tr><tr><td>96 ~ 111</td><td><code>82, 78, 83, 255</code></td><td><code>255, 255, 127, 128</code></td><td><code>144, 197, 89, 0</code></td><td><code>0, 0, 12, 73</code></td></tr><tr><td>112 ~ 127</td><td><code>68, 65, 84, 120</code></td><td><code>156, 99, 16, 96</code></td><td><code>216, 0, 0, 0</code></td><td><code>228, 0, 193, 39</code></td></tr><tr><td>128 ~ 143</td><td><code>168, 232, 87, 0</code></td><td><code>0, 0, 0, 73</code></td><td><code>69, 78, 68, 174</code></td><td><code>66, 96, 130</code></td></tr></tbody></table><p>每个表格的单元格内有 4 字节数据，每个字节由 8 位组成，1 位代表的是 <code>0</code> 或者 <code>1</code> 的一个数字。</p><ul><li><strong>签名部分</strong></li></ul><table><thead><tr><th>0 ~ 3</th><th>4 ~ 7</th></tr></thead><tbody><tr><td><code>137, 80, 78, 71</code></td><td><code>13, 10, 26, 10</code></td></tr><tr><td><code>0x89, 0x50, 0x4e, 0x47</code></td><td><code>0x0d, 0x0a, 0x1a, 0x0a</code></td></tr></tbody></table><p>这张图片的前 8 个字节满足PNG签名的要求。</p><ul><li><strong>文件头数据块部分</strong></li></ul><table><thead><tr><th>8 ~ 11</th><th>12 ~ 15</th></tr></thead><tbody><tr><td><code>0, 0, 0, 13</code></td><td><code>73, 72, 68, 82</code></td></tr><tr><td>长度</td><td>类型</td></tr><tr><td><code>13</code></td><td><code>IHDR</code></td></tr></tbody></table><table><thead><tr><th>16 ~ 19</th><th>20 ~ 23</th><th>24 ~ 27</th><th>28</th></tr></thead><tbody><tr><td><code>0, 0, 0, 2</code></td><td><code>0, 0, 0, 2</code></td><td><code>2, 3, 0, 0</code></td><td><code>0</code></td></tr><tr><td><code>width</code></td><td><code>height</code></td><td><code>depth</code>, <code>colorType</code>, <code>compression</code>, <code>filter</code></td><td><code>interlace</code></td></tr><tr><td><code>2</code></td><td><code>2</code></td><td><code>2, 3, 0, 0</code></td><td><code>0</code></td></tr></tbody></table><table><thead><tr><th>29 ~ 32</th></tr></thead><tbody><tr><td><code>15, 216, 229, 183</code></td></tr><tr><td>CRC32 校验和</td></tr></tbody></table><ul><li><strong>PLTE部分</strong></li></ul><table><thead><tr><th>75 ~ 78</th><th>79 ~ 82</th><th>83 ~ 86</th></tr></thead><tbody><tr><td><code>255, 0, 0, 0</code></td><td><code>255, 0, 0, 0</code></td><td><code>255, 255, 255, 255</code></td></tr></tbody></table><p>色板中包含的数据是 RGB 数据，以 <code>R, G, B</code> 的形式保存，这里一共 12 字节，表示了 4 个色块。得到的色板信息如下：</p><p><strong>色板</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[255, 0, 0], [0, 255, 0], [0, 0, 255], [255, 255, 255]]</span><br></pre></td></tr></table></figure><ul><li><strong>tRNS部分</strong></li></ul><table><thead><tr><th>99 ~ 102</th></tr></thead><tbody><tr><td><code>255, 255, 255, 127</code></td></tr></tbody></table><p>这个数据块为色板提供透明信息，每个字节表示一个色块的透明信息。与色板组合后的色板如下：</p><p><strong>色板</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[255, 0, 0, 255], [0, 255, 0, 255], [0, 0, 255, 255], [255, 255, 255, 127]]</span><br></pre></td></tr></table></figure><ul><li><strong>IDAT部分</strong></li></ul><p>我们重点关注图像数据块的解码部分。</p><table><thead><tr><th>107 ~ 110</th><th>111 ~ 114</th></tr></thead><tbody><tr><td><code>0, 0, 0, 12</code></td><td><code>73, 68, 65, 84</code></td></tr><tr><td>长度</td><td>类型</td></tr><tr><td><code>12</code></td><td><code>IDAT</code></td></tr></tbody></table><p>声明 12 字节的 <code>IDAT</code>像素数据</p><table><thead><tr><th>115 ~ 118</th><th>119 ~ 122</th><th>123 ~ 126</th></tr></thead><tbody><tr><td><code>120, 156, 99, 16</code></td><td><code>96, 216, 0, 0</code></td><td><code>0, 228, 0, 193</code></td></tr></tbody></table><p>所有行的像素数据会经过 deflate 压缩算法压缩。所以，需要对这里的像素数据解压，这里直接使用了 <code>zlib.inflate()</code> 函数。</p><p>解压出来的像素数据是 Uint8Array：<code>0, 16, 0, 176</code>。</p><p><strong>扫描线 Scanline</strong> </p><p>一根扫描线包含图片一行像素的数据。我们知道这张图片的高度是 2，也就是像素数据中有 2 行扫描线。</p><p>一根扫描线由 1 字节的过滤函数标记和像素信息组成。像素信息一个接一个地排列，中间没有多余的空位。如果扫描线长度不足以填满字节的位数，最后几位会被补齐。一根扫描线的结构如下：</p><table><thead><tr><th>过滤函数</th><th>像素…[补齐…]</th></tr></thead><tbody><tr><td><code>8 位</code></td><td><code>每像素位数</code> * <code>每行像素数</code> + <code>补齐</code></td></tr></tbody></table><p><strong>色彩类型 - 色彩通道 - 通道深度 - 每像素位数</strong></p><table><thead><tr><th>色彩类型</th><th>色彩</th><th>每像素通道数</th><th>通道深度</th><th>每像素位数</th></tr></thead><tbody><tr><td><code>0</code></td><td>灰度</td><td>1</td><td>1, 2, 4, 8, 16</td><td>1, 2, 4, 8, 16</td></tr><tr><td><code>2</code></td><td>真彩色（RGB）</td><td>3</td><td>8, 16</td><td>24, 48</td></tr><tr><td><code>3</code></td><td>色板</td><td>1</td><td>1, 2, 4, 8</td><td>1, 2, 4, 8</td></tr><tr><td><code>4</code></td><td>灰度和透明度</td><td>2</td><td>8, 16</td><td>16, 32</td></tr><tr><td><code>6</code></td><td>色彩色和透明度（RGBA）</td><td>4</td><td>8, 16</td><td>32, 64</td></tr></tbody></table><p>这张图片的色彩类型是 <code>3</code>，所以每个像素包含 <code>1</code> 个色彩通道。又因为图片的通道深度是 <code>2</code>，所以我们知道每个像素是用 <code>2</code> 位来表示的。</p><p><strong>解码扫描线</strong></p><table><thead><tr><th>行</th><th>过滤函数</th><th>像素…[补齐…]</th></tr></thead><tbody><tr><td></td><td><code>8 位</code></td><td><code>每像素 2 位 * 2 像素</code> + <code>4 位补齐</code> &#x3D; <code>8 位</code></td></tr><tr><td><code>0</code></td><td><code>0</code></td><td><code>00010000</code> (<code>16</code>)</td></tr><tr><td><code>1</code></td><td><code>0</code></td><td><code>10110000</code> (<code>176</code>)</td></tr></tbody></table><p>这张图片里面的过滤函数 <code>0</code> 表示这张图数据未经过滤。所以我们只要保留原始数据就行了。</p><p><strong>扫描线像素</strong></p><table><thead><tr><th>行</th><th>第 1 列</th><th>第 2 列</th><th>补齐…</th></tr></thead><tbody><tr><td><code>0</code></td><td><code>00</code></td><td><code>01</code></td><td><code>0000</code></td></tr><tr><td><code>1</code></td><td><code>10</code></td><td><code>11</code></td><td><code>0000</code></td></tr></tbody></table><p>这里每个像素中的数据表示了这个像素的颜色在色板中的索引。根据色板，我们可以还原出图片的像素信息：<code>[[255, 0, 0, 255], [0, 255, 0, 255], [0, 0, 255, 255], [255, 255, 255, 127]]</code>。</p><p><strong>图片像素</strong></p><table><thead><tr><th>行\列</th><th><code>0</code></th><th><code>1</code></th></tr></thead><tbody><tr><td><code>0</code></td><td><code>(255, 0, 0, 255)</code></td><td><code>(0, 255, 0, 255)</code></td></tr><tr><td><code>1</code></td><td><code>(0, 0, 255, 255)</code></td><td><code>(255, 255, 255, 127)</code></td></tr></tbody></table><p>最后可以得到这样一个PNG图片信息：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">imageData = <span class="punctuation">&#123;</span></span><br><span class="line">  width<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  height<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  data<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">127</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>PNG (Portable Network Graphics) Specification <a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Contents.html">http://www.libpng.org/pub/png/spec/1.2/PNG-Contents.html</a></p><p>PNG文件格式 <a href="https://rimson.top/png-format/">https://rimson.top/png-format/</a></p><p>PNG文件格式详解 <a href="https://blog.mythsman.com/post/5d2d62b4a2005d74040ef7eb/">https://blog.mythsman.com/post/5d2d62b4a2005d74040ef7eb/</a></p><p>Portable Network Graphics (PNG) Specification (Second Edition) <a href="https://www.w3.org/TR/PNG/">https://www.w3.org/TR/PNG/</a></p><p>一步一步解码 PNG 图片 <a href="https://vivaxyblog.github.io/2019/12/07/decode-a-png-image-with-javascript-cn.html">https://vivaxyblog.github.io/2019/12/07/decode-a-png-image-with-javascript-cn.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu依赖错误记录(未解决)</title>
      <link href="/2022/3/5008382d91a6/"/>
      <url>/2022/3/5008382d91a6/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu依赖错误记录-未解决"><a href="#Ubuntu依赖错误记录-未解决" class="headerlink" title="Ubuntu依赖错误记录(未解决)"></a>Ubuntu依赖错误记录(未解决)</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在使用如<code>apt update</code> <code>apt upgrade</code> <code>apt install</code>等等依赖操作时偶尔出现的错误，一直没有找到通用的解决方案，且<code>dependencies</code>的错误种类各样，故在此仅仅记录解决的操作</p><h2 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h2><h3 id="The-following-packages-have-unmet-dependencies"><a href="#The-following-packages-have-unmet-dependencies" class="headerlink" title="The following packages have unmet dependencies:"></a>The following packages have unmet dependencies:</h3><blockquote><p>下列软件包有未满足的依赖关系：<br> libpython2-stdlib : 破坏: libpython-stdlib (&lt; 2.7.15-2) 但是 2.7.5-5ubuntu3 正要被安装<br> python2 : 破坏: python (&lt; 2.7.15-2) 但是 2.7.5-5ubuntu3 正要被安装<br> python2-minimal : 破坏: python-minimal (&lt; 2.7.15-2) 但是 2.7.5-5ubuntu3 正要被安装</p></blockquote><p>经常出现的问题，原因是<strong>尝试安装的软件包正在寻找它在当前版本中找不到的“依赖关系”</strong>。一般在换源后会出现这样的问题。在网上的通用方法是<strong>更新包数据库，清除包缓存，然后下载并重新安装较新版本。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get autoclean</span><br><span class="line">sudo apt-get -f install</span><br><span class="line">sudo dpkg --configure -a</span><br><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure><p>修复错误可以使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -u dist-upgrade</span><br><span class="line">sudo apt-get -o Debug::pkgProblemResolver=<span class="built_in">yes</span> dist-upgrade</span><br><span class="line">sudo apt-get remove --dry-run package-name</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -u dist-upgrade</span><br><span class="line">sudo apt-get clean package-name</span><br><span class="line">sudo apt-get install --reinstall package-name</span><br></pre></td></tr></table></figure><p>当然由于未知原因，有时这些操作并<strong>不管用</strong>。我一般直接采用 <code>uninstall</code>所有的报错包，在检查软件源都可用后将它们重新安装下来。</p><h3 id="dpkg-error-processing-archive-x2F-var-x2F-cache-x2F-apt-x2F-archives-x2F"><a href="#dpkg-error-processing-archive-x2F-var-x2F-cache-x2F-apt-x2F-archives-x2F" class="headerlink" title="dpkg: error processing archive &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;*"></a>dpkg: error processing archive &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;*</h3><blockquote><p>准备解压 …&#x2F;libopenal1_1%3a1.19.1-1_i386.deb  …<br>正在解压 libopenal1:i386 (1:1.19.1-1) 并覆盖 (1:1.19.1-1) …<br>dpkg: 处理归档 &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;libopenal1_1%3a1.19.1-1_i386.deb (–unpack)时出错：<br> 尝试覆盖共享的 ‘&#x2F;usr&#x2F;share&#x2F;doc&#x2F;libopenal1&#x2F;changelog.Debian.gz’, 它与软件包 libo<br>penal1:i386 中的其他实例不同<br>在处理时有错误发生：<br> &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;libopenal1_1%3a1.19.1-1_amd64.deb<br> &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;libopenal1_1%3a1.19.1-1_i386.deb<br>E: Sub-process &#x2F;usr&#x2F;bin&#x2F;dpkg returned an error code (1)</p></blockquote><p>出现的原因可能是未完全安装。</p><p>可以用以下命令强行overwrite</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i --force-overwrite /var/cache/apt/archives/libopenal1_1%3a1.19.1-1_amd64.deb</span><br></pre></td></tr></table></figure><p><code>.deb</code>尤其多的时候为了不麻烦其实采用全部overwrite目前也没有出现过问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i --force-overwrite /var/cache/apt/archives/*.deb</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux下设定键盘Fn键控制功能</title>
      <link href="/2022/3/80bb26f6b2bf/"/>
      <url>/2022/3/80bb26f6b2bf/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux下设定键盘Fn键控制功能"><a href="#Linux下设定键盘Fn键控制功能" class="headerlink" title="Linux下设定键盘Fn键控制功能"></a>Linux下设定键盘Fn键控制功能</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>入手新键盘，在Linux上使用时发现顶部F1-F12区域默认为功能键，应该是Mac的键盘行为。我希望在使用Fn+FXX来使用这些功能。</p><h2 id="设定方法"><a href="#设定方法" class="headerlink" title="设定方法"></a>设定方法</h2><p>可以通过设定 <code>/sys/module/hid_apple/parameters/fnmode</code>来控制Fn的模式</p><ul><li><code>0</code> 禁用功能键，按<code>Fn+FXX</code>等同于触发<code>FXX</code></li><li><code>1</code> 默认功能键，按<code>FXX</code>等同于触发<code>Fn+FXX</code></li><li><code>2</code> 默认非功能键，按<code>FXX</code>触发<code>FXX</code>，按<code>Fn+FXX</code>触发<code>Fn+FXX</code>。这也是windows下的默认行为</li></ul><p>于是<code>echo 2 &gt; /sys/module/hid_apple/parameters/fnmode</code>即可</p><p>要让该设定永久生效，需要写入启动项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sudo vim /path/hid_apple.conf</span></span><br><span class="line">options hid_apple fnmode=2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#软链接</span></span><br><span class="line">sudo <span class="built_in">ln</span> -s /path/hid_apple.conf /etc/modprobe.d/hid_apple.conf</span><br></pre></td></tr></table></figure><h2 id="自组键盘经历"><a href="#自组键盘经历" class="headerlink" title="自组键盘经历"></a>自组键盘经历</h2><p>之前的黑皮cherry红轴108键的键盘实在是不好用，想要换一个87键的键盘。但是一直没有找到好用且好看的键盘。了解到客制化键盘的说法，简单看了一下感觉不太复杂，简单来说就是套件+键轴+键帽，于是动手组了一把。</p><p>套件用的<strong>腹灵MK870</strong>，热插拔+RGB+三模确实很香，而且还有三侧出线。值得一提的是大键调教的很好，空格键处还贴心地配了两边的黑条。不过买回来没有送typec连接线，得自己拿一根。无线模式延迟还是有的，高速打字的时候能明显感觉得到，<strong>不建议用无线来打游戏</strong></p><p>键轴直接用的87个<strong>G白pro</strong>，很舒服的线段轴。（在寝室用也比较优雅，不会被刀）。插轴的时候，轴脚买回来歪了要掰直再插。</p><p>键帽随便买一套好看的就好，只要是PBT的材质。二色工艺的可以透光，不过其实无所谓</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>&lt;萌化&gt;Ubuntu设置启用“嗨多磨!”登录音效</title>
      <link href="/2021/12/2d290da6e095/"/>
      <url>/2021/12/2d290da6e095/</url>
      
        <content type="html"><![CDATA[<h1 id="萌化-Ubuntu设置启用“嗨多磨！”登录音效"><a href="#萌化-Ubuntu设置启用“嗨多磨！”登录音效" class="headerlink" title="[萌化]Ubuntu设置启用“嗨多磨！”登录音效"></a>[萌化]Ubuntu设置启用“嗨多磨！”登录音效</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>はいどうもー！ バーチャルYouTuber【キズナアイ】です！</p></blockquote><p>HAI DOMO！VIRTUAL YOUTUBER KIZUNA AI DESU！</p><p>2021年12月4日，在仅仅5年后的纪念直播上，“虚拟偶像”绊爱亲自宣布了“休眠”的消息。</p><p>（没错，这其实是套着折腾教学的情怀感想回，先咕咕咕）</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MapReduce论文学习</title>
      <link href="/2021/11/df9fd59361b6/"/>
      <url>/2021/11/df9fd59361b6/</url>
      
        <content type="html"><![CDATA[<h1 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h1><h2 id="MapReduce是什么"><a href="#MapReduce是什么" class="headerlink" title="MapReduce是什么"></a>MapReduce是什么</h2><h3 id="Google三驾马车"><a href="#Google三驾马车" class="headerlink" title="Google三驾马车"></a>Google三驾马车</h3><p><img src="https://i.loli.net/2021/11/23/9Rc8LHqpAxMVIlO.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/9Rc8LHqpAxMVIlO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>Google的基础设施有三驾马车，分别是《Google File System》、《Google MapReduce》以及《Google BigTable》</p><p>现代各种优秀的分布式系统实现的本质，都源于那几篇经典的研究和论文。比如非常流行的 Hadoop(HDFS、MapReduce、Hbase)、Spark、Hive，以及国产数据库软件 TiDB、OceanBase 都是参考这几篇经典论文设计的</p><p>三驾马车之间的关系：</p><p><img src="https://i.loli.net/2021/11/23/R7Jo5f38lhzspOb.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/R7Jo5f38lhzspOb.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121031843498"></p><h3 id="MapReduce解决的问题"><a href="#MapReduce解决的问题" class="headerlink" title="MapReduce解决的问题"></a>MapReduce解决的问题</h3><p>谷歌在这为了处理海量的原始数据，已经实现了数以百计的、专用的计算方法。这些计算方法用来处理大量的原始数据。</p><p>2004年谷歌提出了MapReduce, 在此之前谷歌程序员面对的大规模数据集,常常需要编程实现:</p><ol><li>统计某个关键词的现的频率,计算PageRank</li><li>对大规模数据按词频排序</li><li>对多台机器上的文件进行Grep等</li></ol><p>这些工作不可能在一台机器上完成(否则也不能称之为大规模)，要想在可接受的时间内完成运算，只有将这些计算分布在成百上千的主机上,因此谷歌的程序员每次编写代码都需要处理<strong>并行计算,分发数据,处理错误</strong>等问题<strong>。</strong> </p><p>为了解决上述复杂的问题，谷歌设计了一个新的抽象模型，使用这个抽象模型，我们只要表述我们想要执行的简单运算即可，而不必关心并行计算、容错、数据分布、负载均衡等复杂的细节，这些问题都被封装在了一个库里面。</p><p>设计这个抽象模型的灵感来自Lisp和许多其他函数式语言的Map和Reduce的原语，在大多数运算都包含这样的操作：</p><blockquote><p>在输入数据的“逻辑”记录上应用Map操作得出一个中间key&#x2F;value pair集合，然后在所有具有相同key值的value值上应用Reduce操作，从而达到合并中间的数据，得到一个想要的结果的目的。</p></blockquote><p>使用MapReduce模型，再结合用户实现的Map和Reduce函数，我们就可以非常容易的实现大规模并行化计算；通过MapReduce模型自带的“再次执行”（re-execution）功能，也提供了初级的容错实现方案</p><h2 id="MapReduce的架构-x2F-实现"><a href="#MapReduce的架构-x2F-实现" class="headerlink" title="MapReduce的架构&#x2F;实现"></a>MapReduce的架构&#x2F;实现</h2><h3 id="MapReduce编程模型"><a href="#MapReduce编程模型" class="headerlink" title="MapReduce编程模型"></a>MapReduce编程模型</h3><p>例子：WordCount</p><p><img src="https://i.loli.net/2021/11/23/xL5RWGcj82Xgtmw.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/xL5RWGcj82Xgtmw.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121034200807"></p><p>利用一个输入的key&#x2F;value pair集合来产生一个输出的key&#x2F;value pair集合。</p><p>MapReduce库的用户用两个函数表达这个计算：<code>Map</code>和<code>Reduce</code>。</p><p>用户自定义的<code>Map</code>函数接受一个输入的key&#x2F;value pair集合，然后产生一个中间key&#x2F;value pair值的集合。MapReduce库把所有具有相同中间key值I的中间value值集合在一起后传递给<code>Reduce</code>函数。</p><p>用户自定义的<code>Reduce</code>函数接受一个中间key的值<code>I</code>和相关的一个value值的集合。<code>Reduce</code>函数合并这些value值，形成一个较小的value值的集合。通常我们通过一个<strong>迭代器</strong>把中间value值提供给<code>Reduce</code>函数，这样我们就可以处理无法全部放入内存中的大量的value值的集合。</p><p><strong>需要一提的是</strong>：每个Map在结束后，会将输出结果产生为一个中间文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">map(String key, String value):</span><br><span class="line">    // key: document name</span><br><span class="line">    // value: document contents</span><br><span class="line">    for each word w in value:</span><br><span class="line">        EmitIntermediate(w, &quot;I&quot;);</span><br><span class="line"></span><br><span class="line">reduce(String key, Iterator values):</span><br><span class="line">    // key: a word</span><br><span class="line">    // values: a list of counts</span><br><span class="line">    int result = 0;</span><br><span class="line">    for each v in values:</span><br><span class="line">        result += ParseInt(v);</span><br><span class="line">    Emit(AsString(result));      </span><br></pre></td></tr></table></figure><p>用户提供的 <code>Map</code> 函数和 <code>Reduce</code> 函数应有如下类型：</p><p><img src="https://i.loli.net/2021/11/23/6lvurZqicBCeGzK.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/6lvurZqicBCeGzK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121034838623"></p><p><strong>值得注意的是</strong>，在实际的实现中 MapReduce 框架使用 <code>Iterator</code> 来代表作为输入的集合，主要是为了避免集合过大，无法被完整地放入到内存中</p><h3 id="MapReduce的应用"><a href="#MapReduce的应用" class="headerlink" title="MapReduce的应用"></a>MapReduce的应用</h3><p>分布式的Grep：<code>Map</code>函数输出匹配某个<code>pattern</code>的一行，<code>Reduce</code>函数是一个恒等函数，即把中间数据复制到输出。</p><p>计算URL访问频率：<code>Map</code>函数处理日志中web页面请求的记录，然后输出<code>(URL,1)</code>。<code>Reduce</code>函数把相同URL的value值都累加起来，产生<code>(URL,记录总数)</code>结果。</p><p>倒排索引：<code>Map</code>函数分析每个文档输出一个<code>(word,document_id)</code>的列表，<code>Reduce</code>函数的Input是一个<code>word</code>的所有<code>(word，document_id)</code>，排序所有的<code>document_id</code>，输出<code>(word,list(document_id))</code>。所有的输出集合形成一个简单的倒排索引，它以一种简单的算法跟踪词在文档中的位置。</p><p><img src="https://i.loli.net/2021/11/23/j8tIPNxw4TL5CGz.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/j8tIPNxw4TL5CGz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121040558131"></p><h3 id="MapReduce架构"><a href="#MapReduce架构" class="headerlink" title="MapReduce架构"></a>MapReduce架构</h3><p><img src="https://i.loli.net/2021/11/23/CAEVQ8oeYu9IZOR.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/23/CAEVQ8oeYu9IZOR.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211121054502095"></p><ol><li><p>用户程序首先调用 MapReduce 库将输入文件分成M个数据片段，每个数据片段的大小一般从16MB到64MB(可以通过可选的参数来控制每个数据片段的大小)。然后用户程序在机群中创建大量的程序副本。</p></li><li><p>这些程序副本中的有一个特殊的程序：master。副本中其它的程序都是worker程序，由master分配任务。有M个Map任务和R个Reduce任务将被分配，master将一个Map任务或Reduce任务分配给一个空闲的worker。每个worker一项任务</p></li><li><p>被分配了Map任务的worker程序读取相关的输入数据片段，从输入的数据片段中解析出key&#x2F;value pair，然后把key&#x2F;value pair传递给用户自定义的Map函数，由Map函数生成并输出的中间key&#x2F;value pair，并缓存在内存中。</p></li><li><p>缓存中的key&#x2F;value pair通过分区函数分成R个区域，之后周期性的写入到本地磁盘上。缓存的key&#x2F;value pair在本地磁盘上的存储位置将被回传给master，由master负责把这些存储位置再传送给Reduce worker。</p></li><li><p>当Reduce worker程序接收到master程序发来的数据存储位置信息后，使用RPC(Remote Procedure Call：该协议允许运行于一台计算机的程序调用另一个地址空间(通常为一个开放网络的一台计算机)的子程序)从Map worker所在主机的磁盘上读取这些缓存数据。</p><p>当Reduce worker读取了所有的中间数据后，通过<strong>对key进行排序</strong>后使得具有相同key值的数据聚合在一起。<strong>由于许多不同的key值会映射到相同的Reduce任务上，因此必须进行排序</strong>。如果中间数据太大无法在内存中完成排序，那么就要在外部进行排序。</p></li><li><p>Reduce worker程序遍历排序后的数据，对于每一个唯一的key值，Reduce worker程序将这个key值和它相关的value值的集合传递给用户自定义的Reduce函数。Reduce函数的输出被追加到所属分区的输出文件。</p></li><li><p>当所有的Map和Reduce任务都完成之后，master唤醒用户程序。此时，用户程序中的MapReduce调用返回到用户代码中。</p></li></ol><p>在这个过程中：</p><p>master应当维护多种数据结构。它会存储每个map和reduce任务的状态（空闲、处理中、完成），和每台工作机器的ID（对应非空闲的任务）。</p><p>master是将map任务产生的中间文件的位置传递给reduce任务的通道。因此，master要存储每个已完成的map任务产生的R个中间文件的位置和大小。map任务完成时，master会接收到位置和大小的更新信息。这些信息会被逐步发送到正在处理中的reduce任务节点处。</p><h2 id="MapReduce的容错"><a href="#MapReduce的容错" class="headerlink" title="MapReduce的容错"></a>MapReduce的容错</h2><p>因为MapReduce库的设计初衷是使用由成百上千的机器组成的集群来处理超大规模的数据，所以，这个库必须要能很好的处理机器故障。</p><h3 id="worker故障"><a href="#worker故障" class="headerlink" title="worker故障"></a>worker故障</h3><p>如何检测worker的故障？发心跳包。</p><p>master周期性的ping每个worker。如果在一定时间范围内没有收到worker返回的信息，master将把这个worker标记为失效。</p><p>所有由这个失效的worker完成的<strong>Map任务</strong>被重设为初始的空闲状态，之后这些任务就可以被安排给其他的worker。同样的，worker失效时<strong>正在运行的Map或Reduce任务</strong>也将被重新置为空闲状态，等待重新调度。</p><p><strong>值得一提的是</strong>：worker完成的Reduce任务的输出存储在全局文件系统上，因此不需要再次执行。而Map任务的输出存储在worker对应的这台机器上，不可访问。</p><p>当一个Map任务首先被worker A执行，之后由于worker A失效了又被调度到worker B执行，这个“重新执行”的动作会被通知给所有执行Reduce任务的worker。任何还没有从worker A读取数据的Reduce任务将从worker B读取数据</p><p>通过这样的方式，MapReduce可以处理大规模worker失效的情况。</p><h3 id="master故障"><a href="#master故障" class="headerlink" title="master故障"></a>master故障</h3><p>那就寄！</p><p>备份。一个解决办法是让master周期性将其维护的数据写入磁盘，作为checkpoint，当master挂了后可以通过checkpoint来重启master进程。</p><p>但需要考虑到master故障后再恢复比较麻烦，只有一个master进程，Google的实现是当master故障后，让客户检查到这个状态，然后中止运算并重启MapReduce操作。</p><h2 id="MapReduce在实践过程中的优化"><a href="#MapReduce在实践过程中的优化" class="headerlink" title="MapReduce在实践过程中的优化"></a>MapReduce在实践过程中的优化</h2><h3 id="存储位置"><a href="#存储位置" class="headerlink" title="存储位置"></a>存储位置</h3><p>在分布式系统中，网络带宽通常是稀缺资源，很容易成为系统瓶颈。为了减少网络通信，Google通过将输入数据存储在本地磁盘上。</p><ol><li>GFS把每个文件按64MB一个Block分隔，每个Block保存在多台机器上，环境中就存放了多份拷贝(一般是3个拷贝)。MapReduce的master在调度Map任务时会考虑输入文件的位置信息，尽量将一个Map任务调度在包含相关输入数据拷贝的机器上执行</li><li>如果无法实现，就尝试在保存有输入数据拷贝的机器附近的机器上执行Map任务（比如在同一个交换机的机器上执行Map）</li></ol><h3 id="任务粒度"><a href="#任务粒度" class="headerlink" title="任务粒度"></a>任务粒度</h3><p>正常情况下M、R比集群中的worker数量大很多，这样一来在每台worker机器都执行大量的不同任务能够提高集群的负载均衡能力</p><p>但实际情况下，master会执行O(M+R)次调度，并且在内存中保存O(M*R)个状态</p><p>R的值是由用户指定的，而M的值也尽量满足每一个独立任务都是处理大约16M到64M的输入数据，使得上述存储位置的优化最有效</p><p>比如M&#x3D;200000, R&#x3D;5000，使用2000个worker</p><h3 id="备用任务"><a href="#备用任务" class="headerlink" title="备用任务"></a>备用任务</h3><p>在运算过程中，如果有几台机器运行特别慢，会极大影响MapReduce操作的总时间。</p><p>这里有个通用的方法。MapReduce会启用处理中状态(in-progress)的任务的备用任务进程，它和原任务做相同的事情，无论哪个完成了任务，都视为该任务已经完成</p><h3 id="分区函数"><a href="#分区函数" class="headerlink" title="分区函数"></a>分区函数</h3><p>前面说到R的值是由用户指定的，可以通过分区函数对数据分区，比如用<code>hash(key) mod R</code>进行分区，能够让key&#x2F;value pair比较均衡的分给执行Reduce的worker。当输出的key值是URLs，我们希望每个主机的所有条目保持在同一个输出文件中，又可以通过<code>hash(hostname(urlkey)) mod R</code>将所有来自同一个主机的URLs分在一个分区中。</p><h3 id="顺序保证"><a href="#顺序保证" class="headerlink" title="顺序保证"></a>顺序保证</h3><p>我们确保在给定的分区中，中间key&#x2F;value pair数据的处理顺序是按照key值增量顺序处理的。这样的顺序保证对每个分区生成一个有序的输出文件，这对于需要对输出文件按key值随机存取的应用非常有意义。</p><h3 id="合并函数"><a href="#合并函数" class="headerlink" title="合并函数"></a>合并函数</h3><p>比如在进行词频统计时，一些词的出现频率非常的高，这会导致产生例如<code>(I,1)</code>这种key&#x2F;value pair，导致中间文件到同一个Reduce的大小不均衡。</p><p>此时可以通过指定一个可选的combiner函数，combiner函数首先在本地将这些记录进行一次合并，然后将合并的结果再通过网络发送出去。</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>磁盘挂载没有写权限？彻底关闭你的windows快速启动</title>
      <link href="/2021/9/7a37f059971a/"/>
      <url>/2021/9/7a37f059971a/</url>
      
        <content type="html"><![CDATA[<h2 id="win10的快速启动"><a href="#win10的快速启动" class="headerlink" title="win10的快速启动"></a>win10的快速启动</h2><p>我们都知道windows10在“电源管理”处有一个“快速启动”选项，默认情况下他是开启的。</p><p>这会让windows10更快的关闭和启动。在启用该选项时，本质上win10让你的PC执行了部分休眠，事实上，你的windows并没有关机。（即使你长按电源键关机或者手动点击关机）</p><h2 id="快速启动导致的问题"><a href="#快速启动导致的问题" class="headerlink" title="快速启动导致的问题"></a>快速启动导致的问题</h2><p>在双系统下，如果你在某个linux系统上尝试挂载window磁盘，便会出现磁盘只有读权限，而没有写权限。</p><p>尝试<code>umount</code>后重新挂载依然无法获得写权限。</p><p><img src="https://i.loli.net/2021/09/22/mz3ZbgdSGEkxYlj.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/22/mz3ZbgdSGEkxYlj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我早就关闭了“快速启动”选项，但在某一天开始依旧出现了这样的问题，显然我需要一个彻底关闭windows的方法。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>搜索<code>how to shutdown windows fully</code>彻底关机有两种：</p><p>1、点击关机时按住shirt键</p><p>2、使用 <code>shutdown /s /f /t 0</code>进行关机</p><p>全部尝试后依然无效。</p><p>了解到，在关闭快速启动选项之前，休眠文件会由windows创建，你可以在系统磁盘中找到 <code>hiberfil.sys</code>的文件。</p><p>然而在GUI中关闭快速启动选项后，文件并不会由windows删除。（windows为啥设计这种脏操作）</p><p>解决：</p><p>1、在确保有<code>hiberfil.sys</code>文件存在</p><p>2、打开管理员权限的命令行，执行<code>powercfg /h off</code></p><p>3、确保<code>hiberfil.sys</code>文件已经删除，再重新启动即可。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://unix.stackexchange.com/questions/107978/cant-access-windows-drive-windows-is-hibernated-refused-to-mount">https://unix.stackexchange.com/questions/107978/cant-access-windows-drive-windows-is-hibernated-refused-to-mount</a></p><p><a href="https://superuser.com/questions/1010084/windows-is-hibernated-refused-to-mount-but-fast-startup-is-disabled-on-window">https://superuser.com/questions/1010084/windows-is-hibernated-refused-to-mount-but-fast-startup-is-disabled-on-window</a></p><p><a href="https://unix.stackexchange.com/questions/432869/cant-mount-dual-boot-partition-windows-is-hibernated">https://unix.stackexchange.com/questions/432869/cant-mount-dual-boot-partition-windows-is-hibernated</a></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>敏感词过滤实现</title>
      <link href="/2021/7/ac22932d46a9/"/>
      <url>/2021/7/ac22932d46a9/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>需要实现一个基于已有的敏感词库的敏感词过滤的功能</p><h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><h3 id="遍历匹配"><a href="#遍历匹配" class="headerlink" title="遍历匹配"></a>遍历匹配</h3><p>遍历词库的每一个词，匹配后进行过滤（比如把它们全部换成*号）</p><p>字符串匹配比较常见的算法有：</p><ul><li>Brute Force算法</li><li>KMP算法</li><li>Boyer-Moore算法（BM算法）</li></ul><p>当然，用于字符串匹配的算法有非常多，这里不再赘述</p><p><strong>一个敏感词库的词量往往是巨大的，它会远大于需要处理的文本量</strong>，在这种场景下使用遍历匹配的方法显然<strong>不可行</strong></p><h3 id="利用-DFA-算法"><a href="#利用-DFA-算法" class="headerlink" title="利用 DFA 算法"></a>利用 DFA 算法</h3><h4 id="DFA：Deterministic-Finite-Automata-（确定型有穷自动机）"><a href="#DFA：Deterministic-Finite-Automata-（确定型有穷自动机）" class="headerlink" title="DFA：Deterministic Finite Automata （确定型有穷自动机）"></a>DFA：Deterministic Finite Automata （确定型有穷自动机）</h4><p>从一个状态通过一系列的事件转换到另一个状态，即 state -&gt; event -&gt; state。</p><ul><li>确定：状态以及引起状态转换的事件都是可确定的，不存在“意外”。</li><li>有穷：状态以及事件的数量都是可穷举的。</li></ul><p>计算机操作系统中的进程状态与切换可以作为 DFA 算法的一种近似理解</p><p><img src="https://i.loli.net/2021/09/15/4rHS1xYozvfKkOT.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/4rHS1xYozvfKkOT.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>举例：将DFA算法用于匹配关键词</strong></p><p>我们可以将每个文本片段作为状态，例如“匹配关键词”可拆分为“匹”、“匹配”、“ 匹配关”、“匹配关键”和“匹配关键词”五个文本片段。</p><p><img src="https://i.loli.net/2021/09/15/PkS2OrVw5ysxaDc.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/PkS2OrVw5ysxaDc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20210915205452.png"></p><p>过程：</p><ul><li>初始状态为空，当触发事件“匹”时转换到状态“匹”；</li><li>触发事件“配”，转换到状态“匹配”；</li><li>依次类推，直到转换为最后一个状态“匹配关键词”。</li></ul><p>再让我们考虑多个关键词的情况，例如“匹配算法”、“匹)配关键词”以及“信息抽取”。</p><p><img src="https://i.loli.net/2021/09/15/XldZQIhN1EjasFy.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/XldZQIhN1EjasFy.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们可以发现对于关键词匹配，它的状态是一个树形结构，这样我们判断一个词是否为敏感词时就大大减少了检索的匹配范围。</p><p><strong>如何构建图示结构？</strong></p><p> 为了处理整个关键词库，我们可以使用字典（数组、哈希表、balabala…..）</p><p>字典使用 HashTable 实现，因为一个节点的子节点个数未知，而 HashTable 可以动态扩展，而且可以在 O(1) 的时间复杂度内判断某个子节点是否存在</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">state_event_dict = &#123;</span><br><span class="line">    <span class="string">&quot;匹&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;配&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;算&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;法&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;is_end&quot;</span>: <span class="literal">True</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;关&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;键&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;词&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;is_end&quot;</span>: <span class="literal">True</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;信&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;息&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;抽&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;取&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;is_end&quot;</span>: <span class="literal">True</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;is_end&quot;</span>: <span class="literal">False</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用嵌套字典来作为树形结构（这玩意就是Trie 树），<code>key</code> 作为事件，通过<code>is_end</code>字段来判断状态是否为最后一个状态，如果是最后一个状态，则停止状态转换，获取匹配的关键词。</p><p>每一个敏感词都可以看做一个关键词，构建敏感词的时间复杂度是可以忽略不计的，因为构建完成后我们是可以无数次使用的。对于查找敏感词的时间复杂度。如果字符串的长度为 <code>n</code>，而每个敏感词查找的时间复杂度是 <code>O(m)</code>（<code>m</code> 为最长的字符串的长度），我们需要对字符串遍历 <code>n</code>遍，所以查找敏感词的这个过程的时间复杂度为 <code>O(m*n)</code>。用DFA算法能够很好的满足需求。</p><p>缺点：占用的内存和敏感词库的大小成正比。</p><h3 id="为什么不使用正则匹配"><a href="#为什么不使用正则匹配" class="headerlink" title="为什么不使用正则匹配"></a>为什么不使用正则匹配</h3><p>正则表达式引擎有两种：NFA和DFA。我们常常说用正则去匹配文本，这是NFA的思路。</p><p>大多数正则表达式引擎本质是NFA（非确定性有穷自动机）。而NFA由于在匹配时会多次回溯，导致相比于DFA效率低了很多</p><p><strong>为什么正则使用NFA？：</strong></p><h4 id="NFA：Nondeterministic-Final-Auomaton（非确定型有穷自动机）"><a href="#NFA：Nondeterministic-Final-Auomaton（非确定型有穷自动机）" class="headerlink" title="NFA：Nondeterministic Final Auomaton（非确定型有穷自动机）"></a>NFA：Nondeterministic Final Auomaton（非确定型有穷自动机）</h4><p><img src="https://i.loli.net/2021/09/15/VYpGLw1dtZbS3Uj.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/VYpGLw1dtZbS3Uj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>对于正则匹配，同样逐个读入待匹配字符，每读一个字符，即选取多种可能的匹配规则的一种继续匹配，一旦发现匹配失败，则回溯（backtrack）到之前的状态，重新开始尝试新的一种匹配，直至匹配完成</p><h4 id="NFA-vs-DFA"><a href="#NFA-vs-DFA" class="headerlink" title="NFA vs DFA"></a>NFA vs DFA</h4><p><img src="https://i.loli.net/2021/09/15/KZLsoQ2Erbq5p3i.png" class="lazyload" data-srcset="https://i.loli.net/2021/09/15/KZLsoQ2Erbq5p3i.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>正则表达式在计算机看来只是一串符号，正则引擎首先肯定要解析它。NFA引擎只需要编译就好了；而DFA引擎则比较繁琐，编译完还不算，还要遍历出表达式中所有的可能。因为对DFA引擎来说机会只有一次，它必须得提前知道所有的可能，才能匹配出最优的结果</p><p>DFA的时间复杂度是线性的。DFA不记录所有可能的路径，结果是确定的。</p><p>NFA的时间复杂度较不稳定，好坏程度取决于正则表达式的书写与匹配对象的复杂程度。但NFA相较于DFA，它具有更强大的功能。因此，它也成为Java，JavaScript，PHP，Python，Ruby实现正则表达式的方式。NFA匹配结果，基于表达式，它记录所有可能的路径</p><p>正则中的非贪婪模式、反向引用、零宽断言等只有使用NFA引擎才有。因此大部分正则引擎都使用NFA来实现</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/weixin_43378396/article/details/105910145?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162681308016780271543050%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=162681308016780271543050&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-105910145.first_rank_v2_pc_rank_v29&utm_term=dfa%E7%AE%97%E6%B3%95&spm=1018.2226.3001.4187">DFA 算法</a></p><p><a href="https://hooj0.github.io/sensitive-words-filter/">敏感词过滤、脱敏</a></p><p><a href="https://houbb.github.io/2020/01/07/regex-and-dfa-02">Regex 正则表达式原理及如何从零实现</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-dfa">java 实现敏感词过滤</a></p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 敏感词过滤 </tag>
            
            <tag> DFA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CUDA+cuDNN+pytorch GPU环境搭建</title>
      <link href="/2021/5/8432c972721a/"/>
      <url>/2021/5/8432c972721a/</url>
      
        <content type="html"><![CDATA[<h2 id="安装CUDA"><a href="#安装CUDA" class="headerlink" title="安装CUDA"></a>安装CUDA</h2><blockquote><p>安装</p></blockquote><p>首先去英伟达官网下载cuda安装包：<a href="https://developer.nvidia.com/cuda-toolkit-archive">https://developer.nvidia.com/cuda-toolkit-archive</a></p><p><img src="https://i.loli.net/2021/05/19/bx9B3RXCzMOQy8G.png" class="lazyload" data-srcset="https://i.loli.net/2021/05/19/bx9B3RXCzMOQy8G.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="https://i.loli.net/2021/05/19/bx9B3RXCzMOQy8G.png"></p><p><img src="https://i.loli.net/2021/05/19/d2BcPO7DxnWltaN.png" class="lazyload" data-srcset="https://i.loli.net/2021/05/19/d2BcPO7DxnWltaN.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="https://i.loli.net/2021/05/19/d2BcPO7DxnWltaN.png"></p><p><strong>踩坑：这里最好不要使用deb的安装，推荐使用runfile</strong></p><p>我最初在使用deb的安装时，在最后一步</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install cuda</span><br></pre></td></tr></table></figure><p>中，得到了<code>depends: cuda-11-3 (&gt;= 11.3.0) but it is not going to be installed site:forums.developer.nvidia.com</code>的错误，而这个错误并没有得到良好的解决方案。</p><p>我在搜索资料后推测是由于本身已经安装了nvidia-driver所导致的结果，而英伟达的cuda本身已经自带了驱动（这是一件很奇怪的事情）。</p><p>因此我推荐<strong>runfile</strong>的安装，我在此安装成功。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget &lt;https:<span class="comment">//developer.download.nvidia.com/compute/cuda/11.3.0/local_installers/cuda_11.3.0_465.19.01_linux.run&gt;</span></span><br><span class="line">sudo sh cuda_11<span class="number">.3</span><span class="number">.0</span>_465<span class="number">.19</span><span class="number">.01</span>_linux.run</span><br></pre></td></tr></table></figure><p>需要注意的是，在执行<code>sudo sh cuda_11.3.0_465.19.01_linux.run</code>时，最好使用<code>sudo sh cuda_11.3.0_465.19.01_linux.run -no-opengl-libs</code></p><p><strong>cuda</strong>主要有以下参数：</p><ul><li><code>-no-opengl-libs</code>：表示只安装驱动文件，不安装<strong>OpenGL</strong>文件。必需参数，原因同上。注意：不是<code>no-opengl-files</code>。</li><li><code>-uninstall (deprecated)</code>：用于卸载<strong>CUDA Driver</strong>（已废弃）。</li><li><code>-toolkit</code>：表示只安装<strong>CUDA Toolkit</strong>，不安装<strong>Driver</strong>和<strong>Samples</strong></li><li><code>-help</code>：查看更多高级选项。</li></ul><p><strong>安装过程中的坑</strong></p><p>首先会有一个阅读声明，一直滑到底部输入accept即可。我遇到了无法滑到底部的情况，也就是不能输入accpet。</p><p>解决：</p><p>使用<code>init 3</code>关闭图形界面即可。</p><p><strong>选项</strong></p><p>选项<strong>install nvidia accelerated Graphics Driver</strong>,输入<strong>n</strong>，因为我们已经安装了<strong>nvidia</strong>的驱动。</p><p>选项<strong>install the OpenGL libraries</strong>,如果双显卡(集显+独显)选择<strong>n</strong>，如果只有独显可以选择<strong>y</strong>，如果双显卡选择<strong>y</strong>的话，会出现<strong>黑屏</strong>或者<strong>循环登录</strong>的问题，如果加了上面的参数就不会出现这个选项了。</p><p>后面的可以都选择<strong>yes</strong>，最后一个选项我们可以选择<strong>n</strong>,也就是不复制<strong>Samples</strong>，因为安装目录下有<strong>samples</strong>。</p><p>之后install等待安装结束即可</p><p>此时使用<code>startx</code>重新进入图形界面。</p><blockquote><p>配置环境</p></blockquote><p>终端编辑<code>/etc/profile</code>或者<code>.bashrc</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda<span class="number">-11.3</span>/lib64</span><br><span class="line"><span class="keyword">export</span> PATH=$PATH:/usr/local/cuda<span class="number">-11.3</span>/bin</span><br><span class="line"><span class="keyword">export</span> CUDA_HOME=$CUDA_HOME:/usr/local/cuda<span class="number">-11.3</span></span><br></pre></td></tr></table></figure><p>运行<code>source /etc/profile</code>或者<code>source .bashrc</code></p><h2 id="安装cuDNN"><a href="#安装cuDNN" class="headerlink" title="安装cuDNN"></a>安装cuDNN</h2><p><strong>Installing from a Tar File</strong></p><p>1.Navigate to your <cudnnpath> directory containing the cuDNN Tar file.</p><p>2.Unzip the cuDNN package.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf cudnn-9.0-linux-x64-v7.tgz</span><br></pre></td></tr></table></figure><p>3.Copy the following files into the CUDA Toolkit directory, and change the filepermissions.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> cuda/include/cudnn*.h /usr/local/cuda/include <span class="comment">#此处我和官方文档不同</span></span><br><span class="line">sudo <span class="built_in">cp</span> cuda/lib64/libcudnn* /usr/local/cuda/lib64</span><br><span class="line">sudo <span class="built_in">chmod</span> a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*</span><br></pre></td></tr></table></figure><p>使用<code>cat /usr/local/cuda/include/cudnn_version.h | grep CUDNN_MAJOR -A 2</code>可以查看版本</p><p>网上的<code>cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2</code>这个操作显然在官方文档的操作下是不行的。</p><h2 id="安装pytorch"><a href="#安装pytorch" class="headerlink" title="安装pytorch"></a>安装pytorch</h2><p>conda使用一个正确的环境，不然会默认安装在base上</p><p>在 <a href="https://pytorch.org/get-started/locally/">https://pytorch.org/get-started/locally/</a> 选择正确的方案即可，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch torchvision torchaudio cudatoolkit=11.1 -c pytorch -c nvidia</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决ubuntu deepin-wine TIM无法打开文件位置</title>
      <link href="/2021/4/ca7d14eb3e01/"/>
      <url>/2021/4/ca7d14eb3e01/</url>
      
        <content type="html"><![CDATA[<p>这个坑其实比较好理解 打开文件位置,其实是两个步骤: 打开资源管理器–&gt;跳转到指定位置 deepin-tim是在deepin系统上的, deepin的资源管理器是<code>dde-file-manager</code> ubuntu上面可没有这玩意, 所以打不开很正常 所以添加可执行文件<code>dde-file-manager</code>间接打开ubuntu的资源管理器就可以了</p><p>在&#x2F;usr&#x2F;bin&#x2F; 下面创建文件 dde-file-manager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/bin/dde-file-manager</span><br></pre></td></tr></table></figure><p>输入以下命令</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/python3</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.<span class="title function_">system</span>(<span class="string">&#x27;nautilus &quot;&#x27;</span>+sys.<span class="property">argv</span>[<span class="number">2</span>]+<span class="string">&#x27;&quot;&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>nautilus 是ubuntu的资源管理器</li></ul><p>对该文件授权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> +x /usr/bin/dde-file-manager</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> 折腾 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> wine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决jetbrains IDE(Goland)莫名报错: Unresolved reference</title>
      <link href="/2021/4/ed34e8e9b6f3/"/>
      <url>/2021/4/ed34e8e9b6f3/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一觉醒来项目直接爆红，很怪很怪，go mod是没有问题的</p><p>struct全部unresolved reference的错误，但是程序却可以正常运行</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>目前有两种解决方案，这对于jetbrains家的所有IDE都是可行的</p><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>在settings - go - gopath下方勾上 “Index entire gopath”</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/c0404681-7e89-453e-b401-b263d5d75dbc.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/c0404681-7e89-453e-b401-b263d5d75dbc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>在file - invalidate caches中选择invalidate and restart</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/82b2dc87-0434-4fcc-b779-8354c4b3063b.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/82b2dc87-0434-4fcc-b779-8354c4b3063b.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
      
      
      <categories>
          
          <category> 报错 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jetbrains </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决Ubuntu连接华为freebuds3蓝牙耳机失败</title>
      <link href="/2021/4/d33e602069a3/"/>
      <url>/2021/4/d33e602069a3/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>把Ubuntu18扬了后，重装Ubuntu20.04，莫名解决了在Ubuntu18上的一些问题，而耳机和brightness control的坑一直没碰，最近越发感到不能连接蓝牙耳机的不方面，终于解决，记录出来</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>系统：Ubuntu20.04</p><hr><p>在设置-蓝牙中始终连接不上蓝牙耳机</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/%E8%A7%A3%E5%86%B3Ubuntu%E8%BF%9E%E6%8E%A5%E5%8D%8E%E4%B8%BAfreebuds3%E8%93%9D%E7%89%99%E8%80%B3%E6%9C%BA%E5%A4%B1%E8%B4%A5.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/%E8%A7%A3%E5%86%B3Ubuntu%E8%BF%9E%E6%8E%A5%E5%8D%8E%E4%B8%BAfreebuds3%E8%93%9D%E7%89%99%E8%80%B3%E6%9C%BA%E5%A4%B1%E8%B4%A5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>尝试安装<code>blueman</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install blueman</span><br></pre></td></tr></table></figure><p>再打开<code>blueman</code>进行连接</p><p>失败</p><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>控制台重启蓝牙服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service bluetooth restart</span><br></pre></td></tr></table></figure><p>打开蓝牙控制检查工作情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bluetoothctl</span><br><span class="line">show</span><br></pre></td></tr></table></figure><p>将会显示类似内容：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Controller</span> <span class="attr">C8</span>:<span class="attr">B2</span>:9<span class="attr">B</span>:<span class="attr">F3</span>:<span class="attr">BB</span>:<span class="number">27</span> (public)</span><br><span class="line"><span class="title class_">Name</span>: ryao-<span class="title class_">Lenovo</span>-<span class="title class_">Legion</span>-<span class="variable constant_">Y7000P</span>-2020H</span><br><span class="line"><span class="title class_">Alias</span>: ryao-<span class="title class_">Lenovo</span>-<span class="title class_">Legion</span>-<span class="variable constant_">Y7000P</span>-2020H</span><br><span class="line"><span class="title class_">Class</span>: <span class="number">0x001c010c</span></span><br><span class="line"><span class="title class_">Powered</span>: yes</span><br><span class="line"><span class="title class_">Discoverable</span>: yes</span><br><span class="line"><span class="title class_">DiscoverableTimeout</span>: <span class="number">0x00000000</span></span><br><span class="line"><span class="title class_">Pairable</span>: yes</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Message</span> <span class="title class_">Notification</span> <span class="title class_">Se</span>.. (<span class="number">00001133</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: A/V <span class="title class_">Remote</span> <span class="title class_">Control</span>        (0000110e-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="variable constant_">OBEX</span> <span class="title class_">Object</span> <span class="title class_">Push</span>          (<span class="number">00001105</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Message</span> <span class="title class_">Access</span> <span class="title class_">Server</span>     (<span class="number">00001132</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">PnP</span> <span class="title class_">Information</span>           (<span class="number">00001200</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">IrMC</span> <span class="title class_">Sync</span>                 (<span class="number">00001104</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Vendor</span> specific           (<span class="number">00005005</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-0002ee000001)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Headset</span> <span class="variable constant_">AG</span>                (<span class="number">00001112</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: A/V <span class="title class_">Remote</span> <span class="title class_">Control</span> <span class="title class_">Target</span> (0000110c-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Generic</span> <span class="title class_">Attribute</span> <span class="title class_">Profile</span> (<span class="number">00001801</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Phonebook</span> <span class="title class_">Access</span> <span class="title class_">Server</span>   (0000112f-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Audio</span> <span class="title class_">Sink</span>                (0000110b-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Generic</span> <span class="title class_">Access</span> <span class="title class_">Profile</span>    (<span class="number">00001800</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Headset</span>                   (<span class="number">00001108</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="title class_">Audio</span> <span class="title class_">Source</span>              (0000110a-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="attr">UUID</span>: <span class="variable constant_">OBEX</span> <span class="title class_">File</span> <span class="title class_">Transfer</span>        (<span class="number">00001106</span>-<span class="number">0000</span>-<span class="number">1000</span>-<span class="number">8000</span>-00805f9b34fb)</span><br><span class="line"><span class="title class_">Modalias</span>: <span class="attr">usb</span>:v1D6Bp0246d0535</span><br><span class="line"><span class="title class_">Discovering</span>: no</span><br><span class="line"><span class="title class_">Advertising</span> <span class="title class_">Features</span>:</span><br><span class="line"><span class="title class_">ActiveInstances</span>: <span class="number">0x00</span></span><br><span class="line"><span class="title class_">SupportedInstances</span>: <span class="number">0x05</span></span><br><span class="line"><span class="title class_">SupportedIncludes</span>: tx-power</span><br><span class="line"><span class="title class_">SupportedIncludes</span>: appearance</span><br><span class="line"><span class="title class_">SupportedIncludes</span>: local-name</span><br><span class="line"><span class="title class_">SupportedSecondaryChannels</span>: 1M</span><br><span class="line"><span class="title class_">SupportedSecondaryChannels</span>: 2M</span><br><span class="line"><span class="title class_">SupportedSecondaryChannels</span>: <span class="title class_">Coded</span></span><br></pre></td></tr></table></figure><p>如果没有显示，那么蓝牙设备可能有问题，以下操作将不会解决问题</p><p>正常显示，则执行以下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">agent on</span><br><span class="line">default-agent</span><br><span class="line">power on</span><br><span class="line">pairable on</span><br></pre></td></tr></table></figure><p><strong>将设备调至配对模式</strong>，扫描设备</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan on</span><br></pre></td></tr></table></figure><p>显示设备</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devices</span><br></pre></td></tr></table></figure><p>出现类似内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Device 00:0E:0E:16:20:FF 00-0E-0E-16-20-FF</span><br><span class="line">Device 00:0E:0B:16:11:9F ZK#001#104</span><br><span class="line">Device 94:17:00:46:AC:8F Redmi K30 Ultra</span><br><span class="line">Device 10:63:C8:E8:26:DC 10-63-C8-E8-26-DC</span><br><span class="line">Device EC:7E:FC:28:DD:3F Mi Smart Band 4</span><br><span class="line">Device 60:AB:67:79:3D:8D 1432412001的MI 9 SE</span><br><span class="line">Device 00:0E:0B:16:20:FF 00-0E-0B-16-20-FF</span><br><span class="line">Device 46:C9:D5:E7:84:A5 46-C9-D5-E7-84-A5</span><br><span class="line">Device 00:0E:0B:14:F3:08 00-0E-0B-14-F3-08</span><br><span class="line">Device 7C:2A:DB:54:4E:F6 7C-2A-DB-54-4E-F6</span><br><span class="line">Device 9C:6B:72:B0:FB:36 realme X2</span><br><span class="line">Device 00:00:12:44:48:34 ShanghaiTieTaWang</span><br><span class="line">Device 6C:06:D6:2F:A5:C1 FreeBuds 3</span><br></pre></td></tr></table></figure><p>安装<code>pulseaudio-module-bluetooth</code>（如果像我一样pair failed的话）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install pulseaudio-module-bluetooth </span><br><span class="line">pulseaudio -k</span><br><span class="line">pulseaudio --start</span><br></pre></td></tr></table></figure><p>然后连接设备</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trust [MAC_ADDRESS]</span><br><span class="line">pair [MAC_ADDRESS]</span><br><span class="line">connect [MAC_ADDRESS]</span><br></pre></td></tr></table></figure><p>终于成功</p><p>退出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> 折腾 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu踩坑：资源占用情况低但显示仍然卡顿</title>
      <link href="/2021/4/61aa3931e5e3/"/>
      <url>/2021/4/61aa3931e5e3/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>系统：Ubuntu20.04 以及 Ubuntu18.04</p><p>无论是拖动滑动条，还是播放视频，还是切换屏幕都会有间断性的卡顿</p><p>这是一个一直困扰我的问题，以至于我认为是Ubuntu自身的问题，我在Ubuntu的体验上一直不如windows上丝滑，他会有间断性的卡顿，以至于我感觉是帧率太低或者其他的原因</p><h2 id="初步尝试过程"><a href="#初步尝试过程" class="headerlink" title="初步尝试过程"></a>初步尝试过程</h2><p>我怀疑是nvidia驱动的问题，于是我尝试卸载并重新安装nvidia驱动，问题依然没有解决。于是我又更新了Ubuntu内核，但是无效</p><p>那么真的是帧率低吗</p><p>我尝试使用<code>mesa-utils</code>用<code>glxgears</code>来监视帧率，发现能够一直保持在140以上，这显然是不低的。</p><p>我又将nvidia驱动禁用，使用intel集显，但没有改变卡顿问题。</p><p>我将这个问题搁置又拾起了多次</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>在多次搜索之后竟然偶然在csdn上找到了一个相同的问题<a href="https://blog.csdn.net/qq_43334196/article/details/107374390">https://blog.csdn.net/qq_43334196&#x2F;article&#x2F;details&#x2F;107374390</a><br>我发现我也安装了这个所谓的“系统监视器”，安装命令是 <code>sudo apt install indicator-multiload</code></p><p>（所以在你翻到这篇文章后一定不要用它了）</p><p>你在首选项中能找到这样的东西</p><p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/Untitled.png" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/Untitled.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>于是它每次检测的时候你的界面就会卡顿一次，体验非常不好</p><p>于是<strong>卸载</strong>它就行了</p><p><strong>但是我目前依然不清楚卡顿的内部原因，按道理检测系统资源是不会卡顿的，现在我的Ubuntu异常丝滑了</strong></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> 折腾 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用go-cqhttp搭建qqbot</title>
      <link href="/2021/4/2b48558f4b48/"/>
      <url>/2021/4/2b48558f4b48/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>好久没写博客了（同时前几篇也太水了），之前在折腾博客基建，这段时间也搞了一堆东西，虽然有记录，但是没时间整理一下然后写出来，刚好最近没有什么</p><span id="more"></span><p>事，本来想实践一下微信小程序和微信公众号的开发，奈何没有成年，申请不了，于是被打回来写qqbot，本着好玩的目的，但是实践的过程中还是遇到了一些困难，由于缺乏基本认识而踩了一堆坑</p><h2 id="QQ-协议端搭建"><a href="#QQ-协议端搭建" class="headerlink" title="QQ 协议端搭建"></a>QQ 协议端搭建</h2><p>没错，这个东西叫协议端！</p><p>目前比较常见的有：</p><ul><li><a href="https://link.zhihu.com/?target=https://github.com/Mrs4s/go-cqhttp">go-cqhttp</a> (基于 <a href="https://link.zhihu.com/?target=https://github.com/Mrs4s/MiraiGo">MiraiGo</a>)</li><li><a href="https://link.zhihu.com/?target=https://github.com/yyuueexxiinngg/cqhttp-mirai/tree/embedded">cqhttp-mirai-embedded</a></li><li><a href="https://link.zhihu.com/?target=https://github.com/mamoe/mirai">Mirai</a> + <a href="https://link.zhihu.com/?target=https://github.com/yyuueexxiinngg/cqhttp-mirai">cqhttp-mirai</a></li><li><a href="https://link.zhihu.com/?target=https://github.com/mamoe/mirai">Mirai</a> + <a href="https://link.zhihu.com/?target=https://github.com/iTXTech/mirai-native">Mirai Native</a> + <a href="https://link.zhihu.com/?target=https://github.com/richardchien/coolq-http-api">CQHTTP</a></li><li><a href="https://link.zhihu.com/?target=https://github.com/takayama-lily/onebot">OICQ-http-api</a> (基于 <a href="https://link.zhihu.com/?target=https://github.com/takayama-lily/oicq">OICQ</a>)</li><li><em>酷Q (已停止开发)</em></li></ul><p>（来自知乎）</p><p>我这里采用go-cqhttp，采用其他的基本也相同，最重要的是要基于onebot标准</p><p>关于如何搭建可以看<a href="https://docs.go-cqhttp.org/guide/">文档</a></p><p>首先编写<code>config.hjson</code>文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">    go-cqhttp 默认配置文件</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    // QQ号</span><br><span class="line">    uin: 0</span><br><span class="line">    // QQ密码</span><br><span class="line">    password: &quot;&quot;</span><br><span class="line">    // 是否启用密码加密</span><br><span class="line">    encrypt_password: false</span><br><span class="line">    // 加密后的密码, 如未启用密码加密将为空, 请勿随意修改.</span><br><span class="line">    password_encrypted: &quot;&quot;</span><br><span class="line">    // 是否启用内置数据库</span><br><span class="line">    // 启用将会增加10-20MB的内存占用和一定的磁盘空间</span><br><span class="line">    // 关闭将无法使用 撤回 回复 get_msg 等上下文相关功能</span><br><span class="line">    enable_db: true</span><br><span class="line">    // 访问密钥, 强烈推荐在公网的服务器设置</span><br><span class="line">    access_token: &quot;&quot;</span><br><span class="line">    // 重连设置</span><br><span class="line">    relogin: &#123;</span><br><span class="line">        // 是否启用自动重连</span><br><span class="line">        // 如不启用掉线后将不会自动重连</span><br><span class="line">        enabled: true</span><br><span class="line">        // 重连延迟, 单位秒</span><br><span class="line">        relogin_delay: 3</span><br><span class="line">        // 最大重连次数, 0为无限制</span><br><span class="line">        max_relogin_times: 0</span><br><span class="line">    &#125;</span><br><span class="line">    // API限速设置</span><br><span class="line">    // 该设置为全局生效</span><br><span class="line">    // 原 cqhttp 虽然启用了 rate_limit 后缀, 但是基本没插件适配</span><br><span class="line">    // 目前该限速设置为令牌桶算法, 请参考: </span><br><span class="line">    // https://baike.baidu.com/item/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95/6597000?fr=aladdin</span><br><span class="line">    _rate_limit: &#123;</span><br><span class="line">        // 是否启用限速</span><br><span class="line">        enabled: false</span><br><span class="line">        // 令牌回复频率, 单位秒</span><br><span class="line">        frequency: 1</span><br><span class="line">        // 令牌桶大小</span><br><span class="line">        bucket_size: 1</span><br><span class="line">    &#125;</span><br><span class="line">    // 是否忽略无效的CQ码</span><br><span class="line">    // 如果为假将原样发送</span><br><span class="line">    ignore_invalid_cqcode: false</span><br><span class="line">    // 是否强制分片发送消息</span><br><span class="line">    // 分片发送将会带来更快的速度</span><br><span class="line">    // 但是兼容性会有些问题</span><br><span class="line">    force_fragmented: false</span><br><span class="line">    // 心跳频率, 单位秒</span><br><span class="line">    // -1 为关闭心跳</span><br><span class="line">    heartbeat_interval: 0</span><br><span class="line">    // HTTP设置</span><br><span class="line">    http_config: &#123;</span><br><span class="line">        // 是否启用正向HTTP服务器</span><br><span class="line">        enabled: true</span><br><span class="line">        // 服务端监听地址</span><br><span class="line">        host: 127.0.0.1</span><br><span class="line">        // 服务端监听端口</span><br><span class="line">        port: 22333</span><br><span class="line">        // 反向HTTP超时时间, 单位秒</span><br><span class="line">        // 最小值为5，小于5将会忽略本项设置</span><br><span class="line">        timeout: 0</span><br><span class="line">        // 反向HTTP POST地址列表</span><br><span class="line">        // 格式: </span><br><span class="line">        // &#123;</span><br><span class="line">        //    地址: secret</span><br><span class="line">        // &#125;</span><br><span class="line">        post_urls:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 正向WS设置</span><br><span class="line">    ws_config: &#123;</span><br><span class="line">        // 是否启用正向WS服务器</span><br><span class="line">        enabled: false</span><br><span class="line">        // 正向WS服务器监听地址</span><br><span class="line">        host: 127.0.0.1</span><br><span class="line">        // 正向WS服务器监听端口</span><br><span class="line">        port: 6700</span><br><span class="line">    &#125;</span><br><span class="line">    // 反向WS设置</span><br><span class="line">    ws_reverse_servers: [</span><br><span class="line">        // 可以添加多个反向WS推送</span><br><span class="line">        &#123;</span><br><span class="line">            // 是否启用该推送</span><br><span class="line">            enabled: true</span><br><span class="line">            // 反向WS Universal 地址</span><br><span class="line">            // 注意 设置了此项地址后下面两项将会被忽略</span><br><span class="line">            // 留空请使用 &quot;&quot;</span><br><span class="line">            reverse_url: ws://127.0.0.1:22334/</span><br><span class="line">            // 反向WS API 地址</span><br><span class="line">            reverse_api_url: ws://you_websocket_api.server</span><br><span class="line">            // 反向WS Event 地址</span><br><span class="line">            reverse_event_url: ws://you_websocket_event.server</span><br><span class="line">            // 重连间隔 单位毫秒</span><br><span class="line">            reverse_reconnect_interval: 3000</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    // 上报数据类型</span><br><span class="line">    // 可选: string array</span><br><span class="line">    post_message_format: string</span><br><span class="line">    // 是否使用服务器下发的新地址进行重连</span><br><span class="line">    // 注意, 此设置可能导致在海外服务器上连接情况更差</span><br><span class="line">    use_sso_address: false</span><br><span class="line">    // 是否启用 DEBUG</span><br><span class="line">    debug: false</span><br><span class="line">    // 日志等级 trace,debug,info,warn,error</span><br><span class="line">    log_level: &quot;info&quot;</span><br><span class="line">    // WebUi 设置</span><br><span class="line">    web_ui: &#123;</span><br><span class="line">        // 是否启用 WebUi</span><br><span class="line">        enabled: false</span><br><span class="line">        // 监听地址</span><br><span class="line">        host: 127.0.0.1</span><br><span class="line">        // 监听端口</span><br><span class="line">        web_ui_port: 9999</span><br><span class="line">        // 是否接收来自web的输入</span><br><span class="line">        web_input: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>./go-cqhttp</code>运行后需要进行滑块认证，在浏览器抓取<code>cap_union_new_verify</code> 的返回值，然后把ticket的值输入就行了。</p><p>此时协议端搭建完毕</p><p><strong>注：记得iptable开放相应端口</strong></p><h2 id="后端搭建"><a href="#后端搭建" class="headerlink" title="后端搭建"></a>后端搭建</h2><h3 id="一、使用机器人框架"><a href="#一、使用机器人框架" class="headerlink" title="一、使用机器人框架"></a>一、使用机器人框架</h3><p>不得不说python的nonebot和nonebot2实在是太方便了，文档也十分详细。</p><p>如果你只是想要一个qqbot，推荐使用以上两个框架，大概几个小时就能实现一个bot</p><p>如果你想用go来写，也可以用<a href="https://github.com/wdvxdr1123/ZeroBot">ZeroBot</a>来作为你的框架</p><h3 id="二、写后端来调用协议"><a href="#二、写后端来调用协议" class="headerlink" title="二、写后端来调用协议"></a>二、写后端来调用协议</h3><p>虽然框架很好用（单指python的库）</p><p>但由于觉得好玩，我还是头铁地使用了go来开发</p><p>找不到真正合适的go开发框架，于是自己写websocket来对接</p><p>go websocket的使用请自行学习，这里简单描述搭建服务的过程，细节可以参考我的代码部分<a href="https://github.com/RyaoChengfeng/rinqqbot/blob/main/controller/ws.go">https://github.com/RyaoChengfeng/rinqqbot/blob/main/controller/ws.go</a></p><ul><li>http监听ws反向端口<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">controller.StartWebsocket()  </span><br><span class="line">err:= http.ListenAndServe(config.Addr+<span class="string">`:`</span>+config.WsPort,<span class="literal">nil</span>)  </span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line"> fmt.Println(err)  </span><br><span class="line"> os.Exit(<span class="number">1</span>)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>将http升级为ws并启动ws<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> wsConnection <span class="keyword">struct</span> &#123;  </span><br><span class="line"> wsSocket *websocket.Conn <span class="comment">// 底层websocket  </span></span><br><span class="line"> inChan   <span class="keyword">chan</span> *wsMessage <span class="comment">// 读队列  </span></span><br><span class="line"> outChan  <span class="keyword">chan</span> *wsMessage <span class="comment">// 写队列  </span></span><br><span class="line">  </span><br><span class="line"> mutex     sync.Mutex <span class="comment">// 避免重复关闭管道,加锁处理  </span></span><br><span class="line"> isClosed  <span class="type">bool</span>  </span><br><span class="line"> closeChan <span class="keyword">chan</span> <span class="type">byte</span> <span class="comment">// 关闭通知  </span></span><br><span class="line"> id        <span class="type">int64</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> upgrader = websocket.Upgrader&#123;  </span><br><span class="line"> ReadBufferSize:  <span class="number">1024</span>,  </span><br><span class="line"> WriteBufferSize: <span class="number">1024</span>,  </span><br><span class="line"> <span class="comment">// 允许所有的CORS 跨域请求，正式环境可以关闭  </span></span><br><span class="line"> CheckOrigin: <span class="function"><span class="keyword">func</span><span class="params">(r *http.Request)</span></span> <span class="type">bool</span> &#123;  </span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span>  </span><br><span class="line"> &#125;,  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StartWebsocket</span><span class="params">()</span></span> &#123;  </span><br><span class="line"> WsConnAll = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int64</span>]*wsConnection)  </span><br><span class="line"> http.HandleFunc(<span class="string">&quot;/&quot;</span>, wsHandler)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wsHandler</span><span class="params">(rsp http.ResponseWriter, req *http.Request)</span></span> &#123;  </span><br><span class="line"> <span class="comment">// 应答客户端告知升级连接为websocket  </span></span><br><span class="line"> wsSocket, err := upgrader.Upgrade(rsp, req, <span class="literal">nil</span>)  </span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line"> log.Logger.Error(<span class="string">&quot;升级为websocket失败&quot;</span>, err.Error())  </span><br><span class="line"> &#125; maxConnId++  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">// 连接数保持一定数量，超过的部分不提供服务  </span></span><br><span class="line"> <span class="comment">// 如果要控制连接数可以计算WsConnAll长度 len(WsConnAll) wsConn := &amp;wsConnection&#123;  </span></span><br><span class="line"> wsSocket:  wsSocket,  </span><br><span class="line"> inChan:    <span class="built_in">make</span>(<span class="keyword">chan</span> *wsMessage, <span class="number">1000</span>),  </span><br><span class="line"> outChan:   <span class="built_in">make</span>(<span class="keyword">chan</span> *wsMessage, <span class="number">1000</span>),  </span><br><span class="line"> closeChan: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">byte</span>),  </span><br><span class="line"> isClosed:  <span class="literal">false</span>,  </span><br><span class="line"> id:        maxConnId,  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> WsConnAll[maxConnId] = wsConn  </span><br><span class="line">   <span class="comment">// 处理器,发送定时信息，避免意外关闭  </span></span><br><span class="line"> <span class="keyword">go</span> processLoop(wsConn)  </span><br><span class="line"> <span class="comment">// 读协程  </span></span><br><span class="line"> <span class="keyword">go</span> wsReadLoop(wsConn)  </span><br><span class="line"> <span class="comment">// 写协程  </span></span><br><span class="line"> <span class="keyword">go</span> wsWriteLoop(wsConn)  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>在多线程中处理协议端发来的message，并提取信息进行调用协议端api<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">err = json.Unmarshal(msg.data, &amp;msgData)  </span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line"> log.Logger.Error(<span class="string">&quot;json信息解析错误&quot;</span>, err.Error())  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//log.Logger.Debug(&quot;收到消息：&quot;,msgData)  </span></span><br><span class="line">HandleWsMsg(msgData)</span><br></pre></td></tr></table></figure></li><li>在<code>HandleWsMsg</code>中进行bot功能实现<br>message结构请参考对应的协议文档，以及基于onebot标准的协议的onebot标准，具体参考下方链接</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://docs.go-cqhttp.org/">go-cqhttp文档</a>  </li><li><a href="https://github.com/howmanybots/onebot/blob/master/v11/specs/README.md">Onebot标准</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> go </tag>
            
            <tag> qqbot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-1-链表</title>
      <link href="/2020/12/2fb9b06514d1/"/>
      <url>/2020/12/2fb9b06514d1/</url>
      
        <content type="html"><![CDATA[<h3 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h3><p>指针大法好</p><p>真正到学习数据结构的时候才发现自己对指针的特性理解得非常肤浅，在真正使用链表的时候卡了很久</p><hr><blockquote><p>  核心</p></blockquote><p>增</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">p-&gt;data=*data++; <span class="comment">//data为数据集合</span></span><br><span class="line">p-&gt;next=L-&gt;next;</span><br><span class="line">L-&gt;next=p;</span><br></pre></td></tr></table></figure><p>删</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Link *q;</span><br><span class="line">q=p-&gt;next;</span><br><span class="line">p-&gt;next=q-&gt;next;</span><br><span class="line"><span class="built_in">free</span>(q);</span><br></pre></td></tr></table></figure><p>查</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e=p-&gt;data; <span class="comment">//e为节点data</span></span><br></pre></td></tr></table></figure><p>插</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Link *s;</span><br><span class="line">s=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Link));</span><br><span class="line">s-&gt;data=e; <span class="comment">//e为节点data</span></span><br><span class="line">s-&gt;next=p-&gt;next;</span><br><span class="line">p-&gt;next=s;</span><br></pre></td></tr></table></figure><blockquote><p>  实现</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> Elemtype;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    Elemtype data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> <span class="title">Link</span>;</span></span><br><span class="line"></span><br><span class="line">Link **head;</span><br><span class="line">Link **tail;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先进后出link</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">d_CreateLink</span><span class="params">(Link **L,Elemtype data[],<span class="type">int</span> n)</span>&#123;</span><br><span class="line">    Link *p;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    *L=(Link *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">    (*L)-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        p-&gt;data=*data++;</span><br><span class="line">        p-&gt;next=(*L)-&gt;next;</span><br><span class="line">        (*L)-&gt;next=p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//先进先出link</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">CreateLink</span><span class="params">(Link **L,Elemtype data[],<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    Link *p,*r;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    *L=(Link *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">    r=*L;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        p-&gt;data=*data++;</span><br><span class="line">        r-&gt;next=p;</span><br><span class="line">        r=p;</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增量式单链表（正序）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">AddLink</span><span class="params">(Link **L,Elemtype data[],<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    Link *p,*r;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">if</span> (tail!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        r=*tail;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        *L=(Link *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        r=*L;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        p=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (Link));</span><br><span class="line">        p-&gt;data=*data++;</span><br><span class="line">        r-&gt;next=p;</span><br><span class="line">        r=p;</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">    *tail=r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到第i个节点的data</span></span><br><span class="line">Elemtype <span class="title function_">GetElem</span><span class="params">(Link *L,<span class="type">int</span> i,Elemtype e)</span>&#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    Link *p;</span><br><span class="line">    p=L-&gt;next;</span><br><span class="line">    j=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p&amp;&amp;j&lt;i)&#123;</span><br><span class="line">        p=p-&gt;next;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!p||j&gt;i)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    e=p-&gt;data;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在第i个节点之前插入新的node，L长度+1</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InsertElem</span><span class="params">(Link *L,<span class="type">int</span> i,Elemtype e)</span>  &#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    Link *p,*s;</span><br><span class="line">    p=L;</span><br><span class="line">    j=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p&amp;&amp;j&lt;i)&#123;</span><br><span class="line">        p=p-&gt;next;</span><br><span class="line">        ++j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!p||j&gt;i) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s=(Link*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Link));</span><br><span class="line">    s-&gt;data=e;</span><br><span class="line">    s-&gt;next=p-&gt;next;</span><br><span class="line">    p-&gt;next=s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Elemtype <span class="title function_">DeleteElem</span><span class="params">(Link *L,<span class="type">int</span> i,Elemtype e)</span>&#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    Link *p,*q;</span><br><span class="line">    p=L;</span><br><span class="line">    j=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p-&gt;next&amp;&amp;j&lt;i)&#123;</span><br><span class="line">        p=p-&gt;next;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!(p-&gt;next)||j&gt;i)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    q=p-&gt;next;</span><br><span class="line">    p-&gt;next=q-&gt;next;</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 线性表 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法题解(3)-贪心</title>
      <link href="/2020/12/0980416f6804/"/>
      <url>/2020/12/0980416f6804/</url>
      
        <content type="html"><![CDATA[<h4 id="P2240-【深基12-例1】部分背包问题"><a href="#P2240-【深基12-例1】部分背包问题" class="headerlink" title="P2240 【深基12.例1】部分背包问题"></a>P2240 【深基12.例1】部分背包问题</h4><p>好像只是数学问题，用单位价格排出性价比，取从大到小直到装满就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">mon</span>&#123;</span><br><span class="line">    <span class="type">int</span> w,v;</span><br><span class="line">    <span class="type">double</span> bili;</span><br><span class="line">&#125;money[<span class="number">110</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(mon *a,mon *b)</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> t=a-&gt;bili;</span><br><span class="line">    a-&gt;bili=b-&gt;bili;</span><br><span class="line">    b-&gt;bili=t;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> d=a-&gt;w;</span><br><span class="line">    a-&gt;w=b-&gt;w;</span><br><span class="line">    b-&gt;w=d;</span><br><span class="line"></span><br><span class="line">    d=a-&gt;v;</span><br><span class="line">    a-&gt;v=b-&gt;v;</span><br><span class="line">    b-&gt;v=d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(mon arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">nullptr</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">double</span> pivot = arr[<span class="built_in">rand</span>() % len].bili;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i].bili &gt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &gt; arr[i].bili)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,bag;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;bag);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;money[i].w,&amp;money[i].v);</span><br><span class="line">        <span class="keyword">if</span> (money[i].w==<span class="number">0</span>) money[i].bili=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> money[i].bili=<span class="number">1.0</span>*money[i].v/money[i].w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(money,n);</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (bag&gt;=money[i].w)&#123;</span><br><span class="line">        bag-=money[i].w;</span><br><span class="line">        sum+=money[i].v;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    sum+=bag*money[i].bili;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf&quot;</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P1090合并果子"><a href="#P1090合并果子" class="headerlink" title="P1090合并果子"></a>P1090合并果子</h4><p>刚看到题目心想，这不就是个数学题嘛，排完序一个个加起来就好了，然后配合官方巨水的样例测一下后，一下就提交了。</p><p>之后陷入了疯狂tl和wa的窘境。</p><p>思路如下，要得到最小的花费体力值，先将原数据排序，再将其放到for中进行循环过程来加出sum的值，每次将父列的第一个加到第二个后都要再排一次序来得到新子列，这样才能保证最小</p><p>所以在里面用一个时间复杂度低的插入排序就可以解决问题</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> pivot = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &lt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shell_sort</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> h = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &lt; length / <span class="number">3</span>) &#123;</span><br><span class="line">        h = <span class="number">3</span> * h + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &gt;= h &amp;&amp; arr[j] &lt; arr[j - h]; j -= h) &#123;</span><br><span class="line">                <span class="built_in">swap</span>(&amp;arr[j], &amp;arr[j - h]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        h = h / <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">int</span> guo[n+<span class="number">5</span>];</span><br><span class="line">    guo[n]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;guo[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> tili;</span><br><span class="line">    <span class="built_in">quick_sort</span>(guo,n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">shell_sort</span>((guo+i),n-i);</span><br><span class="line">        tili=<span class="number">0</span>;</span><br><span class="line">        tili+=(guo[i+<span class="number">1</span>]+guo[i]);</span><br><span class="line">        guo[i+<span class="number">1</span>]+=guo[i];</span><br><span class="line">        sum+=tili;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P1223-排队接水"><a href="#P1223-排队接水" class="headerlink" title="P1223 排队接水"></a>P1223 排队接水</h4><p>本是是很简单问题，莫名出了错</p><p>思路是先排序，再把时间加起来，再求平均就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">per</span> &#123;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">int</span> time;</span><br><span class="line">&#125;person[<span class="number">2000</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(per *a,per *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=a-&gt;time;</span><br><span class="line">    a-&gt;time=b-&gt;time;</span><br><span class="line">    b-&gt;time=t;</span><br><span class="line"></span><br><span class="line">    t=a-&gt;index;</span><br><span class="line">    a-&gt;index=b-&gt;index;</span><br><span class="line">    b-&gt;index=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(per arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> pivot = arr[<span class="built_in">rand</span>() % len].time;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i].time &lt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &lt; arr[i].time)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        person[i].index=i+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;person[i].time);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(person,n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,person[i].index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> shijian=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        shijian+=person[i].time;</span><br><span class="line">        sum+=shijian;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>,<span class="number">1.0</span>*sum/n);</span><br><span class="line">    <span class="comment">//?????我卡了半天,后面的1.0*sum/n是原本就有的,sum是int类型。</span></span><br><span class="line">    <span class="comment">//然后本是int的sum变成double,去掉了1.0,就又过了两个，但是第一个却过不了。</span></span><br><span class="line">    <span class="comment">//把1.0加上，就全部过了。离谱</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 贪心 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法题解(2)-二分</title>
      <link href="/2020/12/4cd8ae11fe0e/"/>
      <url>/2020/12/4cd8ae11fe0e/</url>
      
        <content type="html"><![CDATA[<h4 id="洛谷P1873-砍树"><a href="#洛谷P1873-砍树" class="headerlink" title="洛谷P1873 砍树"></a>洛谷P1873 砍树</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(a, b) a&gt;b?a:b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN(a, b) a&gt;b?b:a</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> N, M, mid, length;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld %lld&quot;</span>, &amp;N, &amp;M);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> l = <span class="number">0</span>, s = <span class="number">1000000000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> height[N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;height[i]);</span><br><span class="line">        l = <span class="built_in">MAX</span>(height[i], l);</span><br><span class="line">        s = <span class="built_in">MIN</span>(height[i], s);</span><br><span class="line">    &#125;</span><br><span class="line">    mid = s + ((l - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (s + <span class="number">1</span> &lt; l) &#123;</span><br><span class="line">        length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mid &lt; height[i]) length += height[i] - mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (length &gt;= M) &#123;</span><br><span class="line">            s = mid;</span><br><span class="line">            mid = s + ((l - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            l = mid;</span><br><span class="line">            mid = s + ((l - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, mid);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P2249-【深基13-例1】查找"><a href="#洛谷P2249-【深基13-例1】查找" class="headerlink" title="洛谷P2249 【深基13.例1】查找"></a>洛谷P2249 【深基13.例1】查找</h4><p>就是写二分，但是要注意输出最左边，也就是最小的，怎么找出左边界需要想一下（于是我一直wa</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> len, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = len;</span><br><span class="line">    <span class="type">int</span> mid;</span><br><span class="line">    <span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">        mid =l + (r-l)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (arr[mid] &lt; value)</span><br><span class="line">            l = mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (arr[l]==value)</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="type">int</span> number[n+<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;number[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;value);</span><br><span class="line">        index=<span class="built_in">find</span>(number,n,value);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1678-烦恼的高考志愿"><a href="#洛谷P1678-烦恼的高考志愿" class="headerlink" title="洛谷P1678 烦恼的高考志愿"></a>洛谷P1678 烦恼的高考志愿</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">min</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> min;</span><br><span class="line">    <span class="keyword">if</span> (a&lt;b)min=a;</span><br><span class="line">    <span class="keyword">else</span> min=b;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="type">int</span> school[n+<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;school[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    std::<span class="built_in">sort</span>(school,school+n);</span><br><span class="line">    <span class="type">int</span> stu[m+<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;stu[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> l=<span class="number">0</span>,r=n;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">            <span class="type">int</span> mid=(l+r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(school[mid]&lt;=stu[i])&#123;</span><br><span class="line">                l=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                r=mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stu[i]&lt;=school[<span class="number">0</span>])&#123;</span><br><span class="line">            sum+=school[<span class="number">0</span>]-stu[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            sum+=<span class="built_in">min</span>(<span class="built_in">abs</span>(school[l<span class="number">-1</span>]-stu[i]),<span class="built_in">abs</span>(school[l]-stu[i]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P2440-木材加工"><a href="#P2440-木材加工" class="headerlink" title="P2440 木材加工"></a>P2440 木材加工</h4><p>和砍树问题的思路一样，另写一个函数来判断是否符合要求，然后用二分法确定最大的值即可</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> n, k;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> a[<span class="number">1000005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">jd</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        sum += a[i] / x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum&gt;=k)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> l = <span class="number">0</span>, r = <span class="number">100000001</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> mid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (l + <span class="number">1</span> &lt; r) &#123;</span><br><span class="line">        mid = l+(r-l)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">jd</span>(mid)) &#123;</span><br><span class="line">            l = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,l);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="P2678-跳石头"><a href="#P2678-跳石头" class="headerlink" title="P2678 跳石头"></a>P2678 跳石头</h4><p>同样的二分套路，这里定义了所在石头和下一个石头，mid大于间距时，将石头搬走，同时计数，mid小与或等于间距时，进入下一个石头。当搬走的总数要小于预计的数目时，证明mid偏小，将left右移，否则right左移，最终得到正确的mid。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> num[<span class="number">100000</span>];</span><br><span class="line"><span class="type">long</span> l,n,m,dis=<span class="number">0</span>,first=<span class="number">0</span>,end;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">jd</span><span class="params">(<span class="type">long</span> mid)</span></span>&#123;</span><br><span class="line">    <span class="type">long</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> temp=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= n)&#123;</span><br><span class="line">        first=num[temp];</span><br><span class="line">        end=num[i];</span><br><span class="line">        dis=end-first;</span><br><span class="line">        <span class="keyword">if</span> (dis&lt;mid)&#123;</span><br><span class="line">            sum++;</span><br><span class="line">        &#125; <span class="keyword">else</span> temp=i;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum&lt;=m)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%ld%ld%ld&quot;</span>,&amp;l,&amp;n,&amp;m);</span><br><span class="line">    num[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%ld&quot;</span>,&amp;num[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> left=<span class="number">0</span>,right=l,mid,rst;</span><br><span class="line">    <span class="keyword">while</span> (left&lt;=right)&#123;</span><br><span class="line">        mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">jd</span>(mid))&#123;</span><br><span class="line">            rst=mid;</span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> right=mid<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%ld&quot;</span>,rst);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 二分查找 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法题解(1)-排序</title>
      <link href="/2020/12/a7d68e1b79ca/"/>
      <url>/2020/12/a7d68e1b79ca/</url>
      
        <content type="html"><![CDATA[<h3 id="排序（c-）"><a href="#排序（c-）" class="headerlink" title="排序（c++）"></a>排序（c++）</h3><p>虽然是c++，其实是c语法</p><h4 id="洛谷P1271-选举学生会"><a href="#洛谷P1271-选举学生会" class="headerlink" title="洛谷P1271 选举学生会"></a>洛谷P1271 选举学生会</h4><p>已经得知了数据范围，使用桶排序</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">    <span class="type">int</span> bucket[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n+<span class="number">1</span>; ++i) &#123;</span><br><span class="line">        bucket[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">        bucket[num] += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n+<span class="number">1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; bucket[i]; ++j) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1923-找出第k小的数"><a href="#洛谷P1923-找出第k小的数" class="headerlink" title="洛谷P1923 找出第k小的数"></a>洛谷P1923 找出第k小的数</h4><p>练习快排和分治</p><p>判断排序后两边数组长度，选择一边进行递归</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意题目中最小数序号是0</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findi_quicksort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len,<span class="type">int</span> index)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len&lt;=<span class="number">1</span>) <span class="keyword">return</span> arr[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> temp = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,k=len;</span><br><span class="line">    <span class="keyword">while</span> (i&lt;k)&#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; temp)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (temp &lt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index&lt;j) <span class="keyword">return</span> <span class="built_in">findi_quicksort</span>(arr, j,index);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (index&gt;=k) <span class="keyword">return</span> <span class="built_in">findi_quicksort</span>(arr + k, len - k,index-k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,i;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;i);</span><br><span class="line">    <span class="type">int</span> number[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;number[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">findi_quicksort</span>(number,n,i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1059-明明的随机数"><a href="#洛谷P1059-明明的随机数" class="headerlink" title="洛谷P1059 明明的随机数"></a>洛谷P1059 明明的随机数</h4><p>数据范围不大，可以用桶排序</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> bucket[<span class="number">1001</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> number;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> &amp;i : bucket) &#123;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;number);</span><br><span class="line">        bucket[number]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1001</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bucket[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1001</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bucket[i] &gt; <span class="number">0</span>) &#123; </span><br><span class="line">            count++;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr>P1059重新想了一下，也可以用快排<p>排序完后检测重复然后跳过就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>*a,<span class="type">int</span>*b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quicksort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len&lt;=<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> temp = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,k=len;</span><br><span class="line">    <span class="keyword">while</span> (i&lt;k)&#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i]&lt;temp)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i],&amp;arr[j]);</span><br><span class="line">            j++;</span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(temp&lt;arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i],&amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;</span><br><span class="line">        &#125; <span class="keyword">else</span> i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(arr,j);</span><br><span class="line">    <span class="built_in">quicksort</span>(arr+k,len-k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">int</span> number[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;number[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    number[n+<span class="number">1</span>]=<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">quicksort</span>(number,n);</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="keyword">if</span> (number[i]==number[i+<span class="number">1</span>]) cnt--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (number[i] != number[i + <span class="number">1</span>]) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, number[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1093-奖学金"><a href="#洛谷P1093-奖学金" class="headerlink" title="洛谷P1093 奖学金"></a>洛谷P1093 奖学金</h4><p>结构体排序问题，挺有收获的，语法和算法方面。</p><p>先用快排排好结构体。注意写对swap函数</p><p>然后用冒泡排序的思想排出2,3条件即可</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">stu</span> &#123;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">int</span> cn, mh, en;</span><br><span class="line">    <span class="type">int</span> sum;</span><br><span class="line">&#125; student[<span class="number">310</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为什么用位运算交换就会错？</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(stu *a, stu *b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t=a-&gt;sum;</span><br><span class="line">    a-&gt;sum=b-&gt;sum;</span><br><span class="line">    b-&gt;sum=t;</span><br><span class="line"></span><br><span class="line">    t=a-&gt;cn;</span><br><span class="line">    a-&gt;cn=b-&gt;cn;</span><br><span class="line">    b-&gt;cn=t;</span><br><span class="line"></span><br><span class="line">    t=a-&gt;index;</span><br><span class="line">    a-&gt;index=b-&gt;index;</span><br><span class="line">    b-&gt;index=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quicksort</span><span class="params">(stu arr[], <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>) <span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> temp = arr[<span class="built_in">rand</span>() % len ].sum;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i].sum &gt; temp) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (temp &gt; arr[i].sum) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k - <span class="number">1</span>]);</span><br><span class="line">            k--;</span><br><span class="line">        &#125; <span class="keyword">else</span> i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quicksort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        student[i].index = i + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;student[i].cn, &amp;student[i].mh, &amp;student[i].en);</span><br><span class="line">        student[i].sum = student[i].cn + student[i].en + student[i].mh;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(student, n);</span><br><span class="line">    <span class="type">int</span> in = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (in == <span class="number">0</span>) &#123;</span><br><span class="line">        in = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (student[i].sum == student[i + <span class="number">1</span>].sum) &#123;</span><br><span class="line">                <span class="keyword">if</span> (student[i].cn &lt; student[i + <span class="number">1</span>].cn) &#123;</span><br><span class="line">                    <span class="built_in">swap</span>(&amp;student[i], &amp;student[i + <span class="number">1</span>]);</span><br><span class="line">                    in = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (student[i].cn == student[i + <span class="number">1</span>].cn &amp;&amp; student[i].index &gt; student[i + <span class="number">1</span>].index) &#123;</span><br><span class="line">                    <span class="built_in">swap</span>(&amp;student[i], &amp;student[i + <span class="number">1</span>]);</span><br><span class="line">                    in = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, student[i].index, student[i].sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1781-宇宙选举"><a href="#洛谷P1781-宇宙选举" class="headerlink" title="洛谷P1781 宇宙选举"></a>洛谷P1781 宇宙选举</h4><p>本来以为非常简单，但是发现涉及大整数处理（如果用python这种就丝毫没有问题）</p><p>只要选出一个，所以找出max就可以了，应该不用排序</p><p>感觉指针这种东西挺奇妙，结构体配上数组直接整死我。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">per</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">char</span> vote[<span class="number">1000</span>];</span><br><span class="line">&#125;person[<span class="number">25</span>];</span><br><span class="line"></span><br><span class="line">per <span class="title function_">max</span><span class="params">(per a,per b)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(a.vote)&gt;<span class="built_in">strlen</span>(b.vote))</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strlen</span>(a.vote)&lt;<span class="built_in">strlen</span>(b.vote))</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(a.vote, b.vote) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        person[i].index=i+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,person[i].vote);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(person[<span class="number">24</span>].vote,person[<span class="number">0</span>].vote);</span><br><span class="line">    person[<span class="number">24</span>].index=person[<span class="number">0</span>].index;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        person[<span class="number">24</span>].index=max(person[<span class="number">24</span>],person[i]).index;</span><br><span class="line">        <span class="built_in">strcpy</span>(person[<span class="number">24</span>].vote,max(person[<span class="number">24</span>],person[i]).vote);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,person[<span class="number">24</span>].index);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,person[<span class="number">24</span>].vote);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1104-生日"><a href="#洛谷P1104-生日" class="headerlink" title="洛谷P1104 生日"></a>洛谷P1104 生日</h4><p>可以用结构体做，用快排，之前写过一个了，不过这次想用c++的sort()试一下，就当自己练练c++的语法。</p><p>自己写一个cmp就可以了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span>  <span class="comment">//万能头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std; <span class="comment">//没有这个底下的就都要std::</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">per</span> &#123;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="type">int</span> y, m, d, index;</span><br><span class="line">&#125; person[<span class="number">200</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(per a, per b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.y &lt; b.y)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (a.y &gt; b.y)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (a.y == b.y) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.m &lt; b.m)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (a.m &gt; b.m)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (a.m == b.m) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a.d &lt; b.d)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (a.d &gt; b.d)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (a.d == b.d) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a.index &gt; b.index)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; person[i].s &gt;&gt; person[i].y &gt;&gt; person[i].m &gt;&gt; person[i].d;</span><br><span class="line">        person[i].index = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(person + <span class="number">1</span>, person + n + <span class="number">1</span>, cmp);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)cout &lt;&lt; person[i].s &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="反思："><a href="#反思：" class="headerlink" title="反思："></a>反思：</h4><p>这种题可以用数学思维附上加权，然后排序就可以了，（通俗说就是加权加到一科考好就可以在其他科不考的情况下卷赢其他人）</p><p>貌似要多条件排序都可以这样做，比如</p><p>year*10000+mouth*100+day</p><p>如果部分条件是倒序就减掉就可以了:</p><p>score*10000+(10000-index)</p><h4 id="洛谷P1116-车厢重组"><a href="#洛谷P1116-车厢重组" class="headerlink" title="洛谷P1116 车厢重组"></a>洛谷P1116 车厢重组</h4><p>冒泡排序，加个count就可以了，单纯想熟悉一下</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>*a,<span class="type">int</span>*b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = *a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bubble_sort</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> in = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (in) &#123;</span><br><span class="line">        in = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; arr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                in = <span class="number">1</span>;</span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="built_in">swap</span>(&amp;arr[i],&amp;arr[i+<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">int</span> car[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;car[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">bubble_sort</span>(car,n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,cnt);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P1068-分数线划定"><a href="#洛谷P1068-分数线划定" class="headerlink" title="洛谷P1068 分数线划定"></a>洛谷P1068 分数线划定</h4><p>又是结构体。。。那就用加权吧（</p><p>要注意weight[d-1]，用d就错了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> weight[<span class="number">5010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quicksort</span><span class="params">(<span class="type">int</span> arr[],<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> pivot = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &gt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &gt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quicksort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;a,&amp;b);</span><br><span class="line">        weight[i]=(b+<span class="number">1</span>)*<span class="number">10000</span>-a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quicksort</span>(weight,n);</span><br><span class="line">    <span class="type">int</span> d=(<span class="type">int</span>)m*<span class="number">1.5</span>;</span><br><span class="line">    <span class="type">int</span> score=weight[d<span class="number">-1</span>]/<span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">while</span> (weight[d<span class="number">-1</span>]/<span class="number">10000</span>==score) &#123;</span><br><span class="line">        d++;</span><br><span class="line">    &#125;</span><br><span class="line">    d--;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,weight[d<span class="number">-1</span>]/<span class="number">10000</span>,d);</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (weight[i]/<span class="number">10000</span>&gt;=score)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,<span class="number">10000</span>-weight[i]%<span class="number">10000</span>,weight[i]/<span class="number">10000</span>);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="洛谷P5143-攀爬者"><a href="#洛谷P5143-攀爬者" class="headerlink" title="洛谷P5143 攀爬者"></a>洛谷P5143 攀爬者</h4><p>又是结构体？感觉挺简单，却是个提高题</p><p>用加权，然后把距离加起来就可以了</p><p>后面的测试数据好大，用longlong</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">long</span> <span class="type">long</span> *a,<span class="type">long</span> <span class="type">long</span> *b)</span></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> t=*a;</span><br><span class="line">    *a=*b;</span><br><span class="line">    *b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">long</span> <span class="type">long</span> arr[],<span class="type">long</span> <span class="type">long</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">const</span> <span class="type">long</span> <span class="type">long</span> pivot = arr[<span class="built_in">rand</span>() % len];</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = len;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; pivot)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[j]);</span><br><span class="line">            i++;j++;&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &lt; arr[i])&#123;</span><br><span class="line">            <span class="built_in">swap</span>(&amp;arr[i], &amp;arr[k<span class="number">-1</span>]);</span><br><span class="line">            k--;&#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(arr + k, len - k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> location[n+<span class="number">1</span>];</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> x,y,z;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">        location[i]=z*<span class="number">100000000</span>+y*<span class="number">10000</span>+x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(location,n);</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> z1=location[i]/<span class="number">100000000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> y1=(location[i]%<span class="number">100000000</span>)/<span class="number">10000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> x1=(location[i]%<span class="number">100000000</span>)%<span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> z2=location[i+<span class="number">1</span>]/<span class="number">100000000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> y2=(location[i+<span class="number">1</span>]%<span class="number">100000000</span>)/<span class="number">10000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> x2=(location[i+<span class="number">1</span>]%<span class="number">100000000</span>)%<span class="number">10000</span>;</span><br><span class="line">        sum+=<span class="built_in">sqrt</span>(<span class="number">1.0</span>*((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)+(z2-z1)*(z2-z1)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.3Lf&quot;</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 排序 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用hexo搭建个人网站</title>
      <link href="/2020/12/c03d6b73cca7/"/>
      <url>/2020/12/c03d6b73cca7/</url>
      
        <content type="html"><![CDATA[<h1 id="用hexo搭建个人网站"><a href="#用hexo搭建个人网站" class="headerlink" title="用hexo搭建个人网站"></a>用hexo搭建个人网站</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>未成年，所以域名无法备案，然后网站前几天挂了，本来想用来做新生实践课的大作业，然而ddl</p><p>来了，网站却用不了</p><p>虽然我启用了81端口，nginx也监听了相应端口，然而WordPress却没有改配置（踩坑）。于是进去后就只是一个html。。WordPress管理端是默认端口，于是也没办法管了，只好迅速配一个hexo，刚好自己也准备做一个，只不过太忙了（所以现在更忙了，淦）</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>你需要github或者gitee的账号，以及git的基本操作知识</p><p>我的环境是Ubuntu。</p><p>要求：最新版本的nodejs、npm、git。具体安装 or 更新方法不在此赘述。</p><p><strong>请在自己的电脑上！而不是云服务器！</strong></p><p>使用npm安装hexo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g hexo -cil</span><br></pre></td></tr></table></figure><h2 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h2><p><strong>请全部用sudo（不然会出现权限问题）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init &lt;folder&gt;</span><br><span class="line">cd &lt;folder&gt;</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>若报错:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.js:39</span><br><span class="line">throw new ERR_CONSOLE_WRITABLE_STREAM(&#x27;stdout&#x27;);</span><br><span class="line">^</span><br><span class="line"></span><br><span class="line">TypeError [ERR_CONSOLE_WRITABLE_STREAM]: Console expects a writable stream instance for stdout</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>请更新npm和nodejs</p><p><strong>同时请保证文件夹内是空的！</strong></p><p>新建完成后，指定文件夹的目录如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   ├── _drafts</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure><p><strong>_config.yml</strong>：网站的 <a href="https://hexo.io/zh-cn/docs/configuration">配置</a> 信息，您可以在此配置大部分的参数</p><p>启动服务器。在路径下，命令行（即Git Bash）输入以下命令，运行即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>浏览器访问网址： <code>http://localhost:4000/</code></p><p>至此，您的Hexo博客已经搭建在本地。</p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>gitee新建仓库，名为自己的用户名</p><p>进入项目文件夹：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim _config.yml </span><br></pre></td></tr></table></figure><p>编辑theme来修改主题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: volantis</span><br></pre></td></tr></table></figure><p>终端输入（<strong>要在项目文件夹</strong>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-theme-volantis</span><br></pre></td></tr></table></figure><p>编辑<code>_config.yml</code> ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@gitee.com:himmi/himmi.git #或者https等等</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><p>安装插件,要在<strong>站点目录</strong>下执行以上安装:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>如果已经在其他目录安装了<code>hexo-deployer-git</code>插件，可以使用以下命令卸载该插件：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo hexo deploy</span><br></pre></td></tr></table></figure><p>至此，部署完毕。</p><p>剩下的配置请参考hexo的doc，主题的配置参考各自的doc（其实配置才是折腾的地方）</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://hexo.io/zh-cn/">https://hexo.io/zh-cn/</a></p><p><a href="https://www.simon96.online/2018/10/12/hexo-tutorial/">https://www.simon96.online/2018/10/12/hexo-tutorial/</a></p><p><a href="https://gitee.com/help/articles/4136#article-header3">https://gitee.com/help/articles/4136#article-header3</a></p><p><a href="https://blog.csdn.net/mqdxiaoxiao/article/details/95781368">https://blog.csdn.net/mqdxiaoxiao/article/details/95781368</a></p><p><a href="https://segmentfault.com/a/1190000011203711">https://segmentfault.com/a/1190000011203711</a></p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为网站配置https/http2</title>
      <link href="/2020/11/7b98a429154f/"/>
      <url>/2020/11/7b98a429154f/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前建站的时候就配过了一次了，刚好新人任务有要求，就简单记录一下</p><p>https由于传输原理的问题会比http要慢，在2012年谷歌提出SPDY的方案来应对https存在的延迟等问题。http2相比于https有了一些新特性。于是这里配置http2. </p><h2 id="配置http2"><a href="#配置http2" class="headerlink" title="配置http2"></a>配置http2</h2><p>使用免费的<a class="wp-editor-md-post-content-link" href="https://letsencrypt.org/">Let’s Encrypt</a>，在官网中会告诉你用 <a class="wp-editor-md-post-content-link" href="https://certbot.eff.org/">Certbot</a> ACME 客户端自动配置，进去选择自己的nginx版本和系统版本就好了。页面上会出现操作步骤。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install core;</span><br><span class="line">sudo snap refresh core</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install --classic certbot </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /snap/bin/certbot /usr/bin/certbot</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx</span><br></pre></td></tr></table></figure><p>于是certbot就自动配置好nginx </p><p>使用这个来自动续订：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew --dry-run</span><br></pre></td></tr></table></figure><hr>我们也可以手动折腾一下。<p>申请证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx --register-unsafely-without-email certonly</span><br></pre></td></tr></table></figure><p>选择对应的nginx配置文件（注意，它需要是正确可用的配置，可以执行<code>sudo nginx -t</code>来检查配置），此后letsencrypt证书将会自动生成在<code>/etc/letsencrypt/live/your_conf_file</code>中。</p><p>基本配置:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>; </span><br><span class="line">    <span class="attribute">server_name</span> yoursite;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2; </span><br><span class="line">    <span class="attribute">server_name</span> yoursite; </span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/your_conf_file/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your_conf_file/privkey.pem;</span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf;</span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此时https已配置完成。</p></blockquote><p>禁止不安全的协议:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4&#x27;</span>; </span><br></pre></td></tr></table></figure><p>启用HSTS:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>; </span><br><span class="line"><span class="attribute">add_header</span> Strict-Transport-Security max-age=<span class="number">15768000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>; </span><br><span class="line"><span class="attribute">server_name</span> yoursite;</span><br><span class="line"><span class="attribute">add_header</span> Strict-Transport-Security max-age=<span class="number">15768000</span>; </span><br><span class="line"><span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>  其他的安全配置</p></blockquote><p>缓存连接凭据:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">20m</span>;</span><br><span class="line"><span class="attribute">ssl_session_timeout</span> <span class="number">60m</span>;</span><br></pre></td></tr></table></figure><p>配置赫尔曼密钥:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">openssl</span> dhparam -out dhparam.pem <span class="number">2048</span> <span class="comment">#在 ssh 运行， openssl 生成 2048 位的密钥而不是当作参数写入 nginx.conf 文件</span></span><br><span class="line">ssl_dhparam /path/to/dhparam.pem; <span class="comment">#在 .conf 中配置</span></span><br></pre></td></tr></table></figure><p>OCSP 缝合</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>; </span><br><span class="line"><span class="attribute">ssl_trusted_certificate</span> /etc/nginx/cert/trustchain.crt; </span><br><span class="line"><span class="attribute">resolver</span> <span class="number">233.5.5.5</span> <span class="number">233.6.6.6</span> valid=<span class="number">300s</span>;</span><br></pre></td></tr></table></figure><h2 id="泛域名证书"><a href="#泛域名证书" class="headerlink" title="泛域名证书"></a>泛域名证书</h2><p>certbot支持泛域名证书了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly --preferred-challenges dns --manual  -d *.k8s.ryaoknw.site --server https://acme-v02.api.letsencrypt.org/directory</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>note:图解HTTP(1)</title>
      <link href="/2020/11/e7a4c959b321/"/>
      <url>/2020/11/e7a4c959b321/</url>
      
        <content type="html"><![CDATA[<h2 id="报文和实体的差别"><a href="#报文和实体的差别" class="headerlink" title="报文和实体的差别"></a>报文和实体的差别</h2><p>关于第三章中报文和实体的差别，书中讲得太简洁。</p><p><strong>报文</strong>要么是一个请求报文，要么就是一个响应报文。</p><p>一次传输中，在应用层来看，就是一个传输的单位（客户端请求服务器，是发送一个“请求报文”，服务器响应客户端，则发送“响应报文”），即为书中说的：</p><p>报文是HTTP通信中的基本单位，通过HTTP通信传输 实体其实是报文的一部分，存在于报文主体内 如一个GET请求报文中，就没有报文主体。<br>那么这种情况下，也就不存在实体 实体是作为请求或响应的有效载荷数据被传输 那么在如响应报文中有： </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain </span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>5 1234</span><br></pre></td></tr></table></figure><p> 那么1234就是实体。 实体的内容由实体首部和实体主体组成： 实体头部不一定会有。如上面“1234”这部分内容，就只有实体主体，没有实体头部。<br><strong>实体主体也确实等同于报文主体</strong>：在没有实体头部的时候就是这样 需要实体头部的场合，则是“传输中需要进行编码操作”的时候，如传输表单内容： </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /upload HTTP/1.1 </span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>example.com </span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>xxx </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=AaBbCcDd </span><br><span class="line">--AaBbCcDd </span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data; name=&quot;username&quot; RuphiLau </span><br><span class="line">--AaBbCcDd </span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data; name=&quot;file&quot;; filename=&quot;picture.jpg&quot; </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>image/jpeg ...(picture.jpg的数据)... </span><br><span class="line">--AaBbCcDd-- </span><br></pre></td></tr></table></figure><p>这个报文里有多个实体 实体里，也有实体头部、实体主体，同样是通过CR+LF分割。 在现在的http协议下，传输编码只有一种：<code>Transfer-Encoding: chunked</code> 在其他任何情况下，实体&#x3D;实体主体 <br> 而这就刚好对应了上文的：<strong>编码提升效率</strong> 也就是说,当实体(像图片,文本这种数据的载体)不进行编码时,传输数据按照原貌直接传输,报文主体和实体主体是同一样东西.但是为了提高传输效率,要对实体进行编码 比如说:一个图片按原文传输需要5个字节,编码以后传输就是3个字节了,相当于主体内容已经改变了,但是报文主体是不变的,已经发生了变化 </p><p><br> <br></p><h2 id="HSTS"><a href="#HSTS" class="headerlink" title="HSTS"></a>HSTS</h2><p> <strong>HTTP Strict Transport Security</strong>（HSTS）告诉浏览器只能通过HTTPS访问当前资源，而不是HTTP </p><p>配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=&lt;expire-time&gt;</span><br><span class="line">Strict-Transport-Security: max-age=&lt;expire-time&gt;; includeSubDomains</span><br><span class="line">Strict-Transport-Security: max-age=&lt;expire-time&gt;; preload</span><br></pre></td></tr></table></figure><blockquote><p>  简介</p></blockquote><p>一个网站接受一个HTTP的请求，然后跳转到HTTPS，用户可能在开始跳转前，通过没有加密的方式和服务器对话，比如，用户输入<a href="http://foo.com/">http://foo.com</a> 或者直接 foo.com。 </p><p>这样存在中间人攻击潜在威胁，跳转过程可能被恶意网站利用来直接接触用户信息，而不是原来的加密信息。</p><p> 网站通过HTTP Strict Transport Security通知浏览器，这个网站禁止使用HTTP方式加载，浏览器应该自动把所有尝试使用HTTP的请求自动替换为HTTPS请求</p><blockquote><p>  处理步骤</p></blockquote><p>你的网站第一次通过HTTPS请求，服务器响应<code>Strict-Transport-Security</code> 头，浏览器记录下这些信息，然后后面尝试访问这个网站的请求都会自动把HTTP替换为HTTPS。 </p><p>当HSTS头设置的过期时间到了，后面通过HTTP的访问恢复到正常模式，不会再自动跳转到HTTPS。 </p><p>每次浏览器接收到Strict-Transport-Security头，它都会更新这个网站的过期时间，所以网站可以刷新这些信息，防止过期发生。 </p><p>Chrome、Firefox等浏览器里，当您尝试访问该域名下的内容时，会产生一个307 Internal Redirect（内部跳转），自动跳转到HTTPS请求</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决网站配置完https后访问http失败</title>
      <link href="/2020/11/bbf6c1bf9db3/"/>
      <url>/2020/11/bbf6c1bf9db3/</url>
      
        <content type="html"><![CDATA[<p>报错如下： </p><p>解决办法： 在nginx里配置，让请求http的时候跳转到https就可以啦</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> ryaoknw.site; </span><br><span class="line"><span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意启用https和http的时候要把80和433端口开放</p><p>之后看了一下各个网站，采用的方式也是把http跳转到 https</p><hr><p>发现也可以直接在配置ssl的server块中监听80端口，自己当时的理解错了，url里的http和https只是指定协议，域名依旧是dns解析出来的ip地址，只要改一下端口就好了</p>]]></content>
      
      
      <categories>
          
          <category> 报错 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello, World!</title>
      <link href="/2020/11/f953da04e2b2/"/>
      <url>/2020/11/f953da04e2b2/</url>
      
        <content type="html"><![CDATA[<p><img src="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/1000600035f02b5989ae5.jpeg" class="lazyload" data-srcset="https://gitee.com/ryaochengfeng/ryao-image/raw/master/img/1000600035f02b5989ae5.jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>历经曲折，折腾了一个晚上加上一个下午，终于把博客建出来了。准备手动搭建环境，装好了nginx和mysql，php，但是最后的phpmyadmin总是有迷之问题，折腾了好久最终放弃</p><p>之后使用云帮手来无脑搭环境，然而云帮手果然出了各种问题。。。无奈之下回到了最初的宝塔面板，装好环境后自己搭了WordPress，配了ssl和</p><span id="more"></span><p>域名解析。期间域名解析配错了，又折腾了好久（还有v2ray开全局代理访问会爆500啊！）收获就是之后重装都异常熟练</p><p><img src="https://pic.downk.cc/item/5fce09ee3ffa7d37b3da8877.jpg" class="lazyload" data-srcset="https://pic.downk.cc/item/5fce09ee3ffa7d37b3da8877.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>再就是欢乐地选主题，换了三个siren，sakura和krato，而且最终也没有和ks和zcy一样用kale。还是用了krato，然后稍微折腾一下就成功了</p><p>算是完成了自己的一个浪漫。不过还是想之后有时间写静态页面的博客，但是最近ddl太！多！了！从开学到现在作息非常极客！急需时间管理大法。</p><p>之后有时间要陆陆续续地把自己的东西整理一下，搬到博客上来</p>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
